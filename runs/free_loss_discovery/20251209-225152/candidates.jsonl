{"generation": 0, "index": 0, "ir": {"name": "SigmoidAttenuatedMarginLoss", "intuition": "This loss function, inspired by contrastive learning principles, aims to create a 'margin' in the log-probability space that is proportional to the difference in solution quality (cost). It uses a sigmoid function to attenuate the influence of very large cost differences, preventing extreme gradients and ensuring numerical stability. The core idea is to push the log-probability of the better solution (lower cost) to be higher than the worse one by at least a dynamic margin determined by their cost gap. The softplus function ensures the loss is always non-negative and provides a smooth, convex penalty when the margin is violated.", "pseudocode": "def SigmoidAttenuatedMarginLoss(cost_a, cost_b, logp_a, logp_b, alpha, margin_scale):\n    # Ensure a is the better solution (winner) and b is the worse one (loser)\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # Calculate the normalized cost difference\n    cost_diff = cost_l - cost_w\n\n    # Use sigmoid to create a bounded, dynamic margin from the cost difference.\n    # The margin will be between 0 and margin_scale, scaling non-linearly.\n    # alpha controls the steepness of the sigmoid curve.\n    dynamic_margin = margin_scale * sigmoid(alpha * cost_diff)\n\n    # Calculate the difference in log probabilities\n    logp_diff = logp_w - logp_l\n\n    # The loss is the softplus of the margin minus the log-probability difference.\n    # This penalizes cases where logp_w is not sufficiently larger than logp_l.\n    # The penalty is zero if logp_w - logp_l >= dynamic_margin.\n    loss = softplus(dynamic_margin - logp_diff)\n\n    return loss", "hyperparams": {"alpha": 0.1, "margin_scale": 2.0}, "operators_used": ["sigmoid", "softplus"], "implementation_hint": {"expects": ["cost_a", "cost_b", "logp_a", "logp_b"], "returns": "A single scalar loss value."}}, "fitness": {"hf_like_score": 4.082624912261963, "validation_objective": 4.082624912261963, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.043498158454895}, "train_score_mean": 4.260003954172134, "train_loss_mean": 0.69259824603796, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "SigmoidAttenuatedMarginLoss", "intuition": "This loss function, inspired by contrastive learning principles, aims to create a 'margin' in the log-probability space that is proportional to the difference in solution quality (cost). It uses a sigmoid function to attenuate the influence of very large cost differences, preventing extreme gradients and ensuring numerical stability. The core idea is to push the log-probability of the better solution (lower cost) to be higher than the worse one by at least a dynamic margin determined by their cost gap. The softplus function ensures the loss is always non-negative and provides a smooth, convex penalty when the margin is violated.", "hyperparams": {"alpha": 0.1, "margin_scale": 2.0}, "operators_used": ["sigmoid", "softplus"]}}}
{"generation": 0, "index": 2, "ir": {"name": "AdaptiveMarginHingeLoss", "intuition": "This loss function, named 'Adaptive Margin Hinge Loss', is designed for robust preference learning in combinatorial optimization. Its core idea is to combine a hinge-loss structure with an adaptive margin that is sensitive to the magnitude of the cost difference. The loss penalizes the model only when its preference (indicated by log probability difference) contradicts the ground truth cost ordering. The 'margin' for this penalty is not fixed; instead, it's a sigmoid-scaled function of the normalized cost difference. This means that when two solutions have a very large, unambiguous cost difference, the model is pushed more strongly to respect this preference. Conversely, for solutions with very similar costs, the margin is small, preventing the model from overfitting to noisy or insignificant cost variations. The use of `tanh` on the log probability difference and `softplus` for the final loss calculation ensures that the entire function is smooth, differentiable, and numerically stable, avoiding issues with extreme input values.", "pseudocode": "def AdaptiveMarginHingeLoss(cost_a, cost_b, logp_a, logp_b, beta, tau):\n  # 1. Calculate cost difference and normalize it.\n  #    Use rank_gap for robust, rank-based difference. It's stable against outliers.\n  delta_cost = rank_gap(cost_a, cost_b) # Should be positive if cost_a < cost_b\n\n  # 2. Create an adaptive margin based on the cost difference.\n  #    The sigmoid function maps the cost difference to a (0, 1) range, acting as a confidence score.\n  #    This margin is larger for more significant cost differences.\n  adaptive_margin = sigmoid(delta_cost / tau)\n\n  # 3. Calculate the log probability difference and stabilize it.\n  #    tanh squashes the difference into a [-1, 1] range, preventing explosions from extreme logits.\n  delta_logp = tanh(logp_a - logp_b)\n\n  # 4. Define the core hinge-like term.\n  #    The loss is triggered only if the model's preference (delta_logp) is smaller than the required margin.\n  #    The term `adaptive_margin - delta_logp` captures the violation.\n  #    We scale it by beta to control the penalty strength.\n  violation = beta * (adaptive_margin - delta_logp)\n\n  # 5. Apply softplus to create a smooth, non-negative hinge loss.\n  #    softplus(x) is a smooth approximation of relu(x), i.e., max(0, x).\n  #    This ensures the loss is zero when the preference is correctly satisfied (delta_logp >= adaptive_margin)\n  #    and smoothly increases otherwise.\n  loss = softplus(violation)\n\n  return loss", "hyperparams": {"beta": {"value": 5.0, "description": "A scaling factor that controls the steepness of the loss. Higher values impose a stronger penalty for preference violations."}, "tau": {"value": 0.1, "description": "A temperature parameter for the sigmoid function that controls the sensitivity of the adaptive margin. Smaller values make the margin react more sharply to cost differences."}}, "operators_used": ["rank_gap", "sigmoid", "tanh", "softplus"], "implementation_hint": {"expects": ["cost_a", "cost_b", "logp_a", "logp_b"], "returns": "A scalar representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.094070196151733, "validation_objective": 4.094070196151733, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.036425352096558}, "train_score_mean": 4.221753835678101, "train_loss_mean": 0.6928238309919834, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveMarginHingeLoss", "intuition": "This loss function, named 'Adaptive Margin Hinge Loss', is designed for robust preference learning in combinatorial optimization. Its core idea is to combine a hinge-loss structure with an adaptive margin that is sensitive to the magnitude of the cost difference. The loss penalizes the model only when its preference (indicated by log probability difference) contradicts the ground truth cost ordering. The 'margin' for this penalty is not fixed; instead, it's a sigmoid-scaled function of the normalized cost difference. This means that when two solutions have a very large, unambiguous cost difference, the model is pushed more strongly to respect this preference. Conversely, for solutions with very similar costs, the margin is small, preventing the model from overfitting to noisy or insignificant cost variations. The use of `tanh` on the log probability difference and `softplus` for the final loss calculation ensures that the entire function is smooth, differentiable, and numerically stable, avoiding issues with extreme input values.", "hyperparams": {"beta": {"value": 5.0, "description": "A scaling factor that controls the steepness of the loss. Higher values impose a stronger penalty for preference violations."}, "tau": {"value": 0.1, "description": "A temperature parameter for the sigmoid function that controls the sensitivity of the adaptive margin. Smaller values make the margin react more sharply to cost differences."}}, "operators_used": ["rank_gap", "sigmoid", "tanh", "softplus"]}}}
{"generation": 0, "index": 3, "ir": {"name": "SigmoidClippedMarginLoss", "intuition": "This loss function aims to combine the stability of sigmoid scaling with the clear separation objective of a margin-based loss. It first normalizes the cost difference using a sigmoid function, which maps any cost gap into a bounded range (0, 1), preventing extreme cost differences from dominating the gradient. This normalized cost difference then acts as a dynamic, data-driven margin. The core idea is that a larger, more confident cost difference (e.g., cost(a) is much better than cost(b)) should demand a proportionally larger log probability difference in favor of the better solution. The final loss is calculated using `softplus`, which is a smooth and non-negative approximation of ReLU, ensuring the loss is zero only when the log probability difference correctly exceeds the required dynamic margin. Clipping the logit difference prevents exploding gradients from extremely confident but wrong model predictions.", "pseudocode": "def SigmoidClippedMarginLoss(cost_a, cost_b, logp_a, logp_b, beta, margin_scale, clip_value):\n    # 1. Calculate the log probability difference, representing the model's current preference.\n    logit_diff = logp_a - logp_b\n\n    # 2. Normalize the cost difference using a scaled sigmoid. This creates a target margin.\n    # The sign is flipped so that cost_a < cost_b results in a positive target_margin.\n    cost_diff_scaled = beta * (cost_b - cost_a)\n    target_margin = margin_scale * sigmoid(cost_diff_scaled)\n\n    # 3. Clip the logit difference to prevent extreme values from causing instability.\n    logit_diff_clipped = clamp(logit_diff, -clip_value, clip_value)\n\n    # 4. The loss is activated when the model's preference (logit_diff_clipped) doesn't meet the target margin.\n    # softplus(x) = log(1 + exp(x)). We want logit_diff_clipped > target_margin.\n    # So the argument to softplus should be -(logit_diff_clipped - target_margin), which is (target_margin - logit_diff_clipped).\n    loss = softplus(target_margin - logit_diff_clipped)\n\n    return loss", "hyperparams": {"beta": 1.0, "margin_scale": 5.0, "clip_value": 10.0}, "operators_used": ["sigmoid", "softplus", "clamp"], "implementation_hint": {"expects": ["cost_a", "cost_b", "logp_a", "logp_b"], "returns": "scalar_loss"}}, "fitness": {"hf_like_score": 4.148866653442383, "validation_objective": 4.148866653442383, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.087788343429565}, "train_score_mean": 4.306258969008923, "train_loss_mean": 0.6927731800824404, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "SigmoidClippedMarginLoss", "intuition": "This loss function aims to combine the stability of sigmoid scaling with the clear separation objective of a margin-based loss. It first normalizes the cost difference using a sigmoid function, which maps any cost gap into a bounded range (0, 1), preventing extreme cost differences from dominating the gradient. This normalized cost difference then acts as a dynamic, data-driven margin. The core idea is that a larger, more confident cost difference (e.g., cost(a) is much better than cost(b)) should demand a proportionally larger log probability difference in favor of the better solution. The final loss is calculated using `softplus`, which is a smooth and non-negative approximation of ReLU, ensuring the loss is zero only when the log probability difference correctly exceeds the required dynamic margin. Clipping the logit difference prevents exploding gradients from extremely confident but wrong model predictions.", "hyperparams": {"beta": 1.0, "margin_scale": 5.0, "clip_value": 10.0}, "operators_used": ["sigmoid", "softplus", "clamp"]}}}
{"generation": 1, "index": 0, "ir": {"name": "ZScoreStabilizedBradleyTerryLoss", "intuition": "\u672c\u635f\u5931\u51fd\u6570\u65e8\u5728\u5c06\u7ecf\u5178\u7684 Bradley-Terry \u6a21\u578b\uff08\u5e38\u7528\u4e8e\u6210\u5bf9\u6bd4\u8f83\uff09\u4e0e\u73b0\u4ee3\u6df1\u5ea6\u5b66\u4e60\u4e2d\u7684\u7a33\u5b9a\u5316\u6280\u5de7\u548c\u81ea\u9002\u5e94\u7279\u6027\u76f8\u7ed3\u5408\u3002\u5176\u6838\u5fc3\u601d\u60f3\u662f\uff0c\u4e00\u4e2a\u89e3\u4f18\u4e8e\u53e6\u4e00\u4e2a\u89e3\u7684\u6982\u7387\uff0c\u5e94\u8be5\u4e0e\u5b83\u4eec\u7684\u5206\u6570\uff08logits\uff09\u4e4b\u5dee\u7684 sigmoid \u51fd\u6570\u6210\u6b63\u6bd4\u3002\u5b50\u4ee3\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u8bbe\u8ba1\u601d\u60f3\uff1a1. **\u7ee7\u627f\u81ea SigmoidAttenuatedMarginLoss**\uff1a\u5b50\u4ee3\u7ee7\u627f\u4e86\u5176\u4f7f\u7528 `softplus` \u6784\u9020\u4e00\u4e2a\u5e73\u6ed1\u3001\u975e\u8d1f\u7684\u635f\u5931\uff0c\u5f53\u6a21\u578b\u9884\u6d4b\u7684\u504f\u597d\u4e0e\u771f\u5b9e\u6210\u672c\u5dee\u5f02\u4e0d\u7b26\u65f6\u65bd\u52a0\u60e9\u7f5a\u7684\u6838\u5fc3\u7ed3\u6784\u3002\u635f\u5931\u7684\u5f62\u5f0f `softplus(margin - logp_diff)` \u88ab\u501f\u9274\u548c\u6539\u9020\u30022. **\u7ee7\u627f\u81ea AdaptiveMarginHingeLoss**\uff1a\u5b50\u4ee3\u501f\u9274\u4e86\u5176\u5bf9\u6a21\u578b\u8f93\u51fa\uff08log-probabilities\uff09\u8fdb\u884c\u7a33\u5b9a\u5316\u5904\u7406\u7684\u601d\u60f3\u3002\u7236\u4ee3\u4f7f\u7528\u4e86 `tanh` \u6765\u538b\u7f29 `logp` \u5dee\u5f02\uff0c\u800c\u5b50\u4ee3\u91c7\u7528\u4e86 `zscore` \u5f52\u4e00\u5316\uff0c\u8fd9\u662f\u4e00\u79cd\u66f4\u5f3a\u7684\u7edf\u8ba1\u7a33\u5b9a\u5316\u65b9\u6cd5\uff0c\u53ef\u4ee5\u4f7f `logp` \u7684\u5206\u5e03\u66f4\u52a0\u89c4\u8303\uff0c\u4ece\u800c\u7a33\u5b9a\u8bad\u7ec3\u8fc7\u7a0b\u3002\u65b0\u7684\u8026\u5408\u70b9\u548c\u6539\u52a8\u5305\u62ec\uff1a1. **\u65b0\u7684\u8026\u5408\u70b9 (Bradley-Terry \u6846\u67b6)**\uff1a\u6211\u4eec\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528 `logp` \u5dee\u5f02\uff0c\u800c\u662f\u5c06 `logp` \u5dee\u5f02 `(logp_w - logp_l)` \u653e\u5165 `logsigmoid` \u51fd\u6570\u4e2d\uff0c\u8fd9\u7b49\u4ef7\u4e8e `log(sigmoid(logp_w - logp_l))`\u3002\u8fd9\u6b63\u662f Bradley-Terry \u6a21\u578b\u4e2d\u201cw \u4f18\u4e8e l\u201d\u7684\u5bf9\u6570\u6982\u7387\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u7684\u4f18\u5316\u76ee\u6807\u5728\u6982\u7387\u610f\u4e49\u4e0a\u66f4\u52a0\u660e\u786e\uff1a\u6700\u5927\u5316\u6b63\u786e\u6392\u5e8f\u7684\u5bf9\u6570\u6982\u7387\u30022. **\u65b0\u7684\u8026\u5408\u70b9 (Rank-Gap Margin)**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u539f\u59cb\u7684\u6210\u672c\u5dee\u5f02\uff0c\u800c\u662f\u5f15\u5165\u4e86 `rank_gap` \u7b97\u5b50\u6765\u8ba1\u7b97\u4e00\u4e2a\u9c81\u68d2\u7684\u3001\u57fa\u4e8e\u6392\u5e8f\u7684\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a margin\u3002\u8fd9\u4f7f\u5f97 margin \u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\uff0c\u53ea\u5173\u5fc3\u5176\u76f8\u5bf9\u6392\u5e8f\u5dee\u8ddd\uff0c\u589e\u5f3a\u4e86\u5bf9\u5f02\u5e38\u6210\u672c\u503c\u7684\u9c81\u68d2\u6027\u3002\u8d85\u53c2\u6570 `beta` \u63a7\u5236\u4e86\u8fd9\u4e2a margin \u7684\u5f3a\u5ea6\u3002\u7efc\u4e0a\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u5c06 Bradley-Terry \u7684\u6982\u7387\u6846\u67b6\u4e0e `zscore` \u7a33\u5b9a\u5316\u3001`rank_gap` \u9c81\u68d2 margin \u548c `softplus` \u5e73\u6ed1\u60e9\u7f5a\u7ed3\u5408\u5728\u4e00\u8d77\uff0c\u65e8\u5728\u5b9e\u73b0\u7a33\u5b9a\u3001\u9c81\u68d2\u4e14\u5177\u6709\u660e\u786e\u6982\u7387\u89e3\u91ca\u7684\u504f\u597d\u5b66\u4e60\u3002", "pseudocode": "def ZScoreStabilizedBradleyTerryLoss(cost_a, cost_b, logp_a, logp_b, beta, epsilon):\n    # \u786e\u4fdd w \u662f\u66f4\u4f18\u89e3 (winner), l \u662f\u6b21\u4f18\u89e3 (loser)\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 1. (\u7ee7\u627f\u81ea AdaptiveMarginHingeLoss \u7684\u7a33\u5b9a\u5316\u601d\u60f3\uff0c\u4f46\u4f7f\u7528\u65b0\u7b97\u5b50)\n    #    \u5bf9 log-probabilities \u8fdb\u884c Z-Score \u5f52\u4e00\u5316\uff0c\u4ee5\u7a33\u5b9a\u8bad\u7ec3\u3002\n    #    \u8fd9\u4f7f\u5f97\u6a21\u578b\u8f93\u51fa\u7684\u5206\u5e03\u66f4\u52a0\u89c4\u8303\uff0c\u907f\u514d\u6781\u7aef\u503c\u5f71\u54cd\u3002\n    logp_w_norm, logp_l_norm = zscore([logp_w, logp_l])\n\n    # 2. (\u65b0\u7684\u8026\u5408\u70b9\uff1aBradley-Terry \u6982\u7387\u6846\u67b6)\n    #    \u8ba1\u7b97\u6a21\u578b\u9884\u6d4b\u7684\u201cw \u4f18\u4e8e l\u201d\u7684\u5bf9\u6570\u6982\u7387\u3002\n    #    logsigmoid(x) = log(sigmoid(x))\uff0c\u6570\u503c\u4e0a\u6bd4 log(sigmoid(x)) \u66f4\u7a33\u5b9a\u3002\n    log_prob_w_beats_l = logsigmoid(logp_w_norm - logp_l_norm)\n\n    # 3. (\u65b0\u7684\u8026\u5408\u70b9\uff1aRank-Gap Margin)\n    #    \u4f7f\u7528 rank_gap \u8ba1\u7b97\u4e00\u4e2a\u9c81\u68d2\u7684\u3001\u57fa\u4e8e\u6392\u5e8f\u7684\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a\u76ee\u6807 margin\u3002\n    #    \u8fd9\u6bd4\u76f4\u63a5\u4f7f\u7528 cost_diff \u66f4\u80fd\u62b5\u6297\u5f02\u5e38\u503c\u3002\n    #    beta \u63a7\u5236\u4e86\u8fd9\u4e2a\u76ee\u6807 margin \u7684\u91cd\u8981\u6027\u3002\n    target_margin = beta * rank_gap(cost_w, cost_l)\n\n    # 4. (\u7ee7\u627f\u81ea SigmoidAttenuatedMarginLoss \u7684 softplus \u7ed3\u6784)\n    #    \u635f\u5931\u51fd\u6570\u60e9\u7f5a\u7684\u662f\u6a21\u578b\u9884\u6d4b\u7684\u5bf9\u6570\u6982\u7387\u4e0e\u76ee\u6807 margin \u4e4b\u95f4\u7684\u5dee\u8ddd\u3002\n    #    \u6211\u4eec\u5e0c\u671b log_prob_w_beats_l \u5c3d\u53ef\u80fd\u5927\uff08\u63a5\u8fd10\uff09\uff0c\u56e0\u6b64\u635f\u5931\u662f softplus(target_margin - log_prob_w_beats_l)\u3002\n    #    \u5f53\u6a21\u578b\u9884\u6d4b\u7684\u504f\u597d\u5f3a\u5ea6\u4e0d\u8db3\uff08log_prob_w_beats_l \u8fc7\u5c0f\uff0c\u5373\u8d1f\u5f97\u592a\u591a\uff09\u65f6\uff0c\u4ea7\u751f\u635f\u5931\u3002\n    #    \u6ce8\u610f\uff1alogsigmoid \u7684\u8f93\u51fa\u662f\u8d1f\u6570\uff0c\u6240\u4ee5 `target_margin - log_prob_w_beats_l` \u603b\u662f\u6b63\u6570\u3002\n    loss = softplus(target_margin - log_prob_w_beats_l)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50\uff0c\u7528\u4e8e\u8c03\u8282\u57fa\u4e8e rank_gap \u7684\u76ee\u6807 margin \u7684\u5f3a\u5ea6\u3002\u503c\u8d8a\u5927\uff0c\u6a21\u578b\u8d8a\u88ab\u6fc0\u52b1\u53bb\u5339\u914d\u7531\u6210\u672c\u6392\u5e8f\u5dee\u5f02\u5b9a\u4e49\u7684\u504f\u597d\u5f3a\u5ea6\u3002"}, "epsilon": {"value": 1e-06, "description": "\u4e00\u4e2a\u5c0f\u7684\u5e38\u6570\uff0c\u7528\u4e8e\u5728 zscore \u8ba1\u7b97\u4e2d\u9632\u6b62\u9664\u4ee5\u96f6\uff0c\u4fdd\u8bc1\u6570\u503c\u7a33\u5b9a\u6027\u3002"}}, "operators_used": ["zscore", "logsigmoid", "rank_gap", "softplus"], "implementation_hint": {"expects": ["cost_a, cost_b (scalars), logp_a, logp_b (scalars representing model logits/scores for solutions a and b). These scalars can be part of larger tensors for batched operations."], "returns": "A scalar loss value for the pair, which is differentiable with respect to logp_a and logp_b."}}, "fitness": {"hf_like_score": 4.118204593658447, "validation_objective": 4.118204593658447, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.0690730810165405}, "train_score_mean": 4.28029315918684, "train_loss_mean": 0.6928157955408096, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreStabilizedBradleyTerryLoss", "intuition": "\u672c\u635f\u5931\u51fd\u6570\u65e8\u5728\u5c06\u7ecf\u5178\u7684 Bradley-Terry \u6a21\u578b\uff08\u5e38\u7528\u4e8e\u6210\u5bf9\u6bd4\u8f83\uff09\u4e0e\u73b0\u4ee3\u6df1\u5ea6\u5b66\u4e60\u4e2d\u7684\u7a33\u5b9a\u5316\u6280\u5de7\u548c\u81ea\u9002\u5e94\u7279\u6027\u76f8\u7ed3\u5408\u3002\u5176\u6838\u5fc3\u601d\u60f3\u662f\uff0c\u4e00\u4e2a\u89e3\u4f18\u4e8e\u53e6\u4e00\u4e2a\u89e3\u7684\u6982\u7387\uff0c\u5e94\u8be5\u4e0e\u5b83\u4eec\u7684\u5206\u6570\uff08logits\uff09\u4e4b\u5dee\u7684 sigmoid \u51fd\u6570\u6210\u6b63\u6bd4\u3002\u5b50\u4ee3\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u8bbe\u8ba1\u601d\u60f3\uff1a1. **\u7ee7\u627f\u81ea SigmoidAttenuatedMarginLoss**\uff1a\u5b50\u4ee3\u7ee7\u627f\u4e86\u5176\u4f7f\u7528 `softplus` \u6784\u9020\u4e00\u4e2a\u5e73\u6ed1\u3001\u975e\u8d1f\u7684\u635f\u5931\uff0c\u5f53\u6a21\u578b\u9884\u6d4b\u7684\u504f\u597d\u4e0e\u771f\u5b9e\u6210\u672c\u5dee\u5f02\u4e0d\u7b26\u65f6\u65bd\u52a0\u60e9\u7f5a\u7684\u6838\u5fc3\u7ed3\u6784\u3002\u635f\u5931\u7684\u5f62\u5f0f `softplus(margin - logp_diff)` \u88ab\u501f\u9274\u548c\u6539\u9020\u30022. **\u7ee7\u627f\u81ea AdaptiveMarginHingeLoss**\uff1a\u5b50\u4ee3\u501f\u9274\u4e86\u5176\u5bf9\u6a21\u578b\u8f93\u51fa\uff08log-probabilities\uff09\u8fdb\u884c\u7a33\u5b9a\u5316\u5904\u7406\u7684\u601d\u60f3\u3002\u7236\u4ee3\u4f7f\u7528\u4e86 `tanh` \u6765\u538b\u7f29 `logp` \u5dee\u5f02\uff0c\u800c\u5b50\u4ee3\u91c7\u7528\u4e86 `zscore` \u5f52\u4e00\u5316\uff0c\u8fd9\u662f\u4e00\u79cd\u66f4\u5f3a\u7684\u7edf\u8ba1\u7a33\u5b9a\u5316\u65b9\u6cd5\uff0c\u53ef\u4ee5\u4f7f `logp` \u7684\u5206\u5e03\u66f4\u52a0\u89c4\u8303\uff0c\u4ece\u800c\u7a33\u5b9a\u8bad\u7ec3\u8fc7\u7a0b\u3002\u65b0\u7684\u8026\u5408\u70b9\u548c\u6539\u52a8\u5305\u62ec\uff1a1. **\u65b0\u7684\u8026\u5408\u70b9 (Bradley-Terry \u6846\u67b6)**\uff1a\u6211\u4eec\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528 `logp` \u5dee\u5f02\uff0c\u800c\u662f\u5c06 `logp` \u5dee\u5f02 `(logp_w - logp_l)` \u653e\u5165 `logsigmoid` \u51fd\u6570\u4e2d\uff0c\u8fd9\u7b49\u4ef7\u4e8e `log(sigmoid(logp_w - logp_l))`\u3002\u8fd9\u6b63\u662f Bradley-Terry \u6a21\u578b\u4e2d\u201cw \u4f18\u4e8e l\u201d\u7684\u5bf9\u6570\u6982\u7387\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u7684\u4f18\u5316\u76ee\u6807\u5728\u6982\u7387\u610f\u4e49\u4e0a\u66f4\u52a0\u660e\u786e\uff1a\u6700\u5927\u5316\u6b63\u786e\u6392\u5e8f\u7684\u5bf9\u6570\u6982\u7387\u30022. **\u65b0\u7684\u8026\u5408\u70b9 (Rank-Gap Margin)**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u539f\u59cb\u7684\u6210\u672c\u5dee\u5f02\uff0c\u800c\u662f\u5f15\u5165\u4e86 `rank_gap` \u7b97\u5b50\u6765\u8ba1\u7b97\u4e00\u4e2a\u9c81\u68d2\u7684\u3001\u57fa\u4e8e\u6392\u5e8f\u7684\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a margin\u3002\u8fd9\u4f7f\u5f97 margin \u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\uff0c\u53ea\u5173\u5fc3\u5176\u76f8\u5bf9\u6392\u5e8f\u5dee\u8ddd\uff0c\u589e\u5f3a\u4e86\u5bf9\u5f02\u5e38\u6210\u672c\u503c\u7684\u9c81\u68d2\u6027\u3002\u8d85\u53c2\u6570 `beta` \u63a7\u5236\u4e86\u8fd9\u4e2a margin \u7684\u5f3a\u5ea6\u3002\u7efc\u4e0a\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u5c06 Bradley-Terry \u7684\u6982\u7387\u6846\u67b6\u4e0e `zscore` \u7a33\u5b9a\u5316\u3001`rank_gap` \u9c81\u68d2 margin \u548c `softplus` \u5e73\u6ed1\u60e9\u7f5a\u7ed3\u5408\u5728\u4e00\u8d77\uff0c\u65e8\u5728\u5b9e\u73b0\u7a33\u5b9a\u3001\u9c81\u68d2\u4e14\u5177\u6709\u660e\u786e\u6982\u7387\u89e3\u91ca\u7684\u504f\u597d\u5b66\u4e60\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50\uff0c\u7528\u4e8e\u8c03\u8282\u57fa\u4e8e rank_gap \u7684\u76ee\u6807 margin \u7684\u5f3a\u5ea6\u3002\u503c\u8d8a\u5927\uff0c\u6a21\u578b\u8d8a\u88ab\u6fc0\u52b1\u53bb\u5339\u914d\u7531\u6210\u672c\u6392\u5e8f\u5dee\u5f02\u5b9a\u4e49\u7684\u504f\u597d\u5f3a\u5ea6\u3002"}, "epsilon": {"value": 1e-06, "description": "\u4e00\u4e2a\u5c0f\u7684\u5e38\u6570\uff0c\u7528\u4e8e\u5728 zscore \u8ba1\u7b97\u4e2d\u9632\u6b62\u9664\u4ee5\u96f6\uff0c\u4fdd\u8bc1\u6570\u503c\u7a33\u5b9a\u6027\u3002"}}, "operators_used": ["zscore", "logsigmoid", "rank_gap", "softplus"]}}}
{"generation": 1, "index": 1, "ir": {"name": "RankScaledTanhMarginLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u878d\u5408\u4e86\u4e24\u79cd\u7236\u4ee3\u8bbe\u8ba1\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u65e8\u5728\u521b\u5efa\u4e00\u4e2a\u9c81\u68d2\u4e14\u9002\u5e94\u6027\u5f3a\u7684\u504f\u597d\u635f\u5931\u3002\u9996\u5148\uff0c\u5b83\u7ee7\u627f\u4e86 `AdaptiveMarginHingeLoss`\uff08\u7236\u4ee31\uff09\u4f7f\u7528 `rank_gap` \u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884c\u5f52\u4e00\u5316\u7684\u601d\u60f3\u3002\u8fd9\u79cd\u57fa\u4e8e\u79e9\u7684\u65b9\u6cd5\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\uff0c\u53ea\u5173\u6ce8\u5176\u76f8\u5bf9\u6392\u5e8f\uff0c\u4ece\u800c\u589e\u5f3a\u4e86\u5bf9\u6210\u672c\u5206\u5e03\u53d8\u5316\u7684\u9c81\u68d2\u6027\u3002\u5176\u6b21\uff0c\u5b83\u501f\u9274\u4e86 `SigmoidAttenuatedMarginLoss`\uff08\u7236\u4ee30\uff09\u5c06\u6210\u672c\u5dee\u5f02\u76f4\u63a5\u6620\u5c04\u4e3a\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u7684\u6838\u5fc3\u673a\u5236\u3002\u65b0\u7684\u8026\u5408\u70b9\u5728\u4e8e\uff0c\u6211\u4eec\u5c06 `rank_gap` \u7684\u8f93\u51fa\uff08\u4e00\u4e2a\u7a33\u5b9a\u7684\u3001\u5f52\u4e00\u5316\u7684\u6210\u672c\u5dee\u5f02\uff09\u901a\u8fc7 `tanh` \u51fd\u6570\u8fdb\u884c\u53d8\u6362\u3002`tanh` \u51fd\u6570\u5c06\u6210\u672c\u5dee\u5f02\u5e73\u6ed1\u5730\u6620\u5c04\u5230 `(-1, 1)` \u533a\u95f4\uff0c\u65e2\u4fdd\u7559\u4e86\u5dee\u5f02\u7684\u7b26\u53f7\u548c\u76f8\u5bf9\u5927\u5c0f\uff0c\u53c8\u9650\u5236\u4e86\u5176\u8303\u56f4\uff0c\u9632\u6b62\u4e86\u6781\u7aef\u503c\u5bf9\u88d5\u5ea6\u7684\u8fc7\u5ea6\u5f71\u54cd\u3002\u8fd9\u4e2a\u7ecf\u8fc7 `tanh` \u7f29\u653e\u7684\u88d5\u5ea6\u968f\u540e\u4e0e\u6a21\u578b\u9884\u6d4b\u7684\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u8fdb\u884c\u6bd4\u8f83\u3002\u6700\u540e\uff0c\u6211\u4eec\u4f7f\u7528 `softplus` \u51fd\u6570\u6765\u8ba1\u7b97\u635f\u5931\uff0c\u8fd9\u7ee7\u627f\u4e86\u4e24\u4e2a\u7236\u4ee3\u5171\u540c\u4f7f\u7528\u7684\u5e73\u6ed1\u94f0\u94fe\u635f\u5931\uff08hinge loss\uff09\u7ed3\u6784\uff0c\u786e\u4fdd\u4e86\u5f53\u6a21\u578b\u7684\u504f\u597d\u5f3a\u5ea6\u6ee1\u8db3\u52a8\u6001\u88d5\u5ea6\u65f6\u635f\u5931\u4e3a\u96f6\uff0c\u4e14\u6574\u4e2a\u51fd\u6570\u5904\u5904\u53ef\u5bfc\u3001\u6570\u503c\u7a33\u5b9a\u3002", "pseudocode": "def RankScaledTanhMarginLoss(cost_a, cost_b, logp_a, logp_b, beta, tau):\n    # \u786e\u4fdd w \u662f\u66f4\u4f18\u7684\u89e3 (winner), l \u662f\u8f83\u5dee\u7684\u89e3 (loser)\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 1. \u7ee7\u627f\u81ea\u7236\u4ee31 (AdaptiveMarginHingeLoss): \u4f7f\u7528 rank_gap \u8ba1\u7b97\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u3002\n    #    rank_gap(cost_w, cost_l) \u4f1a\u8fd4\u56de\u4e00\u4e2a\u5f52\u4e00\u5316\u4e14\u6709\u754c\u7684\u6b63\u503c\u3002\n    #    tau \u7528\u4e8e\u8c03\u8282 rank_gap \u7684\u654f\u611f\u5ea6\u3002\n    normalized_cost_diff = rank_gap(cost_w, cost_l, tau=tau)\n\n    # 2. \u65b0\u7684\u8026\u5408\u70b9: \u4f7f\u7528 tanh \u5bf9\u5f52\u4e00\u5316\u7684\u6210\u672c\u5dee\u5f02\u8fdb\u884c\u7f29\u653e\uff0c\u521b\u5efa\u4e00\u4e2a\u6709\u754c\u7684\u52a8\u6001\u88d5\u5ea6\u3002\n    #    tanh \u5c06 [0, inf) \u7684\u8f93\u5165\u6620\u5c04\u5230 [0, 1) \u7684\u8303\u56f4\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5e73\u6ed1\u4e14\u6709\u754c\u7684\u88d5\u5ea6\u4fe1\u53f7\u3002\n    #    \u8fd9\u7ed3\u5408\u4e86\u7236\u4ee30\u7684\u601d\u60f3\uff08\u7528\u6210\u672c\u5dee\u5f02\u521b\u5efa\u88d5\u5ea6\uff09\u548c\u7236\u4ee31\u7684\u601d\u60f3\uff08\u5bf9\u6210\u672c\u5dee\u5f02\u505a\u5f52\u4e00\u5316\uff09\u3002\n    dynamic_margin = tanh(normalized_cost_diff)\n\n    # 3. \u8ba1\u7b97\u5bf9\u6570\u6982\u7387\u7684\u5dee\u503c\u3002\n    logp_diff = logp_w - logp_l\n\n    # 4. \u8ba1\u7b97\u635f\u5931\uff0c\u7ed3\u6784\u7ee7\u627f\u81ea\u4e24\u4e2a\u7236\u4ee3\u3002\n    #    \u635f\u5931\u60e9\u7f5a\u7684\u662f logp_diff \u5c0f\u4e8e dynamic_margin \u7684\u60c5\u51b5\u3002\n    #    beta \u662f\u4e00\u4e2a\u8d85\u53c2\u6570\uff0c\u7528\u4e8e\u7f29\u653e\u6574\u4f53\u635f\u5931\u7684\u5e45\u5ea6\u3002\n    #    softplus(x) \u662f relu(x) \u7684\u5e73\u6ed1\u8fd1\u4f3c\uff0c\u786e\u4fdd\u635f\u5931\u975e\u8d1f\u4e14\u5904\u5904\u53ef\u5bfc\u3002\n    violation = beta * (dynamic_margin - logp_diff)\n    loss = softplus(violation)\n\n    return loss", "hyperparams": {"beta": {"value": 5.0, "description": "\u635f\u5931\u5e45\u5ea6\u7684\u7f29\u653e\u56e0\u5b50\u3002\u66f4\u9ad8\u7684\u503c\u4f1a\u5bf9\u8fdd\u53cd\u88d5\u5ea6\u7684\u884c\u4e3a\u65bd\u52a0\u66f4\u5f3a\u7684\u60e9\u7f5a\u3002"}, "tau": {"value": 0.05, "description": "rank_gap \u7b97\u5b50\u4e2d\u7684\u6e29\u5ea6\u53c2\u6570\uff0c\u63a7\u5236\u6210\u672c\u5dee\u5f02\u5f52\u4e00\u5316\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5c0f\u7684\u503c\u4f1a\u4f7f\u5f52\u4e00\u5316\u540e\u7684\u5dee\u5f02\u5bf9\u539f\u59cb\u6210\u672c\u5dee\u5f02\u66f4\u654f\u611f\u3002"}}, "operators_used": ["rank_gap", "tanh", "softplus"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor) of the same batch dimension. Tensors should be floats."], "returns": "A scalar Tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.027184963226318, "validation_objective": 4.027184963226318, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.9633865356445312}, "train_score_mean": 4.221017122268677, "train_loss_mean": 0.6928280759602785, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "RankScaledTanhMarginLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u878d\u5408\u4e86\u4e24\u79cd\u7236\u4ee3\u8bbe\u8ba1\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u65e8\u5728\u521b\u5efa\u4e00\u4e2a\u9c81\u68d2\u4e14\u9002\u5e94\u6027\u5f3a\u7684\u504f\u597d\u635f\u5931\u3002\u9996\u5148\uff0c\u5b83\u7ee7\u627f\u4e86 `AdaptiveMarginHingeLoss`\uff08\u7236\u4ee31\uff09\u4f7f\u7528 `rank_gap` \u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884c\u5f52\u4e00\u5316\u7684\u601d\u60f3\u3002\u8fd9\u79cd\u57fa\u4e8e\u79e9\u7684\u65b9\u6cd5\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\uff0c\u53ea\u5173\u6ce8\u5176\u76f8\u5bf9\u6392\u5e8f\uff0c\u4ece\u800c\u589e\u5f3a\u4e86\u5bf9\u6210\u672c\u5206\u5e03\u53d8\u5316\u7684\u9c81\u68d2\u6027\u3002\u5176\u6b21\uff0c\u5b83\u501f\u9274\u4e86 `SigmoidAttenuatedMarginLoss`\uff08\u7236\u4ee30\uff09\u5c06\u6210\u672c\u5dee\u5f02\u76f4\u63a5\u6620\u5c04\u4e3a\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u7684\u6838\u5fc3\u673a\u5236\u3002\u65b0\u7684\u8026\u5408\u70b9\u5728\u4e8e\uff0c\u6211\u4eec\u5c06 `rank_gap` \u7684\u8f93\u51fa\uff08\u4e00\u4e2a\u7a33\u5b9a\u7684\u3001\u5f52\u4e00\u5316\u7684\u6210\u672c\u5dee\u5f02\uff09\u901a\u8fc7 `tanh` \u51fd\u6570\u8fdb\u884c\u53d8\u6362\u3002`tanh` \u51fd\u6570\u5c06\u6210\u672c\u5dee\u5f02\u5e73\u6ed1\u5730\u6620\u5c04\u5230 `(-1, 1)` \u533a\u95f4\uff0c\u65e2\u4fdd\u7559\u4e86\u5dee\u5f02\u7684\u7b26\u53f7\u548c\u76f8\u5bf9\u5927\u5c0f\uff0c\u53c8\u9650\u5236\u4e86\u5176\u8303\u56f4\uff0c\u9632\u6b62\u4e86\u6781\u7aef\u503c\u5bf9\u88d5\u5ea6\u7684\u8fc7\u5ea6\u5f71\u54cd\u3002\u8fd9\u4e2a\u7ecf\u8fc7 `tanh` \u7f29\u653e\u7684\u88d5\u5ea6\u968f\u540e\u4e0e\u6a21\u578b\u9884\u6d4b\u7684\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u8fdb\u884c\u6bd4\u8f83\u3002\u6700\u540e\uff0c\u6211\u4eec\u4f7f\u7528 `softplus` \u51fd\u6570\u6765\u8ba1\u7b97\u635f\u5931\uff0c\u8fd9\u7ee7\u627f\u4e86\u4e24\u4e2a\u7236\u4ee3\u5171\u540c\u4f7f\u7528\u7684\u5e73\u6ed1\u94f0\u94fe\u635f\u5931\uff08hinge loss\uff09\u7ed3\u6784\uff0c\u786e\u4fdd\u4e86\u5f53\u6a21\u578b\u7684\u504f\u597d\u5f3a\u5ea6\u6ee1\u8db3\u52a8\u6001\u88d5\u5ea6\u65f6\u635f\u5931\u4e3a\u96f6\uff0c\u4e14\u6574\u4e2a\u51fd\u6570\u5904\u5904\u53ef\u5bfc\u3001\u6570\u503c\u7a33\u5b9a\u3002", "hyperparams": {"beta": {"value": 5.0, "description": "\u635f\u5931\u5e45\u5ea6\u7684\u7f29\u653e\u56e0\u5b50\u3002\u66f4\u9ad8\u7684\u503c\u4f1a\u5bf9\u8fdd\u53cd\u88d5\u5ea6\u7684\u884c\u4e3a\u65bd\u52a0\u66f4\u5f3a\u7684\u60e9\u7f5a\u3002"}, "tau": {"value": 0.05, "description": "rank_gap \u7b97\u5b50\u4e2d\u7684\u6e29\u5ea6\u53c2\u6570\uff0c\u63a7\u5236\u6210\u672c\u5dee\u5f02\u5f52\u4e00\u5316\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5c0f\u7684\u503c\u4f1a\u4f7f\u5f52\u4e00\u5316\u540e\u7684\u5dee\u5f02\u5bf9\u539f\u59cb\u6210\u672c\u5dee\u5f02\u66f4\u654f\u611f\u3002"}}, "operators_used": ["rank_gap", "tanh", "softplus"]}}}
{"generation": 1, "index": 2, "ir": {"name": "RankScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u878d\u5408\u4e86\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u8bbe\u8ba1\u54f2\u5b66\uff0c\u65e8\u5728\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u548c\u6982\u7387\u5dee\u5f02\u90fd\u5177\u6709\u9c81\u68d2\u6027\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u601d\u60f3\uff1a**\n1.  **\u7ee7\u627f\u81ea `AdaptiveMarginHingeLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7528\u4e86 `rank_gap` \u7b97\u5b50\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u3002\u8fd9\u63d0\u4f9b\u4e86\u4e00\u79cd\u57fa\u4e8e\u6392\u5e8f\u7684\u3001\u5bf9\u6210\u672c\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\uff0c\u4ece\u800c\u589e\u5f3a\u4e86\u5bf9\u5f02\u5e38\u6210\u672c\u503c\u7684\u9c81\u68d2\u6027\u3002\u4e0e\u76f4\u63a5\u4f7f\u7528 `cost_l - cost_w` \u76f8\u6bd4\uff0c`rank_gap` \u66f4\u5173\u6ce8\u4e8e\u201c\u54ea\u4e2a\u66f4\u597d\u201d\uff0c\u800c\u4e0d\u662f\u201c\u597d\u591a\u5c11\u201d\uff0c\u8fd9\u5728\u5904\u7406\u5206\u5e03\u5e7f\u6cdb\u7684\u6210\u672c\u65f6\u7279\u522b\u6709\u7528\u3002\n2.  **\u7ee7\u627f\u81ea `SigmoidAttenuatedMarginLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684\u5bf9\u6bd4\u7ed3\u6784\uff0c\u5373\u635f\u5931\u4e3b\u8981\u7531 `logp_w - logp_l` \u9a71\u52a8\u3002\u4f46\u6211\u4eec\u6ca1\u6709\u4f7f\u7528 `softplus` \u548c\u663e\u5f0f\u7684 margin\uff0c\u800c\u662f\u5c06\u5176\u5d4c\u5165\u5230 `logsigmoid` \u6846\u67b6\u4e2d\uff0c\u8fd9\u662f\u4e00\u79cd\u5728\u8bb8\u591a\u6210\u5bf9\u635f\u5931\u51fd\u6570\u4e2d\u88ab\u8bc1\u660e\u6709\u6548\u7684\u5f62\u5f0f\u3002\n\n**\u65b0\u7684\u8026\u5408\u70b9\u4e0e\u6539\u52a8\uff1a**\n1.  **\u6838\u5fc3\u635f\u5931\u7ed3\u6784**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `softplus(margin - logp_diff)` \u7ed3\u6784\uff0c\u800c\u662f\u91c7\u7528\u4e86\u66f4\u7b80\u6d01\u7684 `logsigmoid` \u5f62\u5f0f\u3002\u635f\u5931\u88ab\u5b9a\u4e49\u4e3a `-logsigmoid(scaled_logp_diff)`\u3002\u8fd9\u79cd\u5f62\u5f0f\u5929\u7136\u5730\u5c06 `logp_w > logp_l` \u7684\u60c5\u51b5\u63a8\u5411\u4f4e\u635f\u5931\u533a\u57df\uff0c\u5c06 `logp_w < logp_l` \u7684\u60c5\u51b5\u63a8\u5411\u9ad8\u635f\u5931\u533a\u57df\uff0c\u4e14\u51fd\u6570\u672c\u8eab\u5e73\u6ed1\u3001\u6709\u754c\u3001\u6570\u503c\u7a33\u5b9a\u3002\n2.  **\u81ea\u9002\u5e94\u7f29\u653e (Adaptive Scaling)**\uff1a\u8fd9\u662f\u5173\u952e\u7684\u8026\u5408\u70b9\u3002\u6211\u4eec\u5c06 `rank_gap` \u8ba1\u7b97\u51fa\u7684\u6210\u672c\u5dee\u5f02 `delta_cost` \u7528\u4f5c\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u7684\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50\uff08\u901a\u8fc7\u8d85\u53c2\u6570 `beta` \u63a7\u5236\u5f3a\u5ea6\uff09\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5f53\u4e24\u4e2a\u89e3\u7684\u6210\u672c\u5dee\u5f02\u5f88\u5927\u65f6\uff08`delta_cost` \u8f83\u5927\uff09\uff0c`logp_w - logp_l` \u4f1a\u88ab\u653e\u5927\uff0c\u4ece\u800c `logsigmoid` \u7684\u8f93\u5165\u4f1a\u53d8\u5f97\u66f4\u5927\uff0c\u68af\u5ea6\u4e5f\u66f4\u5f3a\u3002\u8fd9\u8feb\u4f7f\u6a21\u578b\u4ee5\u66f4\u5927\u7684\u529b\u5ea6\u53bb\u5b66\u4e60\u8fd9\u79cd\u660e\u786e\u7684\u504f\u597d\u3002\u53cd\u4e4b\uff0c\u5f53\u6210\u672c\u5dee\u5f02\u5f88\u5c0f\u65f6\uff0c\u7f29\u653e\u6548\u5e94\u51cf\u5f31\uff0c\u6a21\u578b\u53d7\u5230\u7684\u60e9\u7f5a\u4e5f\u66f4\u6e29\u548c\uff0c\u907f\u514d\u4e86\u5728\u6a21\u7cca\u504f\u597d\u4e0a\u4ea7\u751f\u8fc7\u5927\u7684\u68af\u5ea6\u3002\n3.  **\u6982\u7387\u5dee\u7a33\u5b9a\u5316**\uff1a\u4e3a\u4e86\u9632\u6b62 `logp_w - logp_l` \u51fa\u73b0\u6781\u7aef\u503c\u5bfc\u81f4 `delta_cost` \u7684\u7f29\u653e\u6548\u5e94\u88ab\u8fc7\u5ea6\u653e\u5927\uff0c\u6211\u4eec\u5f15\u5165\u4e86 `tanh` \u51fd\u6570\u5bf9\u5176\u8fdb\u884c\u538b\u7f29\uff0c\u5c06\u5176\u7a33\u5b9a\u5728 `[-1, 1]` \u7684\u8303\u56f4\u5185\u3002\u8fd9\u786e\u4fdd\u4e86\u6574\u4e2a\u7cfb\u7edf\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002", "pseudocode": "def RankScaledLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u786e\u5b9a\u4f18\u80dc\u8005(w)\u548c\u5931\u8d25\u8005(l)\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u4f7f\u7528 rank_gap \u8ba1\u7b97\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u3002\n    # rank_gap(cost_w, cost_l) \u4f1a\u8fd4\u56de\u4e00\u4e2a\u6b63\u503c\u3002\n    delta_cost = rank_gap(cost_w, cost_l)\n\n    # 3. [\u65b0\u8026\u5408\u70b9] \u521b\u5efa\u4e00\u4e2a\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u3002\n    # \u8be5\u56e0\u5b50\u4e0e\u6210\u672c\u5dee\u5f02\u6210\u6b63\u6bd4\uff0cbeta \u63a7\u5236\u5176\u5f3a\u5ea6\u3002\n    # \u6211\u4eec\u4f7f\u7528 softplus(delta_cost) \u786e\u4fdd\u7f29\u653e\u56e0\u5b50\u59cb\u7ec8\u4e3a\u6b63\u4e14\u5e73\u6ed1\u3002\n    scaling_factor = beta * softplus(delta_cost)\n\n    # 4. \u8ba1\u7b97\u5bf9\u6570\u6982\u7387\u5dee\u5e76\u901a\u8fc7 tanh \u8fdb\u884c\u7a33\u5b9a\u5316\u3002\n    # tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u65b0\u8026\u5408\u70b9] \u5c06\u7f29\u653e\u56e0\u5b50\u5e94\u7528\u4e8e\u7a33\u5b9a\u7684\u5bf9\u6570\u6982\u7387\u5dee\u3002\n    # \u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u5bf9\u6982\u7387\u5dee\u7684\u52a0\u6743\u5c31\u8d8a\u5f3a\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee30\u7684\u5bf9\u6bd4\u601d\u60f3\uff0c\u4f46\u91c7\u7528\u65b0\u7ed3\u6784]\n    # \u4f7f\u7528 logsigmoid \u8ba1\u7b97\u6700\u7ec8\u635f\u5931\u3002-logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u975e\u8d1f\u7684\u635f\u5931\u51fd\u6570\u3002\n    # \u5f53 scaled_logp_diff > 0 (\u504f\u597d\u6b63\u786e) \u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e0\u3002\n    # \u5f53 scaled_logp_diff < 0 (\u504f\u597d\u9519\u8bef) \u65f6\uff0c\u635f\u5931\u4f1a\u663e\u8457\u589e\u52a0\u3002\n    loss = -logsigmoid(scaled_logp_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 2.0, "description": "\u63a7\u5236\u6210\u672c\u5dee\u5f02\u5bf9\u6982\u7387\u5dee\u7f29\u653e\u5f71\u54cd\u5f3a\u5ea6\u7684\u7cfb\u6570\u3002\u8f83\u5927\u7684 beta \u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u68af\u5ea6\u6709\u66f4\u5927\u7684\u8d21\u732e\u3002"}}, "operators_used": ["rank_gap", "tanh", "softplus", "logsigmoid"], "implementation_hint": {"expects": ["Takes four scalar tensors: cost_a, cost_b, logp_a, logp_b, and a float hyperparameter beta."], "returns": "Returns a single scalar tensor representing the final loss value, which is non-negative and differentiable."}}, "fitness": {"hf_like_score": 4.012439012527466, "validation_objective": 4.012439012527466, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.9843504428863525}, "train_score_mean": 4.247305870056152, "train_loss_mean": 0.6928625665605068, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "RankScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u878d\u5408\u4e86\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u8bbe\u8ba1\u54f2\u5b66\uff0c\u65e8\u5728\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u548c\u6982\u7387\u5dee\u5f02\u90fd\u5177\u6709\u9c81\u68d2\u6027\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u601d\u60f3\uff1a**\n1.  **\u7ee7\u627f\u81ea `AdaptiveMarginHingeLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7528\u4e86 `rank_gap` \u7b97\u5b50\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u3002\u8fd9\u63d0\u4f9b\u4e86\u4e00\u79cd\u57fa\u4e8e\u6392\u5e8f\u7684\u3001\u5bf9\u6210\u672c\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\uff0c\u4ece\u800c\u589e\u5f3a\u4e86\u5bf9\u5f02\u5e38\u6210\u672c\u503c\u7684\u9c81\u68d2\u6027\u3002\u4e0e\u76f4\u63a5\u4f7f\u7528 `cost_l - cost_w` \u76f8\u6bd4\uff0c`rank_gap` \u66f4\u5173\u6ce8\u4e8e\u201c\u54ea\u4e2a\u66f4\u597d\u201d\uff0c\u800c\u4e0d\u662f\u201c\u597d\u591a\u5c11\u201d\uff0c\u8fd9\u5728\u5904\u7406\u5206\u5e03\u5e7f\u6cdb\u7684\u6210\u672c\u65f6\u7279\u522b\u6709\u7528\u3002\n2.  **\u7ee7\u627f\u81ea `SigmoidAttenuatedMarginLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684\u5bf9\u6bd4\u7ed3\u6784\uff0c\u5373\u635f\u5931\u4e3b\u8981\u7531 `logp_w - logp_l` \u9a71\u52a8\u3002\u4f46\u6211\u4eec\u6ca1\u6709\u4f7f\u7528 `softplus` \u548c\u663e\u5f0f\u7684 margin\uff0c\u800c\u662f\u5c06\u5176\u5d4c\u5165\u5230 `logsigmoid` \u6846\u67b6\u4e2d\uff0c\u8fd9\u662f\u4e00\u79cd\u5728\u8bb8\u591a\u6210\u5bf9\u635f\u5931\u51fd\u6570\u4e2d\u88ab\u8bc1\u660e\u6709\u6548\u7684\u5f62\u5f0f\u3002\n\n**\u65b0\u7684\u8026\u5408\u70b9\u4e0e\u6539\u52a8\uff1a**\n1.  **\u6838\u5fc3\u635f\u5931\u7ed3\u6784**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `softplus(margin - logp_diff)` \u7ed3\u6784\uff0c\u800c\u662f\u91c7\u7528\u4e86\u66f4\u7b80\u6d01\u7684 `logsigmoid` \u5f62\u5f0f\u3002\u635f\u5931\u88ab\u5b9a\u4e49\u4e3a `-logsigmoid(scaled_logp_diff)`\u3002\u8fd9\u79cd\u5f62\u5f0f\u5929\u7136\u5730\u5c06 `logp_w > logp_l` \u7684\u60c5\u51b5\u63a8\u5411\u4f4e\u635f\u5931\u533a\u57df\uff0c\u5c06 `logp_w < logp_l` \u7684\u60c5\u51b5\u63a8\u5411\u9ad8\u635f\u5931\u533a\u57df\uff0c\u4e14\u51fd\u6570\u672c\u8eab\u5e73\u6ed1\u3001\u6709\u754c\u3001\u6570\u503c\u7a33\u5b9a\u3002\n2.  **\u81ea\u9002\u5e94\u7f29\u653e (Adaptive Scaling)**\uff1a\u8fd9\u662f\u5173\u952e\u7684\u8026\u5408\u70b9\u3002\u6211\u4eec\u5c06 `rank_gap` \u8ba1\u7b97\u51fa\u7684\u6210\u672c\u5dee\u5f02 `delta_cost` \u7528\u4f5c\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u7684\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50\uff08\u901a\u8fc7\u8d85\u53c2\u6570 `beta` \u63a7\u5236\u5f3a\u5ea6\uff09\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5f53\u4e24\u4e2a\u89e3\u7684\u6210\u672c\u5dee\u5f02\u5f88\u5927\u65f6\uff08`delta_cost` \u8f83\u5927\uff09\uff0c`logp_w - logp_l` \u4f1a\u88ab\u653e\u5927\uff0c\u4ece\u800c `logsigmoid` \u7684\u8f93\u5165\u4f1a\u53d8\u5f97\u66f4\u5927\uff0c\u68af\u5ea6\u4e5f\u66f4\u5f3a\u3002\u8fd9\u8feb\u4f7f\u6a21\u578b\u4ee5\u66f4\u5927\u7684\u529b\u5ea6\u53bb\u5b66\u4e60\u8fd9\u79cd\u660e\u786e\u7684\u504f\u597d\u3002\u53cd\u4e4b\uff0c\u5f53\u6210\u672c\u5dee\u5f02\u5f88\u5c0f\u65f6\uff0c\u7f29\u653e\u6548\u5e94\u51cf\u5f31\uff0c\u6a21\u578b\u53d7\u5230\u7684\u60e9\u7f5a\u4e5f\u66f4\u6e29\u548c\uff0c\u907f\u514d\u4e86\u5728\u6a21\u7cca\u504f\u597d\u4e0a\u4ea7\u751f\u8fc7\u5927\u7684\u68af\u5ea6\u3002\n3.  **\u6982\u7387\u5dee\u7a33\u5b9a\u5316**\uff1a\u4e3a\u4e86\u9632\u6b62 `logp_w - logp_l` \u51fa\u73b0\u6781\u7aef\u503c\u5bfc\u81f4 `delta_cost` \u7684\u7f29\u653e\u6548\u5e94\u88ab\u8fc7\u5ea6\u653e\u5927\uff0c\u6211\u4eec\u5f15\u5165\u4e86 `tanh` \u51fd\u6570\u5bf9\u5176\u8fdb\u884c\u538b\u7f29\uff0c\u5c06\u5176\u7a33\u5b9a\u5728 `[-1, 1]` \u7684\u8303\u56f4\u5185\u3002\u8fd9\u786e\u4fdd\u4e86\u6574\u4e2a\u7cfb\u7edf\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002", "hyperparams": {"beta": {"value": 2.0, "description": "\u63a7\u5236\u6210\u672c\u5dee\u5f02\u5bf9\u6982\u7387\u5dee\u7f29\u653e\u5f71\u54cd\u5f3a\u5ea6\u7684\u7cfb\u6570\u3002\u8f83\u5927\u7684 beta \u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u68af\u5ea6\u6709\u66f4\u5927\u7684\u8d21\u732e\u3002"}}, "operators_used": ["rank_gap", "tanh", "softplus", "logsigmoid"]}}}
{"generation": 1, "index": 3, "ir": {"name": "RankGapScaledHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u7a33\u5b9a\u53c8\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u7684\u504f\u597d\u635f\u5931\u3002\u5b50\u4ee3\u7ee7\u627f\u4e86\u7236\u4ee31\uff08SigmoidAttenuatedMarginLoss\uff09\u7684\u201c\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u201d\u6982\u5ff5\uff0c\u5373\u88d5\u5ea6\u7684\u5927\u5c0f\u5e94\u4e0e\u89e3\u7684\u8d28\u91cf\u5dee\u5f02\u6210\u6b63\u6bd4\u3002\u540c\u65f6\uff0c\u5b83\u7ee7\u627f\u4e86\u7236\u4ee32\uff08AdaptiveMarginHingeLoss\uff09\u7684\u6838\u5fc3\u7ed3\u6784\uff0c\u5373\u4f7f\u7528\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u7ed3\u6784\uff0c\u5e76\u5229\u7528`tanh`\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea\u7236\u4ee31 (SigmoidAttenuatedMarginLoss)**\uff1a\u88d5\u5ea6\uff08margin\uff09\u662f\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u52a8\u6001\u8ba1\u7b97\u7684\u3002\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff0c\u6a21\u578b\u88ab\u8981\u6c42\u4ea7\u751f\u66f4\u5927\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u3002\n2.  **\u7ee7\u627f\u81ea\u7236\u4ee32 (AdaptiveMarginHingeLoss)**\uff1a\u4f7f\u7528`tanh`\u51fd\u6570\u6765\u538b\u7f29\u548c\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\uff0c\u4f7f\u5176\u843d\u5728[-1, 1]\u533a\u95f4\u5185\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\u3002\u540c\u65f6\uff0c\u6574\u4f53\u635f\u5931\u7ed3\u6784\u662f`softplus(margin - logp_diff)`\uff0c\u8fd9\u662f\u4e00\u79cd\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\u5f62\u5f0f\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\uff08\u8026\u5408\u70b91\uff09**\uff1a\u4e3a\u4e86\u63d0\u9ad8\u5bf9\u6210\u672c\u5206\u5e03\u548c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u539f\u59cb\u7684\u6210\u672c\u5dee\u5f02\uff0c\u800c\u662f\u91c7\u7528\u4e86\u7236\u4ee32\u4e2d\u4f7f\u7528\u7684`rank_gap`\u7b97\u5b50\u3002`rank_gap`\u901a\u8fc7\u6392\u5e8f\u6765\u8ba1\u7b97\u5dee\u5f02\uff0c\u5bf9\u7edd\u5bf9\u6570\u503c\u4e0d\u654f\u611f\uff0c\u4ece\u800c\u4f7f\u88d5\u5ea6\u7684\u8ba1\u7b97\u66f4\u52a0\u7a33\u5b9a\u3002\n2.  **\u65b0\u7684\u88d5\u5ea6\u8bbe\u8ba1\uff08\u8026\u5408\u70b92\uff09**\uff1a\u6211\u4eec\u5c06`rank_gap`\u7684\u8f93\u51fa\u76f4\u63a5\u4f5c\u4e3a\u88d5\u5ea6\uff0c\u5e76\u7528\u4e00\u4e2a\u8d85\u53c2\u6570`beta`\u8fdb\u884c\u7f29\u653e\uff08`margin = beta * rank_gap(...)`\uff09\u3002\u8fd9\u6bd4\u4f7f\u7528`sigmoid`\u6765\u521b\u5efa\u88d5\u5ea6\u66f4\u76f4\u63a5\uff0c\u5b83\u5047\u8bbe\u6210\u672c\u7684\u79e9\u5dee\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u8db3\u591f\u597d\u7684\u3001\u7ebf\u6027\u7684\u88d5\u5ea6\u4fe1\u53f7\u3002\u8fd9\u6837\u505a\u7b80\u5316\u4e86\u6a21\u578b\uff0c\u51cf\u5c11\u4e86`sigmoid`\u5e26\u6765\u7684\u975e\u7ebf\u6027\u9971\u548c\u6548\u5e94\uff0c\u4f7f\u5f97\u88d5\u5ea6\u53ef\u4ee5\u968f\u7740\u79e9\u5dee\u7684\u589e\u5927\u800c\u6301\u7eed\u3001\u7ebf\u6027\u5730\u589e\u957f\u3002\n\n\u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7`rank_gap`\u83b7\u5f97\u4e86\u4e00\u4e2a\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\uff0c\u5c06\u5176\u7ebf\u6027\u7f29\u653e\u540e\u4f5c\u4e3a\u52a8\u6001\u88d5\u5ea6\uff0c\u5e76\u7ed3\u5408`tanh`\u7a33\u5b9a\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff0c\u6700\u7ec8\u901a\u8fc7`softplus`\u94f0\u94fe\u635f\u5931\u8fdb\u884c\u60e9\u7f5a\uff0c\u4ece\u800c\u5728\u6570\u503c\u7a33\u5b9a\u6027\u548c\u5bf9\u504f\u597d\u4fe1\u53f7\u7684\u654f\u611f\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u826f\u597d\u7684\u5e73\u8861\u3002", "pseudocode": "def RankGapScaledHingeLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02 [\u65b0\u8026\u5408\u70b91]\n    #    \u7ee7\u627f\u81ea\u7236\u4ee32\u7684`rank_gap`\u7b97\u5b50\uff0c\u4ee5\u589e\u5f3a\u5bf9\u6210\u672c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\u3002\n    #    rank_gap(cost_w, cost_l) \u5c06\u8fd4\u56de\u4e00\u4e2a\u6b63\u503c\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. \u8bbe\u8ba1\u4e00\u4e2a\u7ebf\u6027\u7f29\u653e\u7684\u52a8\u6001\u88d5\u5ea6 [\u65b0\u8026\u5408\u70b92]\n    #    \u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u52a8\u6001\u88d5\u5ea6\u601d\u60f3\uff0c\u4f46\u91c7\u7528\u66f4\u76f4\u63a5\u7684\u7ebf\u6027\u7f29\u653e\uff0c\u800c\u975esigmoid\u3002\n    #    beta \u63a7\u5236\u4e86\u88d5\u5ea6\u5bf9\u79e9\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u3002\n    dynamic_margin = beta * cost_rank_diff\n\n    # 4. \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u7ee7\u627f\u81ea\u7236\u4ee32\u7684`tanh`\u7a33\u5b9a\u6280\u5de7\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\u3002\n    #    (logp_w - logp_l) \u671f\u671b\u4e3a\u6b63\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. \u8ba1\u7b97\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\n    #    \u8fd9\u662f\u7236\u4ee31\u548c\u7236\u4ee32\u5171\u6709\u7684\u6838\u5fc3\u7ed3\u6784\u3002\n    #    \u5f53\u6a21\u578b\u7684\u504f\u597d(stable_logp_diff)\u5c0f\u4e8e\u8981\u6c42\u7684\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    #    softplus(x) \u662f relu(x) \u7684\u5e73\u6ed1\u8fd1\u4f3c\u3002\n    loss = softplus(dynamic_margin - stable_logp_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u79e9\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\u3002"}}, "operators_used": ["rank_gap", "tanh", "softplus"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor) of the same batch dimension. Tensors represent costs and log-probabilities for two sets of solutions."], "returns": "A scalar Tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.005903720855713, "validation_objective": 4.005903720855713, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.969571828842163}, "train_score_mean": 4.226895377039909, "train_loss_mean": 0.6928799003362656, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "RankGapScaledHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u7a33\u5b9a\u53c8\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u7684\u504f\u597d\u635f\u5931\u3002\u5b50\u4ee3\u7ee7\u627f\u4e86\u7236\u4ee31\uff08SigmoidAttenuatedMarginLoss\uff09\u7684\u201c\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u201d\u6982\u5ff5\uff0c\u5373\u88d5\u5ea6\u7684\u5927\u5c0f\u5e94\u4e0e\u89e3\u7684\u8d28\u91cf\u5dee\u5f02\u6210\u6b63\u6bd4\u3002\u540c\u65f6\uff0c\u5b83\u7ee7\u627f\u4e86\u7236\u4ee32\uff08AdaptiveMarginHingeLoss\uff09\u7684\u6838\u5fc3\u7ed3\u6784\uff0c\u5373\u4f7f\u7528\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u7ed3\u6784\uff0c\u5e76\u5229\u7528`tanh`\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea\u7236\u4ee31 (SigmoidAttenuatedMarginLoss)**\uff1a\u88d5\u5ea6\uff08margin\uff09\u662f\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u52a8\u6001\u8ba1\u7b97\u7684\u3002\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff0c\u6a21\u578b\u88ab\u8981\u6c42\u4ea7\u751f\u66f4\u5927\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u3002\n2.  **\u7ee7\u627f\u81ea\u7236\u4ee32 (AdaptiveMarginHingeLoss)**\uff1a\u4f7f\u7528`tanh`\u51fd\u6570\u6765\u538b\u7f29\u548c\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\uff0c\u4f7f\u5176\u843d\u5728[-1, 1]\u533a\u95f4\u5185\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\u3002\u540c\u65f6\uff0c\u6574\u4f53\u635f\u5931\u7ed3\u6784\u662f`softplus(margin - logp_diff)`\uff0c\u8fd9\u662f\u4e00\u79cd\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\u5f62\u5f0f\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\uff08\u8026\u5408\u70b91\uff09**\uff1a\u4e3a\u4e86\u63d0\u9ad8\u5bf9\u6210\u672c\u5206\u5e03\u548c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u539f\u59cb\u7684\u6210\u672c\u5dee\u5f02\uff0c\u800c\u662f\u91c7\u7528\u4e86\u7236\u4ee32\u4e2d\u4f7f\u7528\u7684`rank_gap`\u7b97\u5b50\u3002`rank_gap`\u901a\u8fc7\u6392\u5e8f\u6765\u8ba1\u7b97\u5dee\u5f02\uff0c\u5bf9\u7edd\u5bf9\u6570\u503c\u4e0d\u654f\u611f\uff0c\u4ece\u800c\u4f7f\u88d5\u5ea6\u7684\u8ba1\u7b97\u66f4\u52a0\u7a33\u5b9a\u3002\n2.  **\u65b0\u7684\u88d5\u5ea6\u8bbe\u8ba1\uff08\u8026\u5408\u70b92\uff09**\uff1a\u6211\u4eec\u5c06`rank_gap`\u7684\u8f93\u51fa\u76f4\u63a5\u4f5c\u4e3a\u88d5\u5ea6\uff0c\u5e76\u7528\u4e00\u4e2a\u8d85\u53c2\u6570`beta`\u8fdb\u884c\u7f29\u653e\uff08`margin = beta * rank_gap(...)`\uff09\u3002\u8fd9\u6bd4\u4f7f\u7528`sigmoid`\u6765\u521b\u5efa\u88d5\u5ea6\u66f4\u76f4\u63a5\uff0c\u5b83\u5047\u8bbe\u6210\u672c\u7684\u79e9\u5dee\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u8db3\u591f\u597d\u7684\u3001\u7ebf\u6027\u7684\u88d5\u5ea6\u4fe1\u53f7\u3002\u8fd9\u6837\u505a\u7b80\u5316\u4e86\u6a21\u578b\uff0c\u51cf\u5c11\u4e86`sigmoid`\u5e26\u6765\u7684\u975e\u7ebf\u6027\u9971\u548c\u6548\u5e94\uff0c\u4f7f\u5f97\u88d5\u5ea6\u53ef\u4ee5\u968f\u7740\u79e9\u5dee\u7684\u589e\u5927\u800c\u6301\u7eed\u3001\u7ebf\u6027\u5730\u589e\u957f\u3002\n\n\u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7`rank_gap`\u83b7\u5f97\u4e86\u4e00\u4e2a\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\uff0c\u5c06\u5176\u7ebf\u6027\u7f29\u653e\u540e\u4f5c\u4e3a\u52a8\u6001\u88d5\u5ea6\uff0c\u5e76\u7ed3\u5408`tanh`\u7a33\u5b9a\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff0c\u6700\u7ec8\u901a\u8fc7`softplus`\u94f0\u94fe\u635f\u5931\u8fdb\u884c\u60e9\u7f5a\uff0c\u4ece\u800c\u5728\u6570\u503c\u7a33\u5b9a\u6027\u548c\u5bf9\u504f\u597d\u4fe1\u53f7\u7684\u654f\u611f\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u826f\u597d\u7684\u5e73\u8861\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u79e9\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\u3002"}}, "operators_used": ["rank_gap", "tanh", "softplus"]}}}
{"generation": 1, "index": 4, "ir": {"name": "ZScoreNormalizedHingeLoss", "intuition": "\u6b64\u635f\u5931\u51fd\u6570\u878d\u5408\u4e86\u4e24\u4e2a\u7236\u4ee3\u8bbe\u8ba1\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5e76\u5f15\u5165\u4e86\u65b0\u7684\u8026\u5408\u673a\u5236\u4ee5\u589e\u5f3a\u7a33\u5b9a\u6027\u548c\u9c81\u68d2\u6027\u3002\u5b83\u65e8\u5728\u901a\u8fc7\u4e00\u4e2a\u81ea\u9002\u5e94\u7684\u95f4\u9694\uff08margin\uff09\u6765\u60e9\u7f5a\u6a21\u578b\u5bf9\u89e3\u7684\u504f\u597d\u6392\u5e8f\u9519\u8bef\u3002\n\n**\u7ee7\u627f\u7684\u601d\u60f3**\uff1a\n1.  **\u7ee7\u627f\u81ea `SigmoidAttenuatedMarginLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\uff08cost difference\uff09\u6210\u6bd4\u4f8b\u7684\u52a8\u6001\u95f4\u9694\u3002\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u63d0\u4f9b\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff08log-probability difference\uff09\u4e5f\u5e94\u8d8a\u5927\uff0c\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u662f\u52a8\u6001\u53d8\u5316\u7684\u3002\n2.  **\u7ee7\u627f\u81ea `AdaptiveMarginHingeLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u538b\u7f29\u548c\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `logp_a - logp_b` \u7684\u6280\u5de7\u3002\u8fd9\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u5f53\u6a21\u578b\u8f93\u51fa\u7684\u5bf9\u6570\u6982\u7387\u503c\u8fc7\u5927\u6216\u8fc7\u5c0f\u65f6\uff0c\u68af\u5ea6\u53d1\u751f\u7206\u70b8\u6216\u6d88\u5931\uff0c\u4ece\u800c\u589e\u5f3a\u4e86\u8bad\u7ec3\u8fc7\u7a0b\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (`zscore`)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u6765\u5904\u7406\u6210\u672c\u5dee\u5f02 `cost_l - cost_w`\u3002\u4e0e\u7236\u4ee3\u4e2d\u7b80\u5355\u7684\u5dee\u503c\u6216 `rank_gap` \u4e0d\u540c\uff0c`zscore` \u4f1a\u5728\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u7684\u6570\u636e\u4e0a\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u7684\u5747\u503c\u548c\u6807\u51c6\u5dee\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u6807\u51c6\u5316\u3002\u8fd9\u79cd\u65b9\u5f0f\u4f7f\u5f97\u95f4\u9694\uff08margin\uff09\u7684\u8ba1\u7b97\u5bf9\u4e8e\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u5206\u5e03\u4e0d\u654f\u611f\uff0c\u4ece\u800c\u8ba9\u8d85\u53c2\u6570\uff08\u5982 `margin_scale`\uff09\u5728\u4e0d\u540c\u95ee\u9898\u6216\u6570\u636e\u96c6\u4e0a\u66f4\u5177\u901a\u7528\u6027\u3002\n2.  **\u65b0\u7684\u95f4\u9694\u8bbe\u8ba1**\uff1a\u6211\u4eec\u5c06 `zscore` \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u76f4\u63a5\u7528\u4f5c\u95f4\u9694\uff0c\u5e76\u4e58\u4ee5\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50 `margin_scale`\u3002\u8fd9\u521b\u5efa\u4e86\u4e00\u4e2a\u7ebf\u6027\u7684\u3001\u65e0\u754c\u7684\u3001\u4f46\u7ecf\u8fc7\u6279\u6b21\u7edf\u8ba1\u4fe1\u606f\u6821\u51c6\u7684\u95f4\u9694\u3002\u4e0e\u4f7f\u7528 `sigmoid` \u5c06\u95f4\u9694\u9650\u5236\u5728 `(0, margin_scale)` \u8303\u56f4\u5185\u7684\u7236\u4ee3\u4e0d\u540c\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u5141\u8bb8\u5728\u6210\u672c\u5dee\u5f02\u6781\u5927\u65f6\u4ea7\u751f\u66f4\u5927\u7684\u60e9\u7f5a\u68af\u5ea6\uff0c\u540c\u65f6 `zscore` \u7684\u6279\u6b21\u4e2d\u5fc3\u5316\u7279\u6027\u53c8\u80fd\u9632\u6b62\u5176\u5931\u63a7\u3002\n\n\u6700\u7ec8\uff0c\u635f\u5931\u51fd\u6570\u7684\u5f62\u5f0f\u4e3a `softplus(margin - tanh_logp_diff)`\uff0c\u8fd9\u6784\u6210\u4e86\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u975e\u8d1f\u7684 hinge-like \u635f\u5931\u3002\u53ea\u6709\u5f53\u6a21\u578b\u7684\u504f\u597d\u5f3a\u5ea6\uff08\u7531 `tanh` \u538b\u7f29\u540e\u7684\u5bf9\u6570\u6982\u7387\u5dee\u8868\u793a\uff09\u672a\u80fd\u8fbe\u5230\u7531\u6279\u6b21\u5185\u76f8\u5bf9\u6210\u672c\u5dee\u5f02\u6240\u51b3\u5b9a\u7684\u52a8\u6001\u95f4\u9694\u65f6\uff0c\u624d\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002", "pseudocode": "def ZScoreNormalizedHingeLoss(cost_a, cost_b, logp_a, logp_b, margin_scale):\n    # \u786e\u4fdd a \u662f\u66f4\u4f18\u89e3 (winner), b \u662f\u66f4\u5dee\u89e3 (loser)\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 1. [\u65b0\u8026\u5408\u70b9] \u8ba1\u7b97\u6210\u672c\u5dee\u5f02\uff0c\u5e76\u4f7f\u7528 z-score \u8fdb\u884c\u6279\u6b21\u5f52\u4e00\u5316\u3002\n    #    \u8fd9\u4f7f\u5f97\u95f4\u9694\u7684\u5c3a\u5ea6\u5bf9\u4e8e\u6210\u672c\u7684\u7edd\u5bf9\u503c\u548c\u5206\u5e03\u5177\u6709\u9c81\u68d2\u6027\u3002\n    cost_diff = cost_l - cost_w\n    normalized_cost_diff = zscore(cost_diff) # zscore \u5728\u4e00\u4e2a\u6279\u6b21\u4e0a\u8ba1\u7b97\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u57fa\u4e8e\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\uff0c\u6784\u5efa\u4e00\u4e2a\u52a8\u6001\u95f4\u9694\u3002\n    #    \u4e0e\u7236\u4ee3\u4e0d\u540c\uff0c\u8fd9\u91cc\u4f7f\u7528\u7ebf\u6027\u7f29\u653e\u800c\u975e sigmoid\uff0c\u56e0\u4e3a zscore \u5df2\u63d0\u4f9b\u4e86\u7a33\u5b9a\u6027\u3002\n    dynamic_margin = margin_scale * normalized_cost_diff\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff0c\u5e76\u4f7f\u7528 tanh \u8fdb\u884c\u538b\u7f29\u4ee5\u4fdd\u8bc1\u6570\u503c\u7a33\u5b9a\u3002\n    logp_diff = logp_w - logp_l\n    stabilized_logp_diff = tanh(logp_diff)\n\n    # 4. \u8ba1\u7b97\u95f4\u9694\u51b2\u7a81\uff08violation\uff09\u3002\n    #    \u5f53\u6a21\u578b\u7684\u504f\u597d\u5f3a\u5ea6 (stabilized_logp_diff) \u5c0f\u4e8e\u8981\u6c42\u7684\u52a8\u6001\u95f4\u9694\u65f6\uff0c\u8be5\u503c\u4e3a\u6b63\u3002\n    violation = dynamic_margin - stabilized_logp_diff\n\n    # 5. \u4f7f\u7528 softplus \u521b\u5efa\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u975e\u8d1f\u7684 hinge \u635f\u5931\u3002\n    #    \u5f53\u6a21\u578b\u7684\u504f\u597d\u6ee1\u8db3\u6216\u8d85\u8fc7\u95f4\u9694\u8981\u6c42\u65f6 (violation <= 0)\uff0c\u635f\u5931\u63a5\u8fd1\u4e8e 0\u3002\n    loss = softplus(violation)\n\n    return loss", "hyperparams": {"margin_scale": {"value": 1.0, "description": "\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50\uff0c\u7528\u4e8e\u8c03\u6574\u7531 z-score \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u6240\u6784\u6210\u7684\u52a8\u6001\u95f4\u9694\u7684\u5f3a\u5ea6\u3002\u8f83\u5927\u7684\u503c\u4f1a\u8981\u6c42\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u505a\u51fa\u66f4\u5f3a\u7684\u54cd\u5e94\u3002"}}, "operators_used": ["zscore", "tanh", "softplus"], "implementation_hint": {"expects": ["Tensors `cost_a`, `cost_b`, `logp_a`, `logp_b`, all of shape (batch_size,). The `zscore` operator is expected to compute mean and standard deviation across the batch dimension of its input tensor."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.098781585693359, "validation_objective": 4.098781585693359, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.06608247756958}, "train_score_mean": 4.271146826446056, "train_loss_mean": 0.6928304340690374, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreNormalizedHingeLoss", "intuition": "\u6b64\u635f\u5931\u51fd\u6570\u878d\u5408\u4e86\u4e24\u4e2a\u7236\u4ee3\u8bbe\u8ba1\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5e76\u5f15\u5165\u4e86\u65b0\u7684\u8026\u5408\u673a\u5236\u4ee5\u589e\u5f3a\u7a33\u5b9a\u6027\u548c\u9c81\u68d2\u6027\u3002\u5b83\u65e8\u5728\u901a\u8fc7\u4e00\u4e2a\u81ea\u9002\u5e94\u7684\u95f4\u9694\uff08margin\uff09\u6765\u60e9\u7f5a\u6a21\u578b\u5bf9\u89e3\u7684\u504f\u597d\u6392\u5e8f\u9519\u8bef\u3002\n\n**\u7ee7\u627f\u7684\u601d\u60f3**\uff1a\n1.  **\u7ee7\u627f\u81ea `SigmoidAttenuatedMarginLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\uff08cost difference\uff09\u6210\u6bd4\u4f8b\u7684\u52a8\u6001\u95f4\u9694\u3002\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u63d0\u4f9b\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff08log-probability difference\uff09\u4e5f\u5e94\u8d8a\u5927\uff0c\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u662f\u52a8\u6001\u53d8\u5316\u7684\u3002\n2.  **\u7ee7\u627f\u81ea `AdaptiveMarginHingeLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u538b\u7f29\u548c\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `logp_a - logp_b` \u7684\u6280\u5de7\u3002\u8fd9\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u5f53\u6a21\u578b\u8f93\u51fa\u7684\u5bf9\u6570\u6982\u7387\u503c\u8fc7\u5927\u6216\u8fc7\u5c0f\u65f6\uff0c\u68af\u5ea6\u53d1\u751f\u7206\u70b8\u6216\u6d88\u5931\uff0c\u4ece\u800c\u589e\u5f3a\u4e86\u8bad\u7ec3\u8fc7\u7a0b\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (`zscore`)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u6765\u5904\u7406\u6210\u672c\u5dee\u5f02 `cost_l - cost_w`\u3002\u4e0e\u7236\u4ee3\u4e2d\u7b80\u5355\u7684\u5dee\u503c\u6216 `rank_gap` \u4e0d\u540c\uff0c`zscore` \u4f1a\u5728\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u7684\u6570\u636e\u4e0a\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u7684\u5747\u503c\u548c\u6807\u51c6\u5dee\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u6807\u51c6\u5316\u3002\u8fd9\u79cd\u65b9\u5f0f\u4f7f\u5f97\u95f4\u9694\uff08margin\uff09\u7684\u8ba1\u7b97\u5bf9\u4e8e\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u5206\u5e03\u4e0d\u654f\u611f\uff0c\u4ece\u800c\u8ba9\u8d85\u53c2\u6570\uff08\u5982 `margin_scale`\uff09\u5728\u4e0d\u540c\u95ee\u9898\u6216\u6570\u636e\u96c6\u4e0a\u66f4\u5177\u901a\u7528\u6027\u3002\n2.  **\u65b0\u7684\u95f4\u9694\u8bbe\u8ba1**\uff1a\u6211\u4eec\u5c06 `zscore` \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u76f4\u63a5\u7528\u4f5c\u95f4\u9694\uff0c\u5e76\u4e58\u4ee5\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50 `margin_scale`\u3002\u8fd9\u521b\u5efa\u4e86\u4e00\u4e2a\u7ebf\u6027\u7684\u3001\u65e0\u754c\u7684\u3001\u4f46\u7ecf\u8fc7\u6279\u6b21\u7edf\u8ba1\u4fe1\u606f\u6821\u51c6\u7684\u95f4\u9694\u3002\u4e0e\u4f7f\u7528 `sigmoid` \u5c06\u95f4\u9694\u9650\u5236\u5728 `(0, margin_scale)` \u8303\u56f4\u5185\u7684\u7236\u4ee3\u4e0d\u540c\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u5141\u8bb8\u5728\u6210\u672c\u5dee\u5f02\u6781\u5927\u65f6\u4ea7\u751f\u66f4\u5927\u7684\u60e9\u7f5a\u68af\u5ea6\uff0c\u540c\u65f6 `zscore` \u7684\u6279\u6b21\u4e2d\u5fc3\u5316\u7279\u6027\u53c8\u80fd\u9632\u6b62\u5176\u5931\u63a7\u3002\n\n\u6700\u7ec8\uff0c\u635f\u5931\u51fd\u6570\u7684\u5f62\u5f0f\u4e3a `softplus(margin - tanh_logp_diff)`\uff0c\u8fd9\u6784\u6210\u4e86\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u975e\u8d1f\u7684 hinge-like \u635f\u5931\u3002\u53ea\u6709\u5f53\u6a21\u578b\u7684\u504f\u597d\u5f3a\u5ea6\uff08\u7531 `tanh` \u538b\u7f29\u540e\u7684\u5bf9\u6570\u6982\u7387\u5dee\u8868\u793a\uff09\u672a\u80fd\u8fbe\u5230\u7531\u6279\u6b21\u5185\u76f8\u5bf9\u6210\u672c\u5dee\u5f02\u6240\u51b3\u5b9a\u7684\u52a8\u6001\u95f4\u9694\u65f6\uff0c\u624d\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002", "hyperparams": {"margin_scale": {"value": 1.0, "description": "\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50\uff0c\u7528\u4e8e\u8c03\u6574\u7531 z-score \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u6240\u6784\u6210\u7684\u52a8\u6001\u95f4\u9694\u7684\u5f3a\u5ea6\u3002\u8f83\u5927\u7684\u503c\u4f1a\u8981\u6c42\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u505a\u51fa\u66f4\u5f3a\u7684\u54cd\u5e94\u3002"}}, "operators_used": ["zscore", "tanh", "softplus"]}}}
{"generation": 1, "index": 5, "ir": {"name": "RankGatedMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u901a\u8fc7\u7ed3\u5408\u4e24\u4e2a\u7236\u4ee3\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\uff0c\u65e8\u5728\u5b9e\u73b0\u5bf9\u504f\u597d\u5b66\u4e60\u7684\u7a33\u5b9a\u548c\u81ea\u9002\u5e94\u60e9\u7f5a\u3002\n\n\u601d\u60f3\u7ee7\u627f\uff1a\n1.  **\u7ee7\u627f\u81ea `SigmoidAttenuatedMarginLoss` (\u7236\u4ee3 0)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684 `margin - logp_diff` \u7ed3\u6784\u3002\u8fd9\u610f\u5473\u7740\u635f\u5931\u7684\u76ee\u6807\u662f\u786e\u4fdd\u66f4\u4f18\u89e3\u7684\u5bf9\u6570\u6982\u7387 `logp_w` \u6bd4\u8f83\u5dee\u89e3\u7684 `logp_l` \u81f3\u5c11\u9ad8\u51fa\u4e00\u4e2a\u52a8\u6001\u7684 `margin`\u3002\u5f53 `logp_w - logp_l` \u5927\u4e8e\u7b49\u4e8e `margin` \u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e\u96f6\u3002\n2.  **\u7ee7\u627f\u81ea `AdaptiveMarginHingeLoss` (\u7236\u4ee3 1)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u4f7f\u7528 `rank_gap` \u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\u3002`rank_gap` \u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\uff0c\u53ea\u5173\u5fc3\u5176\u76f8\u5bf9\u6392\u5e8f\u548c\u95f4\u8ddd\uff0c\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u4e8e\u6210\u672c\u5c3a\u5ea6\u548c\u5f02\u5e38\u503c\u66f4\u52a0\u9c81\u68d2\u3002\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u501f\u9274\u4e86\u4f7f\u7528 `tanh` \u6765\u538b\u7f29\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `logp_diff` \u7684\u6280\u5de7\uff0c\u5c06\u5176\u9650\u5236\u5728 `[-1, 1]` \u533a\u95f4\uff0c\u4ee5\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\u3002\n\n\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b9 (Rank-Gated Margin)**\uff1a\u6211\u4eec\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u65b0\u7684\u52a8\u6001 `margin`\u3002\u5b83\u4e0d\u518d\u662f\u50cf\u7236\u4ee3\u4e2d\u90a3\u6837\u76f4\u63a5\u7531 `sigmoid` \u4ea7\u751f\uff0c\u800c\u662f\u7531 `rank_gap` \u7684\u7ed3\u679c\u76f4\u63a5\u548c\u4e00\u4e2a\u8d85\u53c2\u6570 `margin_scale` \u76f8\u4e58\u5f97\u5230\u3002\u8fd9\u4e2a `margin` (`margin_scale * rank_gap_val`) \u662f\u4e00\u4e2a\u6b63\u6bd4\u4e8e\u6210\u672c\u6392\u5e8f\u5dee\u8ddd\u7684\u7ebf\u6027\u95f4\u9694\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a `margin` \u4f5c\u4e3a\u4e00\u4e2a\u201c\u95e8\u63a7\u201d\uff0c\u901a\u8fc7 `tanh` \u4f5c\u7528\u4e8e\u5b83\u3002\u8fd9\u79cd\u8bbe\u8ba1 (`tanh(margin)`) \u4f7f\u5f97\u5f53\u6210\u672c\u5dee\u5f02\u975e\u5e38\u5927\u65f6\uff0c`margin` \u7684\u589e\u957f\u4f1a\u9971\u548c\uff0c\u4ece\u800c\u907f\u514d\u4ea7\u751f\u8fc7\u5927\u7684\u76ee\u6807\u95f4\u9694\uff0c\u9632\u6b62\u6a21\u578b\u8fc7\u5ea6\u5173\u6ce8\u90a3\u4e9b\u5df2\u7ecf\u201c\u975e\u5e38\u5bb9\u6613\u201d\u533a\u5206\u7684\u6837\u672c\u5bf9\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b9 (LogSigmoid \u6846\u67b6)**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `softplus` \u4f5c\u4e3a\u6700\u7ec8\u7684\u6fc0\u6d3b\u51fd\u6570\uff0c\u800c\u662f\u5c06\u6574\u4e2a\u8868\u8fbe\u5f0f `margin - logp_diff` \u653e\u5165 `logsigmoid` \u4e2d\uff0c\u5e76\u53d6\u5176\u76f8\u53cd\u6570\u3002\u5373 `loss = -logsigmoid(logp_diff - margin)`\u3002\u8fd9\u7b49\u4ef7\u4e8e `softplus(margin - logp_diff)`\uff0c\u4f46 `logsigmoid` \u5728\u6570\u503c\u5b9e\u73b0\u4e0a\u901a\u5e38\u66f4\u7a33\u5b9a\u3002\u8fd9\u4e2a\u6846\u67b6\u660e\u786e\u5730\u5c06\u95ee\u9898\u5efa\u6a21\u4e3a\u201c\u6a21\u578b\u504f\u597d `logp_diff` \u8d85\u8fc7\u76ee\u6807\u95f4\u9694 `margin`\u201d\u7684\u5bf9\u6570\u4f3c\u7136\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6e05\u6670\u7684\u6982\u7387\u89e3\u91ca\u3002", "pseudocode": "def RankGatedMarginLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, margin_scale, tau):\n    # 1. \u786e\u5b9a\u4f18\u80dc\u8005(w)\u548c\u5931\u8d25\u8005(l)\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u4f7f\u7528 rank_gap \u8ba1\u7b97\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\n    # tau \u63a7\u5236 rank_gap \u7684\u654f\u611f\u5ea6\n    rank_gap_val = rank_gap(cost_l - cost_w, tau)\n\n    # 3. [\u65b0\u8026\u5408\u70b9] \u8bbe\u8ba1\u4e00\u4e2a\u7531 rank_gap \u95e8\u63a7\u7684\u9971\u548c margin\n    # \u9996\u5148\uff0cmargin \u4e0e rank_gap \u6210\u6b63\u6bd4\n    # \u7136\u540e\uff0c\u4f7f\u7528 tanh \u5bf9\u5176\u8fdb\u884c\u9971\u548c\u5904\u7406\uff0c\u9632\u6b62 margin \u8fc7\u5927\n    dynamic_margin = tanh(margin_scale * rank_gap_val)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u5dee\u5f02\n    # \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1] \u533a\u95f4\uff0c\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\n    logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee30 & \u65b0\u8026\u5408\u70b9] \u4f7f\u7528 LogSigmoid \u6846\u67b6\u8ba1\u7b97\u635f\u5931\n    # \u76ee\u6807\u662f\u8ba9 logp_diff > dynamic_margin\n    # loss = -logsigmoid(logp_diff - dynamic_margin) \u7b49\u4ef7\u4e8e softplus(dynamic_margin - logp_diff)\n    # \u8fd9\u79cd\u5f62\u5f0f\u63d0\u4f9b\u4e86\u6e05\u6670\u7684\u6982\u7387\u89e3\u91ca\uff0c\u5e76\u4e14\u6570\u503c\u7a33\u5b9a\n    loss = -logsigmoid(logp_diff - dynamic_margin)\n\n    return loss", "hyperparams": {"margin_scale": {"value": 2.0, "description": "\u63a7\u5236\u52a8\u6001\u95f4\u9694\u5927\u5c0f\u7684\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u4e0e rank_gap \u76f8\u4e58\uff0c\u51b3\u5b9a\u4e86 tanh \u9971\u548c\u524d\u7684\u6700\u5927\u659c\u7387\u3002"}, "tau": {"value": 0.05, "description": "rank_gap \u7b97\u5b50\u7684\u6e29\u5ea6\u53c2\u6570\uff0c\u63a7\u5236\u5176\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5c0f\u7684\u503c\u4f1a\u4f7f rank_gap \u5bf9\u5fae\u5c0f\u7684\u6210\u672c\u5dee\u5f02\u66f4\u654f\u611f\u3002"}}, "operators_used": ["rank_gap", "tanh", "logsigmoid"], "implementation_hint": {"expects": ["cost_a (float), cost_b (float), logp_a (float, requires_grad), logp_b (float, requires_grad), and hyperparams."], "returns": "A single scalar tensor representing the loss, which is differentiable with respect to logp_a and logp_b."}}, "fitness": {"hf_like_score": 4.174921035766602, "validation_objective": 4.174921035766602, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.1738739013671875}, "train_score_mean": 4.287653312087059, "train_loss_mean": 0.6928951554000378, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "RankGatedMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u901a\u8fc7\u7ed3\u5408\u4e24\u4e2a\u7236\u4ee3\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\uff0c\u65e8\u5728\u5b9e\u73b0\u5bf9\u504f\u597d\u5b66\u4e60\u7684\u7a33\u5b9a\u548c\u81ea\u9002\u5e94\u60e9\u7f5a\u3002\n\n\u601d\u60f3\u7ee7\u627f\uff1a\n1.  **\u7ee7\u627f\u81ea `SigmoidAttenuatedMarginLoss` (\u7236\u4ee3 0)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684 `margin - logp_diff` \u7ed3\u6784\u3002\u8fd9\u610f\u5473\u7740\u635f\u5931\u7684\u76ee\u6807\u662f\u786e\u4fdd\u66f4\u4f18\u89e3\u7684\u5bf9\u6570\u6982\u7387 `logp_w` \u6bd4\u8f83\u5dee\u89e3\u7684 `logp_l` \u81f3\u5c11\u9ad8\u51fa\u4e00\u4e2a\u52a8\u6001\u7684 `margin`\u3002\u5f53 `logp_w - logp_l` \u5927\u4e8e\u7b49\u4e8e `margin` \u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e\u96f6\u3002\n2.  **\u7ee7\u627f\u81ea `AdaptiveMarginHingeLoss` (\u7236\u4ee3 1)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u4f7f\u7528 `rank_gap` \u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\u3002`rank_gap` \u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\uff0c\u53ea\u5173\u5fc3\u5176\u76f8\u5bf9\u6392\u5e8f\u548c\u95f4\u8ddd\uff0c\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u4e8e\u6210\u672c\u5c3a\u5ea6\u548c\u5f02\u5e38\u503c\u66f4\u52a0\u9c81\u68d2\u3002\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u501f\u9274\u4e86\u4f7f\u7528 `tanh` \u6765\u538b\u7f29\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `logp_diff` \u7684\u6280\u5de7\uff0c\u5c06\u5176\u9650\u5236\u5728 `[-1, 1]` \u533a\u95f4\uff0c\u4ee5\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\u3002\n\n\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b9 (Rank-Gated Margin)**\uff1a\u6211\u4eec\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u65b0\u7684\u52a8\u6001 `margin`\u3002\u5b83\u4e0d\u518d\u662f\u50cf\u7236\u4ee3\u4e2d\u90a3\u6837\u76f4\u63a5\u7531 `sigmoid` \u4ea7\u751f\uff0c\u800c\u662f\u7531 `rank_gap` \u7684\u7ed3\u679c\u76f4\u63a5\u548c\u4e00\u4e2a\u8d85\u53c2\u6570 `margin_scale` \u76f8\u4e58\u5f97\u5230\u3002\u8fd9\u4e2a `margin` (`margin_scale * rank_gap_val`) \u662f\u4e00\u4e2a\u6b63\u6bd4\u4e8e\u6210\u672c\u6392\u5e8f\u5dee\u8ddd\u7684\u7ebf\u6027\u95f4\u9694\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a `margin` \u4f5c\u4e3a\u4e00\u4e2a\u201c\u95e8\u63a7\u201d\uff0c\u901a\u8fc7 `tanh` \u4f5c\u7528\u4e8e\u5b83\u3002\u8fd9\u79cd\u8bbe\u8ba1 (`tanh(margin)`) \u4f7f\u5f97\u5f53\u6210\u672c\u5dee\u5f02\u975e\u5e38\u5927\u65f6\uff0c`margin` \u7684\u589e\u957f\u4f1a\u9971\u548c\uff0c\u4ece\u800c\u907f\u514d\u4ea7\u751f\u8fc7\u5927\u7684\u76ee\u6807\u95f4\u9694\uff0c\u9632\u6b62\u6a21\u578b\u8fc7\u5ea6\u5173\u6ce8\u90a3\u4e9b\u5df2\u7ecf\u201c\u975e\u5e38\u5bb9\u6613\u201d\u533a\u5206\u7684\u6837\u672c\u5bf9\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b9 (LogSigmoid \u6846\u67b6)**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `softplus` \u4f5c\u4e3a\u6700\u7ec8\u7684\u6fc0\u6d3b\u51fd\u6570\uff0c\u800c\u662f\u5c06\u6574\u4e2a\u8868\u8fbe\u5f0f `margin - logp_diff` \u653e\u5165 `logsigmoid` \u4e2d\uff0c\u5e76\u53d6\u5176\u76f8\u53cd\u6570\u3002\u5373 `loss = -logsigmoid(logp_diff - margin)`\u3002\u8fd9\u7b49\u4ef7\u4e8e `softplus(margin - logp_diff)`\uff0c\u4f46 `logsigmoid` \u5728\u6570\u503c\u5b9e\u73b0\u4e0a\u901a\u5e38\u66f4\u7a33\u5b9a\u3002\u8fd9\u4e2a\u6846\u67b6\u660e\u786e\u5730\u5c06\u95ee\u9898\u5efa\u6a21\u4e3a\u201c\u6a21\u578b\u504f\u597d `logp_diff` \u8d85\u8fc7\u76ee\u6807\u95f4\u9694 `margin`\u201d\u7684\u5bf9\u6570\u4f3c\u7136\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6e05\u6670\u7684\u6982\u7387\u89e3\u91ca\u3002", "hyperparams": {"margin_scale": {"value": 2.0, "description": "\u63a7\u5236\u52a8\u6001\u95f4\u9694\u5927\u5c0f\u7684\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u4e0e rank_gap \u76f8\u4e58\uff0c\u51b3\u5b9a\u4e86 tanh \u9971\u548c\u524d\u7684\u6700\u5927\u659c\u7387\u3002"}, "tau": {"value": 0.05, "description": "rank_gap \u7b97\u5b50\u7684\u6e29\u5ea6\u53c2\u6570\uff0c\u63a7\u5236\u5176\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5c0f\u7684\u503c\u4f1a\u4f7f rank_gap \u5bf9\u5fae\u5c0f\u7684\u6210\u672c\u5dee\u5f02\u66f4\u654f\u611f\u3002"}}, "operators_used": ["rank_gap", "tanh", "logsigmoid"]}}}
{"generation": 1, "index": 6, "ir": {"name": "ZScoreMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u901a\u8fc7\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u65e8\u5728\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u53c8\u5177\u6709\u6570\u503c\u7a33\u5b9a\u6027\u7684\u504f\u597d\u5b66\u4e60\u76ee\u6807\u3002\u5b50\u4ee3\u7684\u4e3b\u8981\u8bbe\u8ba1\u5982\u4e0b\uff1a\n\n1.  **\u7ee7\u627f\u81ea AdaptiveMarginHingeLoss (\u7236\u4ee3 1)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u538b\u7f29\u548c\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `logp_a - logp_b` \u7684\u601d\u60f3\u3002\u8fd9\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u56e0\u6781\u7aef `logp` \u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u5c06\u6982\u7387\u5dee\u5f02\u6620\u5c04\u5230\u4e00\u4e2a\u6709\u754c\u7684 [-1, 1] \u533a\u95f4\u5185\u3002\n\n2.  **\u7ee7\u627f\u81ea SigmoidAttenuatedMarginLoss (\u7236\u4ee3 0)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7ed3\u6784\uff0c\u5373 `margin - logp_diff` \u7684\u5f62\u5f0f\u3002\u7136\u800c\uff0c\u6211\u4eec\u6ca1\u6709\u4f7f\u7528 `softplus`\uff0c\u800c\u662f\u91c7\u7528\u4e86\u7ecf\u5178\u7684 `logsigmoid` \u5f62\u5f0f\uff0c\u8fd9\u5728\u8bb8\u591a\u504f\u597d\u5b66\u4e60\u4efb\u52a1\uff08\u5982 DPO\uff09\u4e2d\u88ab\u8bc1\u660e\u662f\u6709\u6548\u7684\u3002\u635f\u5931\u7684\u6838\u5fc3\u662f `logsigmoid(logp_l - logp_w + margin)`\uff0c\u65e8\u5728\u6700\u5927\u5316 `logp_w` \u76f8\u5bf9\u4e8e `logp_l` \u7684\u4f18\u52bf\uff0c\u4e14\u4f18\u52bf\u5927\u5c0f\u7531 `margin` \u51b3\u5b9a\u3002\n\n3.  **\u65b0\u7684\u8026\u5408\u70b9 1 (\u5f52\u4e00\u5316)**\uff1a\u5f15\u5165\u4e86 `zscore` \u5bf9\u6210\u672c\u5dee\u5f02 `cost_l - cost_w` \u8fdb\u884c\u5f52\u4e00\u5316\u3002\u4e0e `rank_gap` \u6216\u76f4\u63a5\u4f7f\u7528\u5dee\u503c\u4e0d\u540c\uff0cz-score \u5f52\u4e00\u5316\u8003\u8651\u4e86\u5f53\u524d\u6279\u6b21\uff08batch\uff09\u5185\u6210\u672c\u5dee\u5f02\u7684\u5206\u5e03\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u3002\u8fd9\u4f7f\u5f97\u52a8\u6001 margin \u80fd\u591f\u81ea\u9002\u5e94\u5730\u8c03\u6574\u5176\u5c3a\u5ea6\uff0c\u4f7f\u5176\u5bf9\u6279\u6b21\u5185\u6210\u672c\u7684\u6574\u4f53\u5206\u5e03\u4e0d\u90a3\u4e48\u654f\u611f\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n4.  **\u65b0\u7684\u8026\u5408\u70b9 2 (Margin \u8bbe\u8ba1)**\uff1a\u6211\u4eec\u5c06 z-score \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_cost_diff` \u4e0e\u4e00\u4e2a\u8d85\u53c2\u6570 `beta` \u76f8\u4e58\uff0c\u76f4\u63a5\u4f5c\u4e3a\u52a8\u6001 margin\u3002\u8fd9\u4e2a margin \u662f\u7ebf\u6027\u7684\uff0c\u4f46\u5176\u8f93\u5165\u662f\u7ecf\u8fc7\u6279\u6b21\u7edf\u8ba1\u5f52\u4e00\u5316\u7684\uff0c\u7ed3\u5408\u4e86\u5168\u5c40\uff08\u7ebf\u6027\u7f29\u653e\uff09\u548c\u5c40\u90e8\uff08\u6279\u6b21\u5f52\u4e00\u5316\uff09\u7684\u7279\u6027\u3002\u5f53 `z_cost_diff` \u4e3a\u6b63\uff08\u5373\u6210\u672c\u5dee\u5f02\u5927\u4e8e\u6279\u6b21\u5e73\u5747\u5dee\u5f02\uff09\u65f6\uff0c\u6211\u4eec\u8981\u6c42\u4e00\u4e2a\u66f4\u5927\u7684\u6982\u7387\u95f4\u9694\uff0c\u53cd\u4e4b\u5219\u8981\u6c42\u8f83\u5c0f\u3002\n\n\u6700\u7ec8\uff0c\u635f\u5931\u51fd\u6570\u9f13\u52b1\u6a21\u578b\u4e3a\u6210\u672c\u66f4\u4f4e\u7684\u89e3\uff08winner\uff09\u5206\u914d\u66f4\u9ad8\u7684\u5bf9\u6570\u6982\u7387\uff0c\u60e9\u7f5a\u529b\u5ea6\u4e0e\u7ecf\u8fc7 z-score \u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u6210\u6b63\u6bd4\u3002", "pseudocode": "def ZScoreMarginLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u786e\u5b9a\u8d62\u5bb6 (winner) \u548c\u8f93\u5bb6 (loser)\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b9] \u8ba1\u7b97\u6210\u672c\u5dee\u5f02\uff0c\u5e76\u4f7f\u7528 z-score \u5728\u6279\u6b21\u7ef4\u5ea6\u4e0a\u8fdb\u884c\u5f52\u4e00\u5316\n    # \u8fd9\u4f7f\u5f97 margin \u5bf9\u6279\u6b21\u5185\u6210\u672c\u7684\u5c3a\u5ea6\u548c\u504f\u79fb\u5177\u6709\u9c81\u68d2\u6027\n    cost_diff = cost_l - cost_w\n    z_cost_diff = zscore(cost_diff) # zscore is applied over the batch dimension\n\n    # 3. [\u65b0\u8026\u5408\u70b9] \u57fa\u4e8e\u5f52\u4e00\u5316\u7684\u6210\u672c\u5dee\u5f02\uff0c\u521b\u5efa\u4e00\u4e2a\u52a8\u6001\u7684\u3001\u7ebf\u6027\u7684 margin\n    # \u4f7f\u7528 clamp \u786e\u4fdd margin \u4e0d\u4f1a\u8fc7\u5c0f\u6216\u8fc7\u5927\uff0c\u589e\u52a0\u6570\u503c\u7a33\u5b9a\u6027\n    dynamic_margin = clamp(beta * z_cost_diff, min=0.0)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee3 1] \u8ba1\u7b97\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff0c\u5e76\u4f7f\u7528 tanh \u8fdb\u884c\u7a33\u5b9a\u5316\u5904\u7406\n    # \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1] \u533a\u95f4\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\n    # \u6ce8\u610f\uff1a\u6211\u4eec\u8fd9\u91cc\u8ba1\u7b97 logp_w - logp_l\uff0c\u4e0e DPO \u7684\u5f62\u5f0f\u4fdd\u6301\u4e00\u81f4\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee3 0 \u7684\u7ed3\u6784\uff0c\u4f46\u4f7f\u7528 logsigmoid] \u8ba1\u7b97\u6700\u7ec8\u635f\u5931\n    # \u635f\u5931\u51fd\u6570\u7684\u5f62\u5f0f\u4e3a -log(sigmoid(X))\uff0c\u5176\u4e2d X \u662f\u6a21\u578b\u7684\u504f\u597d\u5f97\u5206\n    # \u6211\u4eec\u5e0c\u671b X = stable_logp_diff - dynamic_margin \u5c3d\u53ef\u80fd\u5927\n    # \u8fd9\u7b49\u4ef7\u4e8e\u6700\u5c0f\u5316 -logsigmoid(stable_logp_diff - dynamic_margin)\n    # \u6ce8\u610f\uff1a\u5728\u5b9e\u8df5\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528 log(1 + exp(-X)) \u7684\u5f62\u5f0f\uff0c\u5373 softplus(-X)\uff0c\u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u6570\u503c\u7a33\u5b9a\u6027\n    # \u8fd9\u91cc\u6211\u4eec\u91c7\u7528 DPO \u7684\u6807\u51c6\u5f62\u5f0f\uff0c\u5373 -logsigmoid(beta * (logp_w - logp_l)) \u7684\u53d8\u4f53\n    # \u6211\u4eec\u7684\u5f62\u5f0f\u662f -logsigmoid(stable_logp_diff - dynamic_margin)\n    # \u8fd9\u9f13\u52b1 stable_logp_diff > dynamic_margin\n    loss = -logsigmoid(stable_logp_diff - dynamic_margin)\n\n    return loss", "hyperparams": {"beta": {"value": 0.5, "description": "\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50\uff0c\u7528\u4e8e\u63a7\u5236 z-score \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u5bf9\u52a8\u6001 margin \u7684\u5f71\u54cd\u7a0b\u5ea6\u3002\u8f83\u5927\u7684 beta \u4f1a\u4ea7\u751f\u66f4\u5927\u7684 margin\uff0c\u4ece\u800c\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u7ea6\u675f\u3002"}}, "operators_used": ["zscore", "tanh", "clamp", "logsigmoid"], "implementation_hint": {"expects": ["Tensors cost_a, cost_b, logp_a, logp_b, all of shape [batch_size]. The zscore operator is expected to compute mean and stddev across the batch dimension."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.023370742797852, "validation_objective": 4.023370742797852, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.9850282669067383}, "train_score_mean": 4.234108433127403, "train_loss_mean": 0.692833986133337, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u901a\u8fc7\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u65e8\u5728\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u53c8\u5177\u6709\u6570\u503c\u7a33\u5b9a\u6027\u7684\u504f\u597d\u5b66\u4e60\u76ee\u6807\u3002\u5b50\u4ee3\u7684\u4e3b\u8981\u8bbe\u8ba1\u5982\u4e0b\uff1a\n\n1.  **\u7ee7\u627f\u81ea AdaptiveMarginHingeLoss (\u7236\u4ee3 1)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u538b\u7f29\u548c\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `logp_a - logp_b` \u7684\u601d\u60f3\u3002\u8fd9\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u56e0\u6781\u7aef `logp` \u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u5c06\u6982\u7387\u5dee\u5f02\u6620\u5c04\u5230\u4e00\u4e2a\u6709\u754c\u7684 [-1, 1] \u533a\u95f4\u5185\u3002\n\n2.  **\u7ee7\u627f\u81ea SigmoidAttenuatedMarginLoss (\u7236\u4ee3 0)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7ed3\u6784\uff0c\u5373 `margin - logp_diff` \u7684\u5f62\u5f0f\u3002\u7136\u800c\uff0c\u6211\u4eec\u6ca1\u6709\u4f7f\u7528 `softplus`\uff0c\u800c\u662f\u91c7\u7528\u4e86\u7ecf\u5178\u7684 `logsigmoid` \u5f62\u5f0f\uff0c\u8fd9\u5728\u8bb8\u591a\u504f\u597d\u5b66\u4e60\u4efb\u52a1\uff08\u5982 DPO\uff09\u4e2d\u88ab\u8bc1\u660e\u662f\u6709\u6548\u7684\u3002\u635f\u5931\u7684\u6838\u5fc3\u662f `logsigmoid(logp_l - logp_w + margin)`\uff0c\u65e8\u5728\u6700\u5927\u5316 `logp_w` \u76f8\u5bf9\u4e8e `logp_l` \u7684\u4f18\u52bf\uff0c\u4e14\u4f18\u52bf\u5927\u5c0f\u7531 `margin` \u51b3\u5b9a\u3002\n\n3.  **\u65b0\u7684\u8026\u5408\u70b9 1 (\u5f52\u4e00\u5316)**\uff1a\u5f15\u5165\u4e86 `zscore` \u5bf9\u6210\u672c\u5dee\u5f02 `cost_l - cost_w` \u8fdb\u884c\u5f52\u4e00\u5316\u3002\u4e0e `rank_gap` \u6216\u76f4\u63a5\u4f7f\u7528\u5dee\u503c\u4e0d\u540c\uff0cz-score \u5f52\u4e00\u5316\u8003\u8651\u4e86\u5f53\u524d\u6279\u6b21\uff08batch\uff09\u5185\u6210\u672c\u5dee\u5f02\u7684\u5206\u5e03\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u3002\u8fd9\u4f7f\u5f97\u52a8\u6001 margin \u80fd\u591f\u81ea\u9002\u5e94\u5730\u8c03\u6574\u5176\u5c3a\u5ea6\uff0c\u4f7f\u5176\u5bf9\u6279\u6b21\u5185\u6210\u672c\u7684\u6574\u4f53\u5206\u5e03\u4e0d\u90a3\u4e48\u654f\u611f\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n4.  **\u65b0\u7684\u8026\u5408\u70b9 2 (Margin \u8bbe\u8ba1)**\uff1a\u6211\u4eec\u5c06 z-score \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_cost_diff` \u4e0e\u4e00\u4e2a\u8d85\u53c2\u6570 `beta` \u76f8\u4e58\uff0c\u76f4\u63a5\u4f5c\u4e3a\u52a8\u6001 margin\u3002\u8fd9\u4e2a margin \u662f\u7ebf\u6027\u7684\uff0c\u4f46\u5176\u8f93\u5165\u662f\u7ecf\u8fc7\u6279\u6b21\u7edf\u8ba1\u5f52\u4e00\u5316\u7684\uff0c\u7ed3\u5408\u4e86\u5168\u5c40\uff08\u7ebf\u6027\u7f29\u653e\uff09\u548c\u5c40\u90e8\uff08\u6279\u6b21\u5f52\u4e00\u5316\uff09\u7684\u7279\u6027\u3002\u5f53 `z_cost_diff` \u4e3a\u6b63\uff08\u5373\u6210\u672c\u5dee\u5f02\u5927\u4e8e\u6279\u6b21\u5e73\u5747\u5dee\u5f02\uff09\u65f6\uff0c\u6211\u4eec\u8981\u6c42\u4e00\u4e2a\u66f4\u5927\u7684\u6982\u7387\u95f4\u9694\uff0c\u53cd\u4e4b\u5219\u8981\u6c42\u8f83\u5c0f\u3002\n\n\u6700\u7ec8\uff0c\u635f\u5931\u51fd\u6570\u9f13\u52b1\u6a21\u578b\u4e3a\u6210\u672c\u66f4\u4f4e\u7684\u89e3\uff08winner\uff09\u5206\u914d\u66f4\u9ad8\u7684\u5bf9\u6570\u6982\u7387\uff0c\u60e9\u7f5a\u529b\u5ea6\u4e0e\u7ecf\u8fc7 z-score \u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u6210\u6b63\u6bd4\u3002", "hyperparams": {"beta": {"value": 0.5, "description": "\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50\uff0c\u7528\u4e8e\u63a7\u5236 z-score \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u5bf9\u52a8\u6001 margin \u7684\u5f71\u54cd\u7a0b\u5ea6\u3002\u8f83\u5927\u7684 beta \u4f1a\u4ea7\u751f\u66f4\u5927\u7684 margin\uff0c\u4ece\u800c\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u7ea6\u675f\u3002"}}, "operators_used": ["zscore", "tanh", "clamp", "logsigmoid"]}}}
{"generation": 1, "index": 7, "ir": {"name": "ZScoreClippedMarginLoss", "intuition": "This loss function, named 'Z-Score Clipped Margin Loss', is a hybrid design that integrates key ideas from its predecessors to create a robust and stable preference learning objective. \n\n**Inherited Concepts:**\n1.  **From SigmoidAttenuatedMarginLoss (Parent 0):** It inherits the core structure of `softplus(margin - logp_diff)`. This structure creates a smooth, hinge-like penalty that is only applied when the model's predicted log-probability difference (`logp_diff`) fails to exceed a required `margin`.\n2.  **From AdaptiveMarginHingeLoss (Parent 1):** It adopts the idea of an adaptive margin that is sensitive to the magnitude of the cost difference. Instead of a fixed margin, the required separation between log probabilities scales with how different the two solutions' costs are.\n\n**New Coupling and Modifications:**\n1.  **New Normalization (Coupling Point 1):** Instead of using `rank_gap` or raw differences, this loss uses a `zscore` normalization on the costs. This standardizes the cost difference relative to the batch statistics (mean and standard deviation), making the margin calculation robust to the absolute scale of costs in a given batch. This is particularly useful when costs can vary by orders of magnitude across different problem instances.\n2.  **Clipped Log-Probability Difference (Coupling Point 2):** To prevent extreme gradients and instability from very large log-probability differences, the `logp_diff` is symmetrically clipped to a range `[-clip_range, clip_range]` using the `clamp` operator. This is a simpler and more direct stability mechanism compared to using `tanh` (from Parent 1), ensuring that the loss is not dominated by outlier predictions from the model.\n\nIn summary, the loss penalizes the model when `logp_w` is not sufficiently larger than `logp_l`. The required 'sufficiency' (the margin) is dynamically determined by the z-scored cost difference, and the entire calculation is stabilized by clipping the log-probability term.", "pseudocode": "def ZScoreClippedMarginLoss(cost_a, cost_b, logp_a, logp_b, margin_scale, clip_range):\n    # 1. Determine the winning (w) and losing (l) solutions based on cost.\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. (New) Normalize the cost difference using z-score.\n    #    This makes the margin robust to the scale of costs in the batch.\n    #    Inherits the idea of an adaptive margin from Parent 1, but with a new normalization.\n    cost_diff = cost_l - cost_w\n    zscored_cost_diff = zscore(cost_diff)\n\n    # 3. Define the dynamic margin based on the normalized cost difference.\n    #    This is a simplified linear margin, but could also use sigmoid like parents.\n    dynamic_margin = margin_scale * zscored_cost_diff\n\n    # 4. Calculate the log probability difference.\n    logp_diff = logp_w - logp_l\n\n    # 5. (New) Clip the log probability difference for stability.\n    #    This prevents extreme values from causing exploding gradients.\n    clipped_logp_diff = clamp(logp_diff, min=-clip_range, max=clip_range)\n\n    # 6. Calculate the final loss.\n    #    Inherits the `softplus(margin - diff)` structure from Parent 0.\n    #    This creates a smooth hinge loss that penalizes violations of the margin.\n    loss = softplus(dynamic_margin - clipped_logp_diff)\n\n    return loss", "hyperparams": {"margin_scale": {"value": 1.0, "description": "Scales the z-scored cost difference to create the target margin. Controls how strongly the cost difference influences the required log-probability gap."}, "clip_range": {"value": 10.0, "description": "The symmetric range `[-clip_range, clip_range]` for clamping the log-probability difference to ensure numerical stability."}}, "operators_used": ["zscore", "clamp", "softplus"], "implementation_hint": {"expects": ["Two cost scalars (cost_a, cost_b) and their corresponding log-probability scalars (logp_a, logp_b). The `zscore` operator is expected to compute its statistics over the batch of `cost_l - cost_w` values."], "returns": "A single scalar loss value, which is non-negative and differentiable."}}, "fitness": {"hf_like_score": 4.019829750061035, "validation_objective": 4.019829750061035, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.9948058128356934}, "train_score_mean": 4.236239343881607, "train_loss_mean": 0.6928458623588085, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedMarginLoss", "intuition": "This loss function, named 'Z-Score Clipped Margin Loss', is a hybrid design that integrates key ideas from its predecessors to create a robust and stable preference learning objective. \n\n**Inherited Concepts:**\n1.  **From SigmoidAttenuatedMarginLoss (Parent 0):** It inherits the core structure of `softplus(margin - logp_diff)`. This structure creates a smooth, hinge-like penalty that is only applied when the model's predicted log-probability difference (`logp_diff`) fails to exceed a required `margin`.\n2.  **From AdaptiveMarginHingeLoss (Parent 1):** It adopts the idea of an adaptive margin that is sensitive to the magnitude of the cost difference. Instead of a fixed margin, the required separation between log probabilities scales with how different the two solutions' costs are.\n\n**New Coupling and Modifications:**\n1.  **New Normalization (Coupling Point 1):** Instead of using `rank_gap` or raw differences, this loss uses a `zscore` normalization on the costs. This standardizes the cost difference relative to the batch statistics (mean and standard deviation), making the margin calculation robust to the absolute scale of costs in a given batch. This is particularly useful when costs can vary by orders of magnitude across different problem instances.\n2.  **Clipped Log-Probability Difference (Coupling Point 2):** To prevent extreme gradients and instability from very large log-probability differences, the `logp_diff` is symmetrically clipped to a range `[-clip_range, clip_range]` using the `clamp` operator. This is a simpler and more direct stability mechanism compared to using `tanh` (from Parent 1), ensuring that the loss is not dominated by outlier predictions from the model.\n\nIn summary, the loss penalizes the model when `logp_w` is not sufficiently larger than `logp_l`. The required 'sufficiency' (the margin) is dynamically determined by the z-scored cost difference, and the entire calculation is stabilized by clipping the log-probability term.", "hyperparams": {"margin_scale": {"value": 1.0, "description": "Scales the z-scored cost difference to create the target margin. Controls how strongly the cost difference influences the required log-probability gap."}, "clip_range": {"value": 10.0, "description": "The symmetric range `[-clip_range, clip_range]` for clamping the log-probability difference to ensure numerical stability."}}, "operators_used": ["zscore", "clamp", "softplus"]}}}
{"generation": 2, "index": 0, "ir": {"name": "AdaptiveScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u9c81\u68d2\u53c8\u5177\u6709\u81ea\u9002\u5e94\u60e9\u7f5a\u5f3a\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u7ed3\u6784\uff0c\u5373\u635f\u5931\u5f62\u5f0f\u4e3a `-logsigmoid(scaled_logp_diff)`\u3002\u8fd9\u79cd\u5f62\u5f0f\u5929\u7136\u5730\u5c06\u6b63\u786e\u7684\u504f\u597d\uff08`logp_w > logp_l`\uff09\u63a8\u5411\u4f4e\u635f\u5931\u533a\u57df\uff0c\u540c\u65f6\u5bf9\u9519\u8bef\u7684\u504f\u597d\u65bd\u52a0\u60e9\u7f5a\uff0c\u4e14\u51fd\u6570\u672c\u8eab\u5e73\u6ed1\u3001\u6709\u754c\u3001\u6570\u503c\u7a33\u5b9a\u3002\u6b64\u5916\uff0c\u6211\u4eec\u4e5f\u7ee7\u627f\u4e86\u4f7f\u7528 `rank_gap` \u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\uff0c\u8fd9\u589e\u5f3a\u4e86\u5bf9\u6210\u672c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u4f7f\u7528 `tanh` \u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee `(logp_w - logp_l)` \u7684\u6280\u5de7\u3002\u5c06\u8fd9\u4e2a\u5dee\u503c\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u53ef\u4ee5\u9632\u6b62\u6781\u7aef\u6982\u7387\u503c\u5bfc\u81f4\u68af\u5ea6\u7206\u70b8\uff0c\u4ece\u800c\u589e\u5f3a\u6574\u4f53\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u70b9\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u3001\u66f4\u590d\u6742\u7684\u7f29\u653e\u56e0\u5b50\u6765\u8c03\u8282 `logp_diff` \u7684\u6743\u91cd\u3002\u7236\u4ee31\u4f7f\u7528 `beta * softplus(delta_cost)`\uff0c\u8fd9\u662f\u4e00\u4e2a\u5355\u8c03\u9012\u589e\u7684\u7f29\u653e\u3002\u6211\u4eec\u5c06\u5176\u6539\u8fdb\u4e3a `beta * (1 + tanh(delta_cost))`\u3002\u8fd9\u91cc\u7684 `delta_cost` \u662f `rank_gap` \u7684\u7ed3\u679c\u3002\u8fd9\u4e2a\u65b0\u7684\u7f29\u653e\u56e0\u5b50\u6709\u4e24\u4e2a\u597d\u5904\uff1a\n    *   **\u6709\u754c\u7f29\u653e**\uff1a`tanh` \u51fd\u6570\u5c06\u7f29\u653e\u56e0\u5b50\u7684\u589e\u957f\u9650\u5236\u5728\u4e00\u4e2a\u6709\u754c\u8303\u56f4\u5185\uff08`beta * [1, 2]`\uff09\u3002\u8fd9\u610f\u5473\u7740\u5373\u4f7f\u6210\u672c\u7684\u79e9\u5dee\u975e\u5e38\u5927\uff0c\u60e9\u7f5a\u7684\u5f3a\u5ea6\u4e5f\u4e0d\u4f1a\u65e0\u9650\u589e\u957f\uff0c\u907f\u514d\u4e86\u6781\u7aef\u6210\u672c\u5bf9\u68af\u5ea6\u4ea7\u751f\u8fc7\u5927\u5f71\u54cd\uff0c\u63d0\u9ad8\u4e86\u7a33\u5b9a\u6027\u3002\n    *   **\u57fa\u7840\u6743\u91cd**\uff1a\u5373\u4f7f\u6210\u672c\u5dee\u5f02\u4e3a\u96f6\uff08`delta_cost=0`\uff09\uff0c\u7f29\u653e\u56e0\u5b50\u4ecd\u7136\u662f `beta`\uff08\u56e0\u4e3a `tanh(0)=0`\uff09\uff0c\u800c\u4e0d\u662f\u63a5\u8fd1\u4e8e\u96f6\u3002\u8fd9\u4fdd\u8bc1\u4e86\u5373\u4f7f\u5bf9\u4e8e\u6210\u672c\u76f8\u8fd1\u7684\u6837\u672c\u5bf9\uff0c\u6a21\u578b\u4ecd\u7136\u4f1a\u53d7\u5230\u4e00\u4e2a\u57fa\u7840\u7684\u3001\u7531 `beta` \u63a7\u5236\u7684\u60e9\u7f5a\uff0c\u9f13\u52b1\u6a21\u578b\u53bb\u533a\u5206\u90a3\u4e9b\u7ec6\u5fae\u7684\u5dee\u5f02\u3002\n\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u53cc\u91cdTanh\u7a33\u5b9a\u7ed3\u6784)**\uff1a\u6211\u4eec\u5c06\u4e24\u4e2a\u7236\u4ee3\u4e2d\u7684 `tanh` \u7528\u5728\u4e86\u4e0d\u540c\u7684\u5730\u65b9\uff0c\u5f62\u6210\u4e86\u4e00\u79cd\u53cc\u91cd\u7a33\u5b9a\u7ed3\u6784\u3002\u7b2c\u4e00\u4e2a `tanh` \u4f5c\u7528\u4e8e `delta_cost`\uff0c\u7528\u4e8e\u521b\u5efa\u6709\u754c\u7684\u7f29\u653e\u56e0\u5b50\u3002\u7b2c\u4e8c\u4e2a `tanh` \u4f5c\u7528\u4e8e `logp_w - logp_l`\uff0c\u7528\u4e8e\u7a33\u5b9a\u6982\u7387\u5dee\u672c\u8eab\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5c06\u6210\u672c\u4fe1\u53f7\u548c\u6982\u7387\u4fe1\u53f7\u5728\u8fdb\u5165\u6700\u7ec8\u7684 `logsigmoid` \u8ba1\u7b97\u4e4b\u524d\u90fd\u8fdb\u884c\u4e86\u5e73\u6ed1\u548c\u754c\u5b9a\uff0c\u6781\u5927\u5730\u589e\u5f3a\u4e86\u6574\u4e2a\u635f\u5931\u51fd\u6570\u7684\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u4f7f\u5176\u80fd\u591f\u5904\u7406\u66f4\u5e7f\u6cdb\u7684\u6210\u672c\u548c\u6982\u7387\u5206\u5e03\u3002", "pseudocode": "def AdaptiveScaledLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\uff0c\u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee30\u548c1] \u4f7f\u7528 rank_gap \u8ba1\u7b97\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\n    # rank_gap(cost_w, cost_l) \u8fd4\u56de\u4e00\u4e2a\u975e\u8d1f\u503c\uff0c\u4ee3\u8868\u6210\u672c\u7684\u79e9\u5dee\n    delta_cost = rank_gap(cost_w, cost_l)\n\n    # 3. [\u65b0\u7684\u8026\u5408\u70b91] \u521b\u5efa\u4e00\u4e2a\u6709\u754c\u7684\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\n    # \u8be5\u56e0\u5b50\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\uff0c\u4f46\u4f7f\u7528 tanh \u5c06\u5176\u6548\u679c\u9650\u5236\u5728 [beta, 2*beta] \u533a\u95f4\u5185\u3002\n    # \u5373\u4f7f delta_cost \u4e3a 0\uff0c\u4e5f\u5b58\u5728\u4e00\u4e2a beta \u7684\u57fa\u7840\u7f29\u653e\u3002\n    scaling_factor = beta * (1 + tanh(delta_cost))\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    # \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1] \u533a\u95f4\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u65b0\u7684\u8026\u5408\u70b92] \u5c06\u6210\u672c\u4fe1\u53f7\u548c\u6982\u7387\u4fe1\u53f7\u8fdb\u884c\u8026\u5408\n    # \u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u6982\u7387\u5dee\u5f02\u5bf9\u6700\u7ec8\u635f\u5931\u7684\u5f71\u54cd\u5c31\u8d8a\u5927\uff0c\u4f46\u8fd9\u79cd\u5f71\u54cd\u662f\u6709\u754c\u7684\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u4f7f\u7528 logsigmoid \u8ba1\u7b97\u6700\u7ec8\u635f\u5931\n    # -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u3001\u975e\u8d1f\u7684\u635f\u5931\u51fd\u6570\u3002\n    # \u5f53 scaled_logp_diff > 0 (\u504f\u597d\u6b63\u786e) \u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e0\u3002\n    # \u5f53 scaled_logp_diff < 0 (\u504f\u597d\u9519\u8bef) \u65f6\uff0c\u635f\u5931\u4f1a\u663e\u8457\u589e\u52a0\u3002\n    loss = -logsigmoid(scaled_logp_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u57fa\u7840\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u635f\u5931\u51fd\u6570\u5bf9\u504f\u597d\u5dee\u5f02\u7684\u6574\u4f53\u654f\u611f\u5ea6\u3002\u6700\u7ec8\u7684\u7f29\u653e\u8303\u56f4\u4e3a [beta, 2*beta]\u3002"}}, "operators_used": ["rank_gap", "tanh", "logsigmoid"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor), beta (float)"], "returns": "loss (Tensor, scalar)"}}, "fitness": {"hf_like_score": 4.140337228775024, "validation_objective": 4.140337228775024, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.052061438560486}, "train_score_mean": 4.269944682717323, "train_loss_mean": 0.6928303372114897, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u9c81\u68d2\u53c8\u5177\u6709\u81ea\u9002\u5e94\u60e9\u7f5a\u5f3a\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u7ed3\u6784\uff0c\u5373\u635f\u5931\u5f62\u5f0f\u4e3a `-logsigmoid(scaled_logp_diff)`\u3002\u8fd9\u79cd\u5f62\u5f0f\u5929\u7136\u5730\u5c06\u6b63\u786e\u7684\u504f\u597d\uff08`logp_w > logp_l`\uff09\u63a8\u5411\u4f4e\u635f\u5931\u533a\u57df\uff0c\u540c\u65f6\u5bf9\u9519\u8bef\u7684\u504f\u597d\u65bd\u52a0\u60e9\u7f5a\uff0c\u4e14\u51fd\u6570\u672c\u8eab\u5e73\u6ed1\u3001\u6709\u754c\u3001\u6570\u503c\u7a33\u5b9a\u3002\u6b64\u5916\uff0c\u6211\u4eec\u4e5f\u7ee7\u627f\u4e86\u4f7f\u7528 `rank_gap` \u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\uff0c\u8fd9\u589e\u5f3a\u4e86\u5bf9\u6210\u672c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u4f7f\u7528 `tanh` \u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee `(logp_w - logp_l)` \u7684\u6280\u5de7\u3002\u5c06\u8fd9\u4e2a\u5dee\u503c\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u53ef\u4ee5\u9632\u6b62\u6781\u7aef\u6982\u7387\u503c\u5bfc\u81f4\u68af\u5ea6\u7206\u70b8\uff0c\u4ece\u800c\u589e\u5f3a\u6574\u4f53\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u70b9\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u3001\u66f4\u590d\u6742\u7684\u7f29\u653e\u56e0\u5b50\u6765\u8c03\u8282 `logp_diff` \u7684\u6743\u91cd\u3002\u7236\u4ee31\u4f7f\u7528 `beta * softplus(delta_cost)`\uff0c\u8fd9\u662f\u4e00\u4e2a\u5355\u8c03\u9012\u589e\u7684\u7f29\u653e\u3002\u6211\u4eec\u5c06\u5176\u6539\u8fdb\u4e3a `beta * (1 + tanh(delta_cost))`\u3002\u8fd9\u91cc\u7684 `delta_cost` \u662f `rank_gap` \u7684\u7ed3\u679c\u3002\u8fd9\u4e2a\u65b0\u7684\u7f29\u653e\u56e0\u5b50\u6709\u4e24\u4e2a\u597d\u5904\uff1a\n    *   **\u6709\u754c\u7f29\u653e**\uff1a`tanh` \u51fd\u6570\u5c06\u7f29\u653e\u56e0\u5b50\u7684\u589e\u957f\u9650\u5236\u5728\u4e00\u4e2a\u6709\u754c\u8303\u56f4\u5185\uff08`beta * [1, 2]`\uff09\u3002\u8fd9\u610f\u5473\u7740\u5373\u4f7f\u6210\u672c\u7684\u79e9\u5dee\u975e\u5e38\u5927\uff0c\u60e9\u7f5a\u7684\u5f3a\u5ea6\u4e5f\u4e0d\u4f1a\u65e0\u9650\u589e\u957f\uff0c\u907f\u514d\u4e86\u6781\u7aef\u6210\u672c\u5bf9\u68af\u5ea6\u4ea7\u751f\u8fc7\u5927\u5f71\u54cd\uff0c\u63d0\u9ad8\u4e86\u7a33\u5b9a\u6027\u3002\n    *   **\u57fa\u7840\u6743\u91cd**\uff1a\u5373\u4f7f\u6210\u672c\u5dee\u5f02\u4e3a\u96f6\uff08`delta_cost=0`\uff09\uff0c\u7f29\u653e\u56e0\u5b50\u4ecd\u7136\u662f `beta`\uff08\u56e0\u4e3a `tanh(0)=0`\uff09\uff0c\u800c\u4e0d\u662f\u63a5\u8fd1\u4e8e\u96f6\u3002\u8fd9\u4fdd\u8bc1\u4e86\u5373\u4f7f\u5bf9\u4e8e\u6210\u672c\u76f8\u8fd1\u7684\u6837\u672c\u5bf9\uff0c\u6a21\u578b\u4ecd\u7136\u4f1a\u53d7\u5230\u4e00\u4e2a\u57fa\u7840\u7684\u3001\u7531 `beta` \u63a7\u5236\u7684\u60e9\u7f5a\uff0c\u9f13\u52b1\u6a21\u578b\u53bb\u533a\u5206\u90a3\u4e9b\u7ec6\u5fae\u7684\u5dee\u5f02\u3002\n\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u53cc\u91cdTanh\u7a33\u5b9a\u7ed3\u6784)**\uff1a\u6211\u4eec\u5c06\u4e24\u4e2a\u7236\u4ee3\u4e2d\u7684 `tanh` \u7528\u5728\u4e86\u4e0d\u540c\u7684\u5730\u65b9\uff0c\u5f62\u6210\u4e86\u4e00\u79cd\u53cc\u91cd\u7a33\u5b9a\u7ed3\u6784\u3002\u7b2c\u4e00\u4e2a `tanh` \u4f5c\u7528\u4e8e `delta_cost`\uff0c\u7528\u4e8e\u521b\u5efa\u6709\u754c\u7684\u7f29\u653e\u56e0\u5b50\u3002\u7b2c\u4e8c\u4e2a `tanh` \u4f5c\u7528\u4e8e `logp_w - logp_l`\uff0c\u7528\u4e8e\u7a33\u5b9a\u6982\u7387\u5dee\u672c\u8eab\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5c06\u6210\u672c\u4fe1\u53f7\u548c\u6982\u7387\u4fe1\u53f7\u5728\u8fdb\u5165\u6700\u7ec8\u7684 `logsigmoid` \u8ba1\u7b97\u4e4b\u524d\u90fd\u8fdb\u884c\u4e86\u5e73\u6ed1\u548c\u754c\u5b9a\uff0c\u6781\u5927\u5730\u589e\u5f3a\u4e86\u6574\u4e2a\u635f\u5931\u51fd\u6570\u7684\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u4f7f\u5176\u80fd\u591f\u5904\u7406\u66f4\u5e7f\u6cdb\u7684\u6210\u672c\u548c\u6982\u7387\u5206\u5e03\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u57fa\u7840\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u635f\u5931\u51fd\u6570\u5bf9\u504f\u597d\u5dee\u5f02\u7684\u6574\u4f53\u654f\u611f\u5ea6\u3002\u6700\u7ec8\u7684\u7f29\u653e\u8303\u56f4\u4e3a [beta, 2*beta]\u3002"}}, "operators_used": ["rank_gap", "tanh", "logsigmoid"]}}}
{"generation": 2, "index": 1, "ir": {"name": "ZScoreClippedLogSigmoidLoss", "intuition": "\u8be5\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u4e2a\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u4f18\u52bf\uff0c\u5373\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u9c81\u68d2\u6027\u548c\u5bf9\u6a21\u578b\u8f93\u51fa\u7684\u7a33\u5b9a\u6027\uff0c\u540c\u65f6\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\u6765\u8fdb\u4e00\u6b65\u589e\u5f3a\u9c81\u68d2\u6027\u548c\u8bad\u7ec3\u52a8\u6001\u6027\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u635f\u5931\u7ed3\u6784\u3002\u635f\u5931\u88ab\u5b9a\u4e49\u4e3a `-logsigmoid(scaled_logp_diff)`\uff0c\u8fd9\u662f\u4e00\u79cd\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u3001\u5e73\u6ed1\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u6210\u5bf9\u635f\u5931\u5f62\u5f0f\u3002\u5b83\u5929\u7136\u5730\u60e9\u7f5a\u9519\u8bef\u7684\u504f\u597d (`logp_w < logp_l`)\uff0c\u5e76\u5956\u52b1\u6b63\u786e\u7684\u504f\u597d\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)** \u548c **`RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6cbf\u7528\u4e86\u4f7f\u7528 `tanh(logp_w - logp_l)` \u6765\u7a33\u5b9a\u6a21\u578b\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u601d\u60f3\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u7684\u8f93\u51fa\u5dee\u5f02\u88ab\u9650\u5236\u5728 `[-1, 1]` \u7684\u53ef\u63a7\u8303\u56f4\u5185\uff0c\u6709\u6548\u9632\u6b62\u4e86\u7531\u6781\u7aef\u6982\u7387\u9884\u6d4b\u5f15\u8d77\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u6452\u5f03\u4e86\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\uff0c\u8f6c\u800c\u91c7\u7528 `zscore` \u5bf9\u6210\u672c\u5dee\u5f02 `cost_l - cost_w` \u8fdb\u884c\u5f52\u4e00\u5316\u3002`zscore` \u5c06\u4e00\u6279\u6570\u636e\u4e2d\u7684\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u80fd\u50cf `rank_gap` \u4e00\u6837\u5904\u7406\u7edd\u5bf9\u503c\u7684\u5c3a\u5ea6\u95ee\u9898\u548c\u5f02\u5e38\u503c\uff0c\u8fd8\u80fd\u4fdd\u7559\u66f4\u591a\u5173\u4e8e\u5dee\u5f02\u5206\u5e03\u7684\u76f8\u5bf9\u4fe1\u606f\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u5728\u6279\u6b21\u4e2d\u663e\u8457\u9ad8\u4e8e\u5e73\u5747\u5dee\u5f02\u7684\u6837\u672c\u5bf9\uff0c\u4f1a\u83b7\u5f97\u4e00\u4e2a\u8f83\u5927\u7684\u6b63 z-score\uff0c\u4ece\u800c\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u83b7\u5f97\u66f4\u5927\u7684\u6743\u91cd\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6279\u6b21\u5185\u6210\u672c\u5dee\u5f02\u7684\u201c\u76f8\u5bf9\u663e\u8457\u6027\u201d\u66f4\u52a0\u654f\u611f\u3002\n2.  **\u65b0\u7684\u8026\u5408\u8bbe\u8ba1\uff1aClipped Margin** (\u8026\u5408\u70b92)\uff1a\u6211\u4eec\u5c06 `zscore` \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `cost_diff_zscore` \u4e0e\u4e00\u4e2a\u8d85\u53c2\u6570 `beta` \u76f8\u4e58\uff0c\u5e76\u4f7f\u7528 `clamp` \u51fd\u6570\u5c06\u5176\u88c1\u526a\u5230\u4e00\u4e2a\u56fa\u5b9a\u7684\u8303\u56f4 `[0, M]`\uff0c\u4ece\u800c\u5f62\u6210\u4e00\u4e2a\u6709\u754c\u7684\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u3002\u8fd9\u4e2a\u88d5\u5ea6 `clipped_margin` \u88ab\u52a0\u5230\u6a21\u578b\u7684\u7a33\u5b9a\u6982\u7387\u5dee `stable_logp_diff` \u4e0a\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7684\u4f18\u52bf\u5728\u4e8e\uff1a\n    *   **\u6fc0\u52b1\u4f5c\u7528**\uff1a\u88d5\u5ea6\u7684\u5b58\u5728\u610f\u5473\u7740\uff0c\u5373\u4f7f\u6a21\u578b\u7684\u9884\u6d4b\u662f\u6b63\u786e\u7684 (`stable_logp_diff > 0`)\uff0c\u4f46\u5982\u679c\u5176\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\u4ee5\u8d85\u8fc7\u88d5\u5ea6\uff0c\u4ecd\u7136\u4f1a\u4ea7\u751f\u635f\u5931\u3002\u88d5\u5ea6\u7684\u5927\u5c0f\u4e0e\u6210\u672c\u5dee\u5f02\u7684\u76f8\u5bf9\u663e\u8457\u6027\uff08z-score\uff09\u6210\u6b63\u6bd4\uff0c\u9f13\u52b1\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u4ea7\u751f\u66f4\u5f3a\u7684\u504f\u597d\u4fe1\u53f7\u3002\n    *   **\u7a33\u5b9a\u6027**\uff1a\u901a\u8fc7 `clamp` \u64cd\u4f5c\uff0c\u6211\u4eec\u4e3a\u88d5\u5ea6\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u4e0a\u9650 `M`\u3002\u8fd9\u53ef\u4ee5\u9632\u6b62\u6279\u6b21\u4e2d\u6781\u7aef\u5927\u7684 `zscore` \u4ea7\u751f\u8fc7\u5927\u7684\u88d5\u5ea6\uff0c\u4ece\u800c\u907f\u514d\u5bf9\u6a21\u578b\u65bd\u52a0\u4e0d\u5207\u5b9e\u9645\u7684\u4f18\u5316\u76ee\u6807\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n\u603b\u7ed3\u6765\u8bf4\uff0c\u8be5\u635f\u5931\u51fd\u6570\u901a\u8fc7 `zscore` \u611f\u77e5\u6279\u6b21\u5185\u7684\u6210\u672c\u5dee\u5f02\u5206\u5e03\uff0c\u5229\u7528\u4e00\u4e2a\u6709\u754c\u7684\u3001\u52a8\u6001\u7684 `clipped_margin` \u6765\u6fc0\u52b1\u6a21\u578b\u5b66\u4e60\uff0c\u5e76\u7ed3\u5408 `tanh` \u548c `logsigmoid` \u6846\u67b6\u6765\u4fdd\u8bc1\u6574\u4f53\u7684\u6570\u503c\u7a33\u5b9a\u6027\u548c\u5e73\u6ed1\u6027\u3002", "pseudocode": "def ZScoreClippedLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta, M):\n    # 1. \u8bc6\u522b\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    [\u7ee7\u627f\u81ea\u7236\u4ee30\u548c\u7236\u4ee31] \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 3. \u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u5e76\u8fdb\u884c Z-Score \u5f52\u4e00\u5316\n    #    [\u65b0\u8026\u5408\u70b91] \u4f7f\u7528 zscore \u66ff\u4ee3 rank_gap\uff0c\u4ee5\u611f\u77e5\u6279\u6b21\u5185\u6210\u672c\u5dee\u5f02\u7684\u76f8\u5bf9\u5206\u5e03\u3002\n    #    zscore() \u671f\u671b\u5728\u4e00\u6279(batch)\u6570\u636e\u4e0a\u64cd\u4f5c\uff0c\u8fd9\u91cc\u662f\u4f2a\u4ee3\u7801\u793a\u610f\u3002\n    cost_diff = cost_l - cost_w\n    cost_diff_zscore = zscore(cost_diff) # \u5047\u8bbe zscore \u5bf9 batch \u5185\u7684 cost_diff \u8fdb\u884c\u64cd\u4f5c\n\n    # 4. \u8bbe\u8ba1\u4e00\u4e2a\u6709\u754c\u7684\u52a8\u6001\u88d5\u5ea6 (Clipped Margin)\n    #    [\u65b0\u8026\u5408\u70b92] \u5c06 z-score \u7f29\u653e\u540e\uff0c\u901a\u8fc7 clamp \u9650\u5236\u5176\u8303\u56f4\uff0c\u9632\u6b62\u88d5\u5ea6\u8fc7\u5927\u3002\n    #    \u8fd9\u521b\u5efa\u4e86\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5bf9\u663e\u8457\u6027\u6b63\u76f8\u5173\uff0c\u4f46\u6709\u4e0a\u9650\u7684\u6fc0\u52b1\u76ee\u6807\u3002\n    #    M \u662f\u88d5\u5ea6\u7684\u4e0a\u9650\u8d85\u53c2\u6570\u3002\n    clipped_margin = clamp(beta * cost_diff_zscore, min=0, max=M)\n    \n    # 5. \u8ba1\u7b97\u6700\u7ec8\u7684\u635f\u5931\u8f93\u5165\n    #    \u6211\u4eec\u5c06\u88d5\u5ea6\u52a0\u5230\u6a21\u578b\u7684\u7a33\u5b9a\u6982\u7387\u5dee\u4e0a\u3002\u6a21\u578b\u9700\u8981\u514b\u670d\u8fd9\u4e2a\u88d5\u5ea6\u624d\u80fd\u4f7f\u635f\u5931\u8d8b\u8fd1\u4e8e\u96f6\u3002\n    #    \u8fd9\u9f13\u52b1\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u4ea7\u751f\u66f4\u5f3a\u7684\u504f\u597d\u3002\n    loss_input = stable_logp_diff - clipped_margin\n\n    # 6. \u8ba1\u7b97 LogSigmoid \u635f\u5931\n    #    [\u7ee7\u627f\u81ea\u7236\u4ee31] \u4f7f\u7528 -logsigmoid \u7ed3\u6784\uff0c\u8fd9\u662f\u4e00\u79cd\u5e73\u6ed1\u3001\u975e\u8d1f\u7684\u6210\u5bf9\u635f\u5931\u3002\n    #    \u5f53 stable_logp_diff > clipped_margin \u65f6\uff0c\u635f\u5931\u63a5\u8fd10\u3002\n    #    \u5f53 stable_logp_diff < clipped_margin \u65f6\uff0c\u635f\u5931\u4f1a\u663e\u8457\u589e\u52a0\u3002\n    loss = -logsigmoid(loss_input)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86 z-score \u5316\u7684\u6210\u672c\u5dee\u5f02\u8f6c\u5316\u4e3a\u88d5\u5ea6\u7684\u5f3a\u5ea6\u3002\u8f83\u5927\u7684 beta \u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u7684\u76f8\u5bf9\u5927\u5c0f\u5bf9\u88d5\u5ea6\u7684\u5f71\u54cd\u66f4\u5927\u3002"}, "M": {"value": 5.0, "description": "\u88d5\u5ea6\u4e0a\u9650\u3002\u8fd9\u662f\u4e00\u4e2a\u7a33\u5b9a\u5316\u53c2\u6570\uff0c\u7528\u4e8e\u9632\u6b62\u6279\u6b21\u4e2d\u6781\u7aef\u7684\u6210\u672c\u5dee\u5f02\uff08\u5373\u4f7f\u5728 z-score \u5316\u540e\uff09\u4ea7\u751f\u8fc7\u5927\u7684\u88d5\u5ea6\u76ee\u6807\uff0c\u4ece\u800c\u4fdd\u8bc1\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002"}}, "operators_used": ["tanh", "zscore", "clamp", "logsigmoid"], "implementation_hint": {"expects": ["Tensors cost_a, cost_b, logp_a, logp_b, all of shape (B,), where B is the batch size. The 'zscore' operator should be implemented to compute the mean and standard deviation across the batch dimension of its input tensor."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.089291334152222, "validation_objective": 4.089291334152222, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.042670249938965}, "train_score_mean": 4.225131839513779, "train_loss_mean": 0.6928428448736668, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedLogSigmoidLoss", "intuition": "\u8be5\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u4e2a\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u4f18\u52bf\uff0c\u5373\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u9c81\u68d2\u6027\u548c\u5bf9\u6a21\u578b\u8f93\u51fa\u7684\u7a33\u5b9a\u6027\uff0c\u540c\u65f6\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\u6765\u8fdb\u4e00\u6b65\u589e\u5f3a\u9c81\u68d2\u6027\u548c\u8bad\u7ec3\u52a8\u6001\u6027\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u635f\u5931\u7ed3\u6784\u3002\u635f\u5931\u88ab\u5b9a\u4e49\u4e3a `-logsigmoid(scaled_logp_diff)`\uff0c\u8fd9\u662f\u4e00\u79cd\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u3001\u5e73\u6ed1\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u6210\u5bf9\u635f\u5931\u5f62\u5f0f\u3002\u5b83\u5929\u7136\u5730\u60e9\u7f5a\u9519\u8bef\u7684\u504f\u597d (`logp_w < logp_l`)\uff0c\u5e76\u5956\u52b1\u6b63\u786e\u7684\u504f\u597d\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)** \u548c **`RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6cbf\u7528\u4e86\u4f7f\u7528 `tanh(logp_w - logp_l)` \u6765\u7a33\u5b9a\u6a21\u578b\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u601d\u60f3\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u7684\u8f93\u51fa\u5dee\u5f02\u88ab\u9650\u5236\u5728 `[-1, 1]` \u7684\u53ef\u63a7\u8303\u56f4\u5185\uff0c\u6709\u6548\u9632\u6b62\u4e86\u7531\u6781\u7aef\u6982\u7387\u9884\u6d4b\u5f15\u8d77\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u6452\u5f03\u4e86\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\uff0c\u8f6c\u800c\u91c7\u7528 `zscore` \u5bf9\u6210\u672c\u5dee\u5f02 `cost_l - cost_w` \u8fdb\u884c\u5f52\u4e00\u5316\u3002`zscore` \u5c06\u4e00\u6279\u6570\u636e\u4e2d\u7684\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u80fd\u50cf `rank_gap` \u4e00\u6837\u5904\u7406\u7edd\u5bf9\u503c\u7684\u5c3a\u5ea6\u95ee\u9898\u548c\u5f02\u5e38\u503c\uff0c\u8fd8\u80fd\u4fdd\u7559\u66f4\u591a\u5173\u4e8e\u5dee\u5f02\u5206\u5e03\u7684\u76f8\u5bf9\u4fe1\u606f\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u5728\u6279\u6b21\u4e2d\u663e\u8457\u9ad8\u4e8e\u5e73\u5747\u5dee\u5f02\u7684\u6837\u672c\u5bf9\uff0c\u4f1a\u83b7\u5f97\u4e00\u4e2a\u8f83\u5927\u7684\u6b63 z-score\uff0c\u4ece\u800c\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u83b7\u5f97\u66f4\u5927\u7684\u6743\u91cd\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6279\u6b21\u5185\u6210\u672c\u5dee\u5f02\u7684\u201c\u76f8\u5bf9\u663e\u8457\u6027\u201d\u66f4\u52a0\u654f\u611f\u3002\n2.  **\u65b0\u7684\u8026\u5408\u8bbe\u8ba1\uff1aClipped Margin** (\u8026\u5408\u70b92)\uff1a\u6211\u4eec\u5c06 `zscore` \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `cost_diff_zscore` \u4e0e\u4e00\u4e2a\u8d85\u53c2\u6570 `beta` \u76f8\u4e58\uff0c\u5e76\u4f7f\u7528 `clamp` \u51fd\u6570\u5c06\u5176\u88c1\u526a\u5230\u4e00\u4e2a\u56fa\u5b9a\u7684\u8303\u56f4 `[0, M]`\uff0c\u4ece\u800c\u5f62\u6210\u4e00\u4e2a\u6709\u754c\u7684\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u3002\u8fd9\u4e2a\u88d5\u5ea6 `clipped_margin` \u88ab\u52a0\u5230\u6a21\u578b\u7684\u7a33\u5b9a\u6982\u7387\u5dee `stable_logp_diff` \u4e0a\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7684\u4f18\u52bf\u5728\u4e8e\uff1a\n    *   **\u6fc0\u52b1\u4f5c\u7528**\uff1a\u88d5\u5ea6\u7684\u5b58\u5728\u610f\u5473\u7740\uff0c\u5373\u4f7f\u6a21\u578b\u7684\u9884\u6d4b\u662f\u6b63\u786e\u7684 (`stable_logp_diff > 0`)\uff0c\u4f46\u5982\u679c\u5176\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\u4ee5\u8d85\u8fc7\u88d5\u5ea6\uff0c\u4ecd\u7136\u4f1a\u4ea7\u751f\u635f\u5931\u3002\u88d5\u5ea6\u7684\u5927\u5c0f\u4e0e\u6210\u672c\u5dee\u5f02\u7684\u76f8\u5bf9\u663e\u8457\u6027\uff08z-score\uff09\u6210\u6b63\u6bd4\uff0c\u9f13\u52b1\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u4ea7\u751f\u66f4\u5f3a\u7684\u504f\u597d\u4fe1\u53f7\u3002\n    *   **\u7a33\u5b9a\u6027**\uff1a\u901a\u8fc7 `clamp` \u64cd\u4f5c\uff0c\u6211\u4eec\u4e3a\u88d5\u5ea6\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u4e0a\u9650 `M`\u3002\u8fd9\u53ef\u4ee5\u9632\u6b62\u6279\u6b21\u4e2d\u6781\u7aef\u5927\u7684 `zscore` \u4ea7\u751f\u8fc7\u5927\u7684\u88d5\u5ea6\uff0c\u4ece\u800c\u907f\u514d\u5bf9\u6a21\u578b\u65bd\u52a0\u4e0d\u5207\u5b9e\u9645\u7684\u4f18\u5316\u76ee\u6807\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n\u603b\u7ed3\u6765\u8bf4\uff0c\u8be5\u635f\u5931\u51fd\u6570\u901a\u8fc7 `zscore` \u611f\u77e5\u6279\u6b21\u5185\u7684\u6210\u672c\u5dee\u5f02\u5206\u5e03\uff0c\u5229\u7528\u4e00\u4e2a\u6709\u754c\u7684\u3001\u52a8\u6001\u7684 `clipped_margin` \u6765\u6fc0\u52b1\u6a21\u578b\u5b66\u4e60\uff0c\u5e76\u7ed3\u5408 `tanh` \u548c `logsigmoid` \u6846\u67b6\u6765\u4fdd\u8bc1\u6574\u4f53\u7684\u6570\u503c\u7a33\u5b9a\u6027\u548c\u5e73\u6ed1\u6027\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86 z-score \u5316\u7684\u6210\u672c\u5dee\u5f02\u8f6c\u5316\u4e3a\u88d5\u5ea6\u7684\u5f3a\u5ea6\u3002\u8f83\u5927\u7684 beta \u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u7684\u76f8\u5bf9\u5927\u5c0f\u5bf9\u88d5\u5ea6\u7684\u5f71\u54cd\u66f4\u5927\u3002"}, "M": {"value": 5.0, "description": "\u88d5\u5ea6\u4e0a\u9650\u3002\u8fd9\u662f\u4e00\u4e2a\u7a33\u5b9a\u5316\u53c2\u6570\uff0c\u7528\u4e8e\u9632\u6b62\u6279\u6b21\u4e2d\u6781\u7aef\u7684\u6210\u672c\u5dee\u5f02\uff08\u5373\u4f7f\u5728 z-score \u5316\u540e\uff09\u4ea7\u751f\u8fc7\u5927\u7684\u88d5\u5ea6\u76ee\u6807\uff0c\u4ece\u800c\u4fdd\u8bc1\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002"}}, "operators_used": ["tanh", "zscore", "clamp", "logsigmoid"]}}}
{"generation": 2, "index": 2, "ir": {"name": "ZScoreClippedAdaptiveHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u80fd\u52a8\u6001\u8c03\u6574\u5b66\u4e60\u5f3a\u5ea6\uff0c\u53c8\u80fd\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784\uff0c\u5373 `softplus(margin - logp_diff)`\u3002\u8fd9\u79cd\u7ed3\u6784\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6e05\u6670\u7684\u201c\u6ee1\u8db3\u533a\u201d\uff1a\u53ea\u8981\u6a21\u578b\u5bf9\u4f18\u80dc\u8005(winner)\u7684\u9884\u6d4b\u6982\u7387\uff08logp_w\uff09\u6bd4\u5931\u8d25\u8005(loser)\u7684\u9884\u6d4b\u6982\u7387\uff08logp_l\uff09\u9ad8\u51fa\u67d0\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6(margin)\uff0c\u635f\u5931\u5c31\u8d8b\u8fd1\u4e8e\u96f6\u3002\u540c\u65f6\uff0c\u6211\u4eec\u501f\u9274\u4e86\u5176\u4f7f\u7528 `tanh` \u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u7684\u6280\u5de7\uff0c\u5c06\u5176\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u6709\u6548\u9632\u6b62\u4e86\u68af\u5ea6\u7206\u70b8\u3002\n2.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u7406\u5ff5\uff0c\u5373\u635f\u5931\u7684\u5f3a\u5ea6\uff08\u6216\u88d5\u5ea6\u7684\u5927\u5c0f\uff09\u5e94\u8be5\u4e0e\u6210\u672c\u5dee\u5f02\uff08cost difference\uff09\u7684\u5927\u5c0f\u6b63\u76f8\u5173\u3002\u5f53\u4e24\u4e2a\u89e3\u7684\u6210\u672c\u5dee\u5f02\u5de8\u5927\u65f6\uff0c\u6a21\u578b\u5e94\u8be5\u53d7\u5230\u66f4\u5f3a\u7684\u60e9\u7f5a\u6765\u5b66\u4e60\u8fd9\u79cd\u660e\u786e\u7684\u504f\u597d\u3002\u5f53\u6210\u672c\u5dee\u5f02\u5f88\u5c0f\u65f6\uff0c\u60e9\u7f5a\u5e94\u8be5\u66f4\u6e29\u548c\uff0c\u4ee5\u907f\u514d\u5728\u6a21\u7cca\u7684\u504f\u597d\u4e0a\u8fc7\u5ea6\u5b66\u4e60\u3002\n\n**\u65b0\u7684\u8026\u5408\u70b9\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f - Z-Score (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u3002`zscore(costs)` \u4f1a\u5728\u4e00\u4e2a\u6279\u6b21(batch)\u5185\u5bf9\u6240\u6709\u6210\u672c\u8fdb\u884c\u6807\u51c6\u5316\uff08\u51cf\u53bb\u5747\u503c\uff0c\u9664\u4ee5\u6807\u51c6\u5dee\uff09\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u6210\u672c\u5dee\u5f02 `cost_l - cost_w` \u4e0d\u518d\u662f\u4e00\u4e2a\u7edd\u5bf9\u503c\uff0c\u800c\u662f\u4e00\u4e2a\u76f8\u5bf9\u4e8e\u5f53\u524d\u6279\u6b21\u6570\u636e\u5206\u5e03\u7684\u76f8\u5bf9\u503c\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u8ba1\u7b97\u5bf9\u6210\u672c\u7684\u6574\u4f53\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u9c81\u68d2\u6027\u66f4\u5f3a\u3002\u4f8b\u5982\uff0c\u65e0\u8bba\u6210\u672c\u662f `[1001, 1002]` \u8fd8\u662f `[1, 2]`\uff0cz-score\u540e\u7684\u5dee\u5f02\u90fd\u662f\u76f8\u4f3c\u7684\uff0c\u800c\u539f\u59cb\u5dee\u5f02\u5219\u76f8\u5dee1000\u500d\u3002\n2.  **\u65b0\u7684\u88d5\u5ea6\u8bbe\u8ba1\u4e0e\u7a33\u5b9a\u6280\u5de7 - Clipped Scaling (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u7ed3\u5408\u4e86\u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u7f29\u653e\u601d\u60f3\u548c\u7ee7\u627f\u81ea\u7236\u4ee30\u7684Hinge Loss\u7ed3\u6784\u3002\u6211\u4eec\u5c06z-score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_cost_diff` \u76f4\u63a5\u7528\u4f5c\u52a8\u6001\u88d5\u5ea6\u7684\u57fa\u7840\u3002\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u7a33\u5b9a\u6027\uff0c\u6211\u4eec\u5f15\u5165\u4e86 `clamp` \u7b97\u5b50\uff0c\u5c06\u8fd9\u4e2a\u88d5\u5ea6\u9650\u5236\u5728\u4e00\u4e2a\u5408\u7406\u7684\u8303\u56f4 `[0, max_margin]` \u5185\u3002\u8fd9\u6709\u4e24\u4e2a\u4f5c\u7528\uff1aa) \u786e\u4fdd\u88d5\u5ea6\u59cb\u7ec8\u4e3a\u975e\u8d1f\u503c\uff1bb) \u9632\u6b62\u7531\u4e8e\u6781\u7aef\u7684\u6210\u672c\u5f02\u5e38\u503c\uff08\u5373\u4f7f\u7ecf\u8fc7z-score\u540e\uff09\u5bfc\u81f4\u88d5\u5ea6\u8fc7\u5927\uff0c\u4ece\u800c\u907f\u514d\u4ea7\u751f\u8fc7\u5927\u7684\u68af\u5ea6\u3002\u8d85\u53c2\u6570 `beta` \u63a7\u5236\u7740\u8fd9\u4e2a\u88d5\u5ea6\u7684\u7f29\u653e\u6bd4\u4f8b\u3002\n\n\u603b\u7ed3\u6765\u8bf4\uff0c`ZScoreClippedAdaptiveHingeLoss` \u901a\u8fc7z-score\u6807\u51c6\u5316\u6765\u83b7\u5f97\u4e00\u4e2a\u4e0e\u6279\u6b21\u5206\u5e03\u76f8\u5173\u7684\u3001\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\uff0c\u7136\u540e\u5c06\u5176\u7ebf\u6027\u7f29\u653e\u5e76\u88c1\u526a\uff0c\u5f62\u6210\u4e00\u4e2a\u7a33\u5b9a\u7684\u52a8\u6001\u88d5\u5ea6\u3002\u6700\u540e\uff0c\u5c06\u8fd9\u4e2a\u88d5\u5ea6\u5e94\u7528\u4e8e\u7ecf\u5178\u7684 `tanh` \u7a33\u5b9a\u7684\u5e73\u6ed1Hinge Loss\u6846\u67b6\u4e2d\uff0c\u4ece\u800c\u5728\u9c81\u68d2\u6027\u3001\u81ea\u9002\u5e94\u6027\u548c\u6570\u503c\u7a33\u5b9a\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "pseudocode": "def ZScoreClippedAdaptiveHingeLoss(all_costs_in_batch, cost_a, cost_b, logp_a, logp_b, beta, max_margin):\n    # 0. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 1. [\u65b0\u8026\u5408\u70b91] \u5bf9\u6279\u6b21\u5185\u7684\u6240\u6709\u6210\u672c\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\n    #    \u8fd9\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u4e0e\u6279\u6b21\u7684\u6574\u4f53\u5206\u5e03\u76f8\u5173\uff0c\u589e\u5f3a\u9c81\u68d2\u6027\n    z_costs = zscore(all_costs_in_batch)\n    #    \u6839\u636e\u539f\u59cb\u7d22\u5f15\u627e\u5230\u5f52\u4e00\u5316\u540e\u7684 cost_w \u548c cost_l\n    z_cost_w = z_costs[index_of_cost_w]\n    z_cost_l = z_costs[index_of_cost_l]\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u601d\u60f3] \u8ba1\u7b97\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\n    #    \u9884\u671f z_cost_l > z_cost_w\uff0c\u6240\u4ee5\u5dee\u503c\u4e3a\u6b63\n    z_cost_diff = z_cost_l - z_cost_w\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u4e00\u4e2a\u7ecf\u88c1\u526a\u548c\u7f29\u653e\u7684\u52a8\u6001\u88d5\u5ea6\n    #    beta \u63a7\u5236\u7f29\u653e\u6bd4\u4f8b\uff0cclamp \u786e\u4fdd\u88d5\u5ea6\u7a33\u5b9a\u5728 [0, max_margin] \u533a\u95f4\u5185\n    #    \u8fd9\u9632\u6b62\u4e86\u6781\u7aef\u6210\u672c\u5dee\u5f02\u5bfc\u81f4\u8fc7\u5927\u7684\u88d5\u5ea6\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\n    dynamic_margin = clamp(beta * z_cost_diff, 0, max_margin)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\n    #    (logp_w - logp_l) \u671f\u671b\u4e3a\u6b63\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e73\u6ed1\u7684Hinge Loss\n    #    \u5f53\u6a21\u578b\u7684\u504f\u597d(stable_logp_diff)\u5c0f\u4e8e\u8981\u6c42\u7684\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\n    #    softplus(x) \u662f relu(x) \u7684\u5e73\u6ed1\u8fd1\u4f3c\n    loss = softplus(dynamic_margin - stable_logp_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236z-score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u76f8\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\u3002"}, "max_margin": {"value": 5.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7684\u4e0a\u9650\u3002\u6b64\u53c2\u6570\u7528\u4e8e\u88c1\u526a\u88d5\u5ea6\uff0c\u9632\u6b62\u56e0\u6279\u6b21\u5185\u6781\u7aef\u7684\u6210\u672c\u5f02\u5e38\u503c\u5bfc\u81f4\u88d5\u5ea6\u8fc7\u5927\uff0c\u4ece\u800c\u907f\u514d\u4ea7\u751f\u8fc7\u5927\u7684\u68af\u5ea6\uff0c\u589e\u5f3a\u8bad\u7ec3\u7a33\u5b9a\u6027\u3002"}}, "operators_used": ["zscore", "clamp", "tanh", "softplus"], "implementation_hint": {"expects": ["all_costs_in_batch: a 1D tensor of all costs in the current batch. cost_a, cost_b: scalar costs for the pair. logp_a, logp_b: scalar log probabilities for the pair. beta, max_margin: scalar hyperparameters. Note: You'll need to know the original indices of cost_a and cost_b within all_costs_in_batch to retrieve their z-scored values."], "returns": "A scalar loss value."}}, "fitness": {"hf_like_score": 4.044807195663452, "validation_objective": 4.044807195663452, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.9858287572860718}, "train_score_mean": 4.2179932445287704, "train_loss_mean": 0.6928663142025471, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedAdaptiveHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u80fd\u52a8\u6001\u8c03\u6574\u5b66\u4e60\u5f3a\u5ea6\uff0c\u53c8\u80fd\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784\uff0c\u5373 `softplus(margin - logp_diff)`\u3002\u8fd9\u79cd\u7ed3\u6784\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6e05\u6670\u7684\u201c\u6ee1\u8db3\u533a\u201d\uff1a\u53ea\u8981\u6a21\u578b\u5bf9\u4f18\u80dc\u8005(winner)\u7684\u9884\u6d4b\u6982\u7387\uff08logp_w\uff09\u6bd4\u5931\u8d25\u8005(loser)\u7684\u9884\u6d4b\u6982\u7387\uff08logp_l\uff09\u9ad8\u51fa\u67d0\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6(margin)\uff0c\u635f\u5931\u5c31\u8d8b\u8fd1\u4e8e\u96f6\u3002\u540c\u65f6\uff0c\u6211\u4eec\u501f\u9274\u4e86\u5176\u4f7f\u7528 `tanh` \u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u7684\u6280\u5de7\uff0c\u5c06\u5176\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u6709\u6548\u9632\u6b62\u4e86\u68af\u5ea6\u7206\u70b8\u3002\n2.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u7406\u5ff5\uff0c\u5373\u635f\u5931\u7684\u5f3a\u5ea6\uff08\u6216\u88d5\u5ea6\u7684\u5927\u5c0f\uff09\u5e94\u8be5\u4e0e\u6210\u672c\u5dee\u5f02\uff08cost difference\uff09\u7684\u5927\u5c0f\u6b63\u76f8\u5173\u3002\u5f53\u4e24\u4e2a\u89e3\u7684\u6210\u672c\u5dee\u5f02\u5de8\u5927\u65f6\uff0c\u6a21\u578b\u5e94\u8be5\u53d7\u5230\u66f4\u5f3a\u7684\u60e9\u7f5a\u6765\u5b66\u4e60\u8fd9\u79cd\u660e\u786e\u7684\u504f\u597d\u3002\u5f53\u6210\u672c\u5dee\u5f02\u5f88\u5c0f\u65f6\uff0c\u60e9\u7f5a\u5e94\u8be5\u66f4\u6e29\u548c\uff0c\u4ee5\u907f\u514d\u5728\u6a21\u7cca\u7684\u504f\u597d\u4e0a\u8fc7\u5ea6\u5b66\u4e60\u3002\n\n**\u65b0\u7684\u8026\u5408\u70b9\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f - Z-Score (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u3002`zscore(costs)` \u4f1a\u5728\u4e00\u4e2a\u6279\u6b21(batch)\u5185\u5bf9\u6240\u6709\u6210\u672c\u8fdb\u884c\u6807\u51c6\u5316\uff08\u51cf\u53bb\u5747\u503c\uff0c\u9664\u4ee5\u6807\u51c6\u5dee\uff09\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u6210\u672c\u5dee\u5f02 `cost_l - cost_w` \u4e0d\u518d\u662f\u4e00\u4e2a\u7edd\u5bf9\u503c\uff0c\u800c\u662f\u4e00\u4e2a\u76f8\u5bf9\u4e8e\u5f53\u524d\u6279\u6b21\u6570\u636e\u5206\u5e03\u7684\u76f8\u5bf9\u503c\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u8ba1\u7b97\u5bf9\u6210\u672c\u7684\u6574\u4f53\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u9c81\u68d2\u6027\u66f4\u5f3a\u3002\u4f8b\u5982\uff0c\u65e0\u8bba\u6210\u672c\u662f `[1001, 1002]` \u8fd8\u662f `[1, 2]`\uff0cz-score\u540e\u7684\u5dee\u5f02\u90fd\u662f\u76f8\u4f3c\u7684\uff0c\u800c\u539f\u59cb\u5dee\u5f02\u5219\u76f8\u5dee1000\u500d\u3002\n2.  **\u65b0\u7684\u88d5\u5ea6\u8bbe\u8ba1\u4e0e\u7a33\u5b9a\u6280\u5de7 - Clipped Scaling (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u7ed3\u5408\u4e86\u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u7f29\u653e\u601d\u60f3\u548c\u7ee7\u627f\u81ea\u7236\u4ee30\u7684Hinge Loss\u7ed3\u6784\u3002\u6211\u4eec\u5c06z-score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_cost_diff` \u76f4\u63a5\u7528\u4f5c\u52a8\u6001\u88d5\u5ea6\u7684\u57fa\u7840\u3002\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u7a33\u5b9a\u6027\uff0c\u6211\u4eec\u5f15\u5165\u4e86 `clamp` \u7b97\u5b50\uff0c\u5c06\u8fd9\u4e2a\u88d5\u5ea6\u9650\u5236\u5728\u4e00\u4e2a\u5408\u7406\u7684\u8303\u56f4 `[0, max_margin]` \u5185\u3002\u8fd9\u6709\u4e24\u4e2a\u4f5c\u7528\uff1aa) \u786e\u4fdd\u88d5\u5ea6\u59cb\u7ec8\u4e3a\u975e\u8d1f\u503c\uff1bb) \u9632\u6b62\u7531\u4e8e\u6781\u7aef\u7684\u6210\u672c\u5f02\u5e38\u503c\uff08\u5373\u4f7f\u7ecf\u8fc7z-score\u540e\uff09\u5bfc\u81f4\u88d5\u5ea6\u8fc7\u5927\uff0c\u4ece\u800c\u907f\u514d\u4ea7\u751f\u8fc7\u5927\u7684\u68af\u5ea6\u3002\u8d85\u53c2\u6570 `beta` \u63a7\u5236\u7740\u8fd9\u4e2a\u88d5\u5ea6\u7684\u7f29\u653e\u6bd4\u4f8b\u3002\n\n\u603b\u7ed3\u6765\u8bf4\uff0c`ZScoreClippedAdaptiveHingeLoss` \u901a\u8fc7z-score\u6807\u51c6\u5316\u6765\u83b7\u5f97\u4e00\u4e2a\u4e0e\u6279\u6b21\u5206\u5e03\u76f8\u5173\u7684\u3001\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\uff0c\u7136\u540e\u5c06\u5176\u7ebf\u6027\u7f29\u653e\u5e76\u88c1\u526a\uff0c\u5f62\u6210\u4e00\u4e2a\u7a33\u5b9a\u7684\u52a8\u6001\u88d5\u5ea6\u3002\u6700\u540e\uff0c\u5c06\u8fd9\u4e2a\u88d5\u5ea6\u5e94\u7528\u4e8e\u7ecf\u5178\u7684 `tanh` \u7a33\u5b9a\u7684\u5e73\u6ed1Hinge Loss\u6846\u67b6\u4e2d\uff0c\u4ece\u800c\u5728\u9c81\u68d2\u6027\u3001\u81ea\u9002\u5e94\u6027\u548c\u6570\u503c\u7a33\u5b9a\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236z-score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u76f8\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\u3002"}, "max_margin": {"value": 5.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7684\u4e0a\u9650\u3002\u6b64\u53c2\u6570\u7528\u4e8e\u88c1\u526a\u88d5\u5ea6\uff0c\u9632\u6b62\u56e0\u6279\u6b21\u5185\u6781\u7aef\u7684\u6210\u672c\u5f02\u5e38\u503c\u5bfc\u81f4\u88d5\u5ea6\u8fc7\u5927\uff0c\u4ece\u800c\u907f\u514d\u4ea7\u751f\u8fc7\u5927\u7684\u68af\u5ea6\uff0c\u589e\u5f3a\u8bad\u7ec3\u7a33\u5b9a\u6027\u3002"}}, "operators_used": ["zscore", "clamp", "tanh", "softplus"]}}}
{"generation": 2, "index": 3, "ir": {"name": "HybridMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u6709\u660e\u786e\u504f\u597d\u8fb9\u754c\uff08margin\uff09\uff0c\u53c8\u80fd\u5728\u6574\u4e2a\u6570\u503c\u8303\u56f4\u5185\u5e73\u6ed1\u60e9\u7f5a\u7684\u9c81\u68d2\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - value)` \u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u4e3a\u6a21\u578b\u5b66\u4e60\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\uff1a\u53ea\u8981\u6a21\u578b\u7684\u504f\u597d\u9884\u6d4b\uff08`value`\uff09\u8d85\u8fc7\u4e86\u52a8\u6001\u8bbe\u5b9a\u7684\u8fb9\u754c\uff08`margin`\uff09\uff0c\u635f\u5931\u5c31\u8d8b\u8fd1\u4e8e\u96f6\u3002\u8fd9\u6709\u52a9\u4e8e\u6a21\u578b\u5728\u201c\u8db3\u591f\u597d\u201d\u7684\u65f6\u5019\u7a33\u5b9a\u4e0b\u6765\uff0c\u907f\u514d\u5bf9\u5df2\u7ecf\u6b63\u786e\u5206\u7c7b\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u4e0d\u5fc5\u8981\u7684\u68af\u5ea6\u3002\n2.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176 `-logsigmoid(x)` \u7684\u6838\u5fc3\u635f\u5931\u5f62\u5f0f\u3002`logsigmoid` \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5e73\u6ed1\u3001\u6709\u754c\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u60e9\u7f5a\u673a\u5236\u3002\u4e0e `softplus` \u4e0d\u540c\uff0c`logsigmoid` \u5bf9\u6240\u6709 `x < 0` \u7684\u60c5\u51b5\u90fd\u4f1a\u4ea7\u751f\u975e\u96f6\u68af\u5ea6\uff0c\u8fd9\u610f\u5473\u7740\u5373\u4f7f\u6a21\u578b\u7684\u9884\u6d4b\u7a0d\u5fae\u6709\u4e9b\u4e0d\u7406\u60f3\uff0c\u4e5f\u4f1a\u53d7\u5230\u6e29\u548c\u7684\u60e9\u7f5a\uff0c\u4ece\u800c\u9f13\u52b1\u6a21\u578b\u6301\u7eed\u4f18\u5316\uff0c\u800c\u4e0d\u662f\u4ec5\u4ec5\u6ee1\u8db3\u4e00\u4e2a\u786c\u8fb9\u754c\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u6df7\u5408\u635f\u5931\u7ed3\u6784\uff08\u8026\u5408\u70b91\uff09**\uff1a\u8fd9\u662f\u6700\u6838\u5fc3\u7684\u521b\u65b0\u3002\u6211\u4eec\u5c06\u4e24\u79cd\u7236\u4ee3\u7684\u7ed3\u6784\u8fdb\u884c\u4e86\u6df7\u5408\u3002\u6211\u4eec\u5c06 `RankGapScaledHingeLoss` \u4e2d\u7684 `stable_logp_diff` \u66ff\u6362\u4e3a\u4e00\u4e2a\u7531 `logsigmoid` \u9a71\u52a8\u7684\u9879\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u6838\u5fc3\u90e8\u5206\u662f `softplus(dynamic_margin - (-logsigmoid(stable_logp_diff)))`\u3002\u8fd9\u91cc\u7684 `-logsigmoid(stable_logp_diff)` \u626e\u6f14\u4e86\u201c\u60e9\u7f5a\u9879\u201d\u7684\u89d2\u8272\u3002\u5f53\u6a21\u578b\u504f\u597d\u6b63\u786e\uff08`stable_logp_diff` > 0\uff09\u65f6\uff0c`logsigmoid` \u63a5\u8fd10\uff0c`-logsigmoid` \u4e5f\u63a5\u8fd10\uff0c\u60e9\u7f5a\u5f88\u5c0f\u3002\u5f53\u6a21\u578b\u504f\u597d\u9519\u8bef\uff08`stable_logp_diff` < 0\uff09\u65f6\uff0c`-logsigmoid` \u4f1a\u6210\u4e3a\u4e00\u4e2a\u663e\u8457\u7684\u6b63\u503c\uff0c\u5982\u679c\u8fd9\u4e2a\u60e9\u7f5a\u503c\u8d85\u8fc7\u4e86 `dynamic_margin`\uff0c\u5c31\u4f1a\u89e6\u53d1 `softplus` \u4ea7\u751f\u66f4\u5927\u7684\u635f\u5931\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7ed3\u5408\u4e86 Hinge Loss \u7684\u201c\u6ee1\u8db3\u533a\u201d\u548c LogSigmoid Loss \u7684\u201c\u5168\u7a0b\u5e73\u6ed1\u60e9\u7f5a\u201d\u7279\u6027\u3002\n2.  **\u52a8\u6001\u88d5\u5ea6\uff08Margin\uff09\u8bbe\u8ba1\uff08\u8026\u5408\u70b92\uff09**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u4e24\u4e2a\u7236\u4ee3\u90fd\u4f7f\u7528\u7684 `rank_gap` \u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u4fdd\u8bc1\u5bf9\u6210\u672c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\u3002\u7136\u540e\uff0c\u6211\u4eec\u50cf `RankGapScaledHingeLoss` \u4e00\u6837\uff0c\u4f7f\u7528 `beta * rank_gap(...)` \u6765\u521b\u5efa\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u7ebf\u6027\u76f8\u5173\u7684\u52a8\u6001\u88d5\u5ea6 `dynamic_margin`\u3002\u8fd9\u4e2a\u88d5\u5ea6\u5b9a\u4e49\u4e86\u6a21\u578b\u9700\u8981\u8fbe\u5230\u7684\u201c\u504f\u597d\u6e05\u6670\u5ea6\u201d\u7684\u9608\u503c\u3002\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u6211\u4eec\u671f\u671b\u6a21\u578b\u7ed9\u51fa\u7684\u504f\u597d\u533a\u5206\u4e5f\u8d8a\u660e\u663e\u3002\n\n\u603b\u7ed3\u6765\u8bf4\uff0c`HybridMarginLogSigmoidLoss` \u901a\u8fc7 `rank_gap` \u83b7\u5f97\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\uff0c\u5e76\u5c06\u5176\u8f6c\u5316\u4e3a\u4e00\u4e2a\u52a8\u6001\u88d5\u5ea6\u3002\u7136\u540e\uff0c\u5b83\u5728\u4e00\u4e2a Hinge-like \u7684\u6846\u67b6\u5185\uff0c\u4f7f\u7528 `logsigmoid` \u6765\u8ba1\u7b97\u4e00\u4e2a\u5e73\u6ed1\u7684\u60e9\u7f5a\u9879\u3002\u8fd9\u79cd\u6df7\u5408\u7ed3\u6784\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u65e2\u6709\u76ee\u6807\u5bfc\u5411\u6027\uff08\u8fbe\u5230\u88d5\u5ea6\uff09\uff0c\u53c8\u80fd\u5728\u672a\u8fbe\u5230\u76ee\u6807\u65f6\u63d0\u4f9b\u5e73\u6ed1\u4e14\u6301\u7eed\u7684\u4f18\u5316\u4fe1\u53f7\uff0c\u540c\u65f6\u901a\u8fc7 `tanh` \u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\uff0c\u4fdd\u8bc1\u4e86\u6574\u4f53\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002", "pseudocode": "def HybridMarginLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee30\u548c1] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    rank_gap(cost_w, cost_l) \u8fd4\u56de\u4e00\u4e2a\u6b63\u503c\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee30, \u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u7ebf\u6027\u76f8\u5173\u7684\u52a8\u6001\u88d5\u5ea6\u3002\n    #    beta \u63a7\u5236\u88d5\u5ea6\u5bf9\u79e9\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u3002\n    dynamic_margin = beta * cost_rank_diff\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee30\u548c1] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\u3002\n    #    (logp_w - logp_l) \u671f\u671b\u4e3a\u6b63\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31, \u65b0\u8026\u5408\u70b91] \u4f7f\u7528 logsigmoid \u8ba1\u7b97\u4e00\u4e2a\u5e73\u6ed1\u7684\u60e9\u7f5a\u9879\u3002\n    #    -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u3001\u975e\u8d1f\u7684\u51f8\u51fd\u6570\u3002\n    #    \u5f53 stable_logp_diff > 0 (\u504f\u597d\u6b63\u786e) \u65f6, penalty \u63a5\u8fd1 0\u3002\n    #    \u5f53 stable_logp_diff < 0 (\u504f\u597d\u9519\u8bef) \u65f6, penalty \u662f\u4e00\u4e2a\u663e\u8457\u7684\u6b63\u503c\u3002\n    penalty_term = -logsigmoid(stable_logp_diff)\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee30, \u65b0\u8026\u5408\u70b91] \u5c06\u60e9\u7f5a\u9879\u5d4c\u5165\u5230\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\u7ed3\u6784\u4e2d\u3002\n    #    \u5f53\u60e9\u7f5a\u9879\u5c0f\u4e8e\u88d5\u5ea6\u65f6\uff0c\u635f\u5931\u8f83\u5c0f\uff1b\u5f53\u60e9\u7f5a\u9879\u8d85\u8fc7\u88d5\u5ea6\u65f6\uff0c\u635f\u5931\u663e\u8457\u589e\u52a0\u3002\n    #    \u8fd9\u9f13\u52b1\u6a21\u578b\u7684\u504f\u597d\u9519\u8bef\uff08\u7531 penalty_term \u91cf\u5316\uff09\u4e0d\u8981\u8d85\u8fc7\u4e00\u4e2a\u7531\u6210\u672c\u5dee\u5f02\u51b3\u5b9a\u7684\u52a8\u6001\u9608\u503c\u3002\n    loss = softplus(penalty_term - dynamic_margin)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u52a8\u6001\u88d5\u5ea6\u5bf9\u6210\u672c\u79e9\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff0c\u6a21\u578b\u9700\u8981\u8fbe\u5230\u7684\u504f\u597d\u6e05\u6670\u5ea6\u9608\u503c\u66f4\u9ad8\u3002"}}, "operators_used": ["rank_gap", "tanh", "logsigmoid", "softplus"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor), beta (float). Tensors are of the same shape, e.g., (batch_size,)."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.060399293899536, "validation_objective": 4.060399293899536, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.020582675933838}, "train_score_mean": 4.2749821320176125, "train_loss_mean": 0.6928306799381971, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "HybridMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u6709\u660e\u786e\u504f\u597d\u8fb9\u754c\uff08margin\uff09\uff0c\u53c8\u80fd\u5728\u6574\u4e2a\u6570\u503c\u8303\u56f4\u5185\u5e73\u6ed1\u60e9\u7f5a\u7684\u9c81\u68d2\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - value)` \u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u4e3a\u6a21\u578b\u5b66\u4e60\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\uff1a\u53ea\u8981\u6a21\u578b\u7684\u504f\u597d\u9884\u6d4b\uff08`value`\uff09\u8d85\u8fc7\u4e86\u52a8\u6001\u8bbe\u5b9a\u7684\u8fb9\u754c\uff08`margin`\uff09\uff0c\u635f\u5931\u5c31\u8d8b\u8fd1\u4e8e\u96f6\u3002\u8fd9\u6709\u52a9\u4e8e\u6a21\u578b\u5728\u201c\u8db3\u591f\u597d\u201d\u7684\u65f6\u5019\u7a33\u5b9a\u4e0b\u6765\uff0c\u907f\u514d\u5bf9\u5df2\u7ecf\u6b63\u786e\u5206\u7c7b\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u4e0d\u5fc5\u8981\u7684\u68af\u5ea6\u3002\n2.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176 `-logsigmoid(x)` \u7684\u6838\u5fc3\u635f\u5931\u5f62\u5f0f\u3002`logsigmoid` \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5e73\u6ed1\u3001\u6709\u754c\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u60e9\u7f5a\u673a\u5236\u3002\u4e0e `softplus` \u4e0d\u540c\uff0c`logsigmoid` \u5bf9\u6240\u6709 `x < 0` \u7684\u60c5\u51b5\u90fd\u4f1a\u4ea7\u751f\u975e\u96f6\u68af\u5ea6\uff0c\u8fd9\u610f\u5473\u7740\u5373\u4f7f\u6a21\u578b\u7684\u9884\u6d4b\u7a0d\u5fae\u6709\u4e9b\u4e0d\u7406\u60f3\uff0c\u4e5f\u4f1a\u53d7\u5230\u6e29\u548c\u7684\u60e9\u7f5a\uff0c\u4ece\u800c\u9f13\u52b1\u6a21\u578b\u6301\u7eed\u4f18\u5316\uff0c\u800c\u4e0d\u662f\u4ec5\u4ec5\u6ee1\u8db3\u4e00\u4e2a\u786c\u8fb9\u754c\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u6df7\u5408\u635f\u5931\u7ed3\u6784\uff08\u8026\u5408\u70b91\uff09**\uff1a\u8fd9\u662f\u6700\u6838\u5fc3\u7684\u521b\u65b0\u3002\u6211\u4eec\u5c06\u4e24\u79cd\u7236\u4ee3\u7684\u7ed3\u6784\u8fdb\u884c\u4e86\u6df7\u5408\u3002\u6211\u4eec\u5c06 `RankGapScaledHingeLoss` \u4e2d\u7684 `stable_logp_diff` \u66ff\u6362\u4e3a\u4e00\u4e2a\u7531 `logsigmoid` \u9a71\u52a8\u7684\u9879\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u6838\u5fc3\u90e8\u5206\u662f `softplus(dynamic_margin - (-logsigmoid(stable_logp_diff)))`\u3002\u8fd9\u91cc\u7684 `-logsigmoid(stable_logp_diff)` \u626e\u6f14\u4e86\u201c\u60e9\u7f5a\u9879\u201d\u7684\u89d2\u8272\u3002\u5f53\u6a21\u578b\u504f\u597d\u6b63\u786e\uff08`stable_logp_diff` > 0\uff09\u65f6\uff0c`logsigmoid` \u63a5\u8fd10\uff0c`-logsigmoid` \u4e5f\u63a5\u8fd10\uff0c\u60e9\u7f5a\u5f88\u5c0f\u3002\u5f53\u6a21\u578b\u504f\u597d\u9519\u8bef\uff08`stable_logp_diff` < 0\uff09\u65f6\uff0c`-logsigmoid` \u4f1a\u6210\u4e3a\u4e00\u4e2a\u663e\u8457\u7684\u6b63\u503c\uff0c\u5982\u679c\u8fd9\u4e2a\u60e9\u7f5a\u503c\u8d85\u8fc7\u4e86 `dynamic_margin`\uff0c\u5c31\u4f1a\u89e6\u53d1 `softplus` \u4ea7\u751f\u66f4\u5927\u7684\u635f\u5931\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7ed3\u5408\u4e86 Hinge Loss \u7684\u201c\u6ee1\u8db3\u533a\u201d\u548c LogSigmoid Loss \u7684\u201c\u5168\u7a0b\u5e73\u6ed1\u60e9\u7f5a\u201d\u7279\u6027\u3002\n2.  **\u52a8\u6001\u88d5\u5ea6\uff08Margin\uff09\u8bbe\u8ba1\uff08\u8026\u5408\u70b92\uff09**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u4e24\u4e2a\u7236\u4ee3\u90fd\u4f7f\u7528\u7684 `rank_gap` \u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u4fdd\u8bc1\u5bf9\u6210\u672c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\u3002\u7136\u540e\uff0c\u6211\u4eec\u50cf `RankGapScaledHingeLoss` \u4e00\u6837\uff0c\u4f7f\u7528 `beta * rank_gap(...)` \u6765\u521b\u5efa\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u7ebf\u6027\u76f8\u5173\u7684\u52a8\u6001\u88d5\u5ea6 `dynamic_margin`\u3002\u8fd9\u4e2a\u88d5\u5ea6\u5b9a\u4e49\u4e86\u6a21\u578b\u9700\u8981\u8fbe\u5230\u7684\u201c\u504f\u597d\u6e05\u6670\u5ea6\u201d\u7684\u9608\u503c\u3002\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u6211\u4eec\u671f\u671b\u6a21\u578b\u7ed9\u51fa\u7684\u504f\u597d\u533a\u5206\u4e5f\u8d8a\u660e\u663e\u3002\n\n\u603b\u7ed3\u6765\u8bf4\uff0c`HybridMarginLogSigmoidLoss` \u901a\u8fc7 `rank_gap` \u83b7\u5f97\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\uff0c\u5e76\u5c06\u5176\u8f6c\u5316\u4e3a\u4e00\u4e2a\u52a8\u6001\u88d5\u5ea6\u3002\u7136\u540e\uff0c\u5b83\u5728\u4e00\u4e2a Hinge-like \u7684\u6846\u67b6\u5185\uff0c\u4f7f\u7528 `logsigmoid` \u6765\u8ba1\u7b97\u4e00\u4e2a\u5e73\u6ed1\u7684\u60e9\u7f5a\u9879\u3002\u8fd9\u79cd\u6df7\u5408\u7ed3\u6784\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u65e2\u6709\u76ee\u6807\u5bfc\u5411\u6027\uff08\u8fbe\u5230\u88d5\u5ea6\uff09\uff0c\u53c8\u80fd\u5728\u672a\u8fbe\u5230\u76ee\u6807\u65f6\u63d0\u4f9b\u5e73\u6ed1\u4e14\u6301\u7eed\u7684\u4f18\u5316\u4fe1\u53f7\uff0c\u540c\u65f6\u901a\u8fc7 `tanh` \u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\uff0c\u4fdd\u8bc1\u4e86\u6574\u4f53\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u52a8\u6001\u88d5\u5ea6\u5bf9\u6210\u672c\u79e9\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff0c\u6a21\u578b\u9700\u8981\u8fbe\u5230\u7684\u504f\u597d\u6e05\u6670\u5ea6\u9608\u503c\u66f4\u9ad8\u3002"}}, "operators_used": ["rank_gap", "tanh", "logsigmoid", "softplus"]}}}
{"generation": 2, "index": 6, "ir": {"name": "HybridLogitClippedLoss", "intuition": "\u8be5\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u4f18\u52bf\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\u6765\u589e\u5f3a\u7a33\u5b9a\u6027\u548c\u7075\u6d3b\u6027\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u9c81\u68d2\u7684`rank_gap`\u7b97\u5b50\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u503c\u548c\u5f02\u5e38\u503c\u4e0d\u654f\u611f\uff0c\u66f4\u5173\u6ce8\u6210\u672c\u7684\u76f8\u5bf9\u6392\u5e8f\uff0c\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\n2.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u635f\u5931\u7ed3\u6784\u3002`-logsigmoid(x)` \u662f\u4e00\u4e2a\u7ecf\u8fc7\u5145\u5206\u9a8c\u8bc1\u7684\u3001\u5e73\u6ed1\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u6210\u5bf9\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u81ea\u7136\u5730\u60e9\u7f5a `x < 0` \u7684\u60c5\u51b5\uff08\u5373\u6a21\u578b\u504f\u597d\u4e0e\u771f\u5b9e\u504f\u597d\u4e0d\u7b26\uff09\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u6df7\u5408Logit\u8bbe\u8ba1)**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u6838\u5fc3\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee31\u90a3\u6837\uff0c\u5c06\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a\u6982\u7387\u5dee\u5f02\u7684\u201c\u7f29\u653e\u56e0\u5b50\u201d\uff0c\u800c\u662f\u5c06\u5176\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u201clogit\u201d\u9879\uff0c\u4e0e\u6982\u7387\u5dee\u5f02\u7684logit\u9879\u76f8\u52a0\u3002\u5177\u4f53\u6765\u8bf4\uff0c`logit_sum = (logp_w - logp_l) + beta * rank_gap(cost_w, cost_l)`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5728\u601d\u60f3\u4e0a\u66f4\u63a5\u8fd1\u4e8e\u4e00\u4e2a\u6df7\u5408\u6a21\u578b\uff1a\u6a21\u578b\u9700\u8981\u540c\u65f6\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\u624d\u80fd\u83b7\u5f97\u4f4e\u635f\u5931\uff1a1) \u6982\u7387\u4e0a\u504f\u597d\u4f18\u80dc\u8005 (`logp_w > logp_l`)\uff1b2) \u8fd9\u4e2a\u504f\u597d\u8981\u8db3\u591f\u5f3a\uff0c\u4ee5\u514b\u670d\u6210\u672c\u5dee\u5f02\u5e26\u6765\u7684\u201c\u963b\u529b\u201d\u3002`beta`\u53c2\u6570\u63a7\u5236\u4e86\u6210\u672c\u5dee\u5f02\u7684\u91cd\u8981\u6027\u3002\u8fd9\u79cd\u52a0\u6cd5\u8026\u5408\u6bd4\u4e58\u6cd5\u8026\u5408\uff08\u5982\u7236\u4ee31\uff09\u5728\u68af\u5ea6\u4e0a\u66f4\u7a33\u5b9a\uff0c\u907f\u514d\u4e86\u5f53\u4e00\u4e2a\u9879\u4e3a\u96f6\u65f6\u68af\u5ea6\u6d88\u5931\u7684\u95ee\u9898\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Logit\u88c1\u526a\u7a33\u5b9a\u6280\u5de7)**\uff1a\u4e3a\u4e86\u9632\u6b62 `logit_sum` \u56e0\u4e3a\u6781\u7aef\u7684\u6982\u7387\u6216\u6210\u672c\u5dee\u5f02\u800c\u53d8\u5f97\u8fc7\u5927\u6216\u8fc7\u5c0f\uff0c\u5bfc\u81f4 `logsigmoid` \u8fdb\u5165\u9971\u548c\u533a\uff08\u68af\u5ea6\u6d88\u5931\uff09\u6216\u4ea7\u751f\u6570\u503c\u6ea2\u51fa\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a`clamp`\u64cd\u4f5c\u3002`clamped_logit = clamp(logit_sum, min=-gamma, max=gamma)`\u3002\u8fd9\u4e2a\u64cd\u4f5c\u5c06logit\u7684\u8303\u56f4\u9650\u5236\u5728\u4e00\u4e2a\u5bf9\u79f0\u7684\u533a\u95f4 `[-gamma, gamma]` \u5185\uff0c\u786e\u4fdd\u4e86\u4f20\u9012\u7ed9 `logsigmoid` \u7684\u503c\u603b\u662f\u5728\u4e00\u4e2a\u6570\u503c\u7a33\u5b9a\u4e14\u68af\u5ea6\u6709\u6548\u7684\u533a\u57df\u5185\u3002\u8fd9\u662f\u4e00\u79cd\u7b80\u5355\u800c\u6709\u6548\u7684\u7a33\u5b9a\u6280\u5de7\uff0c\u4e24\u4e2a\u7236\u4ee3\u5747\u672a\u4f7f\u7528\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`HybridLogitClippedLoss` \u901a\u8fc7\u5c06\u6982\u7387\u5dee\u5f02\u548c\u7ecf`rank_gap`\u5904\u7406\u7684\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a\u4e24\u4e2a\u72ec\u7acb\u7684logit\u9879\u76f8\u52a0\uff0c\u521b\u9020\u4e86\u4e00\u79cd\u65b0\u9896\u7684\u6df7\u5408\u504f\u597d\u4fe1\u53f7\u3002\u7136\u540e\uff0c\u901a\u8fc7\u5bf9\u8fd9\u4e2a\u6df7\u5408logit\u8fdb\u884c\u88c1\u526a\uff0c\u5e76\u6700\u7ec8\u5e94\u7528`logsigmoid`\u635f\u5931\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5728\u9c81\u68d2\u6027\u3001\u7075\u6d3b\u6027\u548c\u6570\u503c\u7a33\u5b9a\u6027\u65b9\u9762\u90fd\u5f97\u5230\u589e\u5f3a\u7684\u65b0\u578b\u504f\u597d\u635f\u5931\u3002", "pseudocode": "def HybridLogitClippedLoss(cost_a, cost_b, logp_a, logp_b, beta, gamma):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    rank_gap(cost_w, cost_l) \u8fd4\u56de\u4e00\u4e2a\u6b63\u503c\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u65b0\u8026\u5408\u70b91] \u6784\u9020\u6df7\u5408Logit\u3002\n    #    \u5c06\u6982\u7387\u5dee\u5f02\u7684logit\u548c\u6210\u672c\u5dee\u5f02\u7684logit\u76f8\u52a0\u3002\n    #    beta\u63a7\u5236\u6210\u672c\u5dee\u5f02\u9879\u7684\u6743\u91cd\u3002\n    #    \u6211\u4eec\u671f\u671b\u8fd9\u4e2a\u548c\u4e3a\u6b63\uff0c\u8868\u793a\u6a21\u578b\u504f\u597d\u4e0e\u6210\u672c\u504f\u597d\u4e00\u81f4\u3002\n    hybrid_logit = (logp_w - logp_l) + beta * cost_rank_diff\n\n    # 4. [\u65b0\u8026\u5408\u70b92] \u5bf9\u6df7\u5408Logit\u8fdb\u884c\u88c1\u526a\u4ee5\u4fdd\u8bc1\u6570\u503c\u7a33\u5b9a\u6027\u3002\n    #    \u9632\u6b62logit\u503c\u8fc7\u5927\u6216\u8fc7\u5c0f\uff0c\u5bfc\u81f4logsigmoid\u8fdb\u5165\u68af\u5ea6\u9971\u548c\u533a\u3002\n    #    gamma\u5b9a\u4e49\u4e86\u88c1\u526a\u7684\u8fb9\u754c\u3002\n    clamped_logit = clamp(hybrid_logit, min=-gamma, max=gamma)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u5e94\u7528logsigmoid\u635f\u5931\u6846\u67b6\u3002\n    #    -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u3001\u975e\u8d1f\u7684\u635f\u5931\u51fd\u6570\u3002\n    #    \u5f53 clamped_logit > 0 (\u504f\u597d\u6b63\u786e) \u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e0\u3002\n    #    \u5f53 clamped_logit < 0 (\u504f\u597d\u9519\u8bef) \u65f6\uff0c\u635f\u5931\u663e\u8457\u589e\u52a0\u3002\n    loss = -logsigmoid(clamped_logit)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u6210\u672c\u5dee\u5f02\u9879\u7684\u6743\u91cd\u56e0\u5b50\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u5728\u603blogit\u4e2d\u5360\u6709\u66f4\u9ad8\u7684\u6bd4\u91cd\uff0c\u6a21\u578b\u9700\u8981\u4ea7\u751f\u66f4\u5927\u7684\u6982\u7387\u5dee\u5f02\u6765\u514b\u670d\u6210\u672c\u52a3\u52bf\u3002"}, "gamma": {"value": 10.0, "description": "Logit\u88c1\u526a\u7684\u8fb9\u754c\u503c\u3002\u7528\u4e8e\u9632\u6b62\u6570\u503c\u6ea2\u51fa\u548c\u68af\u5ea6\u6d88\u5931\uff0c\u5c06logit\u7684\u8f93\u5165\u8303\u56f4\u9650\u5236\u5728[-gamma, gamma]\u5185\u3002\u5e94\u9009\u62e9\u4e00\u4e2a\u8db3\u591f\u5927\u7684\u503c\u4ee5\u4fdd\u7559\u5927\u90e8\u5206\u52a8\u6001\u8303\u56f4\uff0c\u4f46\u53c8\u8db3\u4ee5\u9632\u6b62\u6570\u503c\u95ee\u9898\u3002"}}, "operators_used": ["rank_gap", "clamp", "logsigmoid"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor), beta (float), gamma (float)"], "returns": "loss (Tensor, scalar)"}}, "fitness": {"hf_like_score": 4.079135894775391, "validation_objective": 4.079135894775391, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.064712762832642}, "train_score_mean": 4.227678969502449, "train_loss_mean": 0.6928445771336555, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "HybridLogitClippedLoss", "intuition": "\u8be5\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u4f18\u52bf\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\u6765\u589e\u5f3a\u7a33\u5b9a\u6027\u548c\u7075\u6d3b\u6027\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u9c81\u68d2\u7684`rank_gap`\u7b97\u5b50\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u503c\u548c\u5f02\u5e38\u503c\u4e0d\u654f\u611f\uff0c\u66f4\u5173\u6ce8\u6210\u672c\u7684\u76f8\u5bf9\u6392\u5e8f\uff0c\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\n2.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u635f\u5931\u7ed3\u6784\u3002`-logsigmoid(x)` \u662f\u4e00\u4e2a\u7ecf\u8fc7\u5145\u5206\u9a8c\u8bc1\u7684\u3001\u5e73\u6ed1\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u6210\u5bf9\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u81ea\u7136\u5730\u60e9\u7f5a `x < 0` \u7684\u60c5\u51b5\uff08\u5373\u6a21\u578b\u504f\u597d\u4e0e\u771f\u5b9e\u504f\u597d\u4e0d\u7b26\uff09\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u6df7\u5408Logit\u8bbe\u8ba1)**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u6838\u5fc3\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee31\u90a3\u6837\uff0c\u5c06\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a\u6982\u7387\u5dee\u5f02\u7684\u201c\u7f29\u653e\u56e0\u5b50\u201d\uff0c\u800c\u662f\u5c06\u5176\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u201clogit\u201d\u9879\uff0c\u4e0e\u6982\u7387\u5dee\u5f02\u7684logit\u9879\u76f8\u52a0\u3002\u5177\u4f53\u6765\u8bf4\uff0c`logit_sum = (logp_w - logp_l) + beta * rank_gap(cost_w, cost_l)`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5728\u601d\u60f3\u4e0a\u66f4\u63a5\u8fd1\u4e8e\u4e00\u4e2a\u6df7\u5408\u6a21\u578b\uff1a\u6a21\u578b\u9700\u8981\u540c\u65f6\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\u624d\u80fd\u83b7\u5f97\u4f4e\u635f\u5931\uff1a1) \u6982\u7387\u4e0a\u504f\u597d\u4f18\u80dc\u8005 (`logp_w > logp_l`)\uff1b2) \u8fd9\u4e2a\u504f\u597d\u8981\u8db3\u591f\u5f3a\uff0c\u4ee5\u514b\u670d\u6210\u672c\u5dee\u5f02\u5e26\u6765\u7684\u201c\u963b\u529b\u201d\u3002`beta`\u53c2\u6570\u63a7\u5236\u4e86\u6210\u672c\u5dee\u5f02\u7684\u91cd\u8981\u6027\u3002\u8fd9\u79cd\u52a0\u6cd5\u8026\u5408\u6bd4\u4e58\u6cd5\u8026\u5408\uff08\u5982\u7236\u4ee31\uff09\u5728\u68af\u5ea6\u4e0a\u66f4\u7a33\u5b9a\uff0c\u907f\u514d\u4e86\u5f53\u4e00\u4e2a\u9879\u4e3a\u96f6\u65f6\u68af\u5ea6\u6d88\u5931\u7684\u95ee\u9898\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Logit\u88c1\u526a\u7a33\u5b9a\u6280\u5de7)**\uff1a\u4e3a\u4e86\u9632\u6b62 `logit_sum` \u56e0\u4e3a\u6781\u7aef\u7684\u6982\u7387\u6216\u6210\u672c\u5dee\u5f02\u800c\u53d8\u5f97\u8fc7\u5927\u6216\u8fc7\u5c0f\uff0c\u5bfc\u81f4 `logsigmoid` \u8fdb\u5165\u9971\u548c\u533a\uff08\u68af\u5ea6\u6d88\u5931\uff09\u6216\u4ea7\u751f\u6570\u503c\u6ea2\u51fa\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a`clamp`\u64cd\u4f5c\u3002`clamped_logit = clamp(logit_sum, min=-gamma, max=gamma)`\u3002\u8fd9\u4e2a\u64cd\u4f5c\u5c06logit\u7684\u8303\u56f4\u9650\u5236\u5728\u4e00\u4e2a\u5bf9\u79f0\u7684\u533a\u95f4 `[-gamma, gamma]` \u5185\uff0c\u786e\u4fdd\u4e86\u4f20\u9012\u7ed9 `logsigmoid` \u7684\u503c\u603b\u662f\u5728\u4e00\u4e2a\u6570\u503c\u7a33\u5b9a\u4e14\u68af\u5ea6\u6709\u6548\u7684\u533a\u57df\u5185\u3002\u8fd9\u662f\u4e00\u79cd\u7b80\u5355\u800c\u6709\u6548\u7684\u7a33\u5b9a\u6280\u5de7\uff0c\u4e24\u4e2a\u7236\u4ee3\u5747\u672a\u4f7f\u7528\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`HybridLogitClippedLoss` \u901a\u8fc7\u5c06\u6982\u7387\u5dee\u5f02\u548c\u7ecf`rank_gap`\u5904\u7406\u7684\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a\u4e24\u4e2a\u72ec\u7acb\u7684logit\u9879\u76f8\u52a0\uff0c\u521b\u9020\u4e86\u4e00\u79cd\u65b0\u9896\u7684\u6df7\u5408\u504f\u597d\u4fe1\u53f7\u3002\u7136\u540e\uff0c\u901a\u8fc7\u5bf9\u8fd9\u4e2a\u6df7\u5408logit\u8fdb\u884c\u88c1\u526a\uff0c\u5e76\u6700\u7ec8\u5e94\u7528`logsigmoid`\u635f\u5931\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5728\u9c81\u68d2\u6027\u3001\u7075\u6d3b\u6027\u548c\u6570\u503c\u7a33\u5b9a\u6027\u65b9\u9762\u90fd\u5f97\u5230\u589e\u5f3a\u7684\u65b0\u578b\u504f\u597d\u635f\u5931\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u6210\u672c\u5dee\u5f02\u9879\u7684\u6743\u91cd\u56e0\u5b50\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u5728\u603blogit\u4e2d\u5360\u6709\u66f4\u9ad8\u7684\u6bd4\u91cd\uff0c\u6a21\u578b\u9700\u8981\u4ea7\u751f\u66f4\u5927\u7684\u6982\u7387\u5dee\u5f02\u6765\u514b\u670d\u6210\u672c\u52a3\u52bf\u3002"}, "gamma": {"value": 10.0, "description": "Logit\u88c1\u526a\u7684\u8fb9\u754c\u503c\u3002\u7528\u4e8e\u9632\u6b62\u6570\u503c\u6ea2\u51fa\u548c\u68af\u5ea6\u6d88\u5931\uff0c\u5c06logit\u7684\u8f93\u5165\u8303\u56f4\u9650\u5236\u5728[-gamma, gamma]\u5185\u3002\u5e94\u9009\u62e9\u4e00\u4e2a\u8db3\u591f\u5927\u7684\u503c\u4ee5\u4fdd\u7559\u5927\u90e8\u5206\u52a8\u6001\u8303\u56f4\uff0c\u4f46\u53c8\u8db3\u4ee5\u9632\u6b62\u6570\u503c\u95ee\u9898\u3002"}}, "operators_used": ["rank_gap", "clamp", "logsigmoid"]}}}
{"generation": 2, "index": 7, "ir": {"name": "ZScoreClippedLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee31\u548c\u7236\u4ee32\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u548c\u6982\u7387\u5206\u5e03\u53d8\u5316\u90fd\u5177\u6709\u9c81\u68d2\u6027\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5bf9\u6210\u672c\u548c\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u8fdb\u884c\u6807\u51c6\u5316\uff0c\u6765\u9002\u5e94\u4e0d\u540c\u5c3a\u5ea6\u7684\u6570\u636e\uff0c\u5e76\u4f7f\u7528\u88c1\u526a\u7684\u5bf9\u6570S\u5f62\u51fd\u6570\uff08Clipped LogSigmoid\uff09\u6765\u63d0\u4f9b\u7a33\u5b9a\u7684\u68af\u5ea6\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u91c7\u7528\u4e86 `-logsigmoid(scaled_logp_diff)` \u7684\u5f62\u5f0f\u3002\u8fd9\u79cd\u7ed3\u6784\u5929\u7136\u5730\u5c06\u4f18\u5316\u76ee\u6807\u4e0e\u6700\u5927\u5316\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u8054\u7cfb\u8d77\u6765\uff0c\u5e76\u4e14\u6570\u503c\u7a33\u5b9a\u3001\u5f62\u5f0f\u7b80\u6d01\u3002\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u7ee7\u627f\u4e86\u201c\u6839\u636e\u6210\u672c\u5dee\u5f02\u6765\u7f29\u653e\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u201d\u8fd9\u4e00\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u5e94\u8be5\u5bf9\u635f\u5931\u6709\u66f4\u5927\u7684\u8d21\u732e\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u4f7f\u7528 `tanh` \u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `logp_w - logp_l` \u7684\u6280\u5de7\u3002\u5c06\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\u5185\uff0c\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u56e0\u6781\u7aef\u6982\u7387\u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u6216\u6d88\u5931\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u6a21\u578b\u7684\u8bad\u7ec3\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f - Z-Score\uff08\u8026\u5408\u70b91\uff09**\uff1a\u4ee3\u66ff\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\uff0c\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u7b97\u5b50\u6765\u5bf9\u6279\u6b21\u5185\u7684\u6210\u672c\u5dee\u5f02 `(cost_l - cost_w)` \u8fdb\u884c\u6807\u51c6\u5316\u3002`zscore` \u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\uff0c\u8fd9\u4f7f\u5f97\u7f29\u653e\u56e0\u5b50 `scaling_factor` \u5bf9\u6279\u6b21\u5185\u6210\u672c\u7684\u7edd\u5bf9\u5927\u5c0f\u548c\u5206\u5e03\u4e0d\u654f\u611f\u3002\u65e0\u8bba\u6210\u672c\u662f `[0.1, 0.2]` \u8fd8\u662f `[100, 200]`\uff0c\u6807\u51c6\u5316\u540e\u7684\u5c3a\u5ea6\u90fd\u662f\u4e00\u81f4\u7684\u3002\u8fd9\u4f7f\u5f97\u8d85\u53c2\u6570 `beta` \u7684\u9009\u62e9\u66f4\u52a0\u9c81\u68d2\uff0c\u5e76\u4e14\u6a21\u578b\u53ef\u4ee5\u66f4\u516c\u5e73\u5730\u5904\u7406\u6765\u81ea\u4e0d\u540c\u6210\u672c\u533a\u95f4\u7684\u504f\u597d\u5bf9\u3002\n2.  **\u65b0\u7684\u7a33\u5b9a\u6280\u5de7 - \u88c1\u526a\uff08Clipping\uff09\uff08\u8026\u5408\u70b92\uff09**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u6211\u4eec\u5728\u6700\u7ec8\u7684 `logsigmoid` \u8f93\u5165\u4e0a\u589e\u52a0\u4e86\u4e00\u4e2a `clamp` \u64cd\u4f5c\u3002\u6211\u4eec\u5c06 `scaled_logp_diff` \u7684\u503c\u9650\u5236\u5728\u4e00\u4e2a\u5408\u7406\u7684\u8303\u56f4\u5185\uff08\u4f8b\u5982 `[-10, 10]`\uff09\u3002\u8fd9\u6837\u505a\u6709\u4e24\u4e2a\u597d\u5904\uff1a\u9996\u5148\uff0c\u5b83\u9632\u6b62\u4e86 `zscore` \u4ea7\u751f\u7684\u6781\u7aef\u503c\uff08\u5c3d\u7ba1\u6982\u7387\u5f88\u5c0f\uff09\u4e0e `beta` \u76f8\u4e58\u540e\u5bfc\u81f4 `logsigmoid` \u7684\u8f93\u5165\u8fc7\u5927\u6216\u8fc7\u5c0f\uff0c\u4ece\u800c\u8fdb\u5165\u68af\u5ea6\u9971\u548c\u533a\uff1b\u5176\u6b21\uff0c\u5b83\u4e3a\u635f\u5931\u7684\u68af\u5ea6\u5927\u5c0f\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u9690\u5f0f\u7684\u4e0a\u9650\uff0c\u6709\u52a9\u4e8e\u7a33\u5b9a\u8bad\u7ec3\u8fc7\u7a0b\uff0c\u5c24\u5176\u662f\u5728\u8bad\u7ec3\u521d\u671f\u3002", "pseudocode": "def ZScoreClippedLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta, clip_min, clip_max):\n    # 1. \u8bc6\u522b\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. \u8ba1\u7b97\u6210\u672c\u5dee\u5f02\n    cost_diff = cost_l - cost_w\n\n    # 3. [\u65b0\u8026\u5408\u70b91] \u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884cZ-Score\u6807\u51c6\u5316\n    #    \u8fd9\u4f7f\u5f97\u7f29\u653e\u56e0\u5b50\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u4e0d\u654f\u611f\n    #    zscore() \u671f\u671b\u8f93\u5165\u4e00\u4e2a\u6279\u6b21\u7684 cost_diff \u6570\u636e\n    zscored_cost_diff = zscore(cost_diff)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u57fa\u4e8e\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u521b\u5efa\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u7f29\u653e\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\n    scaling_factor = beta * softplus(zscored_cost_diff)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1] \u8303\u56f4\u5185\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u6838\u5fc3\u601d\u60f3] \u5c06\u7f29\u653e\u56e0\u5b50\u5e94\u7528\u4e8e\u7a33\u5b9a\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\n    #    \u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u5bf9\u6982\u7387\u5dee\u5f02\u7684\u52a0\u6743\u5c31\u8d8a\u5f3a\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 7. [\u65b0\u8026\u5408\u70b92] \u5bf9\u7f29\u653e\u540e\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u8fdb\u884c\u88c1\u526a\n    #    \u8fdb\u4e00\u6b65\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u9632\u6b62\u68af\u5ea6\u9971\u548c\n    clipped_scaled_logp_diff = clamp(scaled_logp_diff, min=clip_min, max=clip_max)\n\n    # 8. [\u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u6838\u5fc3\u7ed3\u6784] \u4f7f\u7528 logsigmoid \u8ba1\u7b97\u6700\u7ec8\u635f\u5931\n    #    -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u975e\u8d1f\u7684\u635f\u5931\u51fd\u6570\n    #    \u5f53 x > 0 (\u504f\u597d\u6b63\u786e) \u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e0\n    #    \u5f53 x < 0 (\u504f\u597d\u9519\u8bef) \u65f6\uff0c\u635f\u5931\u4f1a\u663e\u8457\u589e\u52a0\n    loss = -logsigmoid(clipped_scaled_logp_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u7f29\u653e\u56e0\u5b50\u7cfb\u6570\u3002\u63a7\u5236\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u5bf9\u6700\u7ec8\u635f\u5931\u5f71\u54cd\u7684\u5f3a\u5ea6\u3002\u7531\u4e8e\u6210\u672c\u5dee\u5f02\u5df2\u88ab\u6807\u51c6\u5316\uff0cbeta \u7684\u53d6\u503c\u901a\u5e38\u5728 0.5 \u5230 5.0 \u4e4b\u95f4\u6bd4\u8f83\u9c81\u68d2\u3002"}, "clip_min": {"value": -10.0, "description": "logsigmoid \u8f93\u5165\u7684\u88c1\u526a\u4e0b\u9650\u3002\u9632\u6b62\u6570\u503c\u4e0b\u6ea2\u548c\u8fc7\u5927\u7684\u8d1f\u68af\u5ea6\u3002"}, "clip_max": {"value": 10.0, "description": "logsigmoid \u8f93\u5165\u7684\u88c1\u526a\u4e0a\u9650\u3002\u9632\u6b62\u6570\u503c\u4e0a\u6ea2\u548c\u68af\u5ea6\u9971\u548c\u3002"}}, "operators_used": ["zscore", "softplus", "tanh", "clamp", "logsigmoid"], "implementation_hint": {"expects": ["Tensors `cost_a`, `cost_b`, `logp_a`, `logp_b` of shape (B,), where B is the batch size. The `zscore` operator should be applied across the batch dimension of `cost_l - cost_w`."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.101111173629761, "validation_objective": 4.101111173629761, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.035559892654419}, "train_score_mean": 4.266413040459156, "train_loss_mean": 0.692799985408783, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee31\u548c\u7236\u4ee32\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u548c\u6982\u7387\u5206\u5e03\u53d8\u5316\u90fd\u5177\u6709\u9c81\u68d2\u6027\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5bf9\u6210\u672c\u548c\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u8fdb\u884c\u6807\u51c6\u5316\uff0c\u6765\u9002\u5e94\u4e0d\u540c\u5c3a\u5ea6\u7684\u6570\u636e\uff0c\u5e76\u4f7f\u7528\u88c1\u526a\u7684\u5bf9\u6570S\u5f62\u51fd\u6570\uff08Clipped LogSigmoid\uff09\u6765\u63d0\u4f9b\u7a33\u5b9a\u7684\u68af\u5ea6\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u91c7\u7528\u4e86 `-logsigmoid(scaled_logp_diff)` \u7684\u5f62\u5f0f\u3002\u8fd9\u79cd\u7ed3\u6784\u5929\u7136\u5730\u5c06\u4f18\u5316\u76ee\u6807\u4e0e\u6700\u5927\u5316\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u8054\u7cfb\u8d77\u6765\uff0c\u5e76\u4e14\u6570\u503c\u7a33\u5b9a\u3001\u5f62\u5f0f\u7b80\u6d01\u3002\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u7ee7\u627f\u4e86\u201c\u6839\u636e\u6210\u672c\u5dee\u5f02\u6765\u7f29\u653e\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u201d\u8fd9\u4e00\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u5e94\u8be5\u5bf9\u635f\u5931\u6709\u66f4\u5927\u7684\u8d21\u732e\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u4f7f\u7528 `tanh` \u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `logp_w - logp_l` \u7684\u6280\u5de7\u3002\u5c06\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\u5185\uff0c\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u56e0\u6781\u7aef\u6982\u7387\u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u6216\u6d88\u5931\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u6a21\u578b\u7684\u8bad\u7ec3\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f - Z-Score\uff08\u8026\u5408\u70b91\uff09**\uff1a\u4ee3\u66ff\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\uff0c\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u7b97\u5b50\u6765\u5bf9\u6279\u6b21\u5185\u7684\u6210\u672c\u5dee\u5f02 `(cost_l - cost_w)` \u8fdb\u884c\u6807\u51c6\u5316\u3002`zscore` \u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\uff0c\u8fd9\u4f7f\u5f97\u7f29\u653e\u56e0\u5b50 `scaling_factor` \u5bf9\u6279\u6b21\u5185\u6210\u672c\u7684\u7edd\u5bf9\u5927\u5c0f\u548c\u5206\u5e03\u4e0d\u654f\u611f\u3002\u65e0\u8bba\u6210\u672c\u662f `[0.1, 0.2]` \u8fd8\u662f `[100, 200]`\uff0c\u6807\u51c6\u5316\u540e\u7684\u5c3a\u5ea6\u90fd\u662f\u4e00\u81f4\u7684\u3002\u8fd9\u4f7f\u5f97\u8d85\u53c2\u6570 `beta` \u7684\u9009\u62e9\u66f4\u52a0\u9c81\u68d2\uff0c\u5e76\u4e14\u6a21\u578b\u53ef\u4ee5\u66f4\u516c\u5e73\u5730\u5904\u7406\u6765\u81ea\u4e0d\u540c\u6210\u672c\u533a\u95f4\u7684\u504f\u597d\u5bf9\u3002\n2.  **\u65b0\u7684\u7a33\u5b9a\u6280\u5de7 - \u88c1\u526a\uff08Clipping\uff09\uff08\u8026\u5408\u70b92\uff09**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u6211\u4eec\u5728\u6700\u7ec8\u7684 `logsigmoid` \u8f93\u5165\u4e0a\u589e\u52a0\u4e86\u4e00\u4e2a `clamp` \u64cd\u4f5c\u3002\u6211\u4eec\u5c06 `scaled_logp_diff` \u7684\u503c\u9650\u5236\u5728\u4e00\u4e2a\u5408\u7406\u7684\u8303\u56f4\u5185\uff08\u4f8b\u5982 `[-10, 10]`\uff09\u3002\u8fd9\u6837\u505a\u6709\u4e24\u4e2a\u597d\u5904\uff1a\u9996\u5148\uff0c\u5b83\u9632\u6b62\u4e86 `zscore` \u4ea7\u751f\u7684\u6781\u7aef\u503c\uff08\u5c3d\u7ba1\u6982\u7387\u5f88\u5c0f\uff09\u4e0e `beta` \u76f8\u4e58\u540e\u5bfc\u81f4 `logsigmoid` \u7684\u8f93\u5165\u8fc7\u5927\u6216\u8fc7\u5c0f\uff0c\u4ece\u800c\u8fdb\u5165\u68af\u5ea6\u9971\u548c\u533a\uff1b\u5176\u6b21\uff0c\u5b83\u4e3a\u635f\u5931\u7684\u68af\u5ea6\u5927\u5c0f\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u9690\u5f0f\u7684\u4e0a\u9650\uff0c\u6709\u52a9\u4e8e\u7a33\u5b9a\u8bad\u7ec3\u8fc7\u7a0b\uff0c\u5c24\u5176\u662f\u5728\u8bad\u7ec3\u521d\u671f\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u7f29\u653e\u56e0\u5b50\u7cfb\u6570\u3002\u63a7\u5236\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u5bf9\u6700\u7ec8\u635f\u5931\u5f71\u54cd\u7684\u5f3a\u5ea6\u3002\u7531\u4e8e\u6210\u672c\u5dee\u5f02\u5df2\u88ab\u6807\u51c6\u5316\uff0cbeta \u7684\u53d6\u503c\u901a\u5e38\u5728 0.5 \u5230 5.0 \u4e4b\u95f4\u6bd4\u8f83\u9c81\u68d2\u3002"}, "clip_min": {"value": -10.0, "description": "logsigmoid \u8f93\u5165\u7684\u88c1\u526a\u4e0b\u9650\u3002\u9632\u6b62\u6570\u503c\u4e0b\u6ea2\u548c\u8fc7\u5927\u7684\u8d1f\u68af\u5ea6\u3002"}, "clip_max": {"value": 10.0, "description": "logsigmoid \u8f93\u5165\u7684\u88c1\u526a\u4e0a\u9650\u3002\u9632\u6b62\u6570\u503c\u4e0a\u6ea2\u548c\u68af\u5ea6\u9971\u548c\u3002"}}, "operators_used": ["zscore", "softplus", "tanh", "clamp", "logsigmoid"]}}}
{"generation": 3, "index": 0, "ir": {"name": "AdaptiveLogRatioLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u5b66\u4e60\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u7ed3\u6784\uff0c\u5373\u635f\u5931\u5f62\u5f0f\u4e3a `-logsigmoid(scaled_logp_diff)`\u3002\u8fd9\u662f\u4e00\u79cd\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u3001\u5e73\u6ed1\u4e14\u6709\u754c\u7684\u6210\u5bf9\u635f\u5931\u5f62\u5f0f\uff0c\u5929\u7136\u5730\u5c06 `logp_w > logp_l` \u7684\u60c5\u51b5\u63a8\u5411\u4f4e\u635f\u5931\u533a\u57df\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30) \u548c `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u7ee7\u7eed\u4f7f\u7528 `rank_gap` \u7b97\u5b50\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u3002\u8fd9\u63d0\u4f9b\u4e86\u4e00\u79cd\u57fa\u4e8e\u6392\u5e8f\u7684\u3001\u5bf9\u6210\u672c\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\u7684\u9c81\u68d2\u5f52\u4e00\u5316\u65b9\u6cd5\uff0c\u6709\u6548\u5904\u7406\u6210\u672c\u5206\u5e03\u5e7f\u6cdb\u6216\u5b58\u5728\u5f02\u5e38\u503c\u7684\u60c5\u51b5\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u81ea\u9002\u5e94\u7f29\u653e\u673a\u5236)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u65b9\u5f0f\u6765\u8026\u5408\u6210\u672c\u5dee\u5f02\u548c\u6982\u7387\u5dee\u5f02\u3002\u4e0e\u7236\u4ee31\u4e2d\u5c06\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a\u6982\u7387\u5dee\u5f02\u7684*\u4e58\u6cd5\u7f29\u653e\u56e0\u5b50*\u4e0d\u540c\uff0c\u6211\u4eec\u5c06\u6210\u672c\u5dee\u5f02\uff08\u7ecf\u8fc7`beta`\u7f29\u653e\uff09\u4f5c\u4e3a\u6982\u7387\u5dee\u5f02\u7684*\u52a0\u6cd5\u9879*\uff0c\u5373 `logp_diff + beta * rank_gap`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5728\u601d\u60f3\u4e0a\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u52a8\u6001\u7684\u201c\u5956\u52b1\u589e\u76ca\u201d\u6216\u201c\u4f18\u52bf\u504f\u79fb\u201d\u3002\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff0c\u5b83\u4e3a\u6b63\u786e\u7684\u504f\u597d\u65b9\u5411\uff08`logp_w - logp_l`\uff09\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f3a\u5927\u7684\u6b63\u5411\u504f\u79fb\uff0c\u4f7f\u5f97\u5373\u4f7f\u6a21\u578b\u5f53\u524d\u7684\u6982\u7387\u5dee\u5f02\u5f88\u5c0f\uff0c`logsigmoid`\u7684\u8f93\u5165\u4e5f\u80fd\u53d8\u5f97\u5f88\u5927\uff0c\u4ece\u800c\u4ea7\u751f\u66f4\u5f3a\u7684\u5b66\u4e60\u4fe1\u53f7\u3002\u8fd9\u79cd\u52a0\u6cd5\u8026\u5408\u6bd4\u4e58\u6cd5\u8026\u5408\u5728\u6570\u503c\u4e0a\u66f4\u7a33\u5b9a\uff0c\u56e0\u4e3a\u5b83\u907f\u514d\u4e86\u5f53`logp_diff`\u63a5\u8fd1\u96f6\u65f6\u68af\u5ea6\u6d88\u5931\u7684\u95ee\u9898\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u7b80\u5316\u7684\u7a33\u5b9a\u6027\u8bbe\u8ba1)**\uff1a\u4e0e\u4e24\u4f4d\u7236\u4ee3\u90fd\u4f7f\u7528`tanh`\u6765\u538b\u7f29`logp_w - logp_l`\u4e0d\u540c\uff0c\u6211\u4eec\u9009\u62e9\u4e0d\u4f7f\u7528`tanh`\u3002\u6211\u4eec\u8ba4\u4e3a`logsigmoid`\u51fd\u6570\u672c\u8eab\u5bf9\u4e8e\u5927\u7684\u6b63\u8f93\u5165\u503c\u68af\u5ea6\u4f1a\u81ea\u7136\u8870\u51cf\uff08\u8d8b\u4e8e0\uff09\uff0c\u5bf9\u4e8e\u5927\u7684\u8d1f\u8f93\u5165\u503c\u68af\u5ea6\u4e5f\u4f1a\u9971\u548c\uff08\u8d8b\u4e8e1\uff09\uff0c\u8fd9\u5df2\u7ecf\u63d0\u4f9b\u4e86\u8db3\u591f\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002\u53bb\u6389`tanh`\u53ef\u4ee5\u7b80\u5316\u8ba1\u7b97\uff0c\u5e76\u5141\u8bb8\u68af\u5ea6\u5728`logp_diff`\u53d8\u5316\u65f6\u66f4\u76f4\u63a5\u5730\u6d41\u52a8\uff0c\u907f\u514d\u4e86`tanh`\u53ef\u80fd\u5f15\u5165\u7684\u9971\u548c\u533a\u5bfc\u81f4\u7684\u68af\u5ea6\u6d88\u5931\u95ee\u9898\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`AdaptiveLogRatioLoss`\u901a\u8fc7\u5c06\u9c81\u68d2\u7684`rank_gap`\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u52a0\u6027\u504f\u79fb\uff0c\u5e76\u5c06\u5176\u8f93\u5165\u5230\u7ecf\u5178\u7684`logsigmoid`\u635f\u5931\u6846\u67b6\u4e2d\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u7b80\u6d01\u3001\u9ad8\u6548\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u65b0\u635f\u5931\u3002\u5b83\u9f13\u52b1\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u4ea7\u751f\u66f4\u5927\u7684\u7f6e\u4fe1\u5ea6\u5dee\u8ddd\uff0c\u540c\u65f6\u4fdd\u6301\u4e86\u6574\u4f53\u8ba1\u7b97\u7684\u5e73\u6ed1\u6027\u548c\u53ef\u5bfc\u6027\u3002", "pseudocode": "def AdaptiveLogRatioLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. \u8ba1\u7b97\u5bf9\u6570\u6982\u7387\u5dee\u5f02\n    #    \u8fd9\u662f\u504f\u597d\u5b66\u4e60\u7684\u6838\u5fc3\u4fe1\u53f7\uff0c\u671f\u671b\u4e3a\u6b63\u3002\n    logp_diff = logp_w - logp_l\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee30\u548c1] \u4f7f\u7528 rank_gap \u8ba1\u7b97\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u3002\n    #    rank_gap(cost_w, cost_l) \u8fd4\u56de\u4e00\u4e2a\u6b63\u503c\uff0c\u8868\u793a\u6210\u672c\u5728\u6392\u5e8f\u4e0a\u7684\u5dee\u8ddd\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 4. [\u65b0\u7684\u8026\u5408\u70b91] \u5c06\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u52a0\u6027\u504f\u79fb\u3002\n    #    beta \u63a7\u5236\u6210\u672c\u5dee\u5f02\u7684\u5f71\u54cd\u5f3a\u5ea6\u3002\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u5bf9\u6700\u7ec8\u7684\u903b\u8f91\u8f93\u5165\u8d21\u732e\u8d8a\u5927\u3002\n    #    \u8fd9\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u81ea\u9002\u5e94\u7684\u201c\u4f18\u52bf\u201d\u9879\u3002\n    advantage_term = beta * cost_rank_diff\n    combined_signal = logp_diff + advantage_term\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u6838\u5fc3\u7ed3\u6784\uff0c\u4f46\u6709\u65b0\u7684\u7b80\u5316\u6539\u52a8]\n    #    \u4f7f\u7528 logsigmoid \u8ba1\u7b97\u6700\u7ec8\u635f\u5931\u3002-logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u975e\u8d1f\u7684\u635f\u5931\u51fd\u6570\u3002\n    #    \u5f53 combined_signal > 0 (\u504f\u597d\u6b63\u786e\u4e14/\u6216\u6210\u672c\u5dee\u5f02\u5927) \u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e0\u3002\n    #    \u5f53 combined_signal < 0 (\u504f\u597d\u9519\u8bef) \u65f6\uff0c\u635f\u5931\u4f1a\u663e\u8457\u589e\u52a0\u3002\n    #    [\u65b0\u7684\u8026\u5408\u70b92] \u6211\u4eec\u79fb\u9664\u4e86\u7236\u4ee3\u4e2d\u7684tanh\u538b\u7f29\uff0c\u7b80\u5316\u4e86\u6a21\u578b\u5e76\u4f9d\u8d56logsigmoid\u81ea\u8eab\u7684\u7a33\u5b9a\u6027\u3002\n    loss = -logsigmoid(combined_signal)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u6210\u672c\u5dee\u5f02\u5f71\u54cd\u56e0\u5b50\u3002\u8be5\u53c2\u6570\u63a7\u5236\u4e86\u57fa\u4e8e\u6392\u5e8f\u7684\u6210\u672c\u5dee\u5f02\uff08cost_rank_diff\uff09\u5728\u591a\u5927\u7a0b\u5ea6\u4e0a\u88ab\u52a0\u5230\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u4e0a\u3002\u8f83\u9ad8\u7684beta\u503c\u610f\u5473\u7740\u6a21\u578b\u5c06\u88ab\u66f4\u5f3a\u529b\u5730\u9a71\u52a8\u53bb\u533a\u5206\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u3002"}}, "operators_used": ["rank_gap", "logsigmoid"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor), beta (float). Tensors should be of the same shape, e.g., (batch_size,)."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.13926362991333, "validation_objective": 4.13926362991333, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.100618839263916}, "train_score_mean": 4.284047693014145, "train_loss_mean": 0.6928380485624075, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveLogRatioLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u5b66\u4e60\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u7ed3\u6784\uff0c\u5373\u635f\u5931\u5f62\u5f0f\u4e3a `-logsigmoid(scaled_logp_diff)`\u3002\u8fd9\u662f\u4e00\u79cd\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u3001\u5e73\u6ed1\u4e14\u6709\u754c\u7684\u6210\u5bf9\u635f\u5931\u5f62\u5f0f\uff0c\u5929\u7136\u5730\u5c06 `logp_w > logp_l` \u7684\u60c5\u51b5\u63a8\u5411\u4f4e\u635f\u5931\u533a\u57df\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30) \u548c `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u7ee7\u7eed\u4f7f\u7528 `rank_gap` \u7b97\u5b50\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u3002\u8fd9\u63d0\u4f9b\u4e86\u4e00\u79cd\u57fa\u4e8e\u6392\u5e8f\u7684\u3001\u5bf9\u6210\u672c\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\u7684\u9c81\u68d2\u5f52\u4e00\u5316\u65b9\u6cd5\uff0c\u6709\u6548\u5904\u7406\u6210\u672c\u5206\u5e03\u5e7f\u6cdb\u6216\u5b58\u5728\u5f02\u5e38\u503c\u7684\u60c5\u51b5\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u81ea\u9002\u5e94\u7f29\u653e\u673a\u5236)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u65b9\u5f0f\u6765\u8026\u5408\u6210\u672c\u5dee\u5f02\u548c\u6982\u7387\u5dee\u5f02\u3002\u4e0e\u7236\u4ee31\u4e2d\u5c06\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a\u6982\u7387\u5dee\u5f02\u7684*\u4e58\u6cd5\u7f29\u653e\u56e0\u5b50*\u4e0d\u540c\uff0c\u6211\u4eec\u5c06\u6210\u672c\u5dee\u5f02\uff08\u7ecf\u8fc7`beta`\u7f29\u653e\uff09\u4f5c\u4e3a\u6982\u7387\u5dee\u5f02\u7684*\u52a0\u6cd5\u9879*\uff0c\u5373 `logp_diff + beta * rank_gap`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5728\u601d\u60f3\u4e0a\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u52a8\u6001\u7684\u201c\u5956\u52b1\u589e\u76ca\u201d\u6216\u201c\u4f18\u52bf\u504f\u79fb\u201d\u3002\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff0c\u5b83\u4e3a\u6b63\u786e\u7684\u504f\u597d\u65b9\u5411\uff08`logp_w - logp_l`\uff09\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f3a\u5927\u7684\u6b63\u5411\u504f\u79fb\uff0c\u4f7f\u5f97\u5373\u4f7f\u6a21\u578b\u5f53\u524d\u7684\u6982\u7387\u5dee\u5f02\u5f88\u5c0f\uff0c`logsigmoid`\u7684\u8f93\u5165\u4e5f\u80fd\u53d8\u5f97\u5f88\u5927\uff0c\u4ece\u800c\u4ea7\u751f\u66f4\u5f3a\u7684\u5b66\u4e60\u4fe1\u53f7\u3002\u8fd9\u79cd\u52a0\u6cd5\u8026\u5408\u6bd4\u4e58\u6cd5\u8026\u5408\u5728\u6570\u503c\u4e0a\u66f4\u7a33\u5b9a\uff0c\u56e0\u4e3a\u5b83\u907f\u514d\u4e86\u5f53`logp_diff`\u63a5\u8fd1\u96f6\u65f6\u68af\u5ea6\u6d88\u5931\u7684\u95ee\u9898\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u7b80\u5316\u7684\u7a33\u5b9a\u6027\u8bbe\u8ba1)**\uff1a\u4e0e\u4e24\u4f4d\u7236\u4ee3\u90fd\u4f7f\u7528`tanh`\u6765\u538b\u7f29`logp_w - logp_l`\u4e0d\u540c\uff0c\u6211\u4eec\u9009\u62e9\u4e0d\u4f7f\u7528`tanh`\u3002\u6211\u4eec\u8ba4\u4e3a`logsigmoid`\u51fd\u6570\u672c\u8eab\u5bf9\u4e8e\u5927\u7684\u6b63\u8f93\u5165\u503c\u68af\u5ea6\u4f1a\u81ea\u7136\u8870\u51cf\uff08\u8d8b\u4e8e0\uff09\uff0c\u5bf9\u4e8e\u5927\u7684\u8d1f\u8f93\u5165\u503c\u68af\u5ea6\u4e5f\u4f1a\u9971\u548c\uff08\u8d8b\u4e8e1\uff09\uff0c\u8fd9\u5df2\u7ecf\u63d0\u4f9b\u4e86\u8db3\u591f\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002\u53bb\u6389`tanh`\u53ef\u4ee5\u7b80\u5316\u8ba1\u7b97\uff0c\u5e76\u5141\u8bb8\u68af\u5ea6\u5728`logp_diff`\u53d8\u5316\u65f6\u66f4\u76f4\u63a5\u5730\u6d41\u52a8\uff0c\u907f\u514d\u4e86`tanh`\u53ef\u80fd\u5f15\u5165\u7684\u9971\u548c\u533a\u5bfc\u81f4\u7684\u68af\u5ea6\u6d88\u5931\u95ee\u9898\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`AdaptiveLogRatioLoss`\u901a\u8fc7\u5c06\u9c81\u68d2\u7684`rank_gap`\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u52a0\u6027\u504f\u79fb\uff0c\u5e76\u5c06\u5176\u8f93\u5165\u5230\u7ecf\u5178\u7684`logsigmoid`\u635f\u5931\u6846\u67b6\u4e2d\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u7b80\u6d01\u3001\u9ad8\u6548\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u65b0\u635f\u5931\u3002\u5b83\u9f13\u52b1\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u4ea7\u751f\u66f4\u5927\u7684\u7f6e\u4fe1\u5ea6\u5dee\u8ddd\uff0c\u540c\u65f6\u4fdd\u6301\u4e86\u6574\u4f53\u8ba1\u7b97\u7684\u5e73\u6ed1\u6027\u548c\u53ef\u5bfc\u6027\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u6210\u672c\u5dee\u5f02\u5f71\u54cd\u56e0\u5b50\u3002\u8be5\u53c2\u6570\u63a7\u5236\u4e86\u57fa\u4e8e\u6392\u5e8f\u7684\u6210\u672c\u5dee\u5f02\uff08cost_rank_diff\uff09\u5728\u591a\u5927\u7a0b\u5ea6\u4e0a\u88ab\u52a0\u5230\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u4e0a\u3002\u8f83\u9ad8\u7684beta\u503c\u610f\u5473\u7740\u6a21\u578b\u5c06\u88ab\u66f4\u5f3a\u529b\u5730\u9a71\u52a8\u53bb\u533a\u5206\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u3002"}}, "operators_used": ["rank_gap", "logsigmoid"]}}}
{"generation": 3, "index": 1, "ir": {"name": "AdaptiveMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u4e2a\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u65b0\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u635f\u5931\u7ed3\u6784\u3002`loss = -logsigmoid(x)` \u662f\u4e00\u79cd\u4f18\u96c5\u4e14\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u6210\u5bf9\u6bd4\u8f83\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u5929\u7136\u5e73\u6ed1\u3001\u6709\u754c\uff0c\u5e76\u4e14\u5728 `x > 0` (\u504f\u597d\u6b63\u786e) \u65f6\u635f\u5931\u8d8b\u8fd1\u4e8e0\uff0c\u5728 `x < 0` (\u504f\u597d\u9519\u8bef) \u65f6\u635f\u5931\u663e\u8457\u589e\u52a0\u3002\u8fd9\u6bd4 Hinge-Loss (`softplus(margin - x)`) \u5728\u6570\u5b66\u4e0a\u66f4\u7b80\u6d01\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u5176\u201c\u52a8\u6001\u88d5\u5ea6 (dynamic margin)\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5373\u6a21\u578b\u9700\u8981\u8fbe\u6210\u7684 `logp_w - logp_l` \u7684\u76ee\u6807\u503c\uff08\u5373\u88d5\u5ea6\uff09\u4e0d\u5e94\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u5e94\u4e0e `cost_w` \u548c `cost_l` \u4e4b\u95f4\u7684\u5dee\u5f02\u6210\u6b63\u6bd4\u3002\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u6a21\u578b\u88ab\u8981\u6c42\u4ea7\u751f\u7684\u504f\u597d\u5dee\u8ddd\u4e5f\u5e94\u8d8a\u5927\u3002\u6211\u4eec\u540c\u6837\u4f7f\u7528 `rank_gap` \u6765\u9c81\u68d2\u5730\u8ba1\u7b97\u8fd9\u4e2a\u6210\u672c\u5dee\u5f02\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u88d5\u5ea6\u4e0e\u6982\u7387\u5dee\u7684\u8026\u5408 (\u8026\u5408\u70b91)**\uff1a\u4e0e\u7236\u4ee31\u5c06\u6210\u672c\u5dee\u5f02\u7528\u4f5c `logp_diff` \u7684\u201c\u7f29\u653e\u56e0\u5b50\u201d\u4e0d\u540c\uff0c\u6211\u4eec\u5c06\u7236\u4ee30\u7684\u201c\u88d5\u5ea6\u201d\u6982\u5ff5\u76f4\u63a5\u6574\u5408\u5230\u7236\u4ee31\u7684 `logsigmoid` \u7ed3\u6784\u4e2d\u3002\u635f\u5931\u7684\u8f93\u5165\u9879\u53d8\u4e3a `(logp_w - logp_l) - margin`\u3002\u8fd9\u79cd\u5f62\u5f0f\u66f4\u76f4\u89c2\u5730\u4f53\u73b0\u4e86\u201cHinge Loss\u201d\u7684\u54f2\u5b66\uff1a\u53ea\u8981\u6a21\u578b\u7684\u504f\u597d `(logp_w - logp_l)` \u8d85\u8fc7\u4e86\u52a8\u6001\u8bbe\u5b9a\u7684\u76ee\u6807\u88d5\u5ea6 `margin`\uff0c\u635f\u5931\u5c31\u4f1a\u8fc5\u901f\u4e0b\u964d\u5e76\u9971\u548c\uff0c\u5141\u8bb8\u6a21\u578b\u201c\u6ee1\u8db3\u4e8e\u201d\u5df2\u8fbe\u6210\u7684\u504f\u597d\u5f3a\u5ea6\uff0c\u4ece\u800c\u5c06\u6ce8\u610f\u529b\u8f6c\u79fb\u5230\u66f4\u96be\u7684\u6837\u672c\u4e0a\u3002\u8fd9\u4e0e\u7236\u4ee31\u4e2d\u6210\u672c\u5dee\u5f02\u5bf9\u68af\u5ea6\u8fdb\u884c\u65e0\u754c\u7f29\u653e\u7684\u8bbe\u8ba1\u5f62\u6210\u4e86\u5bf9\u6bd4\u3002\n2.  **\u88d5\u5ea6\u7684\u975e\u7ebf\u6027\u53d8\u6362 (\u8026\u5408\u70b92)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u7a33\u5b9a\u6027\u5e76\u5f15\u5165\u6709\u76ca\u7684\u975e\u7ebf\u6027\uff0c\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee30\u90a3\u6837\u76f4\u63a5\u4f7f\u7528 `beta * rank_gap` \u4f5c\u4e3a\u88d5\u5ea6\uff0c\u800c\u662f\u5bf9 `rank_gap` \u7684\u7ed3\u679c\u5e94\u7528\u4e86 `softplus` \u51fd\u6570\uff0c\u5373 `margin = beta * softplus(rank_gap(...))`\u3002\u8fd9\u5e26\u6765\u4e86\u4e24\u4e2a\u597d\u5904\uff1a(1) `softplus` \u4fdd\u8bc1\u4e86\u88d5\u5ea6\u59cb\u7ec8\u4e3a\u6b63\u4e14\u5e73\u6ed1\u53ef\u5bfc\uff1b(2) \u5b83\u4f7f\u5f97\u88d5\u5ea6\u5728\u6210\u672c\u79e9\u5dee\u8f83\u5c0f\u65f6\u8fd1\u4f3c\u7ebf\u6027\u589e\u957f\uff0c\u800c\u5728\u79e9\u5dee\u975e\u5e38\u5927\u65f6\u589e\u957f\u8d8b\u4e8e\u5e73\u7f13\uff0c\u8fd9\u53ef\u4ee5\u9632\u6b62\u6781\u7aef\u6210\u672c\u5dee\u5f02\u4ea7\u751f\u8fc7\u5927\u7684\u3001\u4e0d\u5207\u5b9e\u9645\u7684\u88d5\u5ea6\u76ee\u6807\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n\u603b\u7ed3\u6765\u8bf4\uff0c`AdaptiveMarginLogSigmoidLoss` \u5c06 `logsigmoid` \u635f\u5931\u7684\u4f18\u96c5\u5f62\u5f0f\u4e0e\u52a8\u6001\u88d5\u5ea6\u7684\u601d\u60f3\u76f8\u7ed3\u5408\uff0c\u901a\u8fc7 `(logp_diff - margin)` \u7684\u5f62\u5f0f\u5c06\u4e24\u8005\u8026\u5408\uff0c\u5e76\u5229\u7528 `softplus` \u5bf9\u88d5\u5ea6\u672c\u8eab\u8fdb\u884c\u5e73\u6ed1\u548c\u7a33\u5b9a\u5316\u5904\u7406\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u9c81\u68d2\u3001\u7a33\u5b9a\u4e14\u76f4\u89c2\u7684\u65b0\u635f\u5931\u51fd\u6570\u3002", "pseudocode": "def AdaptiveMarginLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee30\u548c1] \u4f7f\u7528 rank_gap \u8ba1\u7b97\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u3002\n    #    rank_gap(cost_w, cost_l) \u8fd4\u56de\u4e00\u4e2a\u975e\u8d1f\u503c\uff0c\u8868\u793a\u6210\u672c\u5728\u6392\u5e8f\u4e0a\u7684\u5dee\u8ddd\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u4e00\u4e2a\u975e\u7ebf\u6027\u3001\u5e73\u6ed1\u7684\u52a8\u6001\u88d5\u5ea6\u3002\n    #    \u7ee7\u627f\u7236\u4ee30\u7684\u52a8\u6001\u88d5\u5ea6\u601d\u60f3\uff0c\u4f46\u4f7f\u7528 softplus \u5bf9 rank_gap \u7684\u8f93\u51fa\u8fdb\u884c\u5e73\u6ed1\u548c\u7a33\u5b9a\u5316\u3002\n    #    \u8fd9\u53ef\u4ee5\u9632\u6b62\u6781\u7aef\u7684\u6210\u672c\u5dee\u5f02\u5bfc\u81f4\u88d5\u5ea6\u76ee\u6807\u8fc7\u5927\u3002\n    #    beta \u63a7\u5236\u88d5\u5ea6\u7684\u6574\u4f53\u5c3a\u5ea6\u3002\n    dynamic_margin = beta * softplus(cost_rank_diff)\n\n    # 4. \u8ba1\u7b97\u5bf9\u6570\u6982\u7387\u5dee\u3002\n    #    \u8fd9\u662f\u6a21\u578b\u5f53\u524d\u504f\u597d\u5f3a\u5ea6\u7684\u76f4\u63a5\u5ea6\u91cf\uff0c\u671f\u671b\u4e3a\u6b63\u3002\n    logp_diff = logp_w - logp_l\n\n    # 5. [\u65b0\u8026\u5408\u70b91 & \u7ee7\u627f\u81ea\u7236\u4ee31] \u5c06\u88d5\u5ea6\u4e0e\u6982\u7387\u5dee\u8026\u5408\uff0c\u5e76\u5e94\u7528 logsigmoid \u635f\u5931\u3002\n    #    \u6211\u4eec\u5c06\u7236\u4ee30\u7684 `margin - x` \u601d\u60f3\u4e0e\u7236\u4ee31\u7684 `logsigmoid` \u7ed3\u6784\u878d\u5408\u3002\n    #    \u6838\u5fc3\u9879\u662f `logp_diff - dynamic_margin`\u3002\n    #    - \u5f53 logp_diff > dynamic_margin (\u6a21\u578b\u8868\u73b0\u8d85\u51fa\u9884\u671f)\uff0c\u8be5\u9879\u4e3a\u6b63\uff0clogsigmoid \u63a5\u8fd10\uff0c\u635f\u5931\u5c0f\u3002\n    #    - \u5f53 logp_diff < dynamic_margin (\u6a21\u578b\u8868\u73b0\u672a\u8fbe\u6807)\uff0c\u8be5\u9879\u4e3a\u8d1f\uff0clogsigmoid \u8d8b\u5411\u8d1f\u65e0\u7a77\uff0c\u635f\u5931\u5927\u3002\n    loss_argument = logp_diff - dynamic_margin\n\n    # 6. \u8ba1\u7b97\u6700\u7ec8\u635f\u5931\u3002\n    #    -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u3001\u975e\u8d1f\u7684\u51f8\u51fd\u6570\uff0c\u975e\u5e38\u9002\u5408\u7528\u4f5c\u635f\u5931\u3002\n    loss = -logsigmoid(loss_argument)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\u88ab\u8f6c\u5316\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u5f3a\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u5bf9\u6570\u6982\u7387\u5dee\u3002"}}, "operators_used": ["rank_gap", "softplus", "logsigmoid"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor), beta (float). Tensors are expected to be of shape [batch_size]."], "returns": "A scalar Tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.124246120452881, "validation_objective": 4.124246120452881, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.096334934234619}, "train_score_mean": 4.278915584087372, "train_loss_mean": 0.6928042452782393, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u4e2a\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u65b0\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u635f\u5931\u7ed3\u6784\u3002`loss = -logsigmoid(x)` \u662f\u4e00\u79cd\u4f18\u96c5\u4e14\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u6210\u5bf9\u6bd4\u8f83\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u5929\u7136\u5e73\u6ed1\u3001\u6709\u754c\uff0c\u5e76\u4e14\u5728 `x > 0` (\u504f\u597d\u6b63\u786e) \u65f6\u635f\u5931\u8d8b\u8fd1\u4e8e0\uff0c\u5728 `x < 0` (\u504f\u597d\u9519\u8bef) \u65f6\u635f\u5931\u663e\u8457\u589e\u52a0\u3002\u8fd9\u6bd4 Hinge-Loss (`softplus(margin - x)`) \u5728\u6570\u5b66\u4e0a\u66f4\u7b80\u6d01\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u5176\u201c\u52a8\u6001\u88d5\u5ea6 (dynamic margin)\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5373\u6a21\u578b\u9700\u8981\u8fbe\u6210\u7684 `logp_w - logp_l` \u7684\u76ee\u6807\u503c\uff08\u5373\u88d5\u5ea6\uff09\u4e0d\u5e94\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u5e94\u4e0e `cost_w` \u548c `cost_l` \u4e4b\u95f4\u7684\u5dee\u5f02\u6210\u6b63\u6bd4\u3002\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u6a21\u578b\u88ab\u8981\u6c42\u4ea7\u751f\u7684\u504f\u597d\u5dee\u8ddd\u4e5f\u5e94\u8d8a\u5927\u3002\u6211\u4eec\u540c\u6837\u4f7f\u7528 `rank_gap` \u6765\u9c81\u68d2\u5730\u8ba1\u7b97\u8fd9\u4e2a\u6210\u672c\u5dee\u5f02\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u88d5\u5ea6\u4e0e\u6982\u7387\u5dee\u7684\u8026\u5408 (\u8026\u5408\u70b91)**\uff1a\u4e0e\u7236\u4ee31\u5c06\u6210\u672c\u5dee\u5f02\u7528\u4f5c `logp_diff` \u7684\u201c\u7f29\u653e\u56e0\u5b50\u201d\u4e0d\u540c\uff0c\u6211\u4eec\u5c06\u7236\u4ee30\u7684\u201c\u88d5\u5ea6\u201d\u6982\u5ff5\u76f4\u63a5\u6574\u5408\u5230\u7236\u4ee31\u7684 `logsigmoid` \u7ed3\u6784\u4e2d\u3002\u635f\u5931\u7684\u8f93\u5165\u9879\u53d8\u4e3a `(logp_w - logp_l) - margin`\u3002\u8fd9\u79cd\u5f62\u5f0f\u66f4\u76f4\u89c2\u5730\u4f53\u73b0\u4e86\u201cHinge Loss\u201d\u7684\u54f2\u5b66\uff1a\u53ea\u8981\u6a21\u578b\u7684\u504f\u597d `(logp_w - logp_l)` \u8d85\u8fc7\u4e86\u52a8\u6001\u8bbe\u5b9a\u7684\u76ee\u6807\u88d5\u5ea6 `margin`\uff0c\u635f\u5931\u5c31\u4f1a\u8fc5\u901f\u4e0b\u964d\u5e76\u9971\u548c\uff0c\u5141\u8bb8\u6a21\u578b\u201c\u6ee1\u8db3\u4e8e\u201d\u5df2\u8fbe\u6210\u7684\u504f\u597d\u5f3a\u5ea6\uff0c\u4ece\u800c\u5c06\u6ce8\u610f\u529b\u8f6c\u79fb\u5230\u66f4\u96be\u7684\u6837\u672c\u4e0a\u3002\u8fd9\u4e0e\u7236\u4ee31\u4e2d\u6210\u672c\u5dee\u5f02\u5bf9\u68af\u5ea6\u8fdb\u884c\u65e0\u754c\u7f29\u653e\u7684\u8bbe\u8ba1\u5f62\u6210\u4e86\u5bf9\u6bd4\u3002\n2.  **\u88d5\u5ea6\u7684\u975e\u7ebf\u6027\u53d8\u6362 (\u8026\u5408\u70b92)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u7a33\u5b9a\u6027\u5e76\u5f15\u5165\u6709\u76ca\u7684\u975e\u7ebf\u6027\uff0c\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee30\u90a3\u6837\u76f4\u63a5\u4f7f\u7528 `beta * rank_gap` \u4f5c\u4e3a\u88d5\u5ea6\uff0c\u800c\u662f\u5bf9 `rank_gap` \u7684\u7ed3\u679c\u5e94\u7528\u4e86 `softplus` \u51fd\u6570\uff0c\u5373 `margin = beta * softplus(rank_gap(...))`\u3002\u8fd9\u5e26\u6765\u4e86\u4e24\u4e2a\u597d\u5904\uff1a(1) `softplus` \u4fdd\u8bc1\u4e86\u88d5\u5ea6\u59cb\u7ec8\u4e3a\u6b63\u4e14\u5e73\u6ed1\u53ef\u5bfc\uff1b(2) \u5b83\u4f7f\u5f97\u88d5\u5ea6\u5728\u6210\u672c\u79e9\u5dee\u8f83\u5c0f\u65f6\u8fd1\u4f3c\u7ebf\u6027\u589e\u957f\uff0c\u800c\u5728\u79e9\u5dee\u975e\u5e38\u5927\u65f6\u589e\u957f\u8d8b\u4e8e\u5e73\u7f13\uff0c\u8fd9\u53ef\u4ee5\u9632\u6b62\u6781\u7aef\u6210\u672c\u5dee\u5f02\u4ea7\u751f\u8fc7\u5927\u7684\u3001\u4e0d\u5207\u5b9e\u9645\u7684\u88d5\u5ea6\u76ee\u6807\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n\u603b\u7ed3\u6765\u8bf4\uff0c`AdaptiveMarginLogSigmoidLoss` \u5c06 `logsigmoid` \u635f\u5931\u7684\u4f18\u96c5\u5f62\u5f0f\u4e0e\u52a8\u6001\u88d5\u5ea6\u7684\u601d\u60f3\u76f8\u7ed3\u5408\uff0c\u901a\u8fc7 `(logp_diff - margin)` \u7684\u5f62\u5f0f\u5c06\u4e24\u8005\u8026\u5408\uff0c\u5e76\u5229\u7528 `softplus` \u5bf9\u88d5\u5ea6\u672c\u8eab\u8fdb\u884c\u5e73\u6ed1\u548c\u7a33\u5b9a\u5316\u5904\u7406\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u9c81\u68d2\u3001\u7a33\u5b9a\u4e14\u76f4\u89c2\u7684\u65b0\u635f\u5931\u51fd\u6570\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\u88ab\u8f6c\u5316\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u5f3a\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u5bf9\u6570\u6982\u7387\u5dee\u3002"}}, "operators_used": ["rank_gap", "softplus", "logsigmoid"]}}}
{"generation": 3, "index": 3, "ir": {"name": "AdaptiveScaledMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\u6765\u5e73\u8861\u6a21\u578b\u7684\u5b66\u4e60\u538b\u529b\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u5176\u6838\u5fc3\u7684 `logsigmoid` \u6846\u67b6 (`-logsigmoid(...)`)\u3002\u8fd9\u79cd\u7ed3\u6784\u5929\u7136\u5730\u5c06\u504f\u597d\u5dee\u5f02\u6620\u5c04\u5230\u4e00\u4e2a\u5e73\u6ed1\u3001\u6709\u754c\u7684\u635f\u5931\u7a7a\u95f4\uff0c\u6570\u503c\u7a33\u5b9a\u6027\u597d\uff0c\u4e14\u76f4\u89c2\u5730\u60e9\u7f5a\u9519\u8bef\u7684\u504f\u597d\uff08`logp_w < logp_l`\uff09\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30) \u548c `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u5171\u540c\u7ee7\u627f\u4e86\u4f7f\u7528 `rank_gap` \u7b97\u5b50\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\uff0c\u589e\u5f3a\u4e86\u5bf9\u5f02\u5e38\u6210\u672c\u503c\u7684\u9c81\u68d2\u6027\uff0c\u66f4\u5173\u6ce8\u6210\u672c\u7684\u76f8\u5bf9\u6392\u5e8f\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u52a8\u6001\u88d5\u5ea6\u4e0e\u6982\u7387\u5dee\u5f02\u7684\u8026\u5408\uff08\u8026\u5408\u70b91\uff09**\uff1a\u672c\u8bbe\u8ba1\u7684\u6838\u5fc3\u521b\u65b0\u5728\u4e8e\u5c06\u4e24\u4e2a\u7236\u4ee3\u7684\u601d\u60f3\u8fdb\u884c\u4e86\u91cd\u7ec4\u548c\u8026\u5408\u3002\u7236\u4ee30\u4f7f\u7528 `margin - logp_diff` \u7684\u7ed3\u6784\uff0c\u800c\u7236\u4ee31\u4f7f\u7528 `scaling * logp_diff` \u7684\u7ed3\u6784\u3002\u6211\u4eec\u5c06\u8fd9\u4e24\u79cd\u601d\u60f3\u7ed3\u5408\uff0c\u521b\u5efa\u4e86\u4e00\u4e2a `dynamic_margin - stable_logp_diff` \u7684\u9879\u4f5c\u4e3a `logsigmoid` \u7684\u8f93\u5165\u3002\u5176\u4e2d\uff0c`dynamic_margin` \u7ee7\u627f\u4e86\u7236\u4ee30\u7684\u601d\u60f3\uff0c\u5373\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u8fbe\u6210\u7684\u6982\u7387\u5dee\u5f02\u76ee\u6807\uff08\u88d5\u5ea6\uff09\u5c31\u8d8a\u5927\u3002`stable_logp_diff` \u5219\u662f\u6a21\u578b\u5f53\u524d\u5b9e\u9645\u7684\u6982\u7387\u5dee\u5f02\u3002\u8fd9\u79cd `\u76ee\u6807 - \u5b9e\u9645` \u7684\u7ed3\u6784\u6bd4\u7b80\u5355\u7684\u7f29\u653e (`scaling * logp_diff`) \u63d0\u4f9b\u4e86\u66f4\u660e\u786e\u7684\u4f18\u5316\u76ee\u6807\u3002\n2.  **\u88d5\u5ea6\u9971\u548c\u4e0e\u7a33\u5b9a\u6027\u6280\u5de7\uff08\u8026\u5408\u70b92\uff09**\uff1a\u4e3a\u4e86\u9632\u6b62\u7531\u6781\u5927\u7684\u6210\u672c\u5dee\u5f02 (`rank_gap`) \u5bfc\u81f4\u7684 `dynamic_margin` \u65e0\u9650\u589e\u957f\uff0c\u4ece\u800c\u5bf9\u6a21\u578b\u65bd\u52a0\u8fc7\u5927\u7684\u3001\u4e0d\u5207\u5b9e\u9645\u7684\u5b66\u4e60\u538b\u529b\uff0c\u6211\u4eec\u5f15\u5165\u4e86 `tanh` \u51fd\u6570\u5bf9\u88d5\u5ea6\u8fdb\u884c\u9971\u548c\u5904\u7406\u3002`margin = margin_cap * tanh(beta * rank_gap(...))`\u3002\u8fd9\u786e\u4fdd\u4e86\u76ee\u6807\u88d5\u5ea6\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u5408\u7406\u7684\u8303\u56f4\u5185\uff08\u7531\u8d85\u53c2\u6570 `margin_cap` \u63a7\u5236\uff09\uff0c\u4f7f\u5f97\u6a21\u578b\u5728\u9762\u5bf9\u6210\u672c\u5dee\u5f02\u5de8\u5927\u7684\u6837\u672c\u5bf9\u65f6\uff0c\u4e0d\u4f1a\u4ea7\u751f\u68af\u5ea6\u7206\u70b8\u3002\u8fd9\u662f\u4e00\u79cd\u65b0\u7684\u7a33\u5b9a\u6280\u5de7\uff0c\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u5747\u672a\u51fa\u73b0\u3002\n\n\u603b\u7ed3\u6765\u8bf4\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u6784\u5efa\u4e86\u4e00\u4e2a\u81ea\u9002\u5e94\u7684\u76ee\u6807\u88d5\u5ea6\uff08\u57fa\u4e8e\u6210\u672c\u7684\u79e9\u5dee\uff09\uff0c\u4f46\u901a\u8fc7 `tanh` \u5bf9\u5176\u8fdb\u884c\u4e86\u5c01\u9876\u4ee5\u4fdd\u8bc1\u7a33\u5b9a\u6027\u3002\u7136\u540e\uff0c\u5b83\u5c06\u8fd9\u4e2a\u76ee\u6807\u88d5\u5ea6\u4e0e\u6a21\u578b\u5b9e\u9645\u7684\uff08\u7ecf\u8fc7 `tanh` \u7a33\u5b9a\u7684\uff09\u6982\u7387\u5dee\u5f02\u8fdb\u884c\u6bd4\u8f83\uff0c\u5e76\u5c06\u8fd9\u4e2a\u5dee\u503c\u9001\u5165 `logsigmoid` \u635f\u5931\u51fd\u6570\u4e2d\u8fdb\u884c\u60e9\u7f5a\u3002\u8fd9\u79cd\u8bbe\u8ba1\u517c\u987e\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u6027\u3001\u6570\u503c\u7a33\u5b9a\u6027\u548c\u5bf9\u6a21\u578b\u5b66\u4e60\u538b\u529b\u7684\u5408\u7406\u63a7\u5236\u3002", "pseudocode": "def AdaptiveScaledMarginLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta, margin_cap):\n    # 1. \u8bc6\u522b\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee30\u548c1] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    rank_gap(cost_w, cost_l) \u8fd4\u56de\u4e00\u4e2a\u6b63\u503c\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u65b0\u8026\u5408\u70b91 & 2] \u8bbe\u8ba1\u4e00\u4e2a\u81ea\u9002\u5e94\u4e14\u6709\u754c\u7684\u52a8\u6001\u88d5\u5ea6\u3002\n    #    \u7ee7\u627f\u7236\u4ee30\u7684\u52a8\u6001\u88d5\u5ea6\u601d\u60f3\uff0c\u4f46\u4f7f\u7528 tanh \u8fdb\u884c\u9971\u548c\u5904\u7406\uff0c\u9632\u6b62\u88d5\u5ea6\u65e0\u9650\u589e\u957f\u3002\n    #    beta \u63a7\u5236\u88d5\u5ea6\u5bf9\u79e9\u5dee\u7684\u654f\u611f\u5ea6\uff0cmargin_cap \u662f\u88d5\u5ea6\u7684\u4e0a\u9650\u3002\n    dynamic_margin = margin_cap * tanh(beta * cost_rank_diff)\n\n    # 4. \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    \u8fd9\u4e2a\u6280\u5de7\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u6709\u4f7f\u7528\uff0c\u786e\u4fdd\u6570\u503c\u7a33\u5b9a\u6027\u3002\n    #    (logp_w - logp_l) \u671f\u671b\u4e3a\u6b63\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u65b0\u8026\u5408\u70b91 & \u7ee7\u627f\u81ea\u7236\u4ee31] \u5c06\u88d5\u5ea6\u4e0e\u6982\u7387\u5dee\u7ed3\u5408\uff0c\u5e76\u5e94\u7528 logsigmoid \u635f\u5931\u3002\n    #    \u6211\u4eec\u6784\u5efa\u4e00\u4e2a `\u76ee\u6807 - \u5b9e\u9645` \u7684\u7ed3\u6784 (dynamic_margin - stable_logp_diff)\uff0c\n    #    \u5e76\u5c06\u5176\u4f5c\u4e3a logsigmoid \u7684\u8f93\u5165\uff0c\u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u7684 logsigmoid \u6838\u5fc3\u7ed3\u6784\u3002\n    #    \u5f53\u5b9e\u9645\u8868\u73b0(stable_logp_diff)\u6ee1\u8db3\u76ee\u6807\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u8f93\u5165\u4e3a\u8d1f\uff0c\u635f\u5931\u63a5\u8fd10\u3002\n    #    \u5f53\u5b9e\u9645\u8868\u73b0\u672a\u8fbe\u5230\u76ee\u6807\u65f6\uff0c\u8f93\u5165\u4e3a\u6b63\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    loss_argument = stable_logp_diff - dynamic_margin\n\n    # 6. \u8ba1\u7b97\u6700\u7ec8\u635f\u5931\u3002\n    #    -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u975e\u8d1f\u7684\u635f\u5931\u51fd\u6570\u3002\n    loss = -logsigmoid(loss_argument)\n\n    return loss", "hyperparams": {"beta": {"value": 0.5, "description": "\u88d5\u5ea6\u654f\u611f\u5ea6\u56e0\u5b50\u3002\u63a7\u5236\u52a8\u6001\u88d5\u5ea6\u968f\u6210\u672c\u79e9\u5dee\u589e\u957f\u7684\u901f\u5ea6\u3002\u8f83\u5927\u7684 beta \u503c\u610f\u5473\u7740\u88d5\u5ea6\u4f1a\u66f4\u5feb\u5730\u8fbe\u5230\u9971\u548c\u4e0a\u9650\u3002"}, "margin_cap": {"value": 2.0, "description": "\u88d5\u5ea6\u4e0a\u9650\u3002\u8fd9\u662f\u6a21\u578b\u88ab\u671f\u671b\u8fbe\u5230\u7684\u6700\u5927\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u76ee\u6807\uff08\u7ecf\u8fc7tanh\u538b\u7f29\u540e\uff09\u3002\u5b83\u9650\u5236\u4e86\u5355\u4e2a\u6837\u672c\u5bf9\u80fd\u4ea7\u751f\u7684\u6700\u5927\u5b66\u4e60\u538b\u529b\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\u3002"}}, "operators_used": ["rank_gap", "tanh", "logsigmoid"], "implementation_hint": {"expects": ["cost_a, cost_b (tensors of costs), logp_a, logp_b (tensors of log probabilities from the model), and hyperparameters beta, margin_cap."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.128660440444946, "validation_objective": 4.128660440444946, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.079474449157715}, "train_score_mean": 4.328097939491272, "train_loss_mean": 0.6928089577704668, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveScaledMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\u6765\u5e73\u8861\u6a21\u578b\u7684\u5b66\u4e60\u538b\u529b\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u5176\u6838\u5fc3\u7684 `logsigmoid` \u6846\u67b6 (`-logsigmoid(...)`)\u3002\u8fd9\u79cd\u7ed3\u6784\u5929\u7136\u5730\u5c06\u504f\u597d\u5dee\u5f02\u6620\u5c04\u5230\u4e00\u4e2a\u5e73\u6ed1\u3001\u6709\u754c\u7684\u635f\u5931\u7a7a\u95f4\uff0c\u6570\u503c\u7a33\u5b9a\u6027\u597d\uff0c\u4e14\u76f4\u89c2\u5730\u60e9\u7f5a\u9519\u8bef\u7684\u504f\u597d\uff08`logp_w < logp_l`\uff09\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30) \u548c `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u5171\u540c\u7ee7\u627f\u4e86\u4f7f\u7528 `rank_gap` \u7b97\u5b50\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\uff0c\u589e\u5f3a\u4e86\u5bf9\u5f02\u5e38\u6210\u672c\u503c\u7684\u9c81\u68d2\u6027\uff0c\u66f4\u5173\u6ce8\u6210\u672c\u7684\u76f8\u5bf9\u6392\u5e8f\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u52a8\u6001\u88d5\u5ea6\u4e0e\u6982\u7387\u5dee\u5f02\u7684\u8026\u5408\uff08\u8026\u5408\u70b91\uff09**\uff1a\u672c\u8bbe\u8ba1\u7684\u6838\u5fc3\u521b\u65b0\u5728\u4e8e\u5c06\u4e24\u4e2a\u7236\u4ee3\u7684\u601d\u60f3\u8fdb\u884c\u4e86\u91cd\u7ec4\u548c\u8026\u5408\u3002\u7236\u4ee30\u4f7f\u7528 `margin - logp_diff` \u7684\u7ed3\u6784\uff0c\u800c\u7236\u4ee31\u4f7f\u7528 `scaling * logp_diff` \u7684\u7ed3\u6784\u3002\u6211\u4eec\u5c06\u8fd9\u4e24\u79cd\u601d\u60f3\u7ed3\u5408\uff0c\u521b\u5efa\u4e86\u4e00\u4e2a `dynamic_margin - stable_logp_diff` \u7684\u9879\u4f5c\u4e3a `logsigmoid` \u7684\u8f93\u5165\u3002\u5176\u4e2d\uff0c`dynamic_margin` \u7ee7\u627f\u4e86\u7236\u4ee30\u7684\u601d\u60f3\uff0c\u5373\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u8fbe\u6210\u7684\u6982\u7387\u5dee\u5f02\u76ee\u6807\uff08\u88d5\u5ea6\uff09\u5c31\u8d8a\u5927\u3002`stable_logp_diff` \u5219\u662f\u6a21\u578b\u5f53\u524d\u5b9e\u9645\u7684\u6982\u7387\u5dee\u5f02\u3002\u8fd9\u79cd `\u76ee\u6807 - \u5b9e\u9645` \u7684\u7ed3\u6784\u6bd4\u7b80\u5355\u7684\u7f29\u653e (`scaling * logp_diff`) \u63d0\u4f9b\u4e86\u66f4\u660e\u786e\u7684\u4f18\u5316\u76ee\u6807\u3002\n2.  **\u88d5\u5ea6\u9971\u548c\u4e0e\u7a33\u5b9a\u6027\u6280\u5de7\uff08\u8026\u5408\u70b92\uff09**\uff1a\u4e3a\u4e86\u9632\u6b62\u7531\u6781\u5927\u7684\u6210\u672c\u5dee\u5f02 (`rank_gap`) \u5bfc\u81f4\u7684 `dynamic_margin` \u65e0\u9650\u589e\u957f\uff0c\u4ece\u800c\u5bf9\u6a21\u578b\u65bd\u52a0\u8fc7\u5927\u7684\u3001\u4e0d\u5207\u5b9e\u9645\u7684\u5b66\u4e60\u538b\u529b\uff0c\u6211\u4eec\u5f15\u5165\u4e86 `tanh` \u51fd\u6570\u5bf9\u88d5\u5ea6\u8fdb\u884c\u9971\u548c\u5904\u7406\u3002`margin = margin_cap * tanh(beta * rank_gap(...))`\u3002\u8fd9\u786e\u4fdd\u4e86\u76ee\u6807\u88d5\u5ea6\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u5408\u7406\u7684\u8303\u56f4\u5185\uff08\u7531\u8d85\u53c2\u6570 `margin_cap` \u63a7\u5236\uff09\uff0c\u4f7f\u5f97\u6a21\u578b\u5728\u9762\u5bf9\u6210\u672c\u5dee\u5f02\u5de8\u5927\u7684\u6837\u672c\u5bf9\u65f6\uff0c\u4e0d\u4f1a\u4ea7\u751f\u68af\u5ea6\u7206\u70b8\u3002\u8fd9\u662f\u4e00\u79cd\u65b0\u7684\u7a33\u5b9a\u6280\u5de7\uff0c\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u5747\u672a\u51fa\u73b0\u3002\n\n\u603b\u7ed3\u6765\u8bf4\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u6784\u5efa\u4e86\u4e00\u4e2a\u81ea\u9002\u5e94\u7684\u76ee\u6807\u88d5\u5ea6\uff08\u57fa\u4e8e\u6210\u672c\u7684\u79e9\u5dee\uff09\uff0c\u4f46\u901a\u8fc7 `tanh` \u5bf9\u5176\u8fdb\u884c\u4e86\u5c01\u9876\u4ee5\u4fdd\u8bc1\u7a33\u5b9a\u6027\u3002\u7136\u540e\uff0c\u5b83\u5c06\u8fd9\u4e2a\u76ee\u6807\u88d5\u5ea6\u4e0e\u6a21\u578b\u5b9e\u9645\u7684\uff08\u7ecf\u8fc7 `tanh` \u7a33\u5b9a\u7684\uff09\u6982\u7387\u5dee\u5f02\u8fdb\u884c\u6bd4\u8f83\uff0c\u5e76\u5c06\u8fd9\u4e2a\u5dee\u503c\u9001\u5165 `logsigmoid` \u635f\u5931\u51fd\u6570\u4e2d\u8fdb\u884c\u60e9\u7f5a\u3002\u8fd9\u79cd\u8bbe\u8ba1\u517c\u987e\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u6027\u3001\u6570\u503c\u7a33\u5b9a\u6027\u548c\u5bf9\u6a21\u578b\u5b66\u4e60\u538b\u529b\u7684\u5408\u7406\u63a7\u5236\u3002", "hyperparams": {"beta": {"value": 0.5, "description": "\u88d5\u5ea6\u654f\u611f\u5ea6\u56e0\u5b50\u3002\u63a7\u5236\u52a8\u6001\u88d5\u5ea6\u968f\u6210\u672c\u79e9\u5dee\u589e\u957f\u7684\u901f\u5ea6\u3002\u8f83\u5927\u7684 beta \u503c\u610f\u5473\u7740\u88d5\u5ea6\u4f1a\u66f4\u5feb\u5730\u8fbe\u5230\u9971\u548c\u4e0a\u9650\u3002"}, "margin_cap": {"value": 2.0, "description": "\u88d5\u5ea6\u4e0a\u9650\u3002\u8fd9\u662f\u6a21\u578b\u88ab\u671f\u671b\u8fbe\u5230\u7684\u6700\u5927\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u76ee\u6807\uff08\u7ecf\u8fc7tanh\u538b\u7f29\u540e\uff09\u3002\u5b83\u9650\u5236\u4e86\u5355\u4e2a\u6837\u672c\u5bf9\u80fd\u4ea7\u751f\u7684\u6700\u5927\u5b66\u4e60\u538b\u529b\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\u3002"}}, "operators_used": ["rank_gap", "tanh", "logsigmoid"]}}}
{"generation": 3, "index": 6, "ir": {"name": "ZScoreClippedLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u4e00\u79cd\u65b0\u9896\u7684\u5f52\u4e00\u5316\u548c\u88c1\u526a\u673a\u5236\u6765\u9002\u5e94\u4e0d\u540c\u5c3a\u5ea6\u548c\u5206\u5e03\u7684\u6210\u672c\u4e0e\u5bf9\u6570\u6982\u7387\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u635f\u5931\u7ed3\u6784\u3002\u635f\u5931\u51fd\u6570\u7684\u57fa\u672c\u5f62\u5f0f\u662f `-logsigmoid(scaled_logp_diff)`\uff0c\u8fd9\u662f\u4e00\u79cd\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u3001\u5e73\u6ed1\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u6210\u5bf9\u6bd4\u8f83\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u81ea\u7136\u5730\u60e9\u7f5a\u9519\u8bef\u7684\u504f\u597d\u6392\u5e8f\uff08`logp_w < logp_l`\uff09\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u601d\u60f3\u3002\u901a\u8fc7\u5c06\u8fd9\u4e2a\u5dee\u5f02\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u6781\u7aef\u5bf9\u6570\u6982\u7387\u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\uff0c\u786e\u4fdd\u4e86\u8bad\u7ec3\u8fc7\u7a0b\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f - Z-Score\uff08\u8026\u5408\u70b91\uff09**\uff1a\u4ee3\u66ff\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\uff0c\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u7b97\u5b50\u6765\u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884c\u5f52\u4e00\u5316\u3002`zscore(cost_w, cost_l)` \u8ba1\u7b97\u7684\u662f `(cost_l - cost_w)` \u5728\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u7684Z\u5206\u6570\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u8003\u8651\u4e86\u6210\u672c\u5dee\u5f02\u7684\u7edd\u5bf9\u503c\uff0c\u8fd8\u8003\u8651\u4e86\u5b83\u5728\u5f53\u524d\u6279\u6b21\u6570\u636e\u5206\u5e03\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6210\u672c\u7684\u5c3a\u5ea6\u4e0d\u654f\u611f\uff0c\u5e76\u4e14\u80fd\u591f\u81ea\u9002\u5e94\u5730\u5904\u7406\u4e0d\u540c\u6279\u6b21\u95f4\u6210\u672c\u5206\u5e03\u7684\u53d8\u5316\uff0c\u6bd4 `rank_gap` \u63d0\u4f9b\u4e86\u66f4\u4e30\u5bcc\u7684\u7edf\u8ba1\u4fe1\u606f\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b9 - \u88c1\u526a\uff08Clipping\uff09\u4e0e\u7f29\u653e**\uff1a\u6211\u4eec\u5c06Z\u5206\u6570\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `cost_diff_zscore` \u901a\u8fc7 `clamp` \u51fd\u6570\u88c1\u526a\u5230\u4e00\u4e2a\u56fa\u5b9a\u7684\u8303\u56f4 `[0, gamma]` \u5185\u3002\u8fd9\u4e2a\u88c1\u526a\u64cd\u4f5c\u6709\u4e24\u4e2a\u76ee\u7684\uff1a\u9996\u5148\uff0c`clamp(x, min=0)` \u786e\u4fdd\u4e86\u5373\u4f7f\u5728\u6781\u5c11\u6570\u60c5\u51b5\u4e0b `cost_w > cost_l` \uff08\u7531\u4e8ez-score\u7684\u6279\u6b21\u6548\u5e94\uff09\uff0c\u6211\u4eec\u4e5f\u4e0d\u4f1a\u9519\u8bef\u5730\u60e9\u7f5a\u6a21\u578b\uff1b\u5176\u6b21\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u4e0a\u9650 `gamma` \u53ef\u4ee5\u9632\u6b62\u6279\u6b21\u4e2d\u6781\u7aef\u7684\u6210\u672c\u5dee\u5f02\uff08\u79bb\u7fa4\u70b9\uff09\u5bf9\u635f\u5931\u4ea7\u751f\u8fc7\u5927\u7684\u5f71\u54cd\uff0c\u8fdb\u4e00\u6b65\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\u7136\u540e\uff0c\u8fd9\u4e2a\u88ab\u88c1\u526a\u548c\u5f52\u4e00\u5316\u7684\u6210\u672c\u5dee\u5f02 `clipped_cost_diff` \u88ab\u7528\u4f5c\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50\uff0c\u4e58\u4ee5\u7a33\u5b9a\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `stable_logp_diff`\u3002\u8fd9\u79cd\u8026\u5408\u65b9\u5f0f\u610f\u5473\u7740\uff0c\u53ea\u6709\u5f53\u6210\u672c\u5dee\u5f02\u5728\u7edf\u8ba1\u4e0a\u663e\u8457\uff08Z\u5206\u6570\u8f83\u5927\uff09\u4e14\u5728\u5408\u7406\u8303\u56f4\u5185\u65f6\uff0c\u6a21\u578b\u624d\u4f1a\u88ab\u8981\u6c42\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u4e00\u79cd\u9c81\u68d2\u7684\u81ea\u9002\u5e94\u52a0\u6743\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7Z-Score\u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u901a\u8fc7\u88c1\u526a\u589e\u5f3a\u4e86\u5bf9\u79bb\u7fa4\u70b9\u7684\u9c81\u68d2\u6027\uff0c\u5e76\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u7a33\u5b9a`logsigmoid`\u7ed3\u6784\u548c`tanh`\u7a33\u5b9a\u6280\u5de7\uff0c\u6784\u5efa\u4e86\u4e00\u4e2a\u5728\u5404\u79cd\u6570\u636e\u5206\u5e03\u4e0b\u90fd\u8868\u73b0\u7a33\u5065\u7684\u9ad8\u7ea7\u504f\u597d\u635f\u5931\u3002", "pseudocode": "def ZScoreClippedLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta, gamma):\n    # 1. \u8bc6\u522b\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u4f7f\u7528 zscore \u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884c\u6279\u6b21\u5f52\u4e00\u5316\n    #    zscore(cost_w, cost_l) \u8fd4\u56de (cost_l - cost_w) \u7684Z\u5206\u6570\uff0c\u4f7f\u5176\u5bf9\u5c3a\u5ea6\u4e0d\u654f\u611f\u3002\n    #    \u8fd9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5173\u4e8e\u6210\u672c\u5dee\u5f02\u5728\u5176\u6279\u6b21\u5206\u5e03\u4e2d\u76f8\u5bf9\u91cd\u8981\u6027\u7684\u4fe1\u53f7\u3002\n    cost_diff_zscore = zscore(cost_w, cost_l)\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u88c1\u526a\u5f52\u4e00\u5316\u7684\u6210\u672c\u5dee\u5f02\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\n    #    \u4f7f\u7528 clamp \u5c06 z-score \u88c1\u526a\u5230 [0, gamma] \u8303\u56f4\u5185\u3002\n    #    min=0 \u786e\u4fdd\u4e86\u6211\u4eec\u53ea\u5173\u6ce8 cost_l > cost_w \u7684\u60c5\u51b5\u3002\n    #    max=gamma \u9632\u6b62\u4e86\u6781\u7aef\u79bb\u7fa4\u503c\u4e3b\u5bfc\u635f\u5931\uff0c\u63d0\u9ad8\u4e86\u7a33\u5b9a\u6027\u3002\n    clipped_cost_diff = clamp(cost_diff_zscore, min=0.0, max=gamma)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u4f7f\u7528 tanh \u5c06 (logp_w - logp_l) \u538b\u7f29\u5230 [-1, 1] \u533a\u95f4\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u65b0\u8026\u5408\u70b92\u7684\u5ef6\u7eed] \u521b\u5efa\u81ea\u9002\u5e94\u7f29\u653e\u7684\u504f\u597d\u4fe1\u53f7\n    #    \u5c06\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7 (clipped_cost_diff) \u4f5c\u4e3a\u6743\u91cd\uff0c\u4e58\u4ee5\u7a33\u5b9a\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u3002\n    #    beta \u662f\u4e00\u4e2a\u5168\u5c40\u7f29\u653e\u56e0\u5b50\uff0c\u7528\u4e8e\u8c03\u6574\u6210\u672c\u4fe1\u53f7\u7684\u6574\u4f53\u5f3a\u5ea6\u3002\n    scaled_logp_diff = beta * clipped_cost_diff * stable_logp_diff\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u4f7f\u7528 logsigmoid \u8ba1\u7b97\u6700\u7ec8\u635f\u5931\n    #    \u8fd9\u662f\u7236\u4ee31\u7684\u6838\u5fc3\u7ed3\u6784\uff0c\u5b83\u5e73\u6ed1\u3001\u6709\u754c\uff0c\u5e76\u4e14\u6570\u503c\u7a33\u5b9a\u3002\n    #    \u5f53 scaled_logp_diff > 0 (\u504f\u597d\u6b63\u786e\u4e14\u6210\u672c\u5dee\u5f02\u663e\u8457) \u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e0\u3002\n    #    \u5f53 scaled_logp_diff < 0 (\u504f\u597d\u9519\u8bef) \u65f6\uff0c\u635f\u5931\u4f1a\u663e\u8457\u589e\u52a0\u3002\n    loss = -logsigmoid(scaled_logp_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u5168\u5c40\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u8c03\u6574\u4e86\u7ecf\u8fc7\u5f52\u4e00\u5316\u548c\u88c1\u526a\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\u5bf9\u6700\u7ec8\u635f\u5931\u7684\u6574\u4f53\u5f71\u54cd\u5f3a\u5ea6\u3002"}, "gamma": {"value": 3.0, "description": "Z\u5206\u6570\u6210\u672c\u5dee\u5f02\u7684\u88c1\u526a\u4e0a\u9650\u3002\u6b64\u503c\u9650\u5236\u4e86\u5355\u4e2a\u6837\u672c\u5bf9\uff08\u7531\u4e8e\u5176\u5de8\u5927\u7684\u6210\u672c\u5dee\u5f02\uff09\u5bf9\u635f\u5931\u7684\u8d21\u732e\u4e0a\u9650\uff0c\u9632\u6b62\u79bb\u7fa4\u70b9\u4e3b\u5bfc\u68af\u5ea6\u3002\u901a\u5e38\u8bbe\u7f6e\u4e3a2.0\u62163.0\uff0c\u5bf9\u5e94\u6807\u51c6\u6b63\u6001\u5206\u5e03\u4e2d\u7684\u7b2c97.7\u621699.8\u767e\u5206\u4f4d\u6570\u3002"}}, "operators_used": ["zscore", "clamp", "tanh", "logsigmoid"], "implementation_hint": {"expects": ["Tensors: cost_a, cost_b, logp_a, logp_b. Scalars: beta, gamma. The `zscore` operator is assumed to operate over a batch of (cost_w, cost_l) pairs."], "returns": "A scalar tensor representing the final loss for the pair."}}, "fitness": {"hf_like_score": 4.084754943847656, "validation_objective": 4.084754943847656, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.064309597015381}, "train_score_mean": 4.277524583041668, "train_loss_mean": 0.6928327344357967, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u4e00\u79cd\u65b0\u9896\u7684\u5f52\u4e00\u5316\u548c\u88c1\u526a\u673a\u5236\u6765\u9002\u5e94\u4e0d\u540c\u5c3a\u5ea6\u548c\u5206\u5e03\u7684\u6210\u672c\u4e0e\u5bf9\u6570\u6982\u7387\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u635f\u5931\u7ed3\u6784\u3002\u635f\u5931\u51fd\u6570\u7684\u57fa\u672c\u5f62\u5f0f\u662f `-logsigmoid(scaled_logp_diff)`\uff0c\u8fd9\u662f\u4e00\u79cd\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u3001\u5e73\u6ed1\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u6210\u5bf9\u6bd4\u8f83\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u81ea\u7136\u5730\u60e9\u7f5a\u9519\u8bef\u7684\u504f\u597d\u6392\u5e8f\uff08`logp_w < logp_l`\uff09\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u601d\u60f3\u3002\u901a\u8fc7\u5c06\u8fd9\u4e2a\u5dee\u5f02\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u6781\u7aef\u5bf9\u6570\u6982\u7387\u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\uff0c\u786e\u4fdd\u4e86\u8bad\u7ec3\u8fc7\u7a0b\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f - Z-Score\uff08\u8026\u5408\u70b91\uff09**\uff1a\u4ee3\u66ff\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\uff0c\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u7b97\u5b50\u6765\u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884c\u5f52\u4e00\u5316\u3002`zscore(cost_w, cost_l)` \u8ba1\u7b97\u7684\u662f `(cost_l - cost_w)` \u5728\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u7684Z\u5206\u6570\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u8003\u8651\u4e86\u6210\u672c\u5dee\u5f02\u7684\u7edd\u5bf9\u503c\uff0c\u8fd8\u8003\u8651\u4e86\u5b83\u5728\u5f53\u524d\u6279\u6b21\u6570\u636e\u5206\u5e03\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6210\u672c\u7684\u5c3a\u5ea6\u4e0d\u654f\u611f\uff0c\u5e76\u4e14\u80fd\u591f\u81ea\u9002\u5e94\u5730\u5904\u7406\u4e0d\u540c\u6279\u6b21\u95f4\u6210\u672c\u5206\u5e03\u7684\u53d8\u5316\uff0c\u6bd4 `rank_gap` \u63d0\u4f9b\u4e86\u66f4\u4e30\u5bcc\u7684\u7edf\u8ba1\u4fe1\u606f\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b9 - \u88c1\u526a\uff08Clipping\uff09\u4e0e\u7f29\u653e**\uff1a\u6211\u4eec\u5c06Z\u5206\u6570\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `cost_diff_zscore` \u901a\u8fc7 `clamp` \u51fd\u6570\u88c1\u526a\u5230\u4e00\u4e2a\u56fa\u5b9a\u7684\u8303\u56f4 `[0, gamma]` \u5185\u3002\u8fd9\u4e2a\u88c1\u526a\u64cd\u4f5c\u6709\u4e24\u4e2a\u76ee\u7684\uff1a\u9996\u5148\uff0c`clamp(x, min=0)` \u786e\u4fdd\u4e86\u5373\u4f7f\u5728\u6781\u5c11\u6570\u60c5\u51b5\u4e0b `cost_w > cost_l` \uff08\u7531\u4e8ez-score\u7684\u6279\u6b21\u6548\u5e94\uff09\uff0c\u6211\u4eec\u4e5f\u4e0d\u4f1a\u9519\u8bef\u5730\u60e9\u7f5a\u6a21\u578b\uff1b\u5176\u6b21\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u4e0a\u9650 `gamma` \u53ef\u4ee5\u9632\u6b62\u6279\u6b21\u4e2d\u6781\u7aef\u7684\u6210\u672c\u5dee\u5f02\uff08\u79bb\u7fa4\u70b9\uff09\u5bf9\u635f\u5931\u4ea7\u751f\u8fc7\u5927\u7684\u5f71\u54cd\uff0c\u8fdb\u4e00\u6b65\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\u7136\u540e\uff0c\u8fd9\u4e2a\u88ab\u88c1\u526a\u548c\u5f52\u4e00\u5316\u7684\u6210\u672c\u5dee\u5f02 `clipped_cost_diff` \u88ab\u7528\u4f5c\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50\uff0c\u4e58\u4ee5\u7a33\u5b9a\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `stable_logp_diff`\u3002\u8fd9\u79cd\u8026\u5408\u65b9\u5f0f\u610f\u5473\u7740\uff0c\u53ea\u6709\u5f53\u6210\u672c\u5dee\u5f02\u5728\u7edf\u8ba1\u4e0a\u663e\u8457\uff08Z\u5206\u6570\u8f83\u5927\uff09\u4e14\u5728\u5408\u7406\u8303\u56f4\u5185\u65f6\uff0c\u6a21\u578b\u624d\u4f1a\u88ab\u8981\u6c42\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u4e00\u79cd\u9c81\u68d2\u7684\u81ea\u9002\u5e94\u52a0\u6743\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7Z-Score\u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u901a\u8fc7\u88c1\u526a\u589e\u5f3a\u4e86\u5bf9\u79bb\u7fa4\u70b9\u7684\u9c81\u68d2\u6027\uff0c\u5e76\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u7a33\u5b9a`logsigmoid`\u7ed3\u6784\u548c`tanh`\u7a33\u5b9a\u6280\u5de7\uff0c\u6784\u5efa\u4e86\u4e00\u4e2a\u5728\u5404\u79cd\u6570\u636e\u5206\u5e03\u4e0b\u90fd\u8868\u73b0\u7a33\u5065\u7684\u9ad8\u7ea7\u504f\u597d\u635f\u5931\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u5168\u5c40\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u8c03\u6574\u4e86\u7ecf\u8fc7\u5f52\u4e00\u5316\u548c\u88c1\u526a\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\u5bf9\u6700\u7ec8\u635f\u5931\u7684\u6574\u4f53\u5f71\u54cd\u5f3a\u5ea6\u3002"}, "gamma": {"value": 3.0, "description": "Z\u5206\u6570\u6210\u672c\u5dee\u5f02\u7684\u88c1\u526a\u4e0a\u9650\u3002\u6b64\u503c\u9650\u5236\u4e86\u5355\u4e2a\u6837\u672c\u5bf9\uff08\u7531\u4e8e\u5176\u5de8\u5927\u7684\u6210\u672c\u5dee\u5f02\uff09\u5bf9\u635f\u5931\u7684\u8d21\u732e\u4e0a\u9650\uff0c\u9632\u6b62\u79bb\u7fa4\u70b9\u4e3b\u5bfc\u68af\u5ea6\u3002\u901a\u5e38\u8bbe\u7f6e\u4e3a2.0\u62163.0\uff0c\u5bf9\u5e94\u6807\u51c6\u6b63\u6001\u5206\u5e03\u4e2d\u7684\u7b2c97.7\u621699.8\u767e\u5206\u4f4d\u6570\u3002"}}, "operators_used": ["zscore", "clamp", "tanh", "logsigmoid"]}}}
{"generation": 3, "index": 7, "ir": {"name": "HybridMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u7ed3\u6784\uff0c\u5373 `loss = -logsigmoid(scaled_logp_diff)`\u3002\u8fd9\u79cd\u7ed3\u6784\u5728\u6210\u5bf9\u6bd4\u8f83\u4efb\u52a1\u4e2d\u88ab\u5e7f\u6cdb\u8bc1\u660e\u662f\u6709\u6548\u7684\uff0c\u5b83\u81ea\u7136\u5730\u5c06 `logp_w > logp_l` \u7684\u60c5\u51b5\u63a8\u5411\u4f4e\u635f\u5931\uff0c\u5e76\u4e14\u51fd\u6570\u672c\u8eab\u5e73\u6ed1\u3001\u6709\u754c\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - value)` \u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u601d\u60f3\u3002\u6211\u4eec\u5c06\u8fd9\u4e2a\u601d\u60f3\u5e94\u7528\u5230\u4e86 `logsigmoid` \u7684\u8f93\u5165\u4e2d\uff0c\u5373 `logsigmoid` \u7684\u53c2\u6570\u4e0d\u518d\u662f\u7b80\u5355\u7684 `logp_diff`\uff0c\u800c\u662f `logp_diff - margin` \u7684\u5f62\u5f0f\uff0c\u8fd9\u76f8\u5f53\u4e8e\u5728 `logsigmoid` \u7a7a\u95f4\u4e2d\u5f15\u5165\u4e86\u4e00\u4e2a\u52a8\u6001\u7684\u3001\u57fa\u4e8e\u6210\u672c\u7684\u8fb9\u754c\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u8026\u5408\u70b91\uff1a\u6df7\u5408\u635f\u5931\u7ed3\u6784 (Hybrid Structure)**\uff1a\u8fd9\u662f\u6700\u5173\u952e\u7684\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee30\u90a3\u6837\u76f4\u63a5\u4f7f\u7528 `softplus(margin - logp_diff)`\uff0c\u4e5f\u6ca1\u6709\u50cf\u7236\u4ee31\u90a3\u6837\u4f7f\u7528 `logsigmoid(beta * rank_gap * logp_diff)`\u3002\u800c\u662f\u5c06\u4e24\u8005\u878d\u5408\uff0c\u521b\u5efa\u4e86 `logsigmoid((logp_w - logp_l) - margin)` \u7ed3\u6784\u3002\u8fd9\u91cc\u7684 `margin` \u662f\u52a8\u6001\u7684\uff0c\u7531\u6210\u672c\u5dee\u5f02\u51b3\u5b9a\u3002\u8fd9\u79cd\u8bbe\u8ba1\u610f\u5473\u7740\uff1a\u6a21\u578b\u4e0d\u4ec5\u8981\u4fdd\u8bc1 `logp_w > logp_l`\uff0c\u8fd8\u5fc5\u987b\u4fdd\u8bc1\u5176\u5dee\u5f02 `logp_w - logp_l` \u8d85\u8fc7\u4e00\u4e2a\u7531\u6210\u672c\u5dee\u5f02\u51b3\u5b9a\u7684\u52a8\u6001\u9608\u503c `margin`\uff0c\u624d\u80fd\u83b7\u5f97\u8f83\u4f4e\u7684\u635f\u5931\u3002\u8fd9\u6bd4\u7236\u4ee31\u7684\u8981\u6c42\u66f4\u4e25\u683c\uff0c\u6bd4\u7236\u4ee30\u7684\u68af\u5ea6\u66f4\u5e73\u6ed1\uff08\u56e0\u4e3a `logsigmoid` \u5728\u8d1f\u534a\u8f74\u7684\u68af\u5ea6\u4e0d\u4f1a\u50cf `softplus` \u90a3\u6837\u6d88\u5931\uff09\u3002\n2.  **\u8026\u5408\u70b92\uff1a\u9c81\u68d2\u7684\u52a8\u6001\u88d5\u5ea6 (Robust Dynamic Margin)**\uff1a\u6211\u4eec\u540c\u65f6\u7ee7\u627f\u4e86\u4e24\u4e2a\u7236\u4ee3\u90fd\u4f7f\u7528\u7684 `rank_gap` \u7b97\u5b50\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u5bf9\u6210\u672c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\u3002\u4e0e\u7236\u4ee30\u7c7b\u4f3c\uff0c\u6211\u4eec\u5c06 `rank_gap` \u7684\u8f93\u51fa\u901a\u8fc7\u8d85\u53c2\u6570 `beta` \u8fdb\u884c\u7ebf\u6027\u7f29\u653e\uff0c\u76f4\u63a5\u4f5c\u4e3a\u88d5\u5ea6 `margin`\u3002\u8fd9\u521b\u5efa\u4e86\u4e00\u4e2a\u6e05\u6670\u7684\u76ee\u6807\uff1a\u6210\u672c\u7684\u79e9\u5dee\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u4ea7\u751f\u7684\u5bf9\u6570\u6982\u7387\u5dee\u4e5f\u5e94\u8d8a\u5927\u3002\u516c\u5f0f\u4e3a `margin = beta * rank_gap(cost_w, cost_l)`\u3002\n3.  **\u7a33\u5b9a\u6027\u6280\u5de7**\uff1a\u4e3a\u4e86\u9632\u6b62 `logp_w - logp_l` \u51fa\u73b0\u6781\u7aef\u503c\u5bfc\u81f4\u6570\u503c\u4e0d\u7a33\u5b9a\uff0c\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee3\u90a3\u6837\u4f7f\u7528 `tanh` \u6765\u538b\u7f29\u5b83\u3002\u76f8\u53cd\uff0c\u6211\u4eec\u5229\u7528\u4e86 `logsigmoid` \u51fd\u6570\u81ea\u8eab\u7684\u7279\u6027\u3002`logsigmoid(x)` \u5bf9\u4e8e\u5927\u7684\u6b63 `x` \u503c\u8d8b\u8fd1\u4e8e0\uff0c\u5bf9\u4e8e\u5927\u7684\u8d1f `x` \u503c\u8d8b\u8fd1\u4e8e `-x`\u3002\u901a\u8fc7\u5c06 `logp_diff - margin` \u4f5c\u4e3a\u8f93\u5165\uff0c\u5373\u4f7f `logp_diff` \u53d8\u5f97\u975e\u5e38\u5927\uff0c\u635f\u5931\u4e5f\u4f1a\u7a33\u5b9a\u5730\u8d8b\u8fd1\u4e8e0\uff1b\u5982\u679c `logp_diff` \u53d8\u5f97\u975e\u5e38\u8d1f\uff0c\u635f\u5931\u4f1a\u8fd1\u4f3c\u7ebf\u6027\u589e\u957f\uff0c\u63d0\u4f9b\u4e86\u7a33\u5b9a\u800c\u6709\u6548\u7684\u68af\u5ea6\u4fe1\u53f7\u3002\u8fd9\u79cd\u65b9\u5f0f\u6bd4 `tanh` \u66f4\u7b80\u6d01\uff0c\u56e0\u4e3a\u5b83\u76f4\u63a5\u96c6\u6210\u5728\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u4e2d\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u52a8\u6001\u88d5\u5ea6\u7684\u6982\u5ff5\u5d4c\u5165\u5230 `logsigmoid` \u6846\u67b6\u4e2d\uff0c\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684\u6df7\u5408\u76ee\u6807\uff0c\u65e2\u80fd\u5229\u7528 `logsigmoid` \u7684\u826f\u597d\u7279\u6027\uff0c\u53c8\u80fd\u901a\u8fc7\u52a8\u6001\u88d5\u5ea6\u5f3a\u5236\u6a21\u578b\u5b66\u4e60\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u79f0\u7684\u504f\u597d\u5f3a\u5ea6\u3002", "pseudocode": "def HybridMarginLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u8026\u5408\u70b92] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u52a8\u6001\u88d5\u5ea6 (margin)\n    #    \u7ee7\u627f\u81ea\u7236\u4ee30\u7684\u7ebf\u6027\u7f29\u653e\u88d5\u5ea6\u601d\u60f3\uff0c\u5e76\u4f7f\u7528\u4e24\u4e2a\u7236\u4ee3\u90fd\u9752\u7750\u7684 rank_gap \u7b97\u5b50\u6765\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    beta \u63a7\u5236\u4e86\u6210\u672c\u7684\u79e9\u5dee\u9700\u8981\u8f6c\u5316\u4e3a\u591a\u5927\u7684\u5bf9\u6570\u6982\u7387\u5dee\u76ee\u6807\u3002\n    #    rank_gap(cost_w, cost_l) \u8fd4\u56de\u4e00\u4e2a\u975e\u8d1f\u503c\u3002\n    dynamic_margin = beta * rank_gap(cost_w, cost_l)\n\n    # 3. \u8ba1\u7b97\u539f\u59cb\u7684\u5bf9\u6570\u6982\u7387\u5dee\n    #    (logp_w - logp_l) \u671f\u671b\u4e3a\u6b63\u3002\n    logp_diff = logp_w - logp_l\n\n    # 4. [\u8026\u5408\u70b91] \u5c06\u52a8\u6001\u88d5\u5ea6\u6574\u5408\u5230\u5bf9\u6570\u6982\u7387\u5dee\u4e2d\n    #    \u8fd9\u662f\u5bf9\u7236\u4ee30\u7684 Hinge \u601d\u60f3 (value - margin) \u7684\u4e00\u79cd\u53d8\u4f53\u5e94\u7528\u3002\n    #    \u6211\u4eec\u5e0c\u671b logp_diff \u4e0d\u4ec5\u4e3a\u6b63\uff0c\u800c\u4e14\u8981\u5927\u4e8e dynamic_margin\u3002\n    #    \u5f53 logp_diff > dynamic_margin \u65f6\uff0c\u8be5\u9879\u4e3a\u6b63\uff0c\u635f\u5931\u5c0f\u3002\n    #    \u5f53 logp_diff < dynamic_margin \u65f6\uff0c\u8be5\u9879\u4e3a\u8d1f\uff0c\u635f\u5931\u5927\u3002\n    margin_adjusted_diff = logp_diff - dynamic_margin\n\n    # 5. \u8ba1\u7b97\u6700\u7ec8\u635f\u5931\n    #    \u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u6838\u5fc3 logsigmoid \u7ed3\u6784\u3002\n    #    -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u975e\u8d1f\u7684\u635f\u5931\u51fd\u6570\u3002\n    #    \u5f53 margin_adjusted_diff \u8fdc\u5927\u4e8e0\u65f6\uff0closs \u8d8b\u8fd1\u4e8e 0\u3002\n    #    \u5f53 margin_adjusted_diff \u8fdc\u5c0f\u4e8e0\u65f6\uff0closs \u8d8b\u8fd1\u4e8e -margin_adjusted_diff\uff0c\u63d0\u4f9b\u5f3a\u68af\u5ea6\u4fe1\u53f7\u3002\n    loss = -logsigmoid(margin_adjusted_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6210\u672c\u7684\u79e9\u5dee\uff08rank gap\uff09\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u5bf9\u6570\u6982\u7387\u5dee\uff08\u88d5\u5ea6\uff09\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u79e9\u5dee\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u6982\u7387\u5206\u79bb\u3002"}}, "operators_used": ["rank_gap", "logsigmoid"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor) for a batch of pairs. beta (float)."], "returns": "A scalar Tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.122578144073486, "validation_objective": 4.122578144073486, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.048621892929077}, "train_score_mean": 4.240978077054024, "train_loss_mean": 0.6928594019263983, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "HybridMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u7ed3\u6784\uff0c\u5373 `loss = -logsigmoid(scaled_logp_diff)`\u3002\u8fd9\u79cd\u7ed3\u6784\u5728\u6210\u5bf9\u6bd4\u8f83\u4efb\u52a1\u4e2d\u88ab\u5e7f\u6cdb\u8bc1\u660e\u662f\u6709\u6548\u7684\uff0c\u5b83\u81ea\u7136\u5730\u5c06 `logp_w > logp_l` \u7684\u60c5\u51b5\u63a8\u5411\u4f4e\u635f\u5931\uff0c\u5e76\u4e14\u51fd\u6570\u672c\u8eab\u5e73\u6ed1\u3001\u6709\u754c\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - value)` \u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u601d\u60f3\u3002\u6211\u4eec\u5c06\u8fd9\u4e2a\u601d\u60f3\u5e94\u7528\u5230\u4e86 `logsigmoid` \u7684\u8f93\u5165\u4e2d\uff0c\u5373 `logsigmoid` \u7684\u53c2\u6570\u4e0d\u518d\u662f\u7b80\u5355\u7684 `logp_diff`\uff0c\u800c\u662f `logp_diff - margin` \u7684\u5f62\u5f0f\uff0c\u8fd9\u76f8\u5f53\u4e8e\u5728 `logsigmoid` \u7a7a\u95f4\u4e2d\u5f15\u5165\u4e86\u4e00\u4e2a\u52a8\u6001\u7684\u3001\u57fa\u4e8e\u6210\u672c\u7684\u8fb9\u754c\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u8026\u5408\u70b91\uff1a\u6df7\u5408\u635f\u5931\u7ed3\u6784 (Hybrid Structure)**\uff1a\u8fd9\u662f\u6700\u5173\u952e\u7684\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee30\u90a3\u6837\u76f4\u63a5\u4f7f\u7528 `softplus(margin - logp_diff)`\uff0c\u4e5f\u6ca1\u6709\u50cf\u7236\u4ee31\u90a3\u6837\u4f7f\u7528 `logsigmoid(beta * rank_gap * logp_diff)`\u3002\u800c\u662f\u5c06\u4e24\u8005\u878d\u5408\uff0c\u521b\u5efa\u4e86 `logsigmoid((logp_w - logp_l) - margin)` \u7ed3\u6784\u3002\u8fd9\u91cc\u7684 `margin` \u662f\u52a8\u6001\u7684\uff0c\u7531\u6210\u672c\u5dee\u5f02\u51b3\u5b9a\u3002\u8fd9\u79cd\u8bbe\u8ba1\u610f\u5473\u7740\uff1a\u6a21\u578b\u4e0d\u4ec5\u8981\u4fdd\u8bc1 `logp_w > logp_l`\uff0c\u8fd8\u5fc5\u987b\u4fdd\u8bc1\u5176\u5dee\u5f02 `logp_w - logp_l` \u8d85\u8fc7\u4e00\u4e2a\u7531\u6210\u672c\u5dee\u5f02\u51b3\u5b9a\u7684\u52a8\u6001\u9608\u503c `margin`\uff0c\u624d\u80fd\u83b7\u5f97\u8f83\u4f4e\u7684\u635f\u5931\u3002\u8fd9\u6bd4\u7236\u4ee31\u7684\u8981\u6c42\u66f4\u4e25\u683c\uff0c\u6bd4\u7236\u4ee30\u7684\u68af\u5ea6\u66f4\u5e73\u6ed1\uff08\u56e0\u4e3a `logsigmoid` \u5728\u8d1f\u534a\u8f74\u7684\u68af\u5ea6\u4e0d\u4f1a\u50cf `softplus` \u90a3\u6837\u6d88\u5931\uff09\u3002\n2.  **\u8026\u5408\u70b92\uff1a\u9c81\u68d2\u7684\u52a8\u6001\u88d5\u5ea6 (Robust Dynamic Margin)**\uff1a\u6211\u4eec\u540c\u65f6\u7ee7\u627f\u4e86\u4e24\u4e2a\u7236\u4ee3\u90fd\u4f7f\u7528\u7684 `rank_gap` \u7b97\u5b50\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u5bf9\u6210\u672c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\u3002\u4e0e\u7236\u4ee30\u7c7b\u4f3c\uff0c\u6211\u4eec\u5c06 `rank_gap` \u7684\u8f93\u51fa\u901a\u8fc7\u8d85\u53c2\u6570 `beta` \u8fdb\u884c\u7ebf\u6027\u7f29\u653e\uff0c\u76f4\u63a5\u4f5c\u4e3a\u88d5\u5ea6 `margin`\u3002\u8fd9\u521b\u5efa\u4e86\u4e00\u4e2a\u6e05\u6670\u7684\u76ee\u6807\uff1a\u6210\u672c\u7684\u79e9\u5dee\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u4ea7\u751f\u7684\u5bf9\u6570\u6982\u7387\u5dee\u4e5f\u5e94\u8d8a\u5927\u3002\u516c\u5f0f\u4e3a `margin = beta * rank_gap(cost_w, cost_l)`\u3002\n3.  **\u7a33\u5b9a\u6027\u6280\u5de7**\uff1a\u4e3a\u4e86\u9632\u6b62 `logp_w - logp_l` \u51fa\u73b0\u6781\u7aef\u503c\u5bfc\u81f4\u6570\u503c\u4e0d\u7a33\u5b9a\uff0c\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee3\u90a3\u6837\u4f7f\u7528 `tanh` \u6765\u538b\u7f29\u5b83\u3002\u76f8\u53cd\uff0c\u6211\u4eec\u5229\u7528\u4e86 `logsigmoid` \u51fd\u6570\u81ea\u8eab\u7684\u7279\u6027\u3002`logsigmoid(x)` \u5bf9\u4e8e\u5927\u7684\u6b63 `x` \u503c\u8d8b\u8fd1\u4e8e0\uff0c\u5bf9\u4e8e\u5927\u7684\u8d1f `x` \u503c\u8d8b\u8fd1\u4e8e `-x`\u3002\u901a\u8fc7\u5c06 `logp_diff - margin` \u4f5c\u4e3a\u8f93\u5165\uff0c\u5373\u4f7f `logp_diff` \u53d8\u5f97\u975e\u5e38\u5927\uff0c\u635f\u5931\u4e5f\u4f1a\u7a33\u5b9a\u5730\u8d8b\u8fd1\u4e8e0\uff1b\u5982\u679c `logp_diff` \u53d8\u5f97\u975e\u5e38\u8d1f\uff0c\u635f\u5931\u4f1a\u8fd1\u4f3c\u7ebf\u6027\u589e\u957f\uff0c\u63d0\u4f9b\u4e86\u7a33\u5b9a\u800c\u6709\u6548\u7684\u68af\u5ea6\u4fe1\u53f7\u3002\u8fd9\u79cd\u65b9\u5f0f\u6bd4 `tanh` \u66f4\u7b80\u6d01\uff0c\u56e0\u4e3a\u5b83\u76f4\u63a5\u96c6\u6210\u5728\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u4e2d\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u52a8\u6001\u88d5\u5ea6\u7684\u6982\u5ff5\u5d4c\u5165\u5230 `logsigmoid` \u6846\u67b6\u4e2d\uff0c\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684\u6df7\u5408\u76ee\u6807\uff0c\u65e2\u80fd\u5229\u7528 `logsigmoid` \u7684\u826f\u597d\u7279\u6027\uff0c\u53c8\u80fd\u901a\u8fc7\u52a8\u6001\u88d5\u5ea6\u5f3a\u5236\u6a21\u578b\u5b66\u4e60\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u79f0\u7684\u504f\u597d\u5f3a\u5ea6\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6210\u672c\u7684\u79e9\u5dee\uff08rank gap\uff09\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u5bf9\u6570\u6982\u7387\u5dee\uff08\u88d5\u5ea6\uff09\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u79e9\u5dee\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u6982\u7387\u5206\u79bb\u3002"}}, "operators_used": ["rank_gap", "logsigmoid"]}}}
{"generation": 4, "index": 0, "ir": {"name": "HybridMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u7ed3\u6784\u3002\u635f\u5931\u51fd\u6570\u88ab\u5b9a\u4e49\u4e3a `-logsigmoid(...)`\uff0c\u8fd9\u662f\u4e00\u79cd\u88ab\u5e7f\u6cdb\u8bc1\u660e\u6709\u6548\u7684\u6210\u5bf9\u6bd4\u8f83\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u5929\u7136\u5e73\u6ed1\u3001\u6709\u754c\uff0c\u4e14\u5bf9\u4e8e\u6b63\u786e\u7684\u504f\u597d\uff08\u5373 `logp_w > logp_l`\uff09\u60e9\u7f5a\u5f88\u5c0f\uff0c\u800c\u5bf9\u9519\u8bef\u7684\u504f\u597d\u60e9\u7f5a\u5f88\u5927\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u5176\u5c06\u201c\u6210\u672c\u5dee\u5f02\u201d\u76f4\u63a5\u8f6c\u5316\u4e3a\u201c\u76ee\u6807\u88d5\u5ea6 (margin)\u201d\u7684\u8bbe\u8ba1\u54f2\u5b66\u3002\u5373\uff0c\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u6a21\u578b\u5e94\u8be5\u88ab\u63a8\u52a8\u4ea7\u751f\u8d8a\u5927\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u4fe1\u53f7\u7684\u5f3a\u5ea6\u4e0e\u504f\u597d\u4fe1\u53f7\u7684\u660e\u786e\u7a0b\u5ea6\u6210\u6b63\u6bd4\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u6df7\u5408\u88d5\u5ea6\u8bbe\u8ba1)**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u6838\u5fc3\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee31\u90a3\u6837\u5c06\u6210\u672c\u5dee\u5f02\u7528\u4f5c `logp_diff` \u7684\u7f29\u653e\u56e0\u5b50\uff0c\u4e5f\u6ca1\u6709\u50cf\u7236\u4ee30\u90a3\u6837\u7b80\u5355\u5730\u5c06\u88d5\u5ea6\u4e0e `logp_diff` \u76f8\u51cf\u3002\u800c\u662f\u5c06\u4e24\u8005\u7ed3\u5408\uff1a\u635f\u5931\u7684\u6838\u5fc3\u662f `logsigmoid` \u7684\u8f93\u5165\uff0c\u6211\u4eec\u5c06\u5176\u8bbe\u8ba1\u4e3a `logp_diff - margin`\u3002\u8fd9\u79cd `logsigmoid(logp_diff - margin)` \u7684\u5f62\u5f0f\u53ef\u4ee5\u88ab\u770b\u4f5c\u662f\u7ecf\u5178\u7684 Bradley-Terry \u6a21\u578b\u7684\u4e00\u4e2a\u6269\u5c55\uff0c\u5176\u4e2d\u504f\u597d\u4e0d\u4ec5\u4ec5\u53d6\u51b3\u4e8e `logp_diff`\uff0c\u8fd8\u5fc5\u987b\u201c\u6218\u80dc\u201d\u4e00\u4e2a\u7531\u6210\u672c\u5dee\u5f02\u51b3\u5b9a\u7684\u52a8\u6001\u9608\u503c\uff08\u88d5\u5ea6\uff09\u3002\u5f53 `logp_diff` \u663e\u8457\u5927\u4e8e `margin` \u65f6\uff0c\u635f\u5931\u624d\u8d8b\u8fd1\u4e8e\u96f6\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u88d5\u5ea6\u5f52\u4e00\u5316\u4e0e\u7f29\u653e)**\uff1a\u4e3a\u4e86\u63d0\u9ad8\u5bf9\u6210\u672c\u5206\u5e03\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u9996\u5148\u5bf9\u6279\u6b21\u5185\u7684\u6240\u6709\u6210\u672c\u8fdb\u884c `zscore` \u5f52\u4e00\u5316\u3002\u7136\u540e\uff0c\u4f7f\u7528 `rank_gap` \u8ba1\u7b97\u5f52\u4e00\u5316\u540e\u6210\u672c\u7684\u79e9\u5dee\uff0c\u8fd9\u7ee7\u627f\u4e86\u4e24\u4e2a\u7236\u4ee3\u90fd\u4f7f\u7528\u7684\u9c81\u68d2\u79e9\u5dee\u601d\u60f3\u3002\u6700\u540e\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a\u79e9\u5dee\u901a\u8fc7 `softplus` \u51fd\u6570\u4f20\u9012\uff0c\u5e76\u7528 `beta` \u8fdb\u884c\u7f29\u653e\uff0c\u4ee5\u786e\u4fdd\u88d5\u5ea6\u59cb\u7ec8\u4e3a\u6b63\u4e14\u5e73\u6ed1\u3002`margin = beta * softplus(rank_gap(zscore(cost_w), zscore(cost_l)))`\u3002\u8fd9\u79cd\u591a\u91cd\u5904\u7406\uff08zscore -> rank_gap -> softplus\uff09\u786e\u4fdd\u4e86\u88d5\u5ea6\u4fe1\u53f7\u65e2\u7a33\u5b9a\u53c8\u5177\u6709\u533a\u5206\u5ea6\uff0c\u907f\u514d\u4e86\u539f\u59cb\u6210\u672c\u5c3a\u5ea6\u548c\u5f02\u5e38\u503c\u5e26\u6765\u7684\u95ee\u9898\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`HybridMarginLogSigmoidLoss` \u901a\u8fc7\u5c06\u52a8\u6001\u88d5\u5ea6\u7684\u6982\u5ff5\u65e0\u7f1d\u5730\u5d4c\u5165\u5230 `logsigmoid` \u6846\u67b6\u4e2d\uff0c\u5e76\u5f15\u5165\u4e00\u79cd\u9c81\u68d2\u7684\u88d5\u5ea6\u8ba1\u7b97\u6d41\u7a0b\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u65b0\u9896\u3001\u7a33\u5b9a\u4e14\u89e3\u91ca\u6027\u5f3a\u7684\u504f\u597d\u635f\u5931\u3002", "pseudocode": "def HybridMarginLogSigmoidLoss(costs, all_logps, beta):\n    # costs: [cost_a, cost_b, ...], all_logps: [logp_a, logp_b, ...]\n    # \u5047\u8bbe\u6211\u4eec\u5904\u7406\u7684\u662f\u4e00\u5bf9\u6837\u672c (a, b)\n    cost_a, cost_b = costs[0], costs[1]\n    logp_a, logp_b = all_logps[0], all_logps[1]\n\n    # 1. \u8bc6\u522b\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b92] \u5bf9\u6279\u6b21\u5185\u7684\u6210\u672c\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\n    #    zscore_costs = zscore(costs) # \u5047\u8bbe zscore \u5bf9\u6574\u4e2a\u6279\u6b21\u7684\u6210\u672c\u64cd\u4f5c\n    #    z_cost_w, z_cost_l = zscore_costs[winner_index], zscore_costs[loser_index]\n    #    \u4e3a\u4e86\u4f2a\u4ee3\u7801\u7b80\u6d01\uff0c\u6211\u4eec\u76f4\u63a5\u5bf9\u5f53\u524d\u5bf9\u64cd\u4f5c\uff0c\u5b9e\u9645\u5e94\u5728\u6279\u6b21\u4e0a\u8fdb\u884c\n    z_cost_w, z_cost_l = zscore([cost_w, cost_l])\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee30\u548c1] \u4f7f\u7528 rank_gap \u8ba1\u7b97\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\n    #    rank_gap(z_cost_w, z_cost_l) \u4f1a\u8fd4\u56de\u4e00\u4e2a\u6b63\u503c\n    cost_rank_diff = rank_gap(z_cost_w, z_cost_l)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee30, \u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u4e00\u4e2a\u5e73\u6ed1\u4e14\u975e\u8d1f\u7684\u52a8\u6001\u88d5\u5ea6 (margin)\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u88d5\u5ea6\u5e73\u6ed1\u4e14\u4e3a\u6b63\uff0cbeta \u63a7\u5236\u5176\u5c3a\u5ea6\n    dynamic_margin = beta * softplus(cost_rank_diff)\n\n    # 5. \u8ba1\u7b97\u5bf9\u6570\u6982\u7387\u5dee\u5f02\n    #    \u6211\u4eec\u671f\u671b logp_w - logp_l \u4e3a\u6b63\n    logp_diff = logp_w - logp_l\n\n    # 6. [\u65b0\u8026\u5408\u70b91, \u7ee7\u627f\u81ea\u7236\u4ee31] \u5c06\u88d5\u5ea6\u5d4c\u5165 logsigmoid \u6846\u67b6\n    #    \u6211\u4eec\u8981\u6c42\u6a21\u578b\u7684\u5bf9\u6570\u6982\u7387\u5dee(logp_diff)\u4e0d\u4ec5\u8981\u4e3a\u6b63\uff0c\u8fd8\u8981\u8d85\u8fc7\u52a8\u6001\u88d5\u5ea6(dynamic_margin)\n    #    \u5f53 logp_diff >> dynamic_margin \u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e 0\n    #    \u5f53 logp_diff << dynamic_margin \u65f6\uff0c\u635f\u5931\u4f1a\u5f88\u5927\n    argument = logp_diff - dynamic_margin\n\n    # 7. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u6700\u7ec8\u635f\u5931\n    #    -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u3001\u975e\u8d1f\u7684\u635f\u5931\u51fd\u6570\n    loss = -logsigmoid(argument)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8e\u6210\u672c\u79e9\u5dee\u8ba1\u7b97\u51fa\u7684\u52a8\u6001\u88d5\u5ea6\u7684\u5927\u5c0f\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u6a21\u578b\u9700\u8981\u4ea7\u751f\u66f4\u5927\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u6765\u6ee1\u8db3\u5177\u6709\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\uff0c\u4ece\u800c\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002"}}, "operators_used": ["zscore", "rank_gap", "softplus", "logsigmoid"], "implementation_hint": {"expects": ["A batch of preference pairs. For each pair: `cost_w` (cost of the winner), `cost_l` (cost of the loser), `logp_w` (log probability of the winner), `logp_l` (log probability of the loser). It's more efficient to receive all costs in a batch to perform `zscore` normalization effectively."], "returns": "A scalar loss value for the pair (or a tensor of losses for a batch), which is non-negative and differentiable."}}, "fitness": {"hf_like_score": 4.11691689491272, "validation_objective": 4.11691689491272, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.076740264892578}, "train_score_mean": 4.227005988359451, "train_loss_mean": 0.6928188763558865, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "HybridMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u7ed3\u6784\u3002\u635f\u5931\u51fd\u6570\u88ab\u5b9a\u4e49\u4e3a `-logsigmoid(...)`\uff0c\u8fd9\u662f\u4e00\u79cd\u88ab\u5e7f\u6cdb\u8bc1\u660e\u6709\u6548\u7684\u6210\u5bf9\u6bd4\u8f83\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u5929\u7136\u5e73\u6ed1\u3001\u6709\u754c\uff0c\u4e14\u5bf9\u4e8e\u6b63\u786e\u7684\u504f\u597d\uff08\u5373 `logp_w > logp_l`\uff09\u60e9\u7f5a\u5f88\u5c0f\uff0c\u800c\u5bf9\u9519\u8bef\u7684\u504f\u597d\u60e9\u7f5a\u5f88\u5927\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u5176\u5c06\u201c\u6210\u672c\u5dee\u5f02\u201d\u76f4\u63a5\u8f6c\u5316\u4e3a\u201c\u76ee\u6807\u88d5\u5ea6 (margin)\u201d\u7684\u8bbe\u8ba1\u54f2\u5b66\u3002\u5373\uff0c\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u6a21\u578b\u5e94\u8be5\u88ab\u63a8\u52a8\u4ea7\u751f\u8d8a\u5927\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u4fe1\u53f7\u7684\u5f3a\u5ea6\u4e0e\u504f\u597d\u4fe1\u53f7\u7684\u660e\u786e\u7a0b\u5ea6\u6210\u6b63\u6bd4\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u6df7\u5408\u88d5\u5ea6\u8bbe\u8ba1)**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u6838\u5fc3\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee31\u90a3\u6837\u5c06\u6210\u672c\u5dee\u5f02\u7528\u4f5c `logp_diff` \u7684\u7f29\u653e\u56e0\u5b50\uff0c\u4e5f\u6ca1\u6709\u50cf\u7236\u4ee30\u90a3\u6837\u7b80\u5355\u5730\u5c06\u88d5\u5ea6\u4e0e `logp_diff` \u76f8\u51cf\u3002\u800c\u662f\u5c06\u4e24\u8005\u7ed3\u5408\uff1a\u635f\u5931\u7684\u6838\u5fc3\u662f `logsigmoid` \u7684\u8f93\u5165\uff0c\u6211\u4eec\u5c06\u5176\u8bbe\u8ba1\u4e3a `logp_diff - margin`\u3002\u8fd9\u79cd `logsigmoid(logp_diff - margin)` \u7684\u5f62\u5f0f\u53ef\u4ee5\u88ab\u770b\u4f5c\u662f\u7ecf\u5178\u7684 Bradley-Terry \u6a21\u578b\u7684\u4e00\u4e2a\u6269\u5c55\uff0c\u5176\u4e2d\u504f\u597d\u4e0d\u4ec5\u4ec5\u53d6\u51b3\u4e8e `logp_diff`\uff0c\u8fd8\u5fc5\u987b\u201c\u6218\u80dc\u201d\u4e00\u4e2a\u7531\u6210\u672c\u5dee\u5f02\u51b3\u5b9a\u7684\u52a8\u6001\u9608\u503c\uff08\u88d5\u5ea6\uff09\u3002\u5f53 `logp_diff` \u663e\u8457\u5927\u4e8e `margin` \u65f6\uff0c\u635f\u5931\u624d\u8d8b\u8fd1\u4e8e\u96f6\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u88d5\u5ea6\u5f52\u4e00\u5316\u4e0e\u7f29\u653e)**\uff1a\u4e3a\u4e86\u63d0\u9ad8\u5bf9\u6210\u672c\u5206\u5e03\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u9996\u5148\u5bf9\u6279\u6b21\u5185\u7684\u6240\u6709\u6210\u672c\u8fdb\u884c `zscore` \u5f52\u4e00\u5316\u3002\u7136\u540e\uff0c\u4f7f\u7528 `rank_gap` \u8ba1\u7b97\u5f52\u4e00\u5316\u540e\u6210\u672c\u7684\u79e9\u5dee\uff0c\u8fd9\u7ee7\u627f\u4e86\u4e24\u4e2a\u7236\u4ee3\u90fd\u4f7f\u7528\u7684\u9c81\u68d2\u79e9\u5dee\u601d\u60f3\u3002\u6700\u540e\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a\u79e9\u5dee\u901a\u8fc7 `softplus` \u51fd\u6570\u4f20\u9012\uff0c\u5e76\u7528 `beta` \u8fdb\u884c\u7f29\u653e\uff0c\u4ee5\u786e\u4fdd\u88d5\u5ea6\u59cb\u7ec8\u4e3a\u6b63\u4e14\u5e73\u6ed1\u3002`margin = beta * softplus(rank_gap(zscore(cost_w), zscore(cost_l)))`\u3002\u8fd9\u79cd\u591a\u91cd\u5904\u7406\uff08zscore -> rank_gap -> softplus\uff09\u786e\u4fdd\u4e86\u88d5\u5ea6\u4fe1\u53f7\u65e2\u7a33\u5b9a\u53c8\u5177\u6709\u533a\u5206\u5ea6\uff0c\u907f\u514d\u4e86\u539f\u59cb\u6210\u672c\u5c3a\u5ea6\u548c\u5f02\u5e38\u503c\u5e26\u6765\u7684\u95ee\u9898\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`HybridMarginLogSigmoidLoss` \u901a\u8fc7\u5c06\u52a8\u6001\u88d5\u5ea6\u7684\u6982\u5ff5\u65e0\u7f1d\u5730\u5d4c\u5165\u5230 `logsigmoid` \u6846\u67b6\u4e2d\uff0c\u5e76\u5f15\u5165\u4e00\u79cd\u9c81\u68d2\u7684\u88d5\u5ea6\u8ba1\u7b97\u6d41\u7a0b\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u65b0\u9896\u3001\u7a33\u5b9a\u4e14\u89e3\u91ca\u6027\u5f3a\u7684\u504f\u597d\u635f\u5931\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8e\u6210\u672c\u79e9\u5dee\u8ba1\u7b97\u51fa\u7684\u52a8\u6001\u88d5\u5ea6\u7684\u5927\u5c0f\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u6a21\u578b\u9700\u8981\u4ea7\u751f\u66f4\u5927\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u6765\u6ee1\u8db3\u5177\u6709\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\uff0c\u4ece\u800c\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002"}}, "operators_used": ["zscore", "rank_gap", "softplus", "logsigmoid"]}}}
{"generation": 4, "index": 1, "ir": {"name": "ZScoreClippedLogSigmoidLoss", "intuition": "\u8be5\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u540c\u65f6\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u673a\u5236\uff0c\u521b\u9020\u4e00\u4e2a\u5bf9\u6210\u672c\u548c\u6982\u7387\u5206\u5e03\u53d8\u5316\u90fd\u975e\u5e38\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u91c7\u7528\u4e86 `-logsigmoid(scaled_logp_diff)` \u7684\u5f62\u5f0f\u3002\u8fd9\u662f\u4e00\u79cd\u88ab\u5e7f\u6cdb\u9a8c\u8bc1\u7684\u6210\u5bf9\u6bd4\u8f83\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u5929\u7136\u5730\u5c06 `logp_w > logp_l` \u7684\u60c5\u51b5\u63a8\u5411\u4f4e\u635f\u5931\u533a\u57df\uff0c\u4e14\u51fd\u6570\u672c\u8eab\u5e73\u6ed1\u3001\u6709\u754c\uff0c\u6570\u503c\u7a33\u5b9a\u6027\u597d\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30) \u548c `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u5b50\u4ee3\u7ee7\u627f\u4e86\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u6216\u201c\u52a8\u6001\u88d5\u5ea6\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u6a21\u578b\u53d7\u5230\u7684\u60e9\u7f5a\u5f3a\u5ea6\u5e94\u8be5\u4e0e\u6210\u672c\u5dee\u5f02\u7684\u5927\u5c0f\u76f8\u5173\u3002\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u4ea7\u751f\u66f4\u5f3a\u7684\u504f\u597d\u4fe1\u53f7\u3002\u540c\u65f6\uff0c\u4e3a\u4e86\u9632\u6b62\u6781\u7aef\u6982\u7387\u503c\u5bf9\u635f\u5931\u4ea7\u751f\u8fc7\u5927\u5f71\u54cd\uff0c\u6211\u4eec\u7ee7\u627f\u4e86\u4f7f\u7528 `tanh` \u6765\u538b\u7f29\u548c\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u7684\u6280\u5de7\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u653e\u5f03\u4e86\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\uff0c\u8f6c\u800c\u91c7\u7528 `zscore` \u5bf9\u6210\u672c\u8fdb\u884c\u6279\u6b21\u5185\u7684\u6807\u51c6\u5316\u5904\u7406 (`z_cost_w`, `z_cost_l`)\u3002`zscore` \u5c06\u6279\u6b21\u5185\u6240\u6709\u6210\u672c\u8f6c\u6362\u4e3a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u6210\u672c\u5dee\u5f02\u7684\u5ea6\u91cf `delta_cost` (`z_cost_l - z_cost_w`) \u4e0d\u518d\u662f\u57fa\u4e8e\u6392\u5e8f\u7684\u79bb\u6563\u503c\uff0c\u800c\u662f\u53cd\u6620\u4e86\u5728\u4e00\u4e2a\u6279\u6b21\u5185\uff0c\u4e24\u4e2a\u89e3\u7684\u76f8\u5bf9\u4f18\u8d8a\u7a0b\u5ea6\uff08\u76f8\u5dee\u591a\u5c11\u4e2a\u6807\u51c6\u5dee\uff09\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6574\u4e2a\u6279\u6b21\u7684\u6570\u636e\u5206\u5e03\u66f4\u52a0\u654f\u611f\u548c\u81ea\u9002\u5e94\uff0c\u5c24\u5176\u5728\u5904\u7406\u4e0d\u540c\u5c3a\u5ea6\u6216\u5206\u5e03\u7684\u6210\u672c\u65f6\u8868\u73b0\u66f4\u7a33\u5b9a\u3002\n2.  **\u65b0\u7684\u7a33\u5b9a\u6280\u5de7 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86 `clamp` \u7b97\u5b50\u6765\u7ea6\u675f\u6700\u7ec8\u8f93\u5165\u5230 `logsigmoid` \u7684 `scaled_logp_diff`\u3002\u5c3d\u7ba1\u6211\u4eec\u5df2\u7ecf\u4f7f\u7528\u4e86 `tanh` \u6765\u7a33\u5b9a `logp_diff`\uff0c\u4f46 `delta_cost` \u81ea\u8eab\u53ef\u80fd\u56e0\u4e3a\u6279\u6b21\u5185\u6210\u672c\u65b9\u5dee\u5f88\u5c0f\u800c\u53d8\u5f97\u975e\u5e38\u5927\uff0c\u5bfc\u81f4\u7f29\u653e\u56e0\u5b50\u8fc7\u5927\u3002\u901a\u8fc7 `clamp(x, min=-clip_val, max=clip_val)`\uff0c\u6211\u4eec\u4e3a `logsigmoid` \u7684\u8f93\u5165\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u201c\u5b89\u5168\u533a\u201d\uff0c\u8fd9\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u56e0\u6781\u7aef\u7f29\u653e\u56e0\u5b50\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u6216\u6d88\u5931\u95ee\u9898\uff0c\u8fdb\u4e00\u6b65\u589e\u5f3a\u4e86\u6574\u4e2a\u8bad\u7ec3\u8fc7\u7a0b\u7684\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u4f7f\u5f97\u8d85\u53c2\u6570 `beta` \u7684\u9009\u62e9\u66f4\u52a0\u9c81\u68d2\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7 `zscore` \u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u52a8\u6001\u3001\u4e0a\u4e0b\u6587\u611f\u77e5\u5ea6\u91cf\uff0c\u5229\u7528 `tanh` \u7a33\u5b9a\u4e86\u6982\u7387\u5dee\u5f02\uff0c\u5c06\u4e24\u8005\u76f8\u4e58\u4ee5\u5b9e\u73b0\u81ea\u9002\u5e94\u7f29\u653e\uff0c\u5e76\u6700\u7ec8\u901a\u8fc7 `clamp` \u548c `logsigmoid` \u7ed3\u6784\u4fdd\u8bc1\u4e86\u6574\u4f53\u8ba1\u7b97\u7684\u7a33\u5b9a\u6027\u548c\u6709\u6548\u6027\u3002", "pseudocode": "def ZScoreClippedLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta, clip_val):\n    # \u5047\u8bbe cost_a, cost_b, logp_a, logp_b \u90fd\u662f\u6279\u6b21\u5411\u91cf (batch of values)\n\n    # 1. \u8bc6\u522b\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    is_a_winner = cost_a < cost_b\n    cost_w = where(is_a_winner, cost_a, cost_b)\n    cost_l = where(is_a_winner, cost_b, cost_a)\n    logp_w = where(is_a_winner, logp_a, logp_b)\n    logp_l = where(is_a_winner, logp_b, logp_a)\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u5bf9\u6279\u6b21\u5185\u7684\u6210\u672c\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\n    #    \u8fd9\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u7684\u5ea6\u91cf\u76f8\u5bf9\u4e8e\u6279\u6b21\u5185\u7684\u6570\u636e\u5206\u5e03\u662f\u81ea\u9002\u5e94\u7684\u3002\n    z_cost_w = zscore(cost_w) \n    z_cost_l = zscore(cost_l)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee3] \u8ba1\u7b97\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\n    #    \u4f7f\u7528\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u4f5c\u4e3a\u7f29\u653e\u4fe1\u53f7\uff0c\u5e76\u901a\u8fc7 softplus \u4fdd\u8bc1\u5176\u5e73\u6ed1\u975e\u8d1f\u3002\n    #    beta \u63a7\u5236\u4e86\u6210\u672c\u5dee\u5f02\u5bf9\u6700\u7ec8\u635f\u5931\u7684\u8d21\u732e\u5ea6\u3002\n    delta_cost = z_cost_l - z_cost_w\n    scaling_factor = beta * softplus(delta_cost)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee3] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u5dee\n    #    \u4f7f\u7528 tanh \u5c06 logp \u5dee\u5f02\u538b\u7f29\u5230 [-1, 1] \u533a\u95f4\uff0c\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. \u8ba1\u7b97\u52a0\u6743\u7684\u5bf9\u6570\u6982\u7387\u5dee\n    #    \u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u5bf9\u6a21\u578b\u504f\u597d\u7684\u8981\u6c42\u8d8a\u9ad8\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 6. [\u65b0\u8026\u5408\u70b92] \u5bf9\u8f93\u5165logsigmoid\u7684\u503c\u8fdb\u884c\u88c1\u526a\n    #    \u9632\u6b62\u56e0\u6781\u7aef\u7684 scaling_factor \u5bfc\u81f4\u68af\u5ea6\u7206\u70b8\u6216\u6d88\u5931\uff0c\u589e\u5f3a\u8bad\u7ec3\u7a33\u5b9a\u6027\u3002\n    clipped_scaled_logp_diff = clamp(scaled_logp_diff, min=-clip_val, max=clip_val)\n\n    # 7. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u4f7f\u7528logsigmoid\u8ba1\u7b97\u6700\u7ec8\u635f\u5931\n    #    -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u3001\u975e\u8d1f\u7684\u635f\u5931\u51fd\u6570\u3002\n    #    \u5f53\u6a21\u578b\u7684\u504f\u597d\u4e0e\u6210\u672c\u504f\u597d\u4e00\u81f4\u65f6 (clipped_... > 0)\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e0\u3002\n    loss = -logsigmoid(clipped_scaled_logp_diff)\n\n    # \u8fd4\u56de\u6279\u6b21\u4e2d\u6240\u6709\u6837\u672c\u635f\u5931\u7684\u5e73\u5747\u503c\n    return mean(loss)", "hyperparams": {"beta": {"value": 1.0, "description": "\u6210\u672c\u5dee\u5f02\u7684\u7f29\u653e\u7cfb\u6570\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u5bf9\u6982\u7387\u5dee\u5f02\u52a0\u6743\u7684\u5f71\u54cd\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u4f1a\u653e\u5927\u6210\u672c\u5dee\u5f02\u663e\u8457\u7684\u6837\u672c\u5bf9\u68af\u5ea6\u7684\u8d21\u732e\u3002"}, "clip_val": {"value": 10.0, "description": "\u5728\u5e94\u7528logsigmoid\u4e4b\u524d\u7684\u88c1\u526a\u9608\u503c\u3002\u6b64\u53c2\u6570\u7528\u4e8e\u9650\u5236\u52a0\u6743\u6982\u7387\u5dee\u7684\u7edd\u5bf9\u503c\uff0c\u9632\u6b62\u56e0\u6781\u7aef\u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u6216\u6d88\u5931\uff0c\u63d0\u9ad8\u6570\u503c\u7a33\u5b9a\u6027\u3002"}}, "operators_used": ["zscore", "softplus", "tanh", "clamp", "logsigmoid"], "implementation_hint": {"expects": ["Tensors `cost_a`, `cost_b`, `logp_a`, `logp_b` of shape (B,), where B is the batch size. Floats `beta` and `clip_val`."], "returns": "A single scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.1237876415252686, "validation_objective": 4.1237876415252686, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.095379590988159}, "train_score_mean": 4.291031405329704, "train_loss_mean": 0.6928207315504551, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedLogSigmoidLoss", "intuition": "\u8be5\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u540c\u65f6\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u673a\u5236\uff0c\u521b\u9020\u4e00\u4e2a\u5bf9\u6210\u672c\u548c\u6982\u7387\u5206\u5e03\u53d8\u5316\u90fd\u975e\u5e38\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u91c7\u7528\u4e86 `-logsigmoid(scaled_logp_diff)` \u7684\u5f62\u5f0f\u3002\u8fd9\u662f\u4e00\u79cd\u88ab\u5e7f\u6cdb\u9a8c\u8bc1\u7684\u6210\u5bf9\u6bd4\u8f83\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u5929\u7136\u5730\u5c06 `logp_w > logp_l` \u7684\u60c5\u51b5\u63a8\u5411\u4f4e\u635f\u5931\u533a\u57df\uff0c\u4e14\u51fd\u6570\u672c\u8eab\u5e73\u6ed1\u3001\u6709\u754c\uff0c\u6570\u503c\u7a33\u5b9a\u6027\u597d\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30) \u548c `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u5b50\u4ee3\u7ee7\u627f\u4e86\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u6216\u201c\u52a8\u6001\u88d5\u5ea6\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u6a21\u578b\u53d7\u5230\u7684\u60e9\u7f5a\u5f3a\u5ea6\u5e94\u8be5\u4e0e\u6210\u672c\u5dee\u5f02\u7684\u5927\u5c0f\u76f8\u5173\u3002\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u4ea7\u751f\u66f4\u5f3a\u7684\u504f\u597d\u4fe1\u53f7\u3002\u540c\u65f6\uff0c\u4e3a\u4e86\u9632\u6b62\u6781\u7aef\u6982\u7387\u503c\u5bf9\u635f\u5931\u4ea7\u751f\u8fc7\u5927\u5f71\u54cd\uff0c\u6211\u4eec\u7ee7\u627f\u4e86\u4f7f\u7528 `tanh` \u6765\u538b\u7f29\u548c\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u7684\u6280\u5de7\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u653e\u5f03\u4e86\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\uff0c\u8f6c\u800c\u91c7\u7528 `zscore` \u5bf9\u6210\u672c\u8fdb\u884c\u6279\u6b21\u5185\u7684\u6807\u51c6\u5316\u5904\u7406 (`z_cost_w`, `z_cost_l`)\u3002`zscore` \u5c06\u6279\u6b21\u5185\u6240\u6709\u6210\u672c\u8f6c\u6362\u4e3a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u6210\u672c\u5dee\u5f02\u7684\u5ea6\u91cf `delta_cost` (`z_cost_l - z_cost_w`) \u4e0d\u518d\u662f\u57fa\u4e8e\u6392\u5e8f\u7684\u79bb\u6563\u503c\uff0c\u800c\u662f\u53cd\u6620\u4e86\u5728\u4e00\u4e2a\u6279\u6b21\u5185\uff0c\u4e24\u4e2a\u89e3\u7684\u76f8\u5bf9\u4f18\u8d8a\u7a0b\u5ea6\uff08\u76f8\u5dee\u591a\u5c11\u4e2a\u6807\u51c6\u5dee\uff09\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6574\u4e2a\u6279\u6b21\u7684\u6570\u636e\u5206\u5e03\u66f4\u52a0\u654f\u611f\u548c\u81ea\u9002\u5e94\uff0c\u5c24\u5176\u5728\u5904\u7406\u4e0d\u540c\u5c3a\u5ea6\u6216\u5206\u5e03\u7684\u6210\u672c\u65f6\u8868\u73b0\u66f4\u7a33\u5b9a\u3002\n2.  **\u65b0\u7684\u7a33\u5b9a\u6280\u5de7 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86 `clamp` \u7b97\u5b50\u6765\u7ea6\u675f\u6700\u7ec8\u8f93\u5165\u5230 `logsigmoid` \u7684 `scaled_logp_diff`\u3002\u5c3d\u7ba1\u6211\u4eec\u5df2\u7ecf\u4f7f\u7528\u4e86 `tanh` \u6765\u7a33\u5b9a `logp_diff`\uff0c\u4f46 `delta_cost` \u81ea\u8eab\u53ef\u80fd\u56e0\u4e3a\u6279\u6b21\u5185\u6210\u672c\u65b9\u5dee\u5f88\u5c0f\u800c\u53d8\u5f97\u975e\u5e38\u5927\uff0c\u5bfc\u81f4\u7f29\u653e\u56e0\u5b50\u8fc7\u5927\u3002\u901a\u8fc7 `clamp(x, min=-clip_val, max=clip_val)`\uff0c\u6211\u4eec\u4e3a `logsigmoid` \u7684\u8f93\u5165\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u201c\u5b89\u5168\u533a\u201d\uff0c\u8fd9\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u56e0\u6781\u7aef\u7f29\u653e\u56e0\u5b50\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u6216\u6d88\u5931\u95ee\u9898\uff0c\u8fdb\u4e00\u6b65\u589e\u5f3a\u4e86\u6574\u4e2a\u8bad\u7ec3\u8fc7\u7a0b\u7684\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u4f7f\u5f97\u8d85\u53c2\u6570 `beta` \u7684\u9009\u62e9\u66f4\u52a0\u9c81\u68d2\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7 `zscore` \u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u52a8\u6001\u3001\u4e0a\u4e0b\u6587\u611f\u77e5\u5ea6\u91cf\uff0c\u5229\u7528 `tanh` \u7a33\u5b9a\u4e86\u6982\u7387\u5dee\u5f02\uff0c\u5c06\u4e24\u8005\u76f8\u4e58\u4ee5\u5b9e\u73b0\u81ea\u9002\u5e94\u7f29\u653e\uff0c\u5e76\u6700\u7ec8\u901a\u8fc7 `clamp` \u548c `logsigmoid` \u7ed3\u6784\u4fdd\u8bc1\u4e86\u6574\u4f53\u8ba1\u7b97\u7684\u7a33\u5b9a\u6027\u548c\u6709\u6548\u6027\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u6210\u672c\u5dee\u5f02\u7684\u7f29\u653e\u7cfb\u6570\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u5bf9\u6982\u7387\u5dee\u5f02\u52a0\u6743\u7684\u5f71\u54cd\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u4f1a\u653e\u5927\u6210\u672c\u5dee\u5f02\u663e\u8457\u7684\u6837\u672c\u5bf9\u68af\u5ea6\u7684\u8d21\u732e\u3002"}, "clip_val": {"value": 10.0, "description": "\u5728\u5e94\u7528logsigmoid\u4e4b\u524d\u7684\u88c1\u526a\u9608\u503c\u3002\u6b64\u53c2\u6570\u7528\u4e8e\u9650\u5236\u52a0\u6743\u6982\u7387\u5dee\u7684\u7edd\u5bf9\u503c\uff0c\u9632\u6b62\u56e0\u6781\u7aef\u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u6216\u6d88\u5931\uff0c\u63d0\u9ad8\u6570\u503c\u7a33\u5b9a\u6027\u3002"}}, "operators_used": ["zscore", "softplus", "tanh", "clamp", "logsigmoid"]}}}
{"generation": 4, "index": 2, "ir": {"name": "ZScoreClippedLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u4e14\u5bf9\u504f\u597d\u4fe1\u53f7\u654f\u611f\u7684\u5b50\u4ee3\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u7ed3\u6784\u3002\u635f\u5931\u51fd\u6570\u5b9a\u4e49\u4e3a `-logsigmoid(argument)`\uff0c\u8fd9\u662f\u4e00\u79cd\u7ecf\u8fc7\u5145\u5206\u9a8c\u8bc1\u7684\u6210\u5bf9\u6bd4\u8f83\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u5929\u7136\u5e73\u6ed1\u3001\u6709\u754c\uff0c\u4e14\u6570\u503c\u7a33\u5b9a\u3002\u5f53 `argument` \u4e3a\u6b63\uff08\u8868\u793a\u6a21\u578b\u504f\u597d\u6b63\u786e\uff09\u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e0\uff1b\u5f53 `argument` \u4e3a\u8d1f\uff08\u8868\u793a\u6a21\u578b\u504f\u597d\u9519\u8bef\uff09\u65f6\uff0c\u635f\u5931\u663e\u8457\u589e\u52a0\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u5176\u4f7f\u7528 `tanh` \u7b97\u5b50\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u7684\u601d\u60f3\u3002\u901a\u8fc7\u5c06 `logp_w - logp_l` \u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u56e0\u6781\u7aef\u6982\u7387\u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u6216\u6d88\u5931\u95ee\u9898\uff0c\u786e\u4fdd\u4e86\u635f\u5931\u8ba1\u7b97\u7684\u9c81\u68d2\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (`zscore`) (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u5168\u65b0\u7684\u6210\u672c\u5dee\u5f02\u5f52\u4e00\u5316\u65b9\u6cd5\u3002\u4e0d\u540c\u4e8e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\uff0c\u6211\u4eec\u4f7f\u7528 `zscore(cost_w, cost_l)`\u3002`zscore` \u8ba1\u7b97\u7684\u662f\u6210\u672c\u5dee\u5f02 `cost_l - cost_w` \u5728\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u7684\u6807\u51c6\u5316\u5206\u6570\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u8003\u8651\u4e86\u5f53\u524d\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02\u7edd\u5bf9\u503c\uff0c\u8fd8\u5c06\u5176\u7f6e\u4e8e\u6574\u4e2a\u6279\u6b21\u7684\u6210\u672c\u5dee\u5f02\u5206\u5e03\u4e2d\u8fdb\u884c\u8003\u91cf\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u201c\u5f02\u5e38\u201d\u7684\u6210\u672c\u5dee\u5f02\uff08\u8fdc\u9ad8\u4e8e\u6216\u4f4e\u4e8e\u6279\u6b21\u5e73\u5747\u6c34\u5e73\uff09\u66f4\u52a0\u654f\u611f\uff0c\u540c\u65f6\u5bf9\u6279\u6b21\u5185\u666e\u904d\u7684\u3001\u8f83\u5c0f\u7684\u6210\u672c\u5dee\u5f02\u4e0d\u90a3\u4e48\u654f\u611f\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u4e00\u79cd\u52a8\u6001\u7684\u3001\u4e0a\u4e0b\u6587\u611f\u77e5\u7684\u6210\u672c\u4fe1\u53f7\u3002\n2.  **\u65b0\u7684\u8026\u5408\u8bbe\u8ba1 (`clamp`) (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5c06 `zscore` \u8ba1\u7b97\u51fa\u7684\u6210\u672c\u4fe1\u53f7 `cost_signal` \u4e0e `tanh` \u7a33\u5b9a\u540e\u7684\u6982\u7387\u5dee `stable_logp_diff` \u76f8\u52a0\uff0c\u800c\u4e0d\u662f\u76f8\u4e58\u3002\u8fd9\u79cd\u52a0\u6cd5\u8026\u5408 `cost_signal + stable_logp_diff` \u610f\u5473\u7740\u6210\u672c\u4fe1\u53f7\u76f4\u63a5\u626e\u6f14\u4e86\u4e00\u4e2a\u201c\u52a8\u6001\u504f\u79fb\uff08dynamic offset\uff09\u201d\u6216\u201c\u8f6f\u8fb9\u754c\uff08soft margin\uff09\u201d\u7684\u89d2\u8272\u3002\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u7a33\u5b9a\u6027\u5e76\u63a7\u5236\u6210\u672c\u4fe1\u53f7\u7684\u6781\u7aef\u5f71\u54cd\uff0c\u6211\u4eec\u4f7f\u7528 `clamp(cost_signal, min=-gamma, max=gamma)` \u5bf9\u5176\u8fdb\u884c\u88c1\u526a\u3002\u8d85\u53c2\u6570 `gamma` \u5b9a\u4e49\u4e86\u6210\u672c\u4fe1\u53f7\u80fd\u5bf9\u6700\u7ec8 `logsigmoid` \u7684\u8f93\u5165\u4ea7\u751f\u7684\u6700\u5927\u8d21\u732e\u3002\u8fd9\u79cd\u88c1\u526a\u786e\u4fdd\u4e86\u5373\u4f7f\u5728\u6279\u6b21\u4e2d\u51fa\u73b0\u6781\u7aef\u6210\u672c\u5dee\u5f02\uff0c\u5176\u5bf9\u603b\u635f\u5931\u7684\u8d21\u732e\u4e5f\u662f\u6709\u754c\u7684\uff0c\u4ece\u800c\u9632\u6b62\u4e86\u5355\u4e2a\u6837\u672c\u5bf9\u4e3b\u5bfc\u6574\u4e2a\u6279\u6b21\u7684\u68af\u5ea6\u66f4\u65b0\u3002", "pseudocode": "def ZScoreClippedLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, gamma):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u4f7f\u7528 zscore \u8ba1\u7b97\u4e0a\u4e0b\u6587\u611f\u77e5\u7684\u6210\u672c\u4fe1\u53f7\n    #    zscore(cost_w, cost_l) \u4f1a\u8fd4\u56de cost_l - cost_w \u5728\u5f53\u524d\u6279\u6b21\u4e2d\u7684\u6807\u51c6\u5316\u5206\u6570\u3002\n    #    \u8fd9\u4f7f\u5f97\u6210\u672c\u4fe1\u53f7\u5bf9\u6279\u6b21\u5185\u7684\u5206\u5e03\u654f\u611f\u3002\n    cost_signal_raw = zscore(cost_w, cost_l)\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u88c1\u526a\u6210\u672c\u4fe1\u53f7\u4ee5\u589e\u5f3a\u7a33\u5b9a\u6027\n    #    \u4f7f\u7528 clamp \u9650\u5236 zscore \u7684\u8f93\u51fa\uff0c\u9632\u6b62\u6781\u7aef\u503c\u4e3b\u5bfc\u635f\u5931\u3002\n    #    gamma \u63a7\u5236\u4e86\u6210\u672c\u4fe1\u53f7\u7684\u6700\u5927\u5f71\u54cd\u8303\u56f4\u3002\n    clipped_cost_signal = clamp(cost_signal_raw, min=-gamma, max=gamma)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u5dee\n    #    \u4f7f\u7528 tanh \u5c06 logp_w - logp_l \u538b\u7f29\u5230 [-1, 1] \u533a\u95f4\uff0c\u9632\u6b62\u6570\u503c\u95ee\u9898\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. \u7ec4\u5408\u4fe1\u53f7\uff1a\u5c06\u6210\u672c\u4fe1\u53f7\u4f5c\u4e3a\u6982\u7387\u5dee\u7684\u52a8\u6001\u504f\u79fb\n    #    \u6211\u4eec\u91c7\u7528\u52a0\u6cd5\u8026\u5408\uff0c\u5c06\u6210\u672c\u4fe1\u53f7\u89c6\u4e3a\u4e00\u4e2a\u8f6f\u8fb9\u754c\u3002\n    #    \u6a21\u578b\u9700\u8981\u4ea7\u751f\u7684\u6982\u7387\u5dee stable_logp_diff \u4e0d\u4ec5\u8981\u4e3a\u6b63\uff0c\u8fd8\u8981\u80fd\u514b\u670d\u8d1f\u7684\u6210\u672c\u4fe1\u53f7\u3002\n    argument = stable_logp_diff + clipped_cost_signal\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u4f7f\u7528 logsigmoid \u8ba1\u7b97\u6700\u7ec8\u635f\u5931\n    #    -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u4e14\u975e\u8d1f\u7684\u635f\u5931\u51fd\u6570\u3002\n    #    \u5f53 argument > 0 (\u504f\u597d\u6b63\u786e\u4e14\u6ee1\u8db3\u6210\u672c\u8981\u6c42) \u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e0\u3002\n    #    \u5f53 argument < 0 (\u504f\u597d\u9519\u8bef\u6216\u4e0d\u6ee1\u8db3\u6210\u672c\u8981\u6c42) \u65f6\uff0c\u635f\u5931\u4f1a\u663e\u8457\u589e\u52a0\u3002\n    loss = -logsigmoid(argument)\n\n    return loss", "hyperparams": {"gamma": {"value": 2.0, "description": "\u6210\u672c\u4fe1\u53f7\u88c1\u526a\u8fb9\u754c\u3002\u5b83\u9650\u5236\u4e86\u7531 z-score \u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u5bf9\u6700\u7ec8\u635f\u5931\u53c2\u6570\u7684\u6700\u5927\u8d21\u732e\u503c\u3002\u8f83\u5927\u7684 gamma \u503c\u5141\u8bb8\u6210\u672c\u5dee\u5f02\u5bf9\u635f\u5931\u4ea7\u751f\u66f4\u5927\u7684\u5f71\u54cd\uff0c\u8f83\u5c0f\u7684\u503c\u5219\u589e\u5f3a\u4e86\u5bf9\u6781\u7aef\u6210\u672c\u5dee\u5f02\u7684\u9c81\u68d2\u6027\u3002"}}, "operators_used": ["zscore", "clamp", "tanh", "logsigmoid"], "implementation_hint": {"expects": ["cost_a, cost_b, logp_a, logp_b: Tensors of shape [batch_size]. The `zscore` operator is expected to compute statistics over the batch dimension."], "returns": "loss: A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.025738716125488, "validation_objective": 4.025738716125488, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.984306812286377}, "train_score_mean": 4.228675000369549, "train_loss_mean": 0.6928598992526531, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u4e14\u5bf9\u504f\u597d\u4fe1\u53f7\u654f\u611f\u7684\u5b50\u4ee3\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7528\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u7ed3\u6784\u3002\u635f\u5931\u51fd\u6570\u5b9a\u4e49\u4e3a `-logsigmoid(argument)`\uff0c\u8fd9\u662f\u4e00\u79cd\u7ecf\u8fc7\u5145\u5206\u9a8c\u8bc1\u7684\u6210\u5bf9\u6bd4\u8f83\u635f\u5931\u5f62\u5f0f\uff0c\u5b83\u5929\u7136\u5e73\u6ed1\u3001\u6709\u754c\uff0c\u4e14\u6570\u503c\u7a33\u5b9a\u3002\u5f53 `argument` \u4e3a\u6b63\uff08\u8868\u793a\u6a21\u578b\u504f\u597d\u6b63\u786e\uff09\u65f6\uff0c\u635f\u5931\u8d8b\u8fd1\u4e8e0\uff1b\u5f53 `argument` \u4e3a\u8d1f\uff08\u8868\u793a\u6a21\u578b\u504f\u597d\u9519\u8bef\uff09\u65f6\uff0c\u635f\u5931\u663e\u8457\u589e\u52a0\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u5176\u4f7f\u7528 `tanh` \u7b97\u5b50\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u7684\u601d\u60f3\u3002\u901a\u8fc7\u5c06 `logp_w - logp_l` \u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u56e0\u6781\u7aef\u6982\u7387\u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u6216\u6d88\u5931\u95ee\u9898\uff0c\u786e\u4fdd\u4e86\u635f\u5931\u8ba1\u7b97\u7684\u9c81\u68d2\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (`zscore`) (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u5168\u65b0\u7684\u6210\u672c\u5dee\u5f02\u5f52\u4e00\u5316\u65b9\u6cd5\u3002\u4e0d\u540c\u4e8e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\uff0c\u6211\u4eec\u4f7f\u7528 `zscore(cost_w, cost_l)`\u3002`zscore` \u8ba1\u7b97\u7684\u662f\u6210\u672c\u5dee\u5f02 `cost_l - cost_w` \u5728\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u7684\u6807\u51c6\u5316\u5206\u6570\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u8003\u8651\u4e86\u5f53\u524d\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02\u7edd\u5bf9\u503c\uff0c\u8fd8\u5c06\u5176\u7f6e\u4e8e\u6574\u4e2a\u6279\u6b21\u7684\u6210\u672c\u5dee\u5f02\u5206\u5e03\u4e2d\u8fdb\u884c\u8003\u91cf\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u201c\u5f02\u5e38\u201d\u7684\u6210\u672c\u5dee\u5f02\uff08\u8fdc\u9ad8\u4e8e\u6216\u4f4e\u4e8e\u6279\u6b21\u5e73\u5747\u6c34\u5e73\uff09\u66f4\u52a0\u654f\u611f\uff0c\u540c\u65f6\u5bf9\u6279\u6b21\u5185\u666e\u904d\u7684\u3001\u8f83\u5c0f\u7684\u6210\u672c\u5dee\u5f02\u4e0d\u90a3\u4e48\u654f\u611f\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u4e00\u79cd\u52a8\u6001\u7684\u3001\u4e0a\u4e0b\u6587\u611f\u77e5\u7684\u6210\u672c\u4fe1\u53f7\u3002\n2.  **\u65b0\u7684\u8026\u5408\u8bbe\u8ba1 (`clamp`) (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5c06 `zscore` \u8ba1\u7b97\u51fa\u7684\u6210\u672c\u4fe1\u53f7 `cost_signal` \u4e0e `tanh` \u7a33\u5b9a\u540e\u7684\u6982\u7387\u5dee `stable_logp_diff` \u76f8\u52a0\uff0c\u800c\u4e0d\u662f\u76f8\u4e58\u3002\u8fd9\u79cd\u52a0\u6cd5\u8026\u5408 `cost_signal + stable_logp_diff` \u610f\u5473\u7740\u6210\u672c\u4fe1\u53f7\u76f4\u63a5\u626e\u6f14\u4e86\u4e00\u4e2a\u201c\u52a8\u6001\u504f\u79fb\uff08dynamic offset\uff09\u201d\u6216\u201c\u8f6f\u8fb9\u754c\uff08soft margin\uff09\u201d\u7684\u89d2\u8272\u3002\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u7a33\u5b9a\u6027\u5e76\u63a7\u5236\u6210\u672c\u4fe1\u53f7\u7684\u6781\u7aef\u5f71\u54cd\uff0c\u6211\u4eec\u4f7f\u7528 `clamp(cost_signal, min=-gamma, max=gamma)` \u5bf9\u5176\u8fdb\u884c\u88c1\u526a\u3002\u8d85\u53c2\u6570 `gamma` \u5b9a\u4e49\u4e86\u6210\u672c\u4fe1\u53f7\u80fd\u5bf9\u6700\u7ec8 `logsigmoid` \u7684\u8f93\u5165\u4ea7\u751f\u7684\u6700\u5927\u8d21\u732e\u3002\u8fd9\u79cd\u88c1\u526a\u786e\u4fdd\u4e86\u5373\u4f7f\u5728\u6279\u6b21\u4e2d\u51fa\u73b0\u6781\u7aef\u6210\u672c\u5dee\u5f02\uff0c\u5176\u5bf9\u603b\u635f\u5931\u7684\u8d21\u732e\u4e5f\u662f\u6709\u754c\u7684\uff0c\u4ece\u800c\u9632\u6b62\u4e86\u5355\u4e2a\u6837\u672c\u5bf9\u4e3b\u5bfc\u6574\u4e2a\u6279\u6b21\u7684\u68af\u5ea6\u66f4\u65b0\u3002", "hyperparams": {"gamma": {"value": 2.0, "description": "\u6210\u672c\u4fe1\u53f7\u88c1\u526a\u8fb9\u754c\u3002\u5b83\u9650\u5236\u4e86\u7531 z-score \u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u5bf9\u6700\u7ec8\u635f\u5931\u53c2\u6570\u7684\u6700\u5927\u8d21\u732e\u503c\u3002\u8f83\u5927\u7684 gamma \u503c\u5141\u8bb8\u6210\u672c\u5dee\u5f02\u5bf9\u635f\u5931\u4ea7\u751f\u66f4\u5927\u7684\u5f71\u54cd\uff0c\u8f83\u5c0f\u7684\u503c\u5219\u589e\u5f3a\u4e86\u5bf9\u6781\u7aef\u6210\u672c\u5dee\u5f02\u7684\u9c81\u68d2\u6027\u3002"}}, "operators_used": ["zscore", "clamp", "tanh", "logsigmoid"]}}}
{"generation": 4, "index": 3, "ir": {"name": "ZScoreClippedAdaptiveLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u4e2a\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u4e14\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u5b66\u4e60\u5f3a\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\n    - **\u6838\u5fc3\u7ed3\u6784**\uff1a\u6211\u4eec\u4fdd\u7559\u4e86 `-logsigmoid(scaled_logp_diff)` \u8fd9\u4e00\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u3002\u8fd9\u79cd\u5f62\u5f0f\u5929\u7136\u5730\u5c06\u504f\u597d\u5b66\u4e60\u95ee\u9898\u8f6c\u5316\u4e3a\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u6709\u754c\u7684\u5206\u7c7b\u95ee\u9898\uff0c\u6570\u503c\u7a33\u5b9a\u6027\u597d\uff0c\u4e14\u68af\u5ea6\u7279\u6027\u826f\u597d\u3002\n    - **\u81ea\u9002\u5e94\u7f29\u653e\u601d\u60f3**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u201c\u7528\u6210\u672c\u5dee\u5f02\u6765\u7f29\u653e\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u201d\u8fd9\u4e00\u5173\u952e\u601d\u60f3\uff0c\u5373 `scaled_logp_diff = scaling_factor * logp_diff`\u3002\u8fd9\u4f7f\u5f97\u6a21\u578b\u80fd\u6839\u636e\u504f\u597d\u4fe1\u53f7\u7684\u5f3a\u5f31\uff08\u6210\u672c\u5dee\u5f02\u7684\u5927\u5c0f\uff09\u6765\u52a8\u6001\u8c03\u6574\u5b66\u4e60\u529b\u5ea6\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\n    - **\u6982\u7387\u5dee\u5f02\u7a33\u5b9a\u5316**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u6280\u5de7\u3002\u8fd9\u80fd\u6709\u6548\u9632\u6b62\u56e0\u6a21\u578b\u8f93\u51fa\u6781\u7aef\u6982\u7387\u800c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\uff0c\u5c06\u6982\u7387\u5dee\u5f02\u4fe1\u53f7\u7ea6\u675f\u5728 `[-1, 1]` \u533a\u95f4\u5185\uff0c\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\uff08\u8026\u5408\u70b91\uff09**\uff1a\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u7b97\u5b50\u6765\u5904\u7406\u6279\u6b21\u5185\u7684\u6210\u672c\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u5bf9\u6279\u6b21\u5185\u6240\u6709\u7684 `cost_w` \u548c `cost_l` \u8fdb\u884cZ-score\u5f52\u4e00\u5316\uff0c\u5f97\u5230 `z_cost_w` \u548c `z_cost_l`\u3002\u8fd9\u4e48\u505a\u6709\u4e24\u4e2a\u597d\u5904\uff1a\u9996\u5148\uff0c\u5b83\u6d88\u9664\u4e86\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u504f\u79fb\u91cf\u7684\u5f71\u54cd\uff0c\u4f7f\u5f97\u635f\u5931\u5bf9\u4e0d\u540c\u8303\u56f4\u7684\u6210\u672c\u503c\u90fd\u5177\u6709\u4e00\u81f4\u7684\u884c\u4e3a\uff1b\u5176\u6b21\uff0c`z_cost_l - z_cost_w` \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5728\u6279\u6b21\u7edf\u8ba1\u610f\u4e49\u4e0a\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\uff0c\u76f8\u6bd4 `rank_gap`\uff0c\u5b83\u4fdd\u7559\u4e86\u66f4\u591a\u5173\u4e8e\u5dee\u5f02\u201c\u5e45\u5ea6\u201d\u7684\u4fe1\u606f\uff0c\u4f46\u53c8\u4e0d\u50cf\u539f\u59cb\u5dee\u5f02\u90a3\u6837\u5bb9\u6613\u53d7\u5230\u5f02\u5e38\u503c\u7684\u5f71\u54cd\u3002\n2.  **\u65b0\u7684\u7f29\u653e\u56e0\u5b50\u8bbe\u8ba1\u4e0e\u7a33\u5b9a\u6280\u5de7\uff08\u8026\u5408\u70b92\uff09**\uff1a\u6211\u4eec\u5bf9\u4e0a\u8ff0Z-score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `(z_cost_l - z_cost_w)` \u5e94\u7528\u4e86 `clamp` \u64cd\u4f5c\uff0c\u5c06\u5176\u9650\u5236\u5728\u4e00\u4e2a\u5408\u7406\u7684\u6b63\u533a\u95f4\uff08\u4f8b\u5982 `[0, M]`\uff0cM\u4e3a\u8d85\u53c2\u6570\uff09\u3002\u8fd9\u4e2a `clamped_z_diff` \u76f4\u63a5\u4f5c\u4e3a\u7f29\u653e\u56e0\u5b50 `scaling_factor`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7ed3\u5408\u4e86\u4ee5\u4e0b\u4f18\u70b9\uff1a\n    - **\u76f4\u63a5\u6027**\uff1a\u7f29\u653e\u56e0\u5b50\u4e0e\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u6210\u6b63\u6bd4\uff0c\u5173\u7cfb\u6e05\u6670\u76f4\u89c2\u3002\n    - **\u9c81\u68d2\u6027**\uff1a`clamp` \u64cd\u4f5c\u53ef\u4ee5\u9632\u6b62\u6781\u5927\u7684\u6210\u672c\u5dee\u5f02\uff08\u5373\u4f7f\u662fZ-score\u5f52\u4e00\u5316\u540e\uff09\u4ea7\u751f\u8fc7\u5927\u7684\u7f29\u653e\u56e0\u5b50\uff0c\u4ece\u800c\u907f\u514d\u4e86\u4e0d\u7a33\u5b9a\u7684\u68af\u5ea6\u3002\u8fd9\u662f\u4e00\u79cd\u6bd4 `softplus` \u66f4\u201c\u786c\u201d\u7684\u4e0a\u9650\u7ea6\u675f\uff0c\u63d0\u4f9b\u4e86\u66f4\u5f3a\u7684\u7a33\u5b9a\u6027\u4fdd\u8bc1\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7 `zscore` \u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\u4fe1\u53f7\u7684\u4e0a\u4e0b\u6587\u611f\u77e5\u5f52\u4e00\u5316\uff0c\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u81ea\u9002\u5e94\u7f29\u653e\u548c\u6982\u7387\u7a33\u5b9a\u5316\u601d\u60f3\uff0c\u5e76\u5229\u7528 `clamp` \u6280\u5de7\u521b\u9020\u4e86\u4e00\u4e2a\u9c81\u68d2\u7684\u7f29\u653e\u56e0\u5b50\uff0c\u6700\u7ec8\u5c06\u8fd9\u4e9b\u5143\u7d20\u8026\u5408\u8fdb\u4e00\u4e2a\u7ecf\u8fc7\u9a8c\u8bc1\u7684 `logsigmoid` \u6846\u67b6\u4e2d\uff0c\u4ee5\u5b9e\u73b0\u7a33\u5b9a\u3001\u81ea\u9002\u5e94\u4e14\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u3002", "pseudocode": "def ZScoreClippedAdaptiveLogSigmoidLoss(batch_costs, batch_logps, beta, max_scale):\n    # batch_costs: [cost_a_1, cost_b_1, cost_a_2, cost_b_2, ...]\n    # batch_logps: [logp_a_1, logp_b_1, logp_a_2, logp_b_2, ...]\n\n    # 1. \u8bc6\u522b\u6279\u6b21\u5185\u7684\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\n    costs_w, costs_l = [], []\n    logps_w, logps_l = [], []\n    for i in range(0, len(batch_costs), 2):\n        cost_a, cost_b = batch_costs[i], batch_costs[i+1]\n        logp_a, logp_b = batch_logps[i], batch_logps[i+1]\n        if cost_a < cost_b:\n            costs_w.append(cost_a); costs_l.append(cost_b)\n            logps_w.append(logp_a); logps_l.append(logp_b)\n        else:\n            costs_w.append(cost_b); costs_l.append(cost_a)\n            logps_w.append(logp_b); logps_l.append(logp_a)\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u5bf9\u6279\u6b21\u5185\u6240\u6709\u6210\u672c\u8fdb\u884cZ-score\u5f52\u4e00\u5316\n    # zscore\u9700\u8981\u540c\u65f6\u5904\u7406\u6240\u6709\u6210\u672c\u4ee5\u83b7\u5f97\u51c6\u786e\u7684\u5747\u503c\u548c\u6807\u51c6\u5dee\n    all_costs = costs_w + costs_l\n    z_all_costs = zscore(all_costs)\n    z_costs_w = z_all_costs[:len(costs_w)]\n    z_costs_l = z_all_costs[len(costs_w):]\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u5dee\u5f02\n    # \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\n    logp_diffs = [logp_w - logp_l for logp_w, logp_l in zip(logps_w, logps_l)]\n    stable_logp_diffs = [tanh(d) for d in logp_diffs]\n\n    # 4. \u8ba1\u7b97\u5e76\u5904\u7406\u635f\u5931\n    total_loss = 0\n    for i in range(len(costs_w)):\n        # 4.1. \u8ba1\u7b97\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\n        z_cost_diff = z_costs_l[i] - z_costs_w[i]\n\n        # 4.2. [\u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u4e00\u4e2a\u6709\u754c\u4e14\u9c81\u68d2\u7684\u7f29\u653e\u56e0\u5b50\n        # \u4f7f\u7528 clamp \u9632\u6b62\u7f29\u653e\u56e0\u5b50\u8fc7\u5927\uff0cmax_scale \u662f\u4e00\u4e2a\u8d85\u53c2\u6570\n        # z_cost_diff \u7406\u8bba\u4e0a\u5e94\u4e3a\u6b63\uff0cclamp(x, 0, M) \u786e\u4fdd\u5176\u975e\u8d1f\u4e14\u6709\u4e0a\u9650\n        scaling_factor = beta * clamp(z_cost_diff, 0.0, max_scale)\n\n        # 4.3. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u5e94\u7528\u81ea\u9002\u5e94\u7f29\u653e\n        # \u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u5bf9\u6982\u7387\u5dee\u5f02\u7684\u52a0\u6743\u8d8a\u5f3a\n        scaled_logp_diff = scaling_factor * stable_logp_diffs[i]\n\n        # 4.4. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u6838\u5fc3\u7684logsigmoid\u635f\u5931\n        # -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u975e\u8d1f\u7684\u635f\u5931\u51fd\u6570\n        pair_loss = -logsigmoid(scaled_logp_diff)\n        total_loss += pair_loss\n\n    return total_loss / len(costs_w) # \u8fd4\u56de\u6279\u6b21\u5e73\u5747\u635f\u5931", "hyperparams": {"beta": {"value": 1.0, "description": "\u57fa\u7840\u7f29\u653e\u7cfb\u6570\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u6700\u7ec8\u7f29\u653e\u56e0\u5b50\u7684\u57fa\u672c\u6bd4\u4f8b\u3002\u8f83\u5927\u7684beta\u503c\u4f1a\u653e\u5927\u6210\u672c\u5dee\u5f02\u5bf9\u68af\u5ea6\u7684\u5f71\u54cd\u3002"}, "max_scale": {"value": 5.0, "description": "\u7f29\u653e\u56e0\u5b50\u7684\u6700\u5927\u503c\u4e0a\u754c\u3002\u8fd9\u4e2a\u53c2\u6570\u901a\u8fc7 `clamp` \u64cd\u4f5c\u6765\u9632\u6b62\u6781\u7aef\u7684\u6210\u672c\u5dee\u5f02\u5bfc\u81f4\u4e0d\u7a33\u5b9a\u7684\u68af\u5ea6\uff0c\u662f\u4fdd\u8bc1\u6570\u503c\u7a33\u5b9a\u6027\u7684\u5173\u952e\u6280\u5de7\u3002"}}, "operators_used": ["zscore", "tanh", "clamp", "logsigmoid"], "implementation_hint": {"expects": ["A batch of paired data. For a batch size of N pairs, expects `batch_costs` (a flat tensor of size 2N, e.g., [c_a1, c_b1, c_a2, c_b2, ...]) and `batch_logps` (a flat tensor of size 2N, e.g., [lp_a1, lp_b1, lp_a2, lp_b2, ...]). Also requires hyperparameters `beta` and `max_scale`."], "returns": "A single scalar value representing the mean loss for the batch. The loss is differentiable with respect to `batch_logps`."}}, "fitness": {"hf_like_score": 4.0293474197387695, "validation_objective": 4.0293474197387695, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.9755940437316895}, "train_score_mean": 4.245994687080383, "train_loss_mean": 0.6927947793155909, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedAdaptiveLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u4e2a\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u4e14\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u5b66\u4e60\u5f3a\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\n    - **\u6838\u5fc3\u7ed3\u6784**\uff1a\u6211\u4eec\u4fdd\u7559\u4e86 `-logsigmoid(scaled_logp_diff)` \u8fd9\u4e00\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u3002\u8fd9\u79cd\u5f62\u5f0f\u5929\u7136\u5730\u5c06\u504f\u597d\u5b66\u4e60\u95ee\u9898\u8f6c\u5316\u4e3a\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u6709\u754c\u7684\u5206\u7c7b\u95ee\u9898\uff0c\u6570\u503c\u7a33\u5b9a\u6027\u597d\uff0c\u4e14\u68af\u5ea6\u7279\u6027\u826f\u597d\u3002\n    - **\u81ea\u9002\u5e94\u7f29\u653e\u601d\u60f3**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u201c\u7528\u6210\u672c\u5dee\u5f02\u6765\u7f29\u653e\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u201d\u8fd9\u4e00\u5173\u952e\u601d\u60f3\uff0c\u5373 `scaled_logp_diff = scaling_factor * logp_diff`\u3002\u8fd9\u4f7f\u5f97\u6a21\u578b\u80fd\u6839\u636e\u504f\u597d\u4fe1\u53f7\u7684\u5f3a\u5f31\uff08\u6210\u672c\u5dee\u5f02\u7684\u5927\u5c0f\uff09\u6765\u52a8\u6001\u8c03\u6574\u5b66\u4e60\u529b\u5ea6\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\n    - **\u6982\u7387\u5dee\u5f02\u7a33\u5b9a\u5316**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u6280\u5de7\u3002\u8fd9\u80fd\u6709\u6548\u9632\u6b62\u56e0\u6a21\u578b\u8f93\u51fa\u6781\u7aef\u6982\u7387\u800c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\uff0c\u5c06\u6982\u7387\u5dee\u5f02\u4fe1\u53f7\u7ea6\u675f\u5728 `[-1, 1]` \u533a\u95f4\u5185\uff0c\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\uff08\u8026\u5408\u70b91\uff09**\uff1a\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u7b97\u5b50\u6765\u5904\u7406\u6279\u6b21\u5185\u7684\u6210\u672c\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u5bf9\u6279\u6b21\u5185\u6240\u6709\u7684 `cost_w` \u548c `cost_l` \u8fdb\u884cZ-score\u5f52\u4e00\u5316\uff0c\u5f97\u5230 `z_cost_w` \u548c `z_cost_l`\u3002\u8fd9\u4e48\u505a\u6709\u4e24\u4e2a\u597d\u5904\uff1a\u9996\u5148\uff0c\u5b83\u6d88\u9664\u4e86\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u504f\u79fb\u91cf\u7684\u5f71\u54cd\uff0c\u4f7f\u5f97\u635f\u5931\u5bf9\u4e0d\u540c\u8303\u56f4\u7684\u6210\u672c\u503c\u90fd\u5177\u6709\u4e00\u81f4\u7684\u884c\u4e3a\uff1b\u5176\u6b21\uff0c`z_cost_l - z_cost_w` \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5728\u6279\u6b21\u7edf\u8ba1\u610f\u4e49\u4e0a\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\uff0c\u76f8\u6bd4 `rank_gap`\uff0c\u5b83\u4fdd\u7559\u4e86\u66f4\u591a\u5173\u4e8e\u5dee\u5f02\u201c\u5e45\u5ea6\u201d\u7684\u4fe1\u606f\uff0c\u4f46\u53c8\u4e0d\u50cf\u539f\u59cb\u5dee\u5f02\u90a3\u6837\u5bb9\u6613\u53d7\u5230\u5f02\u5e38\u503c\u7684\u5f71\u54cd\u3002\n2.  **\u65b0\u7684\u7f29\u653e\u56e0\u5b50\u8bbe\u8ba1\u4e0e\u7a33\u5b9a\u6280\u5de7\uff08\u8026\u5408\u70b92\uff09**\uff1a\u6211\u4eec\u5bf9\u4e0a\u8ff0Z-score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `(z_cost_l - z_cost_w)` \u5e94\u7528\u4e86 `clamp` \u64cd\u4f5c\uff0c\u5c06\u5176\u9650\u5236\u5728\u4e00\u4e2a\u5408\u7406\u7684\u6b63\u533a\u95f4\uff08\u4f8b\u5982 `[0, M]`\uff0cM\u4e3a\u8d85\u53c2\u6570\uff09\u3002\u8fd9\u4e2a `clamped_z_diff` \u76f4\u63a5\u4f5c\u4e3a\u7f29\u653e\u56e0\u5b50 `scaling_factor`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7ed3\u5408\u4e86\u4ee5\u4e0b\u4f18\u70b9\uff1a\n    - **\u76f4\u63a5\u6027**\uff1a\u7f29\u653e\u56e0\u5b50\u4e0e\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u6210\u6b63\u6bd4\uff0c\u5173\u7cfb\u6e05\u6670\u76f4\u89c2\u3002\n    - **\u9c81\u68d2\u6027**\uff1a`clamp` \u64cd\u4f5c\u53ef\u4ee5\u9632\u6b62\u6781\u5927\u7684\u6210\u672c\u5dee\u5f02\uff08\u5373\u4f7f\u662fZ-score\u5f52\u4e00\u5316\u540e\uff09\u4ea7\u751f\u8fc7\u5927\u7684\u7f29\u653e\u56e0\u5b50\uff0c\u4ece\u800c\u907f\u514d\u4e86\u4e0d\u7a33\u5b9a\u7684\u68af\u5ea6\u3002\u8fd9\u662f\u4e00\u79cd\u6bd4 `softplus` \u66f4\u201c\u786c\u201d\u7684\u4e0a\u9650\u7ea6\u675f\uff0c\u63d0\u4f9b\u4e86\u66f4\u5f3a\u7684\u7a33\u5b9a\u6027\u4fdd\u8bc1\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7 `zscore` \u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\u4fe1\u53f7\u7684\u4e0a\u4e0b\u6587\u611f\u77e5\u5f52\u4e00\u5316\uff0c\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u81ea\u9002\u5e94\u7f29\u653e\u548c\u6982\u7387\u7a33\u5b9a\u5316\u601d\u60f3\uff0c\u5e76\u5229\u7528 `clamp` \u6280\u5de7\u521b\u9020\u4e86\u4e00\u4e2a\u9c81\u68d2\u7684\u7f29\u653e\u56e0\u5b50\uff0c\u6700\u7ec8\u5c06\u8fd9\u4e9b\u5143\u7d20\u8026\u5408\u8fdb\u4e00\u4e2a\u7ecf\u8fc7\u9a8c\u8bc1\u7684 `logsigmoid` \u6846\u67b6\u4e2d\uff0c\u4ee5\u5b9e\u73b0\u7a33\u5b9a\u3001\u81ea\u9002\u5e94\u4e14\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u57fa\u7840\u7f29\u653e\u7cfb\u6570\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u6700\u7ec8\u7f29\u653e\u56e0\u5b50\u7684\u57fa\u672c\u6bd4\u4f8b\u3002\u8f83\u5927\u7684beta\u503c\u4f1a\u653e\u5927\u6210\u672c\u5dee\u5f02\u5bf9\u68af\u5ea6\u7684\u5f71\u54cd\u3002"}, "max_scale": {"value": 5.0, "description": "\u7f29\u653e\u56e0\u5b50\u7684\u6700\u5927\u503c\u4e0a\u754c\u3002\u8fd9\u4e2a\u53c2\u6570\u901a\u8fc7 `clamp` \u64cd\u4f5c\u6765\u9632\u6b62\u6781\u7aef\u7684\u6210\u672c\u5dee\u5f02\u5bfc\u81f4\u4e0d\u7a33\u5b9a\u7684\u68af\u5ea6\uff0c\u662f\u4fdd\u8bc1\u6570\u503c\u7a33\u5b9a\u6027\u7684\u5173\u952e\u6280\u5de7\u3002"}}, "operators_used": ["zscore", "tanh", "clamp", "logsigmoid"]}}}
{"generation": 4, "index": 4, "ir": {"name": "ZScoreNormalizedDynamicMarginLoss", "intuition": "\u8be5\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u7236\u4ee3\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u673a\u5236\u6765\u5904\u7406\u66f4\u5e7f\u6cdb\u7684\u6570\u636e\u5206\u5e03\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u91c7\u7528\u4e86\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u5f62\u5f0f\uff0c\u5373 `softplus(margin - score_diff)`\u3002\u8fd9\u79cd\u7ed3\u6784\u4e3a\u6a21\u578b\u5b66\u4e60\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\uff1a\u53ea\u8981\u6a21\u578b\u7684\u504f\u597d\u5f97\u5206\u5dee\u5f02\uff08`score_diff`\uff09\u8d85\u8fc7\u4e86\u52a8\u6001\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u635f\u5931\u5c31\u8d8b\u8fd1\u4e8e\u96f6\u3002\u8fd9\u662f\u4e00\u79cd\u7a33\u5b9a\u4e14\u88ab\u5e7f\u6cdb\u9a8c\u8bc1\u6709\u6548\u7684\u504f\u597d\u5b66\u4e60\u8303\u5f0f\u3002\n2.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u4f5c\u4e3a\u6a21\u578b\u504f\u597d\u5f97\u5206\u7684\u57fa\u672c\u5ea6\u91cf\u3002\u6b64\u5916\uff0c\u6211\u4eec\u540c\u6837\u4f7f\u7528\u4e86 `tanh` \u51fd\u6570\u6765\u538b\u7f29\u8fd9\u4e2a\u5f97\u5206\u5dee\uff0c\u5c06\u5176\u7a33\u5b9a\u5728 `[-1, 1]` \u533a\u95f4\u5185\uff0c\u8fd9\u6709\u6548\u9632\u6b62\u4e86\u56e0\u6781\u7aef\u5bf9\u6570\u6982\u7387\u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\uff08\u8026\u5408\u70b91\uff09**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u57fa\u4e8e `rank_gap` \u7684\u6210\u672c\u5dee\u5f02\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u3002\u5728\u8ba1\u7b97\u52a8\u6001\u88d5\u5ea6\u524d\uff0c\u6211\u4eec\u9996\u5148\u5bf9\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u6240\u6709\u7684\u6210\u672c\u5dee\u5f02\uff08`cost_l - cost_w`\uff09\u8fdb\u884c `zscore` \u8ba1\u7b97\u3002`zscore` \u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u88d5\u5ea6\u7684\u8ba1\u7b97\u4e0d\u518d\u4f9d\u8d56\u4e8e\u6210\u672c\u5dee\u5f02\u7684\u7edd\u5bf9\u5927\u5c0f\uff0c\u800c\u662f\u5176\u5728\u4e00\u4e2a\u6279\u6b21\u5185\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u5bf9\u6210\u672c\u7684\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u9c81\u68d2\u6027\u66f4\u5f3a\uff0c\u7279\u522b\u662f\u5728\u4e0d\u540c\u6279\u6b21\u95f4\u6210\u672c\u5206\u5e03\u5dee\u5f02\u5f88\u5927\u65f6\u3002\n2.  **\u65b0\u7684\u88d5\u5ea6\u8bbe\u8ba1\u4e0e\u7a33\u5b9a\u6280\u5de7\uff08\u8026\u5408\u70b92\uff09**\uff1a\u6211\u4eec\u5c06 `zscore` \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_cost_diff` \u901a\u8fc7 `softplus` \u51fd\u6570\u8fdb\u884c\u5904\u7406\uff0c\u786e\u4fdd\u5176\u59cb\u7ec8\u4e3a\u975e\u8d1f\u503c\uff0c\u5e76\u4ee5\u6b64\u4e3a\u57fa\u7840\u6784\u5efa\u52a8\u6001\u88d5\u5ea6 `dynamic_margin = beta * softplus(z_cost_diff)`\u3002`softplus` \u7684\u4f7f\u7528\u76f8\u6bd4\u76f4\u63a5\u7ebf\u6027\u7f29\u653e\uff0c\u4e3a\u88d5\u5ea6\u589e\u52a0\u4e86\u4e00\u4e2a\u5e73\u6ed1\u7684\u975e\u7ebf\u6027\u53d8\u6362\uff0c\u4f7f\u5f97\u88d5\u5ea6\u5728 `z_cost_diff` \u8f83\u5c0f\u65f6\u589e\u957f\u7f13\u6162\uff0c\u5728\u8f83\u5927\u65f6\u8fd1\u4f3c\u7ebf\u6027\u589e\u957f\u3002\u8fd9\u6709\u52a9\u4e8e\u6a21\u578b\u66f4\u6e29\u548c\u5730\u5904\u7406\u6210\u672c\u5dee\u5f02\u4e0d\u663e\u8457\u7684\u6837\u672c\u5bf9\uff0c\u540c\u65f6\u5bf9\u6210\u672c\u5dee\u5f02\u663e\u8457\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u8db3\u591f\u7684\u5b66\u4e60\u538b\u529b\u3002\n\n\u603b\u7ed3\u800c\u8a00\uff0c`ZScoreNormalizedDynamicMarginLoss` \u7ee7\u627f\u4e86\u7236\u4ee3\u7ecf\u5178\u7684 `softplus(margin - score_diff)` \u7ed3\u6784\u548c `tanh` \u7a33\u5b9a\u6280\u5de7\uff0c\u4f46\u521b\u65b0\u6027\u5730\u4f7f\u7528 `zscore` \u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884c\u6279\u5185\u5f52\u4e00\u5316\uff0c\u5e76\u7ed3\u5408 `softplus` \u8bbe\u8ba1\u4e86\u4e00\u4e2a\u5bf9\u6210\u672c\u76f8\u5bf9\u5927\u5c0f\u654f\u611f\u7684\u52a8\u6001\u88d5\u5ea6\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u5728\u4e0d\u540c\u6570\u636e\u5c3a\u5ea6\u4e0b\u7684\u9ad8\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\u3002", "pseudocode": "def ZScoreNormalizedDynamicMarginLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # \u5047\u8bbe cost_a, cost_b, logp_a, logp_b \u90fd\u662f\u6279\u6b21\u6570\u636e (tensors)\n\n    # 1. \u8bc6\u522b\u6279\u6b21\u4e2d\u6bcf\u4e2a\u6837\u672c\u5bf9\u7684\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    is_a_winner = cost_a < cost_b\n    cost_w = where(is_a_winner, cost_a, cost_b)\n    cost_l = where(is_a_winner, cost_b, cost_a)\n    logp_w = where(is_a_winner, logp_a, logp_b)\n    logp_l = where(is_a_winner, logp_b, logp_a)\n\n    # 2. \u8ba1\u7b97\u6210\u672c\u5dee\u5f02\n    cost_diffs = cost_l - cost_w\n\n    # 3. [\u65b0\u8026\u5408\u70b91] \u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\n    #    \u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u8ba1\u7b97\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u5728\u6279\u6b21\u5185\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff0c\u800c\u975e\u7edd\u5bf9\u503c\u3002\n    #    zscore(x) = (x - mean(x)) / std(x)\n    z_cost_diffs = zscore(cost_diffs)\n\n    # 4. [\u65b0\u8026\u5408\u70b92] \u57fa\u4e8e\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\u8bbe\u8ba1\u52a8\u6001\u88d5\u5ea6\n    #    \u7ee7\u627f\u81ea\u7236\u4ee30\u7684\u52a8\u6001\u88d5\u5ea6\u601d\u60f3\uff0c\u4f46\u91c7\u7528\u65b0\u7684\u5f52\u4e00\u5316\u548c\u6fc0\u6d3b\u51fd\u6570\u3002\n    #    softplus\u786e\u4fdd\u88d5\u5ea6\u4e3a\u975e\u8d1f\uff0cbeta\u63a7\u5236\u5176\u7f29\u653e\u3002\n    dynamic_margin = beta * softplus(z_cost_diffs)\n\n    # 5. \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u6a21\u578b\u504f\u597d\u5f97\u5206\n    #    \u7ee7\u627f\u81ea\u7236\u4ee31\u7684tanh\u7a33\u5b9a\u6280\u5de7\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\u3002\n    #    logp_w - logp_l \u671f\u671b\u4e3a\u6b63\u3002\n    stable_score_diff = tanh(logp_w - logp_l)\n\n    # 6. \u8ba1\u7b97\u6700\u7ec8\u7684\u5e73\u6ed1\u94f0\u94fe\u635f\u5931\n    #    \u7ee7\u627f\u81ea\u7236\u4ee30\u7684\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u3002\n    #    \u5f53\u6a21\u578b\u7684\u504f\u597d\u5f97\u5206(stable_score_diff)\u5c0f\u4e8e\u76ee\u6807\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    loss = softplus(dynamic_margin - stable_score_diff)\n\n    # \u8fd4\u56de\u6279\u6b21\u7684\u5e73\u5747\u635f\u5931\n    return mean(loss)", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u5728\u591a\u5927\u7a0b\u5ea6\u4e0a\u8f6c\u5316\u4e3a\u76ee\u6807\u88d5\u5ea6\u3002\u8f83\u9ad8\u7684beta\u503c\u610f\u5473\u7740\u6a21\u578b\u9700\u8981\u4e3a\u5177\u6709\u76f8\u5bf9\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5f97\u5206\u5dee\u8ddd\u3002"}}, "operators_used": ["zscore", "softplus", "tanh"], "implementation_hint": {"expects": ["Tensors `cost_a`, `cost_b`, `logp_a`, `logp_b` of shape [batch_size], and a scalar `beta`."], "returns": "A single scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.069334506988525, "validation_objective": 4.069334506988525, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.008345723152161}, "train_score_mean": 4.2678552120924, "train_loss_mean": 0.6928258575499058, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreNormalizedDynamicMarginLoss", "intuition": "\u8be5\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u7236\u4ee3\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u673a\u5236\u6765\u5904\u7406\u66f4\u5e7f\u6cdb\u7684\u6570\u636e\u5206\u5e03\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u91c7\u7528\u4e86\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u5f62\u5f0f\uff0c\u5373 `softplus(margin - score_diff)`\u3002\u8fd9\u79cd\u7ed3\u6784\u4e3a\u6a21\u578b\u5b66\u4e60\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\uff1a\u53ea\u8981\u6a21\u578b\u7684\u504f\u597d\u5f97\u5206\u5dee\u5f02\uff08`score_diff`\uff09\u8d85\u8fc7\u4e86\u52a8\u6001\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u635f\u5931\u5c31\u8d8b\u8fd1\u4e8e\u96f6\u3002\u8fd9\u662f\u4e00\u79cd\u7a33\u5b9a\u4e14\u88ab\u5e7f\u6cdb\u9a8c\u8bc1\u6709\u6548\u7684\u504f\u597d\u5b66\u4e60\u8303\u5f0f\u3002\n2.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u5bf9\u6570\u6982\u7387\u5dee `logp_w - logp_l` \u4f5c\u4e3a\u6a21\u578b\u504f\u597d\u5f97\u5206\u7684\u57fa\u672c\u5ea6\u91cf\u3002\u6b64\u5916\uff0c\u6211\u4eec\u540c\u6837\u4f7f\u7528\u4e86 `tanh` \u51fd\u6570\u6765\u538b\u7f29\u8fd9\u4e2a\u5f97\u5206\u5dee\uff0c\u5c06\u5176\u7a33\u5b9a\u5728 `[-1, 1]` \u533a\u95f4\u5185\uff0c\u8fd9\u6709\u6548\u9632\u6b62\u4e86\u56e0\u6781\u7aef\u5bf9\u6570\u6982\u7387\u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\uff08\u8026\u5408\u70b91\uff09**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u57fa\u4e8e `rank_gap` \u7684\u6210\u672c\u5dee\u5f02\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u3002\u5728\u8ba1\u7b97\u52a8\u6001\u88d5\u5ea6\u524d\uff0c\u6211\u4eec\u9996\u5148\u5bf9\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u6240\u6709\u7684\u6210\u672c\u5dee\u5f02\uff08`cost_l - cost_w`\uff09\u8fdb\u884c `zscore` \u8ba1\u7b97\u3002`zscore` \u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u88d5\u5ea6\u7684\u8ba1\u7b97\u4e0d\u518d\u4f9d\u8d56\u4e8e\u6210\u672c\u5dee\u5f02\u7684\u7edd\u5bf9\u5927\u5c0f\uff0c\u800c\u662f\u5176\u5728\u4e00\u4e2a\u6279\u6b21\u5185\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u5bf9\u6210\u672c\u7684\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u9c81\u68d2\u6027\u66f4\u5f3a\uff0c\u7279\u522b\u662f\u5728\u4e0d\u540c\u6279\u6b21\u95f4\u6210\u672c\u5206\u5e03\u5dee\u5f02\u5f88\u5927\u65f6\u3002\n2.  **\u65b0\u7684\u88d5\u5ea6\u8bbe\u8ba1\u4e0e\u7a33\u5b9a\u6280\u5de7\uff08\u8026\u5408\u70b92\uff09**\uff1a\u6211\u4eec\u5c06 `zscore` \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_cost_diff` \u901a\u8fc7 `softplus` \u51fd\u6570\u8fdb\u884c\u5904\u7406\uff0c\u786e\u4fdd\u5176\u59cb\u7ec8\u4e3a\u975e\u8d1f\u503c\uff0c\u5e76\u4ee5\u6b64\u4e3a\u57fa\u7840\u6784\u5efa\u52a8\u6001\u88d5\u5ea6 `dynamic_margin = beta * softplus(z_cost_diff)`\u3002`softplus` \u7684\u4f7f\u7528\u76f8\u6bd4\u76f4\u63a5\u7ebf\u6027\u7f29\u653e\uff0c\u4e3a\u88d5\u5ea6\u589e\u52a0\u4e86\u4e00\u4e2a\u5e73\u6ed1\u7684\u975e\u7ebf\u6027\u53d8\u6362\uff0c\u4f7f\u5f97\u88d5\u5ea6\u5728 `z_cost_diff` \u8f83\u5c0f\u65f6\u589e\u957f\u7f13\u6162\uff0c\u5728\u8f83\u5927\u65f6\u8fd1\u4f3c\u7ebf\u6027\u589e\u957f\u3002\u8fd9\u6709\u52a9\u4e8e\u6a21\u578b\u66f4\u6e29\u548c\u5730\u5904\u7406\u6210\u672c\u5dee\u5f02\u4e0d\u663e\u8457\u7684\u6837\u672c\u5bf9\uff0c\u540c\u65f6\u5bf9\u6210\u672c\u5dee\u5f02\u663e\u8457\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u8db3\u591f\u7684\u5b66\u4e60\u538b\u529b\u3002\n\n\u603b\u7ed3\u800c\u8a00\uff0c`ZScoreNormalizedDynamicMarginLoss` \u7ee7\u627f\u4e86\u7236\u4ee3\u7ecf\u5178\u7684 `softplus(margin - score_diff)` \u7ed3\u6784\u548c `tanh` \u7a33\u5b9a\u6280\u5de7\uff0c\u4f46\u521b\u65b0\u6027\u5730\u4f7f\u7528 `zscore` \u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884c\u6279\u5185\u5f52\u4e00\u5316\uff0c\u5e76\u7ed3\u5408 `softplus` \u8bbe\u8ba1\u4e86\u4e00\u4e2a\u5bf9\u6210\u672c\u76f8\u5bf9\u5927\u5c0f\u654f\u611f\u7684\u52a8\u6001\u88d5\u5ea6\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u5728\u4e0d\u540c\u6570\u636e\u5c3a\u5ea6\u4e0b\u7684\u9ad8\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u5728\u591a\u5927\u7a0b\u5ea6\u4e0a\u8f6c\u5316\u4e3a\u76ee\u6807\u88d5\u5ea6\u3002\u8f83\u9ad8\u7684beta\u503c\u610f\u5473\u7740\u6a21\u578b\u9700\u8981\u4e3a\u5177\u6709\u76f8\u5bf9\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5f97\u5206\u5dee\u8ddd\u3002"}}, "operators_used": ["zscore", "softplus", "tanh"]}}}
{"generation": 4, "index": 5, "ir": {"name": "HybridMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u7ed3\u5408\u4e86Hinge Loss\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\uff08margin\uff09\u201d\u601d\u60f3\u548cLogSigmoid\u635f\u5931\u7684\u201c\u9690\u5f0f\u52a0\u6743\u201d\u601d\u60f3\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u5730\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u6df7\u5408\u88d5\u5ea6\u8bbe\u8ba1 (Hybrid Margin) [\u8026\u5408\u70b91]**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u5173\u952e\u521b\u65b0\u3002\u6211\u4eec\u5c06\u7236\u4ee30\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\u201d\u548c\u7236\u4ee31\u7684\u201c\u9690\u5f0f\u52a0\u6743\u9879\u201d\u7ed3\u5408\u5728\u4e00\u8d77\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u51fd\u6570\u7684\u5f62\u5f0f\u662f `softplus(dynamic_margin - scaled_logp_diff)`\u3002\u8fd9\u91cc\u7684 `scaled_logp_diff` (\u5373 `scaling_factor * stable_logp_diff`) \u7ee7\u627f\u81ea\u7236\u4ee31\uff0c\u5b83\u672c\u8eab\u5c31\u5305\u542b\u4e86\u6210\u672c\u5dee\u5f02\u7684\u52a0\u6743\u4fe1\u606f\u3002\u540c\u65f6\uff0c`dynamic_margin` (\u5373 `beta * rank_gap(...)`) \u7ee7\u627f\u81ea\u7236\u4ee30\uff0c\u5b83\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u76ee\u6807\u9608\u503c\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff0c\u4e0d\u4ec5\u88d5\u5ea6\u76ee\u6807 (`dynamic_margin`) \u53d8\u9ad8\uff0c\u800c\u4e14\u6a21\u578b\u504f\u597d\u9879 (`scaled_logp_diff`) \u7684\u6743\u91cd\u4e5f\u53d8\u5927\uff0c\u4ece\u800c\u5bf9\u91cd\u8981\u6837\u672c\u5bf9\u65bd\u52a0\u4e86\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u6838\u5fc3\u635f\u5931\u6846\u67b6\u7684\u7edf\u4e00 [\u8026\u5408\u70b92]**\uff1a\u4e0e\u7236\u4ee31\u76f4\u63a5\u4f7f\u7528 `-logsigmoid(scaled_logp_diff)` \u4e0d\u540c\uff0c\u6211\u4eec\u5c06 `scaled_logp_diff` \u5d4c\u5165\u5230\u4e86\u7236\u4ee30\u7684 `softplus` \u94f0\u94fe\u635f\u5931\u6846\u67b6\u4e2d\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u6211\u4eec\u4e0d\u4ec5\u60e9\u7f5a\u65b9\u5411\u9519\u8bef\u7684\u504f\u597d\uff08`scaled_logp_diff < 0`\uff09\uff0c\u4e5f\u60e9\u7f5a\u90a3\u4e9b\u867d\u7136\u65b9\u5411\u6b63\u786e\u4f46\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\uff08`0 < scaled_logp_diff < dynamic_margin`\uff09\u7684\u9884\u6d4b\u3002\u8fd9\u6bd4\u5355\u7eaf\u7684 `logsigmoid` \u63d0\u4f9b\u4e86\u66f4\u7cbe\u7ec6\u7684\u63a7\u5236\uff0c\u56e0\u4e3a\u5b83\u8981\u6c42\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u5fc5\u987b\u201c\u8db3\u591f\u597d\u201d\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u201c\u65b9\u5411\u6b63\u786e\u201d\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee31\u7684\u201c\u52a0\u6743\u9879\u201d\u4f5c\u4e3a\u7236\u4ee30\u7684\u201c\u7f6e\u4fe1\u5ea6\u9879\u201d\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u6df7\u5408\u88d5\u5ea6\u6a21\u578b\u3002\u5b83\u65e2\u4fdd\u7559\u4e86Hinge Loss\u660e\u786e\u7684\u76ee\u6807\u8bbe\u5b9a\uff0c\u53c8\u878d\u5165\u4e86LogSigmoid\u635f\u5931\u4e2d\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u81ea\u9002\u5e94\u52a0\u6743\uff0c\u4ece\u800c\u5728\u9c81\u68d2\u6027\u3001\u7a33\u5b9a\u6027\u548c\u5bf9\u5173\u952e\u6837\u672c\u7684\u654f\u611f\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "pseudocode": "def HybridMarginLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    \u8fd9\u4e2a\u601d\u60f3\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u6709\u4f53\u73b0\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8bbe\u8ba1\u4e00\u4e2a\u7ebf\u6027\u7684\u52a8\u6001\u88d5\u5ea6(margin)\u3002\n    #    \u88d5\u5ea6\u7684\u5927\u5c0f\u4e0e\u6210\u672c\u7684\u79e9\u5dee\u6210\u6b63\u6bd4\u3002\n    dynamic_margin = beta * cost_rank_diff\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u521b\u5efa\u4e00\u4e2a\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u3002\n    #    \u8fd9\u4e2a\u56e0\u5b50\u540c\u6837\u4e0e\u6210\u672c\u5dee\u5f02\u6b63\u76f8\u5173\uff0c\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\u3002\n    scaling_factor = softplus(cost_rank_diff)\n\n    # 5. [\u7ee7\u627f] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 6. [\u65b0\u8026\u5408\u70b91 & 2] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\u3002\n    #    \u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u8be5\u9879\u7684\u5f71\u54cd\u529b\u8d8a\u5927\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 7. [\u65b0\u8026\u5408\u70b91 & 2] \u5c06\u52a0\u6743\u9879\u5d4c\u5165Hinge Loss\u6846\u67b6\u3002\n    #    \u6211\u4eec\u4f7f\u7528\u7236\u4ee30\u7684Hinge\u7ed3\u6784\uff0c\u4f46\u7528\u7236\u4ee31\u7684\u201c\u52a0\u6743\u9879\u201d\u66ff\u4ee3\u4e86\u539f\u59cb\u7684\u201c\u7f6e\u4fe1\u5ea6\u9879\u201d\u3002\n    #    \u5f53\u6a21\u578b\u7684\u52a0\u6743\u7f6e\u4fe1\u5ea6(scaled_logp_diff)\u5c0f\u4e8e\u52a8\u6001\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    #    \u8fd9\u5f62\u6210\u4e86\u4e00\u4e2a\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u6548\u5e94\u3002\n    loss = softplus(dynamic_margin - scaled_logp_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u79e9\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}}, "operators_used": ["rank_gap", "tanh", "softplus"], "implementation_hint": {"expects": ["cost_a, cost_b (scalars, costs of two samples), logp_a, logp_b (scalars, log probabilities from the model), beta (hyperparameter)"], "returns": "A single scalar value representing the loss for the pair."}}, "fitness": {"hf_like_score": 4.012051701545715, "validation_objective": 4.012051701545715, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.977712631225586}, "train_score_mean": 4.242170572280884, "train_loss_mean": 0.6928606368601322, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "HybridMarginLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u7ed3\u5408\u4e86Hinge Loss\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\uff08margin\uff09\u201d\u601d\u60f3\u548cLogSigmoid\u635f\u5931\u7684\u201c\u9690\u5f0f\u52a0\u6743\u201d\u601d\u60f3\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u5730\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `RankScaledLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u6df7\u5408\u88d5\u5ea6\u8bbe\u8ba1 (Hybrid Margin) [\u8026\u5408\u70b91]**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u5173\u952e\u521b\u65b0\u3002\u6211\u4eec\u5c06\u7236\u4ee30\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\u201d\u548c\u7236\u4ee31\u7684\u201c\u9690\u5f0f\u52a0\u6743\u9879\u201d\u7ed3\u5408\u5728\u4e00\u8d77\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u51fd\u6570\u7684\u5f62\u5f0f\u662f `softplus(dynamic_margin - scaled_logp_diff)`\u3002\u8fd9\u91cc\u7684 `scaled_logp_diff` (\u5373 `scaling_factor * stable_logp_diff`) \u7ee7\u627f\u81ea\u7236\u4ee31\uff0c\u5b83\u672c\u8eab\u5c31\u5305\u542b\u4e86\u6210\u672c\u5dee\u5f02\u7684\u52a0\u6743\u4fe1\u606f\u3002\u540c\u65f6\uff0c`dynamic_margin` (\u5373 `beta * rank_gap(...)`) \u7ee7\u627f\u81ea\u7236\u4ee30\uff0c\u5b83\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u76ee\u6807\u9608\u503c\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff0c\u4e0d\u4ec5\u88d5\u5ea6\u76ee\u6807 (`dynamic_margin`) \u53d8\u9ad8\uff0c\u800c\u4e14\u6a21\u578b\u504f\u597d\u9879 (`scaled_logp_diff`) \u7684\u6743\u91cd\u4e5f\u53d8\u5927\uff0c\u4ece\u800c\u5bf9\u91cd\u8981\u6837\u672c\u5bf9\u65bd\u52a0\u4e86\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u6838\u5fc3\u635f\u5931\u6846\u67b6\u7684\u7edf\u4e00 [\u8026\u5408\u70b92]**\uff1a\u4e0e\u7236\u4ee31\u76f4\u63a5\u4f7f\u7528 `-logsigmoid(scaled_logp_diff)` \u4e0d\u540c\uff0c\u6211\u4eec\u5c06 `scaled_logp_diff` \u5d4c\u5165\u5230\u4e86\u7236\u4ee30\u7684 `softplus` \u94f0\u94fe\u635f\u5931\u6846\u67b6\u4e2d\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u6211\u4eec\u4e0d\u4ec5\u60e9\u7f5a\u65b9\u5411\u9519\u8bef\u7684\u504f\u597d\uff08`scaled_logp_diff < 0`\uff09\uff0c\u4e5f\u60e9\u7f5a\u90a3\u4e9b\u867d\u7136\u65b9\u5411\u6b63\u786e\u4f46\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\uff08`0 < scaled_logp_diff < dynamic_margin`\uff09\u7684\u9884\u6d4b\u3002\u8fd9\u6bd4\u5355\u7eaf\u7684 `logsigmoid` \u63d0\u4f9b\u4e86\u66f4\u7cbe\u7ec6\u7684\u63a7\u5236\uff0c\u56e0\u4e3a\u5b83\u8981\u6c42\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u5fc5\u987b\u201c\u8db3\u591f\u597d\u201d\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u201c\u65b9\u5411\u6b63\u786e\u201d\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee31\u7684\u201c\u52a0\u6743\u9879\u201d\u4f5c\u4e3a\u7236\u4ee30\u7684\u201c\u7f6e\u4fe1\u5ea6\u9879\u201d\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u6df7\u5408\u88d5\u5ea6\u6a21\u578b\u3002\u5b83\u65e2\u4fdd\u7559\u4e86Hinge Loss\u660e\u786e\u7684\u76ee\u6807\u8bbe\u5b9a\uff0c\u53c8\u878d\u5165\u4e86LogSigmoid\u635f\u5931\u4e2d\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u81ea\u9002\u5e94\u52a0\u6743\uff0c\u4ece\u800c\u5728\u9c81\u68d2\u6027\u3001\u7a33\u5b9a\u6027\u548c\u5bf9\u5173\u952e\u6837\u672c\u7684\u654f\u611f\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u79e9\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}}, "operators_used": ["rank_gap", "tanh", "softplus"]}}}
{"generation": 4, "index": 7, "ir": {"name": "HybridMarginLogSigmoidLoss", "intuition": "\u8be5\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u6709\u660e\u786e\u7684\u3001\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684\u201c\u6700\u5c0f\u504f\u597d\u5dee\u8ddd\u201d\uff08margin\uff09\uff0c\u53c8\u80fd\u5229\u7528\u5bf9\u6570\u51e0\u7387\uff08LogSigmoid\uff09\u635f\u5931\u7684\u5e73\u6ed1\u6027\u548c\u6982\u7387\u89e3\u91ca\u6027\u7684\u6df7\u5408\u6a21\u578b\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1. **\u7ee7\u627f\u81ea\u7236\u4ee30 (RankGapScaledHingeLoss)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684\u201cHinge Loss\u201d\u7ed3\u6784\uff0c\u5373 `softplus(margin - score_diff)`\u3002\u8fd9\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u5dee\u8ddd\uff08score_diff\uff09\u81f3\u5c11\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u8ba1\u7b97\u7684\u88d5\u5ea6\uff08margin\uff09\u3002\u5f53\u6a21\u578b\u7684\u8868\u73b0\u672a\u8fbe\u5230\u8fd9\u4e2a\u88d5\u5ea6\u65f6\uff0c\u624d\u4f1a\u4ea7\u751f\u635f\u5931\uff0c\u8fd9\u6709\u52a9\u4e8e\u6a21\u578b\u4e13\u6ce8\u4e8e\u5b66\u4e60\u90a3\u4e9b\u201c\u56f0\u96be\u201d\u7684\u3001\u504f\u597d\u4e0d\u660e\u663e\u7684\u6837\u672c\u5bf9\u3002\n2. **\u7ee7\u627f\u81ea\u7236\u4ee31 (RankScaledLogSigmoidLoss)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u4f7f\u7528 `rank_gap` \u6765\u8ba1\u7b97\u9c81\u68d2\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u52a8\u6001\u88d5\u5ea6\u7684\u57fa\u7840\u3002\u6b64\u5916\uff0c\u6211\u4eec\u4fdd\u7559\u4e86 `tanh` \u7b97\u5b50\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u786e\u4fdd\u6570\u503c\u7a33\u5b9a\u6027\u3002\u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u5bf9\u9c81\u68d2\u6027\u548c\u7a33\u5b9a\u6027\u7684\u53cc\u91cd\u5173\u6ce8\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1. **\u6838\u5fc3\u7ed3\u6784\u8026\u5408\uff08\u8026\u5408\u70b91\uff09**\uff1a\u6211\u4eec\u5c06\u7236\u4ee30\u7684Hinge\u7ed3\u6784\u4e0e\u7236\u4ee31\u7684LogSigmoid\u6846\u67b6\u8fdb\u884c\u4e86\u521b\u65b0\u6027\u8026\u5408\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u5c06 `margin - stable_logp_diff` \u8fd9\u4e00\u9879\uff08\u6e90\u81eaHinge Loss\u601d\u60f3\uff09\u4f5c\u4e3a `logsigmoid` \u51fd\u6570\u7684\u8f93\u5165\u3002\u6700\u7ec8\u635f\u5931\u5b9a\u4e49\u4e3a `-logsigmoid(margin - stable_logp_diff)`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5de7\u5999\u5730\u878d\u5408\u4e86\u4e24\u79cd\u601d\u60f3\uff1a\n    - \u5f53 `stable_logp_diff > margin` \u65f6\uff08\u6a21\u578b\u504f\u597d\u8fdc\u8d85\u8981\u6c42\uff09\uff0c`margin - stable_logp_diff` \u662f\u4e00\u4e2a\u5927\u7684\u8d1f\u6570\uff0c`-logsigmoid` \u7684\u7ed3\u679c\u8d8b\u8fd1\u4e8e0\uff0c\u635f\u5931\u5f88\u5c0f\u3002\n    - \u5f53 `stable_logp_diff < margin` \u65f6\uff08\u6a21\u578b\u504f\u597d\u672a\u8fbe\u5230\u8981\u6c42\uff09\uff0c`margin - stable_logp_diff` \u662f\u6b63\u6570\uff0c`-logsigmoid` \u4f1a\u4ea7\u751f\u663e\u8457\u7684\u60e9\u7f5a\u3002\n    - \u76f8\u6bd4\u4e8e `softplus`\uff0c`logsigmoid` \u5728\u8f93\u5165\u4e3a\u8d1f\u65f6\u4ecd\u6709\u5fae\u5c0f\u68af\u5ea6\uff0c\u53ef\u4ee5\u6301\u7eed\u9f13\u52b1\u6a21\u578b\u201c\u597d\u4e0a\u52a0\u597d\u201d\uff0c\u800c\u4e0d\u662f\u8fbe\u5230\u88d5\u5ea6\u540e\u5c31\u505c\u6b62\u5b66\u4e60\u3002\n2. **\u88d5\u5ea6\u4e0e\u6982\u7387\u5dee\u7684\u8054\u5408\u5f52\u4e00\u5316\uff08\u8026\u5408\u70b92\uff09**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u7a33\u5b9a\u6027\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u5f52\u4e00\u5316\u6b65\u9aa4\u3002\u5728\u8ba1\u7b97 `margin - stable_logp_diff` \u4e4b\u524d\uff0c\u6211\u4eec\u4f7f\u7528 `zscore` \u5bf9 `dynamic_margin` \u548c `stable_logp_diff` \u8fd9\u4e24\u4e2a\u5f20\u91cf\u5728\u6279\u6b21\uff08batch\uff09\u7ef4\u5ea6\u4e0a\u8fdb\u884c\u6807\u51c6\u5316\u3002`zscore` \u5c06\u5b83\u4eec\u7684\u5747\u503c\u53d8\u4e3a0\uff0c\u6807\u51c6\u5dee\u53d8\u4e3a1\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff1a\n    - \u6d88\u9664\u4e86 `beta` \u8d85\u53c2\u6570\u5bf9 `dynamic_margin` \u7edd\u5bf9\u5c3a\u5ea6\u7684\u5f71\u54cd\uff0c\u4f7f\u5f97 `beta` \u7684\u4f5c\u7528\u66f4\u4fa7\u91cd\u4e8e\u8c03\u6574 `rank_gap` \u7684\u76f8\u5bf9\u91cd\u8981\u6027\uff0c\u8c03\u53c2\u66f4\u9c81\u68d2\u3002\n    - \u4f7f\u5f97 `margin` \u548c `logp_diff` \u5728\u8fdb\u5165 `logsigmoid` \u4e4b\u524d\u5904\u4e8e\u76f8\u4f3c\u7684\u6570\u503c\u5c3a\u5ea6\uff0c\u907f\u514d\u5176\u4e2d\u4e00\u4e2a\u4e3b\u5bfc\u4e86\u635f\u5931\u7684\u8ba1\u7b97\uff0c\u4f7f\u8bad\u7ec3\u8fc7\u7a0b\u66f4\u52a0\u7a33\u5b9a\uff0c\u51cf\u5c11\u4e86\u5bf9\u5b66\u4e60\u7387\u7684\u654f\u611f\u6027\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7 `zscore` \u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u88d5\u5ea6\u548c\u6982\u7387\u5dee\u5728\u6570\u503c\u4e0a\u7684\u201c\u516c\u5e73\u5bf9\u8bdd\u201d\uff0c\u7136\u540e\u5c06Hinge Loss\u7684\u76ee\u6807\u5dee\u8ddd\u601d\u60f3\u5d4c\u5165\u5230LogSigmoid\u7684\u5149\u6ed1\u60e9\u7f5a\u6846\u67b6\u4e2d\uff0c\u4ece\u800c\u5728\u9c81\u68d2\u6027\u3001\u7a33\u5b9a\u6027\u548c\u5b66\u4e60\u6548\u7387\u4e0a\u5bfb\u6c42\u4e86\u65b0\u7684\u5e73\u8861\u3002", "pseudocode": "def HybridMarginLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u80dc\u8005(winner)\u548c\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee30\u548c1] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8bbe\u8ba1\u4e00\u4e2a\u7ebf\u6027\u7f29\u653e\u7684\u52a8\u6001\u88d5\u5ea6\u3002\n    #    beta \u63a7\u5236\u88d5\u5ea6\u5bf9\u79e9\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u3002\n    dynamic_margin = beta * cost_rank_diff\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u65b0\u8026\u5408\u70b92] \u5bf9\u88d5\u5ea6\u548c\u6982\u7387\u5dee\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\u3002\n    #    \u8fd9\u4f7f\u5f97\u5b83\u4eec\u5728\u8fdb\u5165\u635f\u5931\u51fd\u6570\u524d\u5177\u6709\u76f8\u4f3c\u7684\u5c3a\u5ea6\uff0c\u589e\u5f3a\u7a33\u5b9a\u6027\u3002\n    #    \u5047\u8bbe zscore \u5728\u6279\u6b21\u7ef4\u5ea6\u4e0a\u64cd\u4f5c\u3002\n    norm_margin = zscore(dynamic_margin)\n    norm_logp_diff = zscore(stable_logp_diff)\n\n    # 6. [\u65b0\u8026\u5408\u70b91] \u5c06Hinge\u601d\u60f3\u4e0eLogSigmoid\u6846\u67b6\u8026\u5408\u3002\n    #    \u6211\u4eec\u8ba1\u7b97\u5f52\u4e00\u5316\u540e\u7684\u88d5\u5ea6\u4e0e\u6982\u7387\u5dee\u7684\u5dee\u8ddd\u3002\n    #    \u8fd9\u4e2a\u5dee\u8ddd\u8861\u91cf\u4e86\u6a21\u578b\u8868\u73b0\u4e0e\u671f\u671b\u76ee\u6807\u7684\u8ddd\u79bb\u3002\n    gap = norm_margin - norm_logp_diff\n\n    # 7. \u4f7f\u7528-logsigmoid\u8ba1\u7b97\u6700\u7ec8\u635f\u5931\u3002\n    #    \u5f53\u6a21\u578b\u8868\u73b0\u4f18\u4e8e\u88d5\u5ea6\u65f6(norm_logp_diff > norm_margin)\uff0cgap\u4e3a\u8d1f\uff0c\u635f\u5931\u63a5\u8fd10\u3002\n    #    \u5f53\u6a21\u578b\u8868\u73b0\u5dee\u4e8e\u88d5\u5ea6\u65f6(norm_logp_diff < norm_margin)\uff0cgap\u4e3a\u6b63\uff0c\u635f\u5931\u663e\u8457\u589e\u52a0\u3002\n    loss = -logsigmoid(-gap)  # \u7b49\u4ef7\u4e8e -logsigmoid(norm_logp_diff - norm_margin)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u8c03\u6574\u4e86\u6210\u672c\u7684\u79e9\u5dee\u5f02\uff08rank_gap\uff09\u5728\u6279\u6b21\u5185\u5f52\u4e00\u5316\u524d\u7684\u76f8\u5bf9\u91cd\u8981\u6027\u3002\u8f83\u5927\u7684beta\u503c\u4f1a\u653e\u5927\u9ad8\u79e9\u5dee\u6837\u672c\u5bf9\u7684\u88d5\u5ea6\uff0c\u4f7f\u5176\u5728\u5f52\u4e00\u5316\u540e\u4ecd\u53ef\u80fd\u83b7\u5f97\u66f4\u9ad8\u7684\u76f8\u5bf9\u88d5\u5ea6\u503c\u3002"}}, "operators_used": ["rank_gap", "tanh", "zscore", "logsigmoid"], "implementation_hint": {"expects": ["cost_a, cost_b, logp_a, logp_b: Tensors of shape [batch_size]. beta: a scalar float."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.020906448364258, "validation_objective": 4.020906448364258, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.9759292602539062}, "train_score_mean": 4.220928147435188, "train_loss_mean": 0.6928025148808956, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "HybridMarginLogSigmoidLoss", "intuition": "\u8be5\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u6709\u660e\u786e\u7684\u3001\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684\u201c\u6700\u5c0f\u504f\u597d\u5dee\u8ddd\u201d\uff08margin\uff09\uff0c\u53c8\u80fd\u5229\u7528\u5bf9\u6570\u51e0\u7387\uff08LogSigmoid\uff09\u635f\u5931\u7684\u5e73\u6ed1\u6027\u548c\u6982\u7387\u89e3\u91ca\u6027\u7684\u6df7\u5408\u6a21\u578b\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1. **\u7ee7\u627f\u81ea\u7236\u4ee30 (RankGapScaledHingeLoss)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684\u201cHinge Loss\u201d\u7ed3\u6784\uff0c\u5373 `softplus(margin - score_diff)`\u3002\u8fd9\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u5dee\u8ddd\uff08score_diff\uff09\u81f3\u5c11\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u8ba1\u7b97\u7684\u88d5\u5ea6\uff08margin\uff09\u3002\u5f53\u6a21\u578b\u7684\u8868\u73b0\u672a\u8fbe\u5230\u8fd9\u4e2a\u88d5\u5ea6\u65f6\uff0c\u624d\u4f1a\u4ea7\u751f\u635f\u5931\uff0c\u8fd9\u6709\u52a9\u4e8e\u6a21\u578b\u4e13\u6ce8\u4e8e\u5b66\u4e60\u90a3\u4e9b\u201c\u56f0\u96be\u201d\u7684\u3001\u504f\u597d\u4e0d\u660e\u663e\u7684\u6837\u672c\u5bf9\u3002\n2. **\u7ee7\u627f\u81ea\u7236\u4ee31 (RankScaledLogSigmoidLoss)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u4f7f\u7528 `rank_gap` \u6765\u8ba1\u7b97\u9c81\u68d2\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u52a8\u6001\u88d5\u5ea6\u7684\u57fa\u7840\u3002\u6b64\u5916\uff0c\u6211\u4eec\u4fdd\u7559\u4e86 `tanh` \u7b97\u5b50\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u786e\u4fdd\u6570\u503c\u7a33\u5b9a\u6027\u3002\u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u5bf9\u9c81\u68d2\u6027\u548c\u7a33\u5b9a\u6027\u7684\u53cc\u91cd\u5173\u6ce8\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1. **\u6838\u5fc3\u7ed3\u6784\u8026\u5408\uff08\u8026\u5408\u70b91\uff09**\uff1a\u6211\u4eec\u5c06\u7236\u4ee30\u7684Hinge\u7ed3\u6784\u4e0e\u7236\u4ee31\u7684LogSigmoid\u6846\u67b6\u8fdb\u884c\u4e86\u521b\u65b0\u6027\u8026\u5408\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u5c06 `margin - stable_logp_diff` \u8fd9\u4e00\u9879\uff08\u6e90\u81eaHinge Loss\u601d\u60f3\uff09\u4f5c\u4e3a `logsigmoid` \u51fd\u6570\u7684\u8f93\u5165\u3002\u6700\u7ec8\u635f\u5931\u5b9a\u4e49\u4e3a `-logsigmoid(margin - stable_logp_diff)`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5de7\u5999\u5730\u878d\u5408\u4e86\u4e24\u79cd\u601d\u60f3\uff1a\n    - \u5f53 `stable_logp_diff > margin` \u65f6\uff08\u6a21\u578b\u504f\u597d\u8fdc\u8d85\u8981\u6c42\uff09\uff0c`margin - stable_logp_diff` \u662f\u4e00\u4e2a\u5927\u7684\u8d1f\u6570\uff0c`-logsigmoid` \u7684\u7ed3\u679c\u8d8b\u8fd1\u4e8e0\uff0c\u635f\u5931\u5f88\u5c0f\u3002\n    - \u5f53 `stable_logp_diff < margin` \u65f6\uff08\u6a21\u578b\u504f\u597d\u672a\u8fbe\u5230\u8981\u6c42\uff09\uff0c`margin - stable_logp_diff` \u662f\u6b63\u6570\uff0c`-logsigmoid` \u4f1a\u4ea7\u751f\u663e\u8457\u7684\u60e9\u7f5a\u3002\n    - \u76f8\u6bd4\u4e8e `softplus`\uff0c`logsigmoid` \u5728\u8f93\u5165\u4e3a\u8d1f\u65f6\u4ecd\u6709\u5fae\u5c0f\u68af\u5ea6\uff0c\u53ef\u4ee5\u6301\u7eed\u9f13\u52b1\u6a21\u578b\u201c\u597d\u4e0a\u52a0\u597d\u201d\uff0c\u800c\u4e0d\u662f\u8fbe\u5230\u88d5\u5ea6\u540e\u5c31\u505c\u6b62\u5b66\u4e60\u3002\n2. **\u88d5\u5ea6\u4e0e\u6982\u7387\u5dee\u7684\u8054\u5408\u5f52\u4e00\u5316\uff08\u8026\u5408\u70b92\uff09**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u7a33\u5b9a\u6027\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u5f52\u4e00\u5316\u6b65\u9aa4\u3002\u5728\u8ba1\u7b97 `margin - stable_logp_diff` \u4e4b\u524d\uff0c\u6211\u4eec\u4f7f\u7528 `zscore` \u5bf9 `dynamic_margin` \u548c `stable_logp_diff` \u8fd9\u4e24\u4e2a\u5f20\u91cf\u5728\u6279\u6b21\uff08batch\uff09\u7ef4\u5ea6\u4e0a\u8fdb\u884c\u6807\u51c6\u5316\u3002`zscore` \u5c06\u5b83\u4eec\u7684\u5747\u503c\u53d8\u4e3a0\uff0c\u6807\u51c6\u5dee\u53d8\u4e3a1\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff1a\n    - \u6d88\u9664\u4e86 `beta` \u8d85\u53c2\u6570\u5bf9 `dynamic_margin` \u7edd\u5bf9\u5c3a\u5ea6\u7684\u5f71\u54cd\uff0c\u4f7f\u5f97 `beta` \u7684\u4f5c\u7528\u66f4\u4fa7\u91cd\u4e8e\u8c03\u6574 `rank_gap` \u7684\u76f8\u5bf9\u91cd\u8981\u6027\uff0c\u8c03\u53c2\u66f4\u9c81\u68d2\u3002\n    - \u4f7f\u5f97 `margin` \u548c `logp_diff` \u5728\u8fdb\u5165 `logsigmoid` \u4e4b\u524d\u5904\u4e8e\u76f8\u4f3c\u7684\u6570\u503c\u5c3a\u5ea6\uff0c\u907f\u514d\u5176\u4e2d\u4e00\u4e2a\u4e3b\u5bfc\u4e86\u635f\u5931\u7684\u8ba1\u7b97\uff0c\u4f7f\u8bad\u7ec3\u8fc7\u7a0b\u66f4\u52a0\u7a33\u5b9a\uff0c\u51cf\u5c11\u4e86\u5bf9\u5b66\u4e60\u7387\u7684\u654f\u611f\u6027\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7 `zscore` \u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u88d5\u5ea6\u548c\u6982\u7387\u5dee\u5728\u6570\u503c\u4e0a\u7684\u201c\u516c\u5e73\u5bf9\u8bdd\u201d\uff0c\u7136\u540e\u5c06Hinge Loss\u7684\u76ee\u6807\u5dee\u8ddd\u601d\u60f3\u5d4c\u5165\u5230LogSigmoid\u7684\u5149\u6ed1\u60e9\u7f5a\u6846\u67b6\u4e2d\uff0c\u4ece\u800c\u5728\u9c81\u68d2\u6027\u3001\u7a33\u5b9a\u6027\u548c\u5b66\u4e60\u6548\u7387\u4e0a\u5bfb\u6c42\u4e86\u65b0\u7684\u5e73\u8861\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u8c03\u6574\u4e86\u6210\u672c\u7684\u79e9\u5dee\u5f02\uff08rank_gap\uff09\u5728\u6279\u6b21\u5185\u5f52\u4e00\u5316\u524d\u7684\u76f8\u5bf9\u91cd\u8981\u6027\u3002\u8f83\u5927\u7684beta\u503c\u4f1a\u653e\u5927\u9ad8\u79e9\u5dee\u6837\u672c\u5bf9\u7684\u88d5\u5ea6\uff0c\u4f7f\u5176\u5728\u5f52\u4e00\u5316\u540e\u4ecd\u53ef\u80fd\u83b7\u5f97\u66f4\u9ad8\u7684\u76f8\u5bf9\u88d5\u5ea6\u503c\u3002"}}, "operators_used": ["rank_gap", "tanh", "zscore", "logsigmoid"]}}}
{"generation": 5, "index": 0, "ir": {"name": "AdaptiveScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u5c06\u7236\u4ee30\u7684Hinge-Loss\u7ed3\u6784\u4e0e\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\u8fdb\u884c\u4e86\u65b0\u9896\u7684\u8026\u5408\uff0c\u5e76\u5f15\u5165\u4e86\u57fa\u4e8eZ-Score\u7684\u52a8\u6001\u504f\u79fb\u6765\u589e\u5f3a\u5bf9\u4e0d\u540c\u6279\u6b21\u6570\u636e\u5206\u5e03\u7684\u9002\u5e94\u6027\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u6b63\u76f8\u5173\u7684`scaling_factor`\u6765\u52a0\u6743`logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\u6211\u4eec\u4fdd\u7559\u4e86 `scaling_factor = softplus(cost_rank_diff)` \u8fd9\u4e00\u5e73\u6ed1\u4e14\u975e\u8d1f\u7684\u8bbe\u8ba1\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u5176\u4f7f\u7528`tanh`\u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u6280\u5de7\u3002\u5c06 `logp_diff` \u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u8fc7\u7a0b\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u7edf\u4e00\u7684LogSigmoid\u6846\u67b6 (\u8026\u5408\u70b91)**\uff1a\u4e0e\u7236\u4ee3\u4eec\u91c7\u7528\u7684 `softplus(margin - term)` \u7684Hinge-Loss\u7ed3\u6784\u4e0d\u540c\uff0c\u6211\u4eec\u9009\u62e9\u5c06\u6574\u4e2a\u8868\u8fbe\u5f0f\u5d4c\u5165\u5230\u7ecf\u5178\u7684 `logsigmoid` \u6846\u67b6\u4e2d\uff0c\u5373 `loss = -logsigmoid(term)`\u3002\u6211\u4eec\u5c06\u7236\u4ee31\u4e2d\u7684\u6838\u5fc3\u9879 `scaled_logp_diff` \u4f5c\u4e3a `logsigmoid` \u7684\u8f93\u5165\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u635f\u5931\u51fd\u6570\u5929\u7136\u5730\u60e9\u7f5a\u6240\u6709 `scaled_logp_diff < 0` \u7684\u60c5\u51b5\uff0c\u5e76\u4e14\u5bf9\u4e8e `scaled_logp_diff > 0` \u7684\u60c5\u51b5\uff0c\u635f\u5931\u4f1a\u968f\u7740\u5176\u503c\u7684\u589e\u5927\u800c\u5e73\u6ed1\u51cf\u5c0f\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8fde\u7eed\u7684\u3001\u65e0\u786c\u6027\u8fb9\u754c\u7684\u68af\u5ea6\u4fe1\u53f7\uff0c\u9f13\u52b1\u6a21\u578b\u65e0\u9650\u5730\u63d0\u5347\u5bf9\u6b63\u786e\u914d\u5bf9\u7684\u7f6e\u4fe1\u5ea6\u3002\u8fd9\u7edf\u4e00\u4e86\u4e24\u4e2a\u7236\u4ee3\u4e2d\u201c\u52a0\u6743\u201d\u548c\u201c\u7a33\u5b9a\u201d\u7684\u601d\u60f3\uff0c\u5e76\u5c06\u5176\u7f6e\u4e8e\u4e00\u4e2a\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u3001\u7a33\u5065\u7684\u6982\u7387\u635f\u5931\u6846\u67b6\u4e0b\u3002\n2.  **\u52a8\u6001\u504f\u79fb\u7684Z-Score\u5f52\u4e00\u5316 (\u8026\u5408\u70b92)**\uff1a\u8fd9\u662f\u4e00\u4e2a\u5168\u65b0\u7684\u7a33\u5b9a\u5316\u548c\u81ea\u9002\u5e94\u6280\u5de7\u3002\u5728\u8ba1\u7b97 `scaled_logp_diff` \u4e4b\u540e\uff0c\u6211\u4eec\u4e0d\u662f\u76f4\u63a5\u5c06\u5176\u9001\u5165 `logsigmoid`\uff0c\u800c\u662f\u5148\u5bf9\u5176\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\uff0c\u7136\u540e\u518d\u901a\u8fc7\u4e00\u4e2a\u53ef\u5b66\u4e60\u7684 `gamma` \u548c `beta` \u8fdb\u884c\u7f29\u653e\u548c\u504f\u79fb\u3002`normalized_term = gamma * zscore(scaled_logp_diff) + beta`\u3002\u8fd9\u79cd\u505a\u6cd5\u5e26\u6765\u4e86\u4e24\u4e2a\u597d\u5904\uff1a\u9996\u5148\uff0c`zscore` \u4f7f\u5f97\u635f\u5931\u7684\u8f93\u5165\u5728\u6bcf\u4e2a\u6279\u6b21\u5185\u90fd\u8fd1\u4f3c\u4e8e\u6807\u51c6\u6b63\u6001\u5206\u5e03\uff0c\u6781\u5927\u5730\u589e\u5f3a\u4e86\u5bf9 `scaled_logp_diff` \u5c3a\u5ea6\u548c\u504f\u79fb\u7684\u9c81\u68d2\u6027\uff0c\u907f\u514d\u4e86\u56e0\u6210\u672c\u6216\u6a21\u578b\u5206\u6570\u5267\u70c8\u53d8\u5316\u5bfc\u81f4\u7684\u68af\u5ea6\u6d88\u5931\u6216\u7206\u70b8\u95ee\u9898\u3002\u5176\u6b21\uff0c\u5f15\u5165\u7684 `gamma` \u548c `beta` (\u6b64\u5904\u6211\u4eec\u7b80\u5316\uff0c\u53ea\u4f7f\u7528 `beta` \u4f5c\u4e3a\u52a8\u6001\u504f\u79fb) \u5141\u8bb8\u6a21\u578b\u5b66\u4e60\u4e00\u4e2a\u6700\u4f73\u7684\u201c\u51b3\u7b56\u8fb9\u754c\u201d\u504f\u79fb\u91cf\u3002\u8fd9\u4e2a\u504f\u79fb\u91cf `beta` \u53ef\u4ee5\u88ab\u7406\u89e3\u4e3a\u4e00\u4e2a\u6570\u636e\u9a71\u52a8\u7684\u3001\u52a8\u6001\u7684\u201c\u8f6f\u8fb9\u754c\u201d\uff0c\u5b83\u6839\u636e\u5f53\u524d\u6279\u6b21\u7684\u6570\u636e\u5206\u5e03\u81ea\u9002\u5e94\u5730\u8c03\u6574\uff0c\u51b3\u5b9a\u4e86\u591a\u5927\u7684 `zscore(scaled_logp_diff)` \u624d\u7b97\u201c\u8db3\u591f\u597d\u201d\uff0c\u4ece\u800c\u66ff\u4ee3\u4e86\u7236\u4ee3\u4e2d\u57fa\u4e8e `rank_gap` \u7684\u56fa\u5b9amargin\u8bbe\u8ba1\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee31\u7684\u201c\u81ea\u9002\u5e94\u52a0\u6743\u201d\u601d\u60f3\u4e0e\u7236\u4ee30\u7684\u201ctanh\u7a33\u5b9a\u201d\u6280\u5de7\u76f8\u7ed3\u5408\uff0c\u5e76\u5c06\u5176\u7edf\u4e00\u5728 `logsigmoid` \u6846\u67b6\u4e0b\uff0c\u540c\u65f6\u5f15\u5165\u4e86\u521b\u65b0\u7684Z-Score\u5f52\u4e00\u5316\u548c\u52a8\u6001\u504f\u79fb\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5bf9\u8f93\u5165\u5c3a\u5ea6\u4e0d\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u51b3\u7b56\u8fb9\u754c\u7684\u65b0\u578b\u504f\u597d\u635f\u5931\u3002", "pseudocode": "def AdaptiveScaledLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    \u8fd9\u4e2a\u601d\u60f3\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u6709\u4f53\u73b0\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u521b\u5efa\u4e00\u4e2a\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u3002\n    #    \u8be5\u56e0\u5b50\u4e0e\u6210\u672c\u5dee\u5f02\u6b63\u76f8\u5173\uff0c\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\u3002\n    scaling_factor = softplus(cost_rank_diff)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\u3002\n    #    \u8fd9\u7ed3\u5408\u4e86\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u52a0\u6743\u548c\u7236\u4ee30\u7684\u7a33\u5b9a\u6027\u6280\u5de7\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 6. [\u65b0\u8026\u5408\u70b91 & 2] \u5bf9\u52a0\u6743\u9879\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\u5e76\u6dfb\u52a0\u52a8\u6001\u504f\u79fb\u3002\n    #    zscore(x) \u4f1a\u5728\u6279\u6b21\u7ef4\u5ea6\u4e0a\u8ba1\u7b97 (x - mean(x)) / std(x)\uff0c\u589e\u5f3a\u5bf9\u5c3a\u5ea6\u548c\u504f\u79fb\u7684\u9c81\u68d2\u6027\u3002\n    #    beta \u4f5c\u4e3a\u53ef\u5b66\u4e60\u7684\u52a8\u6001\u504f\u79fb\uff0c\u66ff\u4ee3\u4e86\u56fa\u5b9a\u7684margin\u3002\n    #    clamp \u7528\u4e8e\u9632\u6b62zscore\u5728\u6279\u6b21\u5927\u5c0f\u4e3a1\u6216\u6807\u51c6\u5dee\u6781\u5c0f\u7684\u60c5\u51b5\u4e0b\u4ea7\u751fNaN/Inf\u3002\n    normalized_term = clamp(zscore(scaled_logp_diff), min=-3, max=3) + beta\n\n    # 7. [\u65b0\u8026\u5408\u70b91] \u5c06\u5f52\u4e00\u5316\u540e\u7684\u9879\u5d4c\u5165\u7edf\u4e00\u7684LogSigmoid\u6846\u67b6\u3002\n    #    -logsigmoid(x) \u662f\u4e00\u4e2a\u5e73\u6ed1\u3001\u7a33\u5b9a\u4e14\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u5206\u7c7b\u635f\u5931\u3002\n    #    \u5b83\u9f13\u52b1 normalized_term \u5c3d\u53ef\u80fd\u5927\u3002\n    loss = -logsigmoid(normalized_term)\n\n    return loss", "hyperparams": {"beta": {"value": 0.0, "description": "\u52a8\u6001\u504f\u79fb\u91cf\u3002\u8fd9\u662f\u4e00\u4e2a\u53ef\u5b66\u4e60\u7684\u53c2\u6570\u6216\u56fa\u5b9a\u8d85\u53c2\u6570\uff0c\u7528\u4e8e\u8c03\u6574Z-Score\u5f52\u4e00\u5316\u540e\u7684\u51b3\u7b56\u8fb9\u754c\u3002\u6b63\u503c\u4f1a\u4f7f\u5f97\u635f\u5931\u66f4\u5bb9\u6613\u964d\u4f4e\uff08\u5bf9\u6a21\u578b\u8981\u6c42\u66f4\u5bbd\u677e\uff09\uff0c\u8d1f\u503c\u5219\u66f4\u4e25\u683c\u3002\u4f5c\u4e3a\u8d85\u53c2\u6570\u65f6\uff0c0.0\u662f\u4e00\u4e2a\u4e2d\u6027\u7684\u8d77\u59cb\u70b9\u3002"}}, "operators_used": ["rank_gap", "softplus", "tanh", "zscore", "clamp", "logsigmoid"], "implementation_hint": {"expects": ["Tensors cost_a, cost_b, logp_a, logp_b, all of shape (batch_size,). The `zscore` operator is expected to compute mean and stddev across the batch dimension."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.082237482070923, "validation_objective": 4.082237482070923, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.032087802886963}, "train_score_mean": 4.238415323197842, "train_loss_mean": 0.692829605191946, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u5c06\u7236\u4ee30\u7684Hinge-Loss\u7ed3\u6784\u4e0e\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\u8fdb\u884c\u4e86\u65b0\u9896\u7684\u8026\u5408\uff0c\u5e76\u5f15\u5165\u4e86\u57fa\u4e8eZ-Score\u7684\u52a8\u6001\u504f\u79fb\u6765\u589e\u5f3a\u5bf9\u4e0d\u540c\u6279\u6b21\u6570\u636e\u5206\u5e03\u7684\u9002\u5e94\u6027\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u6b63\u76f8\u5173\u7684`scaling_factor`\u6765\u52a0\u6743`logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\u6211\u4eec\u4fdd\u7559\u4e86 `scaling_factor = softplus(cost_rank_diff)` \u8fd9\u4e00\u5e73\u6ed1\u4e14\u975e\u8d1f\u7684\u8bbe\u8ba1\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u501f\u9274\u4e86\u5176\u4f7f\u7528`tanh`\u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u6280\u5de7\u3002\u5c06 `logp_diff` \u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u8fc7\u7a0b\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u7edf\u4e00\u7684LogSigmoid\u6846\u67b6 (\u8026\u5408\u70b91)**\uff1a\u4e0e\u7236\u4ee3\u4eec\u91c7\u7528\u7684 `softplus(margin - term)` \u7684Hinge-Loss\u7ed3\u6784\u4e0d\u540c\uff0c\u6211\u4eec\u9009\u62e9\u5c06\u6574\u4e2a\u8868\u8fbe\u5f0f\u5d4c\u5165\u5230\u7ecf\u5178\u7684 `logsigmoid` \u6846\u67b6\u4e2d\uff0c\u5373 `loss = -logsigmoid(term)`\u3002\u6211\u4eec\u5c06\u7236\u4ee31\u4e2d\u7684\u6838\u5fc3\u9879 `scaled_logp_diff` \u4f5c\u4e3a `logsigmoid` \u7684\u8f93\u5165\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u635f\u5931\u51fd\u6570\u5929\u7136\u5730\u60e9\u7f5a\u6240\u6709 `scaled_logp_diff < 0` \u7684\u60c5\u51b5\uff0c\u5e76\u4e14\u5bf9\u4e8e `scaled_logp_diff > 0` \u7684\u60c5\u51b5\uff0c\u635f\u5931\u4f1a\u968f\u7740\u5176\u503c\u7684\u589e\u5927\u800c\u5e73\u6ed1\u51cf\u5c0f\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8fde\u7eed\u7684\u3001\u65e0\u786c\u6027\u8fb9\u754c\u7684\u68af\u5ea6\u4fe1\u53f7\uff0c\u9f13\u52b1\u6a21\u578b\u65e0\u9650\u5730\u63d0\u5347\u5bf9\u6b63\u786e\u914d\u5bf9\u7684\u7f6e\u4fe1\u5ea6\u3002\u8fd9\u7edf\u4e00\u4e86\u4e24\u4e2a\u7236\u4ee3\u4e2d\u201c\u52a0\u6743\u201d\u548c\u201c\u7a33\u5b9a\u201d\u7684\u601d\u60f3\uff0c\u5e76\u5c06\u5176\u7f6e\u4e8e\u4e00\u4e2a\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u3001\u7a33\u5065\u7684\u6982\u7387\u635f\u5931\u6846\u67b6\u4e0b\u3002\n2.  **\u52a8\u6001\u504f\u79fb\u7684Z-Score\u5f52\u4e00\u5316 (\u8026\u5408\u70b92)**\uff1a\u8fd9\u662f\u4e00\u4e2a\u5168\u65b0\u7684\u7a33\u5b9a\u5316\u548c\u81ea\u9002\u5e94\u6280\u5de7\u3002\u5728\u8ba1\u7b97 `scaled_logp_diff` \u4e4b\u540e\uff0c\u6211\u4eec\u4e0d\u662f\u76f4\u63a5\u5c06\u5176\u9001\u5165 `logsigmoid`\uff0c\u800c\u662f\u5148\u5bf9\u5176\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\uff0c\u7136\u540e\u518d\u901a\u8fc7\u4e00\u4e2a\u53ef\u5b66\u4e60\u7684 `gamma` \u548c `beta` \u8fdb\u884c\u7f29\u653e\u548c\u504f\u79fb\u3002`normalized_term = gamma * zscore(scaled_logp_diff) + beta`\u3002\u8fd9\u79cd\u505a\u6cd5\u5e26\u6765\u4e86\u4e24\u4e2a\u597d\u5904\uff1a\u9996\u5148\uff0c`zscore` \u4f7f\u5f97\u635f\u5931\u7684\u8f93\u5165\u5728\u6bcf\u4e2a\u6279\u6b21\u5185\u90fd\u8fd1\u4f3c\u4e8e\u6807\u51c6\u6b63\u6001\u5206\u5e03\uff0c\u6781\u5927\u5730\u589e\u5f3a\u4e86\u5bf9 `scaled_logp_diff` \u5c3a\u5ea6\u548c\u504f\u79fb\u7684\u9c81\u68d2\u6027\uff0c\u907f\u514d\u4e86\u56e0\u6210\u672c\u6216\u6a21\u578b\u5206\u6570\u5267\u70c8\u53d8\u5316\u5bfc\u81f4\u7684\u68af\u5ea6\u6d88\u5931\u6216\u7206\u70b8\u95ee\u9898\u3002\u5176\u6b21\uff0c\u5f15\u5165\u7684 `gamma` \u548c `beta` (\u6b64\u5904\u6211\u4eec\u7b80\u5316\uff0c\u53ea\u4f7f\u7528 `beta` \u4f5c\u4e3a\u52a8\u6001\u504f\u79fb) \u5141\u8bb8\u6a21\u578b\u5b66\u4e60\u4e00\u4e2a\u6700\u4f73\u7684\u201c\u51b3\u7b56\u8fb9\u754c\u201d\u504f\u79fb\u91cf\u3002\u8fd9\u4e2a\u504f\u79fb\u91cf `beta` \u53ef\u4ee5\u88ab\u7406\u89e3\u4e3a\u4e00\u4e2a\u6570\u636e\u9a71\u52a8\u7684\u3001\u52a8\u6001\u7684\u201c\u8f6f\u8fb9\u754c\u201d\uff0c\u5b83\u6839\u636e\u5f53\u524d\u6279\u6b21\u7684\u6570\u636e\u5206\u5e03\u81ea\u9002\u5e94\u5730\u8c03\u6574\uff0c\u51b3\u5b9a\u4e86\u591a\u5927\u7684 `zscore(scaled_logp_diff)` \u624d\u7b97\u201c\u8db3\u591f\u597d\u201d\uff0c\u4ece\u800c\u66ff\u4ee3\u4e86\u7236\u4ee3\u4e2d\u57fa\u4e8e `rank_gap` \u7684\u56fa\u5b9amargin\u8bbe\u8ba1\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee31\u7684\u201c\u81ea\u9002\u5e94\u52a0\u6743\u201d\u601d\u60f3\u4e0e\u7236\u4ee30\u7684\u201ctanh\u7a33\u5b9a\u201d\u6280\u5de7\u76f8\u7ed3\u5408\uff0c\u5e76\u5c06\u5176\u7edf\u4e00\u5728 `logsigmoid` \u6846\u67b6\u4e0b\uff0c\u540c\u65f6\u5f15\u5165\u4e86\u521b\u65b0\u7684Z-Score\u5f52\u4e00\u5316\u548c\u52a8\u6001\u504f\u79fb\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5bf9\u8f93\u5165\u5c3a\u5ea6\u4e0d\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u51b3\u7b56\u8fb9\u754c\u7684\u65b0\u578b\u504f\u597d\u635f\u5931\u3002", "hyperparams": {"beta": {"value": 0.0, "description": "\u52a8\u6001\u504f\u79fb\u91cf\u3002\u8fd9\u662f\u4e00\u4e2a\u53ef\u5b66\u4e60\u7684\u53c2\u6570\u6216\u56fa\u5b9a\u8d85\u53c2\u6570\uff0c\u7528\u4e8e\u8c03\u6574Z-Score\u5f52\u4e00\u5316\u540e\u7684\u51b3\u7b56\u8fb9\u754c\u3002\u6b63\u503c\u4f1a\u4f7f\u5f97\u635f\u5931\u66f4\u5bb9\u6613\u964d\u4f4e\uff08\u5bf9\u6a21\u578b\u8981\u6c42\u66f4\u5bbd\u677e\uff09\uff0c\u8d1f\u503c\u5219\u66f4\u4e25\u683c\u3002\u4f5c\u4e3a\u8d85\u53c2\u6570\u65f6\uff0c0.0\u662f\u4e00\u4e2a\u4e2d\u6027\u7684\u8d77\u59cb\u70b9\u3002"}}, "operators_used": ["rank_gap", "softplus", "tanh", "zscore", "clamp", "logsigmoid"]}}}
{"generation": 5, "index": 1, "ir": {"name": "ZScoreClippedAdaptiveLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165Z-score\u5f52\u4e00\u5316\u548c\u975e\u5bf9\u79f0\u7684\u68af\u5ea6\u88c1\u526a\uff0c\u6765\u5904\u7406\u6279\u91cf\u6570\u636e\u4e2d\u7684\u6210\u672c\u5206\u5e03\u548c\u6781\u7aef\u68af\u5ea6\u95ee\u9898\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u7ee7\u627f\u4e86\u4f7f\u7528`tanh`\u6765\u7a33\u5b9a`logp_diff`\u7684\u6280\u5de7\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u6765\u5904\u7406\u6210\u672c\u5dee\u5f02\u3002\u4e0e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap` \u4e0d\u540c\uff0c`zscore` \u4e0d\u4ec5\u8003\u8651\u4e86\u6210\u672c\u7684\u6392\u5e8f\uff0c\u8fd8\u8003\u8651\u4e86\u5b83\u4eec\u5728\u5f53\u524d\u6279\u6b21\uff08batch\uff09\u5185\u7684\u7edf\u8ba1\u5206\u5e03\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u3002`zscore(cost_w, cost_l)` \u4f1a\u8fd4\u56de\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\uff0c\u8fd9\u4f7f\u5f97\u88d5\u5ea6 `dynamic_margin` \u548c\u7f29\u653e\u56e0\u5b50 `scaling_factor` \u7684\u8ba1\u7b97\u5bf9\u6574\u4e2a\u6279\u6b21\u6570\u636e\u7684\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n2.  **\u5f15\u5165\u975e\u5bf9\u79f0\u88c1\u526a (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u8d85\u53c2\u6570 `gamma` \u548c `clamp` \u7b97\u5b50\u6765\u5bf9\u6700\u7ec8\u7684\u635f\u5931\u9879 `loss_term` \u8fdb\u884c\u975e\u5bf9\u79f0\u88c1\u526a\uff1a`clamp(loss_term, min=-gamma)`\u3002\u8fd9\u4e2a\u8bbe\u8ba1\u7684\u52a8\u673a\u662f\uff1a\u5f53\u6a21\u578b\u9884\u6d4b\u5b8c\u5168\u9519\u8bef\u65f6\uff08\u5373 `logp_w` \u8fdc\u5c0f\u4e8e `logp_l`\uff09\uff0c`loss_term` \u4f1a\u53d8\u5f97\u975e\u5e38\u5927\uff0c\u53ef\u80fd\u5bfc\u81f4\u68af\u5ea6\u7206\u70b8\u548c\u8bad\u7ec3\u4e0d\u7a33\u5b9a\u3002\u901a\u8fc7\u8bbe\u7f6e\u4e00\u4e2a\u8d1f\u7684\u4e0b\u754c\uff08`-gamma`\uff09\uff0c\u6211\u4eec\u5141\u8bb8\u6a21\u578b\u5728\u9884\u6d4b\u6b63\u786e\u65f6\uff08`loss_term`\u4e3a\u8d1f\uff09\u83b7\u5f97\u65e0\u9650\u5236\u7684\u201c\u5956\u52b1\u201d\uff08\u5373\u66f4\u4f4e\u7684\u635f\u5931\uff09\uff0c\u4f46\u9650\u5236\u4e86\u5f53\u9884\u6d4b\u9519\u8bef\u65f6\u53ef\u80fd\u4ea7\u751f\u7684\u6700\u5927\u60e9\u7f5a\u3002\u8fd9\u5728\u4fdd\u6301\u5bf9\u56f0\u96be\u8d1f\u6837\u672c\u7684\u5b66\u4e60\u52a8\u529b\u7684\u540c\u65f6\uff0c\u6709\u6548\u9632\u6b62\u4e86\u6781\u7aef\u68af\u5ea6\u5bf9\u6a21\u578b\u66f4\u65b0\u7684\u7834\u574f\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7Z-score\u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6279\u6b21\u5185\u6210\u672c\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u7ee7\u627f\u4e86\u7236\u4ee3\u4e2d\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684\u52a8\u6001\u88d5\u5ea6\u548c\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\uff0c\u5e76\u521b\u65b0\u6027\u5730\u5f15\u5165\u4e86\u975e\u5bf9\u79f0\u88c1\u526a\u6765\u589e\u5f3a\u8bad\u7ec3\u7684\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u4ece\u800c\u5728\u9c81\u68d2\u6027\u3001\u654f\u611f\u6027\u548c\u7a33\u5b9a\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "pseudocode": "def ZScoreClippedAdaptiveLoss(cost_a, cost_b, logp_a, logp_b, beta, gamma):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u4f7f\u7528Z-score\u8ba1\u7b97\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\n    #    zscore(cost_w, cost_l) \u4f1a\u5728\u6279\u6b21\u7ea7\u522b\u4e0a\u8fdb\u884c\u6807\u51c6\u5316\uff0c\u8fd4\u56de\u4e00\u4e2a\u5bf9\u5c3a\u5ea6\u9c81\u68d2\u7684\u5dee\u5f02\u503c\u3002\n    cost_diff_standardized = zscore(cost_w, cost_l)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8bbe\u8ba1\u4e00\u4e2a\u57fa\u4e8e\u6807\u51c6\u5316\u6210\u672c\u5dee\u5f02\u7684\u52a8\u6001\u88d5\u5ea6(margin)\n    #    \u88d5\u5ea6\u7684\u5927\u5c0f\u4e0e\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u6210\u6b63\u6bd4\u3002\n    dynamic_margin = beta * cost_diff_standardized\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u521b\u5efa\u4e00\u4e2a\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\n    #    \u8be5\u56e0\u5b50\u540c\u6837\u4e0e\u6210\u672c\u5dee\u5f02\u6b63\u76f8\u5173\uff0c\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\u3002\n    scaling_factor = softplus(cost_diff_standardized)\n\n    # 5. [\u7ee7\u627f] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\n    #    \u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u8be5\u9879\u7684\u5f71\u54cd\u529b\u8d8a\u5927\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 7. \u8ba1\u7b97Hinge Loss\u7684\u6838\u5fc3\u9879\n    #    \u8fd9\u662f\u7236\u4ee30\u548c\u7236\u4ee31\u5171\u6709\u7684\u6838\u5fc3\u7ed3\u6784\u3002\n    loss_term = dynamic_margin - scaled_logp_diff\n\n    # 8. [\u65b0\u8026\u5408\u70b92] \u5bf9\u635f\u5931\u9879\u8fdb\u884c\u975e\u5bf9\u79f0\u88c1\u526a\n    #    \u5f53\u6a21\u578b\u9884\u6d4b\u6b63\u786e\u65f6\uff08loss_term < 0\uff09\uff0c\u635f\u5931\u53ef\u4ee5\u975e\u5e38\u5c0f\u3002\n    #    \u5f53\u6a21\u578b\u9884\u6d4b\u9519\u8bef\u65f6\uff08loss_term > 0\uff09\uff0c\u5176\u6700\u5927\u503c\u88ab softplus \u81ea\u7136\u5904\u7406\u3002\n    #    \u4f46\u6211\u4eec\u989d\u5916\u9650\u5236\u5176\u6700\u5c0f\u503c\u4e0d\u5c0f\u4e8e -gamma\uff0c\u9632\u6b62\u6781\u7aef\u6b63\u786e\u7684\u9884\u6d4b\u4ea7\u751f\u8fc7\u5927\u7684\u8d1f\u503c\uff0c\u53ef\u80fd\u5bfc\u81f4\u68af\u5ea6\u6d88\u5931\u3002\n    clipped_loss_term = clamp(loss_term, min=-gamma)\n\n    # 9. \u8ba1\u7b97\u6700\u7ec8\u7684\u5e73\u6ed1Hinge\u635f\u5931\n    #    \u5f53\u6a21\u578b\u7684\u52a0\u6743\u7f6e\u4fe1\u5ea6(scaled_logp_diff)\u5c0f\u4e8e\u52a8\u6001\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    loss = softplus(clipped_loss_term)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8e\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\u3002"}, "gamma": {"value": 5.0, "description": "\u975e\u5bf9\u79f0\u88c1\u526a\u7684\u4e0b\u754c\u53c2\u6570\u3002\u5b83\u9650\u5236\u4e86Hinge\u635f\u5931\u5185\u90e8\u9879\u7684\u6700\u5c0f\u503c\uff0c\u9632\u6b62\u56e0\u6a21\u578b\u9884\u6d4b\u8fc7\u4e8e\u6b63\u786e\uff08\u5373scaled_logp_diff\u8fdc\u5927\u4e8edynamic_margin\uff09\u800c\u4ea7\u751f\u6781\u5927\u7684\u8d1f\u503c\uff0c\u4ece\u800c\u7a33\u5b9a\u68af\u5ea6\uff0c\u9632\u6b62\u68af\u5ea6\u6d88\u5931\u95ee\u9898\u3002"}}, "operators_used": ["zscore", "softplus", "tanh", "clamp"], "implementation_hint": {"expects": ["Tensors cost_a, cost_b, logp_a, logp_b of shape (B,), and scalar hyperparams beta, gamma. 'zscore' is expected to operate on the entire batch."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.079308271408081, "validation_objective": 4.079308271408081, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.038342118263245}, "train_score_mean": 4.212179750204086, "train_loss_mean": 0.6928704008460045, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedAdaptiveLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165Z-score\u5f52\u4e00\u5316\u548c\u975e\u5bf9\u79f0\u7684\u68af\u5ea6\u88c1\u526a\uff0c\u6765\u5904\u7406\u6279\u91cf\u6570\u636e\u4e2d\u7684\u6210\u672c\u5206\u5e03\u548c\u6781\u7aef\u68af\u5ea6\u95ee\u9898\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u7ee7\u627f\u4e86\u4f7f\u7528`tanh`\u6765\u7a33\u5b9a`logp_diff`\u7684\u6280\u5de7\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u6765\u5904\u7406\u6210\u672c\u5dee\u5f02\u3002\u4e0e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap` \u4e0d\u540c\uff0c`zscore` \u4e0d\u4ec5\u8003\u8651\u4e86\u6210\u672c\u7684\u6392\u5e8f\uff0c\u8fd8\u8003\u8651\u4e86\u5b83\u4eec\u5728\u5f53\u524d\u6279\u6b21\uff08batch\uff09\u5185\u7684\u7edf\u8ba1\u5206\u5e03\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u3002`zscore(cost_w, cost_l)` \u4f1a\u8fd4\u56de\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\uff0c\u8fd9\u4f7f\u5f97\u88d5\u5ea6 `dynamic_margin` \u548c\u7f29\u653e\u56e0\u5b50 `scaling_factor` \u7684\u8ba1\u7b97\u5bf9\u6574\u4e2a\u6279\u6b21\u6570\u636e\u7684\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n2.  **\u5f15\u5165\u975e\u5bf9\u79f0\u88c1\u526a (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u8d85\u53c2\u6570 `gamma` \u548c `clamp` \u7b97\u5b50\u6765\u5bf9\u6700\u7ec8\u7684\u635f\u5931\u9879 `loss_term` \u8fdb\u884c\u975e\u5bf9\u79f0\u88c1\u526a\uff1a`clamp(loss_term, min=-gamma)`\u3002\u8fd9\u4e2a\u8bbe\u8ba1\u7684\u52a8\u673a\u662f\uff1a\u5f53\u6a21\u578b\u9884\u6d4b\u5b8c\u5168\u9519\u8bef\u65f6\uff08\u5373 `logp_w` \u8fdc\u5c0f\u4e8e `logp_l`\uff09\uff0c`loss_term` \u4f1a\u53d8\u5f97\u975e\u5e38\u5927\uff0c\u53ef\u80fd\u5bfc\u81f4\u68af\u5ea6\u7206\u70b8\u548c\u8bad\u7ec3\u4e0d\u7a33\u5b9a\u3002\u901a\u8fc7\u8bbe\u7f6e\u4e00\u4e2a\u8d1f\u7684\u4e0b\u754c\uff08`-gamma`\uff09\uff0c\u6211\u4eec\u5141\u8bb8\u6a21\u578b\u5728\u9884\u6d4b\u6b63\u786e\u65f6\uff08`loss_term`\u4e3a\u8d1f\uff09\u83b7\u5f97\u65e0\u9650\u5236\u7684\u201c\u5956\u52b1\u201d\uff08\u5373\u66f4\u4f4e\u7684\u635f\u5931\uff09\uff0c\u4f46\u9650\u5236\u4e86\u5f53\u9884\u6d4b\u9519\u8bef\u65f6\u53ef\u80fd\u4ea7\u751f\u7684\u6700\u5927\u60e9\u7f5a\u3002\u8fd9\u5728\u4fdd\u6301\u5bf9\u56f0\u96be\u8d1f\u6837\u672c\u7684\u5b66\u4e60\u52a8\u529b\u7684\u540c\u65f6\uff0c\u6709\u6548\u9632\u6b62\u4e86\u6781\u7aef\u68af\u5ea6\u5bf9\u6a21\u578b\u66f4\u65b0\u7684\u7834\u574f\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7Z-score\u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6279\u6b21\u5185\u6210\u672c\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u7ee7\u627f\u4e86\u7236\u4ee3\u4e2d\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684\u52a8\u6001\u88d5\u5ea6\u548c\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\uff0c\u5e76\u521b\u65b0\u6027\u5730\u5f15\u5165\u4e86\u975e\u5bf9\u79f0\u88c1\u526a\u6765\u589e\u5f3a\u8bad\u7ec3\u7684\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u4ece\u800c\u5728\u9c81\u68d2\u6027\u3001\u654f\u611f\u6027\u548c\u7a33\u5b9a\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8e\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\u3002"}, "gamma": {"value": 5.0, "description": "\u975e\u5bf9\u79f0\u88c1\u526a\u7684\u4e0b\u754c\u53c2\u6570\u3002\u5b83\u9650\u5236\u4e86Hinge\u635f\u5931\u5185\u90e8\u9879\u7684\u6700\u5c0f\u503c\uff0c\u9632\u6b62\u56e0\u6a21\u578b\u9884\u6d4b\u8fc7\u4e8e\u6b63\u786e\uff08\u5373scaled_logp_diff\u8fdc\u5927\u4e8edynamic_margin\uff09\u800c\u4ea7\u751f\u6781\u5927\u7684\u8d1f\u503c\uff0c\u4ece\u800c\u7a33\u5b9a\u68af\u5ea6\uff0c\u9632\u6b62\u68af\u5ea6\u6d88\u5931\u95ee\u9898\u3002"}}, "operators_used": ["zscore", "softplus", "tanh", "clamp"]}}}
{"generation": 5, "index": 2, "ir": {"name": "AdaptiveScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u80fd\u5728\u6570\u503c\u4e0a\u4fdd\u6301\u7a33\u5b9a\uff0c\u540c\u65f6\u8fd8\u80fd\u81ea\u9002\u5e94\u5730\u8c03\u6574\u5b66\u4e60\u538b\u529b\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684`softplus(margin - term)`\u7684Hinge Loss\u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684`scaling_factor`\u6765\u52a0\u6743`logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u81ea\u9002\u5e94\u7f29\u653e\u7684\u5bf9\u6570\u51e0\u7387\u635f\u5931)**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u5173\u952e\u521b\u65b0\u3002\u6211\u4eec\u5c06\u7236\u4ee31\u4e2d\u7684\u201c\u52a0\u6743\u9879\u201d`scaled_logp_diff`\uff08\u5373 `scaling_factor * logp_diff`\uff09\u4e0e\u7ecf\u5178\u7684\u5bf9\u6570\u51e0\u7387\u635f\u5931\uff08Log-Likelihood Loss\uff09\u8fdb\u884c\u4e86\u8026\u5408\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u5c06`scaled_logp_diff`\u4f5c\u4e3a`logsigmoid`\u51fd\u6570\u7684\u8f93\u5165\uff0c\u5f97\u5230`loss = -logsigmoid(scaled_logp_diff)`\u3002\u8fd9\u4e0e\u76f4\u63a5\u4f7f\u7528`logp_diff`\u7684\u4f20\u7edfDPO\u635f\u5931\u4e0d\u540c\uff0c\u5b83\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u7684\u68af\u5ea6\u88ab`scaling_factor`\u653e\u5927\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u5bf9\u91cd\u8981\u6837\u672c\u7684\u201c\u91cd\u70b9\u5b66\u4e60\u201d\u3002\u8fd9\u79cd\u8bbe\u8ba1\u6bd4\u7236\u4ee31\u7684Hinge\u7ed3\u6784\u66f4\u76f4\u63a5\uff0c\u56e0\u4e3a\u5b83\u4e0d\u8bbe\u56fa\u5b9a\u7684\u88d5\u5ea6\uff0c\u800c\u662f\u9f13\u52b1`scaled_logp_diff`\u8d8a\u5927\u8d8a\u597d\uff0c\u7406\u8bba\u4e0a\u53ef\u4ee5\u65e0\u9650\u4f18\u5316\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u5f15\u5165\u6e29\u5ea6\u56e0\u5b50\u8fdb\u884c\u68af\u5ea6\u8c03\u8282)**\uff1a\u4e3a\u4e86\u589e\u52a0\u5bf9\u68af\u5ea6\u5e45\u5ea6\u7684\u63a7\u5236\uff0c\u6211\u4eec\u5728\u8ba1\u7b97`scaled_logp_diff`\u65f6\u5f15\u5165\u4e86\u4e00\u4e2a\u8d85\u53c2\u6570`temperature` (\u03c4)\u3002\u8ba1\u7b97\u516c\u5f0f\u53d8\u4e3a `scaled_logp_diff = scaling_factor * stable_logp_diff / temperature`\u3002\u8fd9\u4e2a`temperature`\u626e\u6f14\u4e86\u8c03\u8282\u68af\u5ea6\u7684\u89d2\u8272\uff1a\n    *   \u5f53 `temperature` > 1 \u65f6\uff0c\u5b83\u4f1a\u201c\u51b7\u5374\u201d\u7cfb\u7edf\uff0c\u7f29\u5c0f`scaled_logp_diff`\u7684\u6570\u503c\u8303\u56f4\uff0c\u4ece\u800c\u51cf\u5c0f\u68af\u5ea6\uff0c\u4f7f\u5f97\u5b66\u4e60\u8fc7\u7a0b\u66f4\u5e73\u6ed1\u3001\u7a33\u5b9a\uff0c\u5c24\u5176\u662f\u5728`logp_diff`\u6570\u503c\u8f83\u5927\u7684\u533a\u57df\u3002\n    *   \u5f53 `temperature` < 1 \u65f6\uff0c\u5b83\u4f1a\u201c\u52a0\u70ed\u201d\u7cfb\u7edf\uff0c\u653e\u5927`scaled_logp_diff`\uff0c\u4ece\u800c\u589e\u5927\u68af\u5ea6\uff0c\u4f7f\u5f97\u6a21\u578b\u5728\u533a\u5206\u6837\u672c\u5bf9\u65f6\u66f4\u52a0\u201c\u6fc0\u8fdb\u201d\u3002\n    \u8fd9\u4e2a\u8026\u5408\u70b9\u4e3a\u635f\u5931\u51fd\u6570\u589e\u52a0\u4e86\u4e00\u4e2a\u91cd\u8981\u7684\u8c03\u63a7\u65cb\u94ae\uff0c\u53ef\u4ee5\u5728\u7a33\u5b9a\u6027\u548c\u5b66\u4e60\u5f3a\u5ea6\u4e4b\u95f4\u8fdb\u884c\u6743\u8861\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee31\u7684\u201c\u81ea\u9002\u5e94\u52a0\u6743\u201d\u601d\u60f3\u4e0e\u7ecf\u5178\u7684\u5bf9\u6570\u51e0\u7387\u635f\u5931\u6846\u67b6\u76f8\u7ed3\u5408\uff0c\u521b\u9020\u4e86\u4e00\u79cd\u65b0\u7684\u3001\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u7684\u635f\u5931\u5f62\u5f0f\u3002\u540c\u65f6\uff0c\u5f15\u5165\u7684`temperature`\u53c2\u6570\u63d0\u4f9b\u4e86\u989d\u5916\u7684\u6570\u503c\u7a33\u5b9a\u6027\u548c\u68af\u5ea6\u8c03\u8282\u80fd\u529b\uff0c\u4f7f\u5176\u5728\u9c81\u68d2\u6027\u548c\u5b66\u4e60\u6548\u7387\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "pseudocode": "def AdaptiveScaledLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, temperature):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    \u8fd9\u4e2a\u601d\u60f3\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u6709\u4f53\u73b0\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u521b\u5efa\u4e00\u4e2a\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u3002\n    #    \u8fd9\u4e2a\u56e0\u5b50\u4e0e\u6210\u672c\u5dee\u5f02\u6b63\u76f8\u5173\uff0c\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\u3002\n    scaling_factor = softplus(cost_rank_diff)\n\n    # 4. [\u7ee7\u627f] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u65b0\u8026\u5408\u70b91 & 2] \u8ba1\u7b97\u7ecf\u81ea\u9002\u5e94\u7f29\u653e\u548c\u6e29\u5ea6\u8c03\u8282\u7684\u6982\u7387\u5dee\u5f02\u9879\u3002\n    #    \u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u7684\u201c\u52a0\u6743\u9879\u201d\u601d\u60f3\uff0c\u5e76\u5f15\u5165\u4e86\u65b0\u7684`temperature`\u8d85\u53c2\u6570\u8fdb\u884c\u68af\u5ea6\u8c03\u8282\u3002\n    #    temperature > 1 \u4f1a\u4f7f\u68af\u5ea6\u66f4\u5e73\u6ed1\uff0c< 1 \u4f1a\u4f7f\u68af\u5ea6\u66f4\u9661\u5ced\u3002\n    #    \u4e3a\u907f\u514d\u9664\u4ee5\u96f6\uff0c\u7ed9temperature\u52a0\u4e0a\u4e00\u4e2a\u5f88\u5c0f\u7684epsilon\u3002\n    scaled_logp_diff = (scaling_factor * stable_logp_diff) / (temperature + 1e-8)\n\n    # 6. [\u65b0\u8026\u5408\u70b91] \u5c06\u52a0\u6743\u9879\u8026\u5408\u5230\u5bf9\u6570\u51e0\u7387\u635f\u5931 (LogSigmoid) \u6846\u67b6\u4e2d\u3002\n    #    \u8fd9\u4e0e\u7236\u4ee3\u4f7f\u7528\u7684Hinge Loss\u7ed3\u6784\u4e0d\u540c\uff0c\u5b83\u76f4\u63a5\u6700\u5927\u5316\u52a0\u6743\u7684\u5bf9\u6570\u4f3c\u7136\u3002\n    #    -logsigmoid(x) \u7b49\u4ef7\u4e8e softplus(-x)\uff0c\u5728\u6570\u503c\u4e0a\u975e\u5e38\u7a33\u5b9a\u3002\n    #    \u5f53 scaled_logp_diff > 0 \u65f6\uff0c\u6211\u4eec\u5e0c\u671b\u5b83\u8d8a\u5927\u8d8a\u597d\uff0c\u635f\u5931\u8d8a\u5c0f\u3002\n    loss = -logsigmoid(scaled_logp_diff)\n\n    return loss", "hyperparams": {"temperature": {"value": 1.0, "description": "\u6e29\u5ea6\u56e0\u5b50\uff0c\u7528\u4e8e\u8c03\u8282\u68af\u5ea6\u7684\u5e45\u5ea6\u3002\u5927\u4e8e1.0\u65f6\uff0c\u4f1a\u7f29\u5c0f\u52a0\u6743\u6982\u7387\u5dee\u5f02\u9879\u7684\u6570\u503c\uff0c\u4f7f\u68af\u5ea6\u66f4\u5e73\u6ed1\uff0c\u5b66\u4e60\u66f4\u7a33\u5b9a\u3002\u5c0f\u4e8e1.0\u65f6\uff0c\u4f1a\u653e\u5927\u8be5\u9879\uff0c\u4f7f\u68af\u5ea6\u66f4\u9661\u5ced\uff0c\u5b66\u4e60\u66f4\u6fc0\u8fdb\u3002\u9ed8\u8ba4\u503c\u4e3a1.0\uff0c\u4e0d\u8d77\u7f29\u653e\u4f5c\u7528\u3002"}}, "operators_used": ["rank_gap", "softplus", "tanh", "logsigmoid"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor), and hyperparameter temperature (float). Tensors are of the same shape, e.g., (batch_size,)."], "returns": "A scalar Tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.104740858078003, "validation_objective": 4.104740858078003, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.066928148269653}, "train_score_mean": 4.276429243385792, "train_loss_mean": 0.6928292773663998, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u80fd\u5728\u6570\u503c\u4e0a\u4fdd\u6301\u7a33\u5b9a\uff0c\u540c\u65f6\u8fd8\u80fd\u81ea\u9002\u5e94\u5730\u8c03\u6574\u5b66\u4e60\u538b\u529b\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684`softplus(margin - term)`\u7684Hinge Loss\u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684`scaling_factor`\u6765\u52a0\u6743`logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u81ea\u9002\u5e94\u7f29\u653e\u7684\u5bf9\u6570\u51e0\u7387\u635f\u5931)**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u5173\u952e\u521b\u65b0\u3002\u6211\u4eec\u5c06\u7236\u4ee31\u4e2d\u7684\u201c\u52a0\u6743\u9879\u201d`scaled_logp_diff`\uff08\u5373 `scaling_factor * logp_diff`\uff09\u4e0e\u7ecf\u5178\u7684\u5bf9\u6570\u51e0\u7387\u635f\u5931\uff08Log-Likelihood Loss\uff09\u8fdb\u884c\u4e86\u8026\u5408\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u5c06`scaled_logp_diff`\u4f5c\u4e3a`logsigmoid`\u51fd\u6570\u7684\u8f93\u5165\uff0c\u5f97\u5230`loss = -logsigmoid(scaled_logp_diff)`\u3002\u8fd9\u4e0e\u76f4\u63a5\u4f7f\u7528`logp_diff`\u7684\u4f20\u7edfDPO\u635f\u5931\u4e0d\u540c\uff0c\u5b83\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u7684\u68af\u5ea6\u88ab`scaling_factor`\u653e\u5927\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u5bf9\u91cd\u8981\u6837\u672c\u7684\u201c\u91cd\u70b9\u5b66\u4e60\u201d\u3002\u8fd9\u79cd\u8bbe\u8ba1\u6bd4\u7236\u4ee31\u7684Hinge\u7ed3\u6784\u66f4\u76f4\u63a5\uff0c\u56e0\u4e3a\u5b83\u4e0d\u8bbe\u56fa\u5b9a\u7684\u88d5\u5ea6\uff0c\u800c\u662f\u9f13\u52b1`scaled_logp_diff`\u8d8a\u5927\u8d8a\u597d\uff0c\u7406\u8bba\u4e0a\u53ef\u4ee5\u65e0\u9650\u4f18\u5316\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u5f15\u5165\u6e29\u5ea6\u56e0\u5b50\u8fdb\u884c\u68af\u5ea6\u8c03\u8282)**\uff1a\u4e3a\u4e86\u589e\u52a0\u5bf9\u68af\u5ea6\u5e45\u5ea6\u7684\u63a7\u5236\uff0c\u6211\u4eec\u5728\u8ba1\u7b97`scaled_logp_diff`\u65f6\u5f15\u5165\u4e86\u4e00\u4e2a\u8d85\u53c2\u6570`temperature` (\u03c4)\u3002\u8ba1\u7b97\u516c\u5f0f\u53d8\u4e3a `scaled_logp_diff = scaling_factor * stable_logp_diff / temperature`\u3002\u8fd9\u4e2a`temperature`\u626e\u6f14\u4e86\u8c03\u8282\u68af\u5ea6\u7684\u89d2\u8272\uff1a\n    *   \u5f53 `temperature` > 1 \u65f6\uff0c\u5b83\u4f1a\u201c\u51b7\u5374\u201d\u7cfb\u7edf\uff0c\u7f29\u5c0f`scaled_logp_diff`\u7684\u6570\u503c\u8303\u56f4\uff0c\u4ece\u800c\u51cf\u5c0f\u68af\u5ea6\uff0c\u4f7f\u5f97\u5b66\u4e60\u8fc7\u7a0b\u66f4\u5e73\u6ed1\u3001\u7a33\u5b9a\uff0c\u5c24\u5176\u662f\u5728`logp_diff`\u6570\u503c\u8f83\u5927\u7684\u533a\u57df\u3002\n    *   \u5f53 `temperature` < 1 \u65f6\uff0c\u5b83\u4f1a\u201c\u52a0\u70ed\u201d\u7cfb\u7edf\uff0c\u653e\u5927`scaled_logp_diff`\uff0c\u4ece\u800c\u589e\u5927\u68af\u5ea6\uff0c\u4f7f\u5f97\u6a21\u578b\u5728\u533a\u5206\u6837\u672c\u5bf9\u65f6\u66f4\u52a0\u201c\u6fc0\u8fdb\u201d\u3002\n    \u8fd9\u4e2a\u8026\u5408\u70b9\u4e3a\u635f\u5931\u51fd\u6570\u589e\u52a0\u4e86\u4e00\u4e2a\u91cd\u8981\u7684\u8c03\u63a7\u65cb\u94ae\uff0c\u53ef\u4ee5\u5728\u7a33\u5b9a\u6027\u548c\u5b66\u4e60\u5f3a\u5ea6\u4e4b\u95f4\u8fdb\u884c\u6743\u8861\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee31\u7684\u201c\u81ea\u9002\u5e94\u52a0\u6743\u201d\u601d\u60f3\u4e0e\u7ecf\u5178\u7684\u5bf9\u6570\u51e0\u7387\u635f\u5931\u6846\u67b6\u76f8\u7ed3\u5408\uff0c\u521b\u9020\u4e86\u4e00\u79cd\u65b0\u7684\u3001\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u7684\u635f\u5931\u5f62\u5f0f\u3002\u540c\u65f6\uff0c\u5f15\u5165\u7684`temperature`\u53c2\u6570\u63d0\u4f9b\u4e86\u989d\u5916\u7684\u6570\u503c\u7a33\u5b9a\u6027\u548c\u68af\u5ea6\u8c03\u8282\u80fd\u529b\uff0c\u4f7f\u5176\u5728\u9c81\u68d2\u6027\u548c\u5b66\u4e60\u6548\u7387\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "hyperparams": {"temperature": {"value": 1.0, "description": "\u6e29\u5ea6\u56e0\u5b50\uff0c\u7528\u4e8e\u8c03\u8282\u68af\u5ea6\u7684\u5e45\u5ea6\u3002\u5927\u4e8e1.0\u65f6\uff0c\u4f1a\u7f29\u5c0f\u52a0\u6743\u6982\u7387\u5dee\u5f02\u9879\u7684\u6570\u503c\uff0c\u4f7f\u68af\u5ea6\u66f4\u5e73\u6ed1\uff0c\u5b66\u4e60\u66f4\u7a33\u5b9a\u3002\u5c0f\u4e8e1.0\u65f6\uff0c\u4f1a\u653e\u5927\u8be5\u9879\uff0c\u4f7f\u68af\u5ea6\u66f4\u9661\u5ced\uff0c\u5b66\u4e60\u66f4\u6fc0\u8fdb\u3002\u9ed8\u8ba4\u503c\u4e3a1.0\uff0c\u4e0d\u8d77\u7f29\u653e\u4f5c\u7528\u3002"}}, "operators_used": ["rank_gap", "softplus", "tanh", "logsigmoid"]}}}
{"generation": 5, "index": 3, "ir": {"name": "AdaptiveLogSigmoidHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u878d\u5408\u4e86Hinge Loss\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\uff08margin\uff09\u201d\u601d\u60f3\u548cLogSigmoid\u635f\u5931\u7684\u201c\u9690\u5f0f\u52a0\u6743\u201d\u601d\u60f3\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u5730\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u7edf\u4e00\u7684\u81ea\u9002\u5e94\u88d5\u5ea6\u4e0e\u7f29\u653e (Unified Adaptive Margin & Scaling) [\u8026\u5408\u70b91]**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u5173\u952e\u521b\u65b0\u3002\u7236\u4ee31\u4f7f\u7528\u4e86\u4e24\u4e2a\u72ec\u7acb\u7684\u3001\u90fd\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a`dynamic_margin` \u548c `scaling_factor`\u3002\u6211\u4eec\u8ba4\u4e3a\u8fd9\u53ef\u80fd\u5f15\u5165\u4e86\u5197\u4f59\u3002\u5728\u8fd9\u4e2a\u5b50\u4ee3\u4e2d\uff0c\u6211\u4eec\u5c06\u8fd9\u4e24\u8005\u7edf\u4e00\u3002\u6211\u4eec\u4e0d\u518d\u8bbe\u7f6e\u4e00\u4e2a\u72ec\u7acb\u7684 `dynamic_margin`\uff0c\u800c\u662f\u8ba9 `scaling_factor` \u672c\u8eab\u626e\u6f14\u88d5\u5ea6\u7684\u89d2\u8272\u3002\u635f\u5931\u51fd\u6570\u7684\u6838\u5fc3\u53d8\u4e3a `softplus(scaling_factor - logp_diff)`\u3002\u8fd9\u6837\u505a\u7b80\u5316\u4e86\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u88d5\u5ea6\u548c\u5bf9\u6570\u6982\u7387\u5dee\u7684\u7f29\u653e\u7531\u540c\u4e00\u4e2a\u9879 `scaling_factor` \u63a7\u5236\u3002\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff0c`scaling_factor` \u53d8\u5927\uff0c\u8fd9\u65e2\u63d0\u9ad8\u4e86\u88d5\u5ea6\u76ee\u6807\uff0c\u4e5f\uff08\u5728\u4e0b\u4e00\u6b65\u4e2d\uff09\u589e\u5f3a\u4e86\u5bf9 `logp_diff` \u7684\u7f29\u653e\u3002\n2.  **\u53cc\u91cd\u52a0\u6743\u7684\u5bf9\u6570\u6982\u7387\u5dee (Doubly-Weighted Log-Probability Difference) [\u8026\u5408\u70b92]**\uff1a\u5728\u65b0\u7684 `softplus(scaling_factor - logp_diff)` \u7ed3\u6784\u4e2d\uff0c\u4e3a\u4e86\u8fdb\u4e00\u6b65\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u91cd\u8981\u6027\uff0c\u6211\u4eec\u5c06 `logp_diff` \u4e5f\u7528 `scaling_factor` \u8fdb\u884c\u4e86\u52a0\u6743\uff0c\u5f62\u6210 `scaling_factor * logp_diff`\u3002\u56e0\u6b64\uff0c\u6700\u7ec8\u7684\u635f\u5931\u5f62\u5f0f\u4e3a `softplus(scaling_factor - scaling_factor * logp_diff)`\uff0c\u53ef\u4ee5\u56e0\u5f0f\u5206\u89e3\u4e3a `softplus(scaling_factor * (1 - logp_diff))`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5b9e\u73b0\u4e86\u201c\u53cc\u91cd\u52a0\u6743\u201d\uff1a\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff08`scaling_factor` \u5927\uff09\uff0c\u4e0d\u4ec5\u88d5\u5ea6\u76ee\u6807\u53d8\u9ad8\uff0c\u800c\u4e14\u6a21\u578b\u504f\u597d\u9879 `logp_diff` \u5bf9\u635f\u5931\u7684\u8d21\u732e\u4e5f\u88ab\u653e\u5927\u3002\u8fd9\u4f7f\u5f97\u6a21\u578b\u5728\u9762\u5bf9\u533a\u5206\u5ea6\u9ad8\u7684\u6837\u672c\u5bf9\u65f6\uff0c\u4f1a\u53d7\u5230\u66f4\u5f3a\u7684\u68af\u5ea6\u60e9\u7f5a\uff0c\u4ece\u800c\u66f4\u4e13\u6ce8\u4e8e\u5b66\u4e60\u8fd9\u4e9b\u91cd\u8981\u7684\u504f\u597d\u5173\u7cfb\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee3\u4e2d\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\u201d\u548c\u201c\u9690\u5f0f\u7f29\u653e\u201d\u4e24\u4e2a\u6982\u5ff5\u7edf\u4e00\u4e3a\u4e00\u4e2a\u81ea\u9002\u5e94\u56e0\u5b50 `scaling_factor`\uff0c\u5e76\u7528\u6b64\u56e0\u5b50\u5bf9Hinge Loss\u7684\u4e24\u4e2a\u90e8\u5206\uff08\u88d5\u5ea6\u548c\u7f6e\u4fe1\u5ea6\u9879\uff09\u540c\u65f6\u8fdb\u884c\u52a0\u6743\uff0c\u521b\u9020\u51fa\u4e00\u79cd\u65b0\u9896\u7684\u3001\u5bf9\u6210\u672c\u5dee\u5f02\u9ad8\u5ea6\u654f\u611f\u7684\u81ea\u9002\u5e94\u5b66\u4e60\u673a\u5236\u3002\u5b83\u4fdd\u7559\u4e86Hinge Loss\u7684\u660e\u786e\u76ee\u6807\u548cLogSigmoid\u7684\u52a8\u6001\u52a0\u6743\u7279\u6027\uff0c\u540c\u65f6\u7b80\u5316\u4e86\u8d85\u53c2\u6570\uff0c\u589e\u5f3a\u4e86\u5bf9\u5173\u952e\u6837\u672c\u7684\u5173\u6ce8\u5ea6\u3002", "pseudocode": "def AdaptiveLogSigmoidHingeLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    \u8fd9\u4e2a\u601d\u60f3\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u6709\u4f53\u73b0\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u521b\u5efa\u4e00\u4e2a\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u3002\n    #    \u8be5\u56e0\u5b50\u4e0e\u6210\u672c\u5dee\u5f02\u6b63\u76f8\u5173\uff0c\u7528\u4e8e\u52a0\u6743\u3002\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\u3002beta\u63a7\u5236\u5176\u654f\u611f\u5ea6\u3002\n    scaling_factor = beta * softplus(cost_rank_diff)\n\n    # 4. [\u7ee7\u627f] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u65b0\u8026\u5408\u70b91 & 2] \u8ba1\u7b97\u53cc\u91cd\u52a0\u6743\u7684Hinge\u635f\u5931\u3002\n    #    \u6211\u4eec\u5c06\u7236\u4ee31\u4e2d\u7684 `dynamic_margin` \u548c `scaled_logp_diff` \u7edf\u4e00\u4e86\u3002\n    #    \u73b0\u5728\uff0c`scaling_factor` \u540c\u65f6\u626e\u6f14\u4e86\u88d5\u5ea6\u548c\u52a0\u6743\u7cfb\u6570\u7684\u89d2\u8272\u3002\n    #    \u635f\u5931\u5f62\u5f0f\u4e3a: softplus(scaling_factor - scaling_factor * stable_logp_diff)\n    #    \u8fd9\u53ef\u4ee5\u5199\u4f5c: softplus(scaling_factor * (1 - stable_logp_diff))\n    #    \u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6 (`scaling_factor`\u5927)\uff0c\u6a21\u578b\u4e0d\u4ec5\u88ab\u8981\u6c42\u62c9\u5f00\u66f4\u5927\u7684\u5dee\u8ddd(1-stable_logp_diff\u8d8b\u8fd1\u4e8e0)\uff0c\n    #    \u800c\u4e14\u8fd9\u4e2a\u8981\u6c42\u672c\u8eab\u4e5f\u88ab\u653e\u5927\u4e86\uff0c\u4ece\u800c\u5bf9\u91cd\u8981\u6837\u672c\u65bd\u52a0\u5f3a\u5927\u7684\u5b66\u4e60\u538b\u529b\u3002\n    loss = softplus(scaling_factor * (1 - stable_logp_diff))\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u7684\u654f\u611f\u5ea6\u63a7\u5236\u5668\u3002\u5b83\u8c03\u8282\u4e86\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\u88ab\u8f6c\u5316\u4e3a\u7edf\u4e00\u88d5\u5ea6\u548c\u52a0\u6743\u7cfb\u6570\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u79e9\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u533a\u5206\u5ea6\u3002"}}, "operators_used": ["rank_gap", "softplus", "tanh"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor), beta (float). Tensors are of shape (B,), where B is the batch size. cost_a[i] and cost_b[i] represent the costs of a pair of samples, and logp_a[i], logp_b[i] are their corresponding log probabilities from the model."], "returns": "A scalar Tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.06027889251709, "validation_objective": 4.06027889251709, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.036724925041199}, "train_score_mean": 4.28562705218792, "train_loss_mean": 0.6928270030766726, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveLogSigmoidHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u878d\u5408\u4e86Hinge Loss\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\uff08margin\uff09\u201d\u601d\u60f3\u548cLogSigmoid\u635f\u5931\u7684\u201c\u9690\u5f0f\u52a0\u6743\u201d\u601d\u60f3\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u5730\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u7edf\u4e00\u7684\u81ea\u9002\u5e94\u88d5\u5ea6\u4e0e\u7f29\u653e (Unified Adaptive Margin & Scaling) [\u8026\u5408\u70b91]**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u5173\u952e\u521b\u65b0\u3002\u7236\u4ee31\u4f7f\u7528\u4e86\u4e24\u4e2a\u72ec\u7acb\u7684\u3001\u90fd\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a`dynamic_margin` \u548c `scaling_factor`\u3002\u6211\u4eec\u8ba4\u4e3a\u8fd9\u53ef\u80fd\u5f15\u5165\u4e86\u5197\u4f59\u3002\u5728\u8fd9\u4e2a\u5b50\u4ee3\u4e2d\uff0c\u6211\u4eec\u5c06\u8fd9\u4e24\u8005\u7edf\u4e00\u3002\u6211\u4eec\u4e0d\u518d\u8bbe\u7f6e\u4e00\u4e2a\u72ec\u7acb\u7684 `dynamic_margin`\uff0c\u800c\u662f\u8ba9 `scaling_factor` \u672c\u8eab\u626e\u6f14\u88d5\u5ea6\u7684\u89d2\u8272\u3002\u635f\u5931\u51fd\u6570\u7684\u6838\u5fc3\u53d8\u4e3a `softplus(scaling_factor - logp_diff)`\u3002\u8fd9\u6837\u505a\u7b80\u5316\u4e86\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u88d5\u5ea6\u548c\u5bf9\u6570\u6982\u7387\u5dee\u7684\u7f29\u653e\u7531\u540c\u4e00\u4e2a\u9879 `scaling_factor` \u63a7\u5236\u3002\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff0c`scaling_factor` \u53d8\u5927\uff0c\u8fd9\u65e2\u63d0\u9ad8\u4e86\u88d5\u5ea6\u76ee\u6807\uff0c\u4e5f\uff08\u5728\u4e0b\u4e00\u6b65\u4e2d\uff09\u589e\u5f3a\u4e86\u5bf9 `logp_diff` \u7684\u7f29\u653e\u3002\n2.  **\u53cc\u91cd\u52a0\u6743\u7684\u5bf9\u6570\u6982\u7387\u5dee (Doubly-Weighted Log-Probability Difference) [\u8026\u5408\u70b92]**\uff1a\u5728\u65b0\u7684 `softplus(scaling_factor - logp_diff)` \u7ed3\u6784\u4e2d\uff0c\u4e3a\u4e86\u8fdb\u4e00\u6b65\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u91cd\u8981\u6027\uff0c\u6211\u4eec\u5c06 `logp_diff` \u4e5f\u7528 `scaling_factor` \u8fdb\u884c\u4e86\u52a0\u6743\uff0c\u5f62\u6210 `scaling_factor * logp_diff`\u3002\u56e0\u6b64\uff0c\u6700\u7ec8\u7684\u635f\u5931\u5f62\u5f0f\u4e3a `softplus(scaling_factor - scaling_factor * logp_diff)`\uff0c\u53ef\u4ee5\u56e0\u5f0f\u5206\u89e3\u4e3a `softplus(scaling_factor * (1 - logp_diff))`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5b9e\u73b0\u4e86\u201c\u53cc\u91cd\u52a0\u6743\u201d\uff1a\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff08`scaling_factor` \u5927\uff09\uff0c\u4e0d\u4ec5\u88d5\u5ea6\u76ee\u6807\u53d8\u9ad8\uff0c\u800c\u4e14\u6a21\u578b\u504f\u597d\u9879 `logp_diff` \u5bf9\u635f\u5931\u7684\u8d21\u732e\u4e5f\u88ab\u653e\u5927\u3002\u8fd9\u4f7f\u5f97\u6a21\u578b\u5728\u9762\u5bf9\u533a\u5206\u5ea6\u9ad8\u7684\u6837\u672c\u5bf9\u65f6\uff0c\u4f1a\u53d7\u5230\u66f4\u5f3a\u7684\u68af\u5ea6\u60e9\u7f5a\uff0c\u4ece\u800c\u66f4\u4e13\u6ce8\u4e8e\u5b66\u4e60\u8fd9\u4e9b\u91cd\u8981\u7684\u504f\u597d\u5173\u7cfb\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee3\u4e2d\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\u201d\u548c\u201c\u9690\u5f0f\u7f29\u653e\u201d\u4e24\u4e2a\u6982\u5ff5\u7edf\u4e00\u4e3a\u4e00\u4e2a\u81ea\u9002\u5e94\u56e0\u5b50 `scaling_factor`\uff0c\u5e76\u7528\u6b64\u56e0\u5b50\u5bf9Hinge Loss\u7684\u4e24\u4e2a\u90e8\u5206\uff08\u88d5\u5ea6\u548c\u7f6e\u4fe1\u5ea6\u9879\uff09\u540c\u65f6\u8fdb\u884c\u52a0\u6743\uff0c\u521b\u9020\u51fa\u4e00\u79cd\u65b0\u9896\u7684\u3001\u5bf9\u6210\u672c\u5dee\u5f02\u9ad8\u5ea6\u654f\u611f\u7684\u81ea\u9002\u5e94\u5b66\u4e60\u673a\u5236\u3002\u5b83\u4fdd\u7559\u4e86Hinge Loss\u7684\u660e\u786e\u76ee\u6807\u548cLogSigmoid\u7684\u52a8\u6001\u52a0\u6743\u7279\u6027\uff0c\u540c\u65f6\u7b80\u5316\u4e86\u8d85\u53c2\u6570\uff0c\u589e\u5f3a\u4e86\u5bf9\u5173\u952e\u6837\u672c\u7684\u5173\u6ce8\u5ea6\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u7684\u654f\u611f\u5ea6\u63a7\u5236\u5668\u3002\u5b83\u8c03\u8282\u4e86\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\u88ab\u8f6c\u5316\u4e3a\u7edf\u4e00\u88d5\u5ea6\u548c\u52a0\u6743\u7cfb\u6570\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u79e9\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u533a\u5206\u5ea6\u3002"}}, "operators_used": ["rank_gap", "softplus", "tanh"]}}}
{"generation": 5, "index": 5, "ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165Z-score\u5f52\u4e00\u5316\u6765\u52a8\u6001\u8c03\u6574\u5b66\u4e60\u4fe1\u53f7\uff0c\u4f7f\u5f97\u6a21\u578b\u80fd\u591f\u66f4\u597d\u5730\u9002\u5e94\u4e0d\u540c\u6279\u6b21\uff08batch\uff09\u6570\u636e\u7684\u6210\u672c\u5206\u5e03\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6\uff08Hybrid Margin\uff09\u201d\u601d\u60f3\uff0c\u5373\u635f\u5931\u51fd\u6570\u540c\u65f6\u5305\u542b\u4e00\u4e2a\u660e\u786e\u7684\u52a8\u6001\u88d5\u5ea6\uff08`dynamic_margin`\uff09\u548c\u4e00\u4e2a\u7531\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u5bf9\u6570\u6982\u7387\u9879\uff08`scaled_logp_diff`\uff09\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u91cd\u8981\u6837\u672c\u5bf9\uff08\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\uff09\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\u5177\u4f53\u8868\u73b0\u4e3a`softplus(dynamic_margin - scaled_logp_diff)`\u7684\u6574\u4f53\u7ed3\u6784\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u4f7f\u7528`tanh`\u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\uff08`logp_w - logp_l`\uff09\u7684\u6280\u5de7\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u9879\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u6709\u754c\u7684\u8303\u56f4\u5185\uff08[-1, 1]\uff09\uff0c\u4ece\u800c\u9632\u6b62\u4e86\u56e0\u6982\u7387\u5dee\u5f02\u8fc7\u5927\u800c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u5173\u952e\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684`rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86`zscore`\u5f52\u4e00\u5316\u3002`cost_diff_zscore = zscore(cost_l - cost_w)`\u4f1a\u8ba1\u7b97\u5f53\u524d\u6279\u6b21\u5185\u6240\u6709\u6210\u672c\u5dee\u5f02\u7684Z-score\u3002\u8fd9\u79cd\u505a\u6cd5\u6709\u4e24\u5927\u597d\u5904\uff1a(1) **\u52a8\u6001\u9002\u5e94\u6027**\uff1a\u635f\u5931\u7684\u5c3a\u5ea6\u4f1a\u6839\u636e\u5f53\u524d\u6279\u6b21\u6570\u636e\u7684\u6210\u672c\u5dee\u5f02\u5206\u5e03\u81ea\u52a8\u8c03\u6574\u3002\u5982\u679c\u6279\u6b21\u5185\u5dee\u5f02\u666e\u904d\u8f83\u5c0f\uff0c\u4e00\u4e2a\u5fae\u5c0f\u7684\u5dee\u5f02\u4e5f\u4f1a\u88ab\u653e\u5927\uff1b\u53cd\u4e4b\uff0c\u5982\u679c\u5dee\u5f02\u666e\u904d\u5f88\u5927\uff0c\u4e00\u4e2a\u4e2d\u7b49\u5927\u5c0f\u7684\u5dee\u5f02\u53ef\u80fd\u53ea\u5f97\u5230\u4e00\u4e2a\u666e\u901a\u7684Z-score\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u5bf9\u6570\u636e\u5206\u5e03\u66f4\u52a0\u9c81\u68d2\u3002(2) **\u4fe1\u53f7\u589e\u5f3a**\uff1a\u5b83\u5c06\u539f\u59cb\u7684\u6210\u672c\u5dee\u5f02\u8f6c\u5316\u4e3a\u4e86\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u3001\u4ee50\u4e3a\u4e2d\u5fc3\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u4fe1\u53f7\uff0c\u8fd9\u4f7f\u5f97\u8d85\u53c2\u6570`beta`\u548c`gamma`\u7684\u8c03\u4f18\u53ef\u80fd\u53d8\u5f97\u66f4\u5bb9\u6613\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u8f93\u5165\u5c3a\u5ea6\u662f\u56fa\u5b9a\u7684\u3002\n2.  **\u53cc\u91cdZ-score\u8026\u5408 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5c06\u8ba1\u7b97\u51fa\u7684`cost_diff_zscore`\u540c\u65f6\u7528\u4e8e\u4e24\u4e2a\u5730\u65b9\uff0c\u5f62\u6210\u4e86\u4e00\u79cd\u65b0\u7684\u8026\u5408\u673a\u5236\u3002\u9996\u5148\uff0c\u5b83\u901a\u8fc7`dynamic_margin = beta * softplus(cost_diff_zscore)`\u6765\u8bbe\u5b9a\u4e00\u4e2a\u975e\u8d1f\u7684\u3001\u52a8\u6001\u7684\u88d5\u5ea6\u76ee\u6807\u3002\u5176\u6b21\uff0c\u5b83\u901a\u8fc7`scaling_factor = gamma * softplus(cost_diff_zscore)`\u6765\u8ba1\u7b97\u4e00\u4e2a\u975e\u8d1f\u7684\u7f29\u653e\u56e0\u5b50\uff0c\u7528\u4e8e\u52a0\u6743\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u3002`softplus`\u786e\u4fdd\u4e86\u5373\u4f7fZ-score\u4e3a\u8d1f\uff08\u5373\u6210\u672c\u5dee\u5f02\u5c0f\u4e8e\u6279\u6b21\u5e73\u5747\u503c\uff09\uff0c\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u4e5f\u4fdd\u6301\u4e3a\u6b63\u503c\uff0c\u907f\u514d\u4e86\u60e9\u7f5a\u65b9\u5411\u7684\u7ffb\u8f6c\uff0c\u540c\u65f6\u4fdd\u6301\u4e86\u68af\u5ea6\u7684\u5e73\u6ed1\u3002\n\n\u603b\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7Z-score\u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6279\u6b21\u6570\u636e\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u5e76\u5c06\u5176\u540c\u65f6\u8026\u5408\u5230\u88d5\u5ea6\u8ba1\u7b97\u548c\u7f6e\u4fe1\u5ea6\u52a0\u6743\u4e2d\uff0c\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u6df7\u5408\u88d5\u5ea6\u7ed3\u6784\u548c`tanh`\u7a33\u5b9a\u6280\u5de7\uff0c\u65e8\u5728\u5b9e\u73b0\u66f4\u7a33\u5065\u3001\u66f4\u81ea\u9002\u5e94\u7684\u504f\u597d\u5b66\u4e60\u3002", "pseudocode": "def ZScoreNormalizedHybridLoss(cost_a, cost_b, logp_a, logp_b, beta, gamma):\n    # \u5047\u8bbe cost_a, cost_b, logp_a, logp_b \u90fd\u662f\u4e00\u4e2a\u6279\u6b21(batch)\u7684\u5f20\u91cf\u3002\n\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    is_a_winner = cost_a < cost_b\n    cost_w = where(is_a_winner, cost_a, cost_b)\n    cost_l = where(is_a_winner, cost_b, cost_a)\n    logp_w = where(is_a_winner, logp_a, logp_b)\n    logp_l = where(is_a_winner, logp_b, logp_a)\n\n    # 2. \u8ba1\u7b97\u6210\u672c\u5dee\u5f02\n    cost_diff = cost_l - cost_w\n\n    # 3. [\u65b0\u8026\u5408\u70b91] \u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884cZ-score\u5f52\u4e00\u5316\n    #    \u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u5f53\u524d\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\u5177\u6709\u81ea\u9002\u5e94\u6027\u3002\n    #    zscore(x) = (x - mean(x)) / std(x)\n    cost_diff_zscore = zscore(cost_diff)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31 & \u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u52a8\u6001\u88d5\u5ea6\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u88d5\u5ea6\u4e3a\u975e\u8d1f\uff0c\u5373\u4f7fz-score\u4e3a\u8d1f\u3002\n    dynamic_margin = beta * softplus(cost_diff_zscore)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31 & \u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\n    #    \u540c\u6837\u4f7f\u7528 z-score\uff0c\u5e76\u5c06 gamma \u4f5c\u4e3a\u72ec\u7acb\u7684\u8d85\u53c2\u6570\u3002\n    scaling_factor = gamma * softplus(cost_diff_zscore)\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 7. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\n    #    \u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u8be5\u9879\u5f71\u54cd\u8d8a\u5927\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 8. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u6700\u7ec8\u7684\u6df7\u5408\u88d5\u5ea6\u635f\u5931\n    #    \u5f53\u6a21\u578b\u7684\u52a0\u6743\u7f6e\u4fe1\u5ea6(scaled_logp_diff)\u5c0f\u4e8e\u52a8\u6001\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    loss = softplus(dynamic_margin - scaled_logp_diff)\n\n    # \u8fd4\u56de\u8be5\u6279\u6b21\u6240\u6709\u6837\u672c\u635f\u5931\u7684\u5e73\u5747\u503c\n    return mean(loss)", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\uff08Z-score\uff09\u5982\u4f55\u8f6c\u5316\u4e3a\u4e00\u4e2a\u660e\u786e\u7684\u88d5\u5ea6\u76ee\u6807\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u76f8\u5bf9\u8f83\u5927\u7684\u6837\u672c\u5bf9\u9700\u8981\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u7f6e\u4fe1\u5ea6\u5dee\u8ddd\u3002"}, "gamma": {"value": 1.0, "description": "\u7f6e\u4fe1\u5ea6\u52a0\u6743\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\uff08Z-score\uff09\u5982\u4f55\u53bb\u52a0\u6743\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u9879\uff08stable_logp_diff\uff09\u3002\u8f83\u5927\u7684gamma\u503c\u4f1a\u653e\u5927\u6210\u672c\u5dee\u5f02\u5bf9\u6700\u7ec8\u635f\u5931\u68af\u5ea6\u7684\u5f71\u54cd\u3002"}}, "operators_used": ["zscore", "softplus", "tanh"], "implementation_hint": {"expects": ["Tensors cost_a, cost_b, logp_a, logp_b of shape [batch_size]. The zscore operator is expected to work across the batch dimension."], "returns": "A single scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.200515508651733, "validation_objective": 4.200515508651733, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.169320583343506}, "train_score_mean": 4.293297633528709, "train_loss_mean": 0.6927961204200983, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165Z-score\u5f52\u4e00\u5316\u6765\u52a8\u6001\u8c03\u6574\u5b66\u4e60\u4fe1\u53f7\uff0c\u4f7f\u5f97\u6a21\u578b\u80fd\u591f\u66f4\u597d\u5730\u9002\u5e94\u4e0d\u540c\u6279\u6b21\uff08batch\uff09\u6570\u636e\u7684\u6210\u672c\u5206\u5e03\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6\uff08Hybrid Margin\uff09\u201d\u601d\u60f3\uff0c\u5373\u635f\u5931\u51fd\u6570\u540c\u65f6\u5305\u542b\u4e00\u4e2a\u660e\u786e\u7684\u52a8\u6001\u88d5\u5ea6\uff08`dynamic_margin`\uff09\u548c\u4e00\u4e2a\u7531\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u5bf9\u6570\u6982\u7387\u9879\uff08`scaled_logp_diff`\uff09\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u91cd\u8981\u6837\u672c\u5bf9\uff08\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\uff09\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\u5177\u4f53\u8868\u73b0\u4e3a`softplus(dynamic_margin - scaled_logp_diff)`\u7684\u6574\u4f53\u7ed3\u6784\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u4f7f\u7528`tanh`\u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\uff08`logp_w - logp_l`\uff09\u7684\u6280\u5de7\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u9879\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u6709\u754c\u7684\u8303\u56f4\u5185\uff08[-1, 1]\uff09\uff0c\u4ece\u800c\u9632\u6b62\u4e86\u56e0\u6982\u7387\u5dee\u5f02\u8fc7\u5927\u800c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u5173\u952e\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684`rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86`zscore`\u5f52\u4e00\u5316\u3002`cost_diff_zscore = zscore(cost_l - cost_w)`\u4f1a\u8ba1\u7b97\u5f53\u524d\u6279\u6b21\u5185\u6240\u6709\u6210\u672c\u5dee\u5f02\u7684Z-score\u3002\u8fd9\u79cd\u505a\u6cd5\u6709\u4e24\u5927\u597d\u5904\uff1a(1) **\u52a8\u6001\u9002\u5e94\u6027**\uff1a\u635f\u5931\u7684\u5c3a\u5ea6\u4f1a\u6839\u636e\u5f53\u524d\u6279\u6b21\u6570\u636e\u7684\u6210\u672c\u5dee\u5f02\u5206\u5e03\u81ea\u52a8\u8c03\u6574\u3002\u5982\u679c\u6279\u6b21\u5185\u5dee\u5f02\u666e\u904d\u8f83\u5c0f\uff0c\u4e00\u4e2a\u5fae\u5c0f\u7684\u5dee\u5f02\u4e5f\u4f1a\u88ab\u653e\u5927\uff1b\u53cd\u4e4b\uff0c\u5982\u679c\u5dee\u5f02\u666e\u904d\u5f88\u5927\uff0c\u4e00\u4e2a\u4e2d\u7b49\u5927\u5c0f\u7684\u5dee\u5f02\u53ef\u80fd\u53ea\u5f97\u5230\u4e00\u4e2a\u666e\u901a\u7684Z-score\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u5bf9\u6570\u636e\u5206\u5e03\u66f4\u52a0\u9c81\u68d2\u3002(2) **\u4fe1\u53f7\u589e\u5f3a**\uff1a\u5b83\u5c06\u539f\u59cb\u7684\u6210\u672c\u5dee\u5f02\u8f6c\u5316\u4e3a\u4e86\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u3001\u4ee50\u4e3a\u4e2d\u5fc3\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u4fe1\u53f7\uff0c\u8fd9\u4f7f\u5f97\u8d85\u53c2\u6570`beta`\u548c`gamma`\u7684\u8c03\u4f18\u53ef\u80fd\u53d8\u5f97\u66f4\u5bb9\u6613\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u8f93\u5165\u5c3a\u5ea6\u662f\u56fa\u5b9a\u7684\u3002\n2.  **\u53cc\u91cdZ-score\u8026\u5408 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5c06\u8ba1\u7b97\u51fa\u7684`cost_diff_zscore`\u540c\u65f6\u7528\u4e8e\u4e24\u4e2a\u5730\u65b9\uff0c\u5f62\u6210\u4e86\u4e00\u79cd\u65b0\u7684\u8026\u5408\u673a\u5236\u3002\u9996\u5148\uff0c\u5b83\u901a\u8fc7`dynamic_margin = beta * softplus(cost_diff_zscore)`\u6765\u8bbe\u5b9a\u4e00\u4e2a\u975e\u8d1f\u7684\u3001\u52a8\u6001\u7684\u88d5\u5ea6\u76ee\u6807\u3002\u5176\u6b21\uff0c\u5b83\u901a\u8fc7`scaling_factor = gamma * softplus(cost_diff_zscore)`\u6765\u8ba1\u7b97\u4e00\u4e2a\u975e\u8d1f\u7684\u7f29\u653e\u56e0\u5b50\uff0c\u7528\u4e8e\u52a0\u6743\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u3002`softplus`\u786e\u4fdd\u4e86\u5373\u4f7fZ-score\u4e3a\u8d1f\uff08\u5373\u6210\u672c\u5dee\u5f02\u5c0f\u4e8e\u6279\u6b21\u5e73\u5747\u503c\uff09\uff0c\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u4e5f\u4fdd\u6301\u4e3a\u6b63\u503c\uff0c\u907f\u514d\u4e86\u60e9\u7f5a\u65b9\u5411\u7684\u7ffb\u8f6c\uff0c\u540c\u65f6\u4fdd\u6301\u4e86\u68af\u5ea6\u7684\u5e73\u6ed1\u3002\n\n\u603b\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7Z-score\u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6279\u6b21\u6570\u636e\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u5e76\u5c06\u5176\u540c\u65f6\u8026\u5408\u5230\u88d5\u5ea6\u8ba1\u7b97\u548c\u7f6e\u4fe1\u5ea6\u52a0\u6743\u4e2d\uff0c\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u6df7\u5408\u88d5\u5ea6\u7ed3\u6784\u548c`tanh`\u7a33\u5b9a\u6280\u5de7\uff0c\u65e8\u5728\u5b9e\u73b0\u66f4\u7a33\u5065\u3001\u66f4\u81ea\u9002\u5e94\u7684\u504f\u597d\u5b66\u4e60\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\uff08Z-score\uff09\u5982\u4f55\u8f6c\u5316\u4e3a\u4e00\u4e2a\u660e\u786e\u7684\u88d5\u5ea6\u76ee\u6807\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u76f8\u5bf9\u8f83\u5927\u7684\u6837\u672c\u5bf9\u9700\u8981\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u7f6e\u4fe1\u5ea6\u5dee\u8ddd\u3002"}, "gamma": {"value": 1.0, "description": "\u7f6e\u4fe1\u5ea6\u52a0\u6743\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\uff08Z-score\uff09\u5982\u4f55\u53bb\u52a0\u6743\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u9879\uff08stable_logp_diff\uff09\u3002\u8f83\u5927\u7684gamma\u503c\u4f1a\u653e\u5927\u6210\u672c\u5dee\u5f02\u5bf9\u6700\u7ec8\u635f\u5931\u68af\u5ea6\u7684\u5f71\u54cd\u3002"}}, "operators_used": ["zscore", "softplus", "tanh"]}}}
{"generation": 5, "index": 6, "ir": {"name": "ZScoredDynamicMarginLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u5b66\u4e60\u5f3a\u5ea6\uff0c\u53c8\u5bf9\u6210\u672c\u548c\u5bf9\u6570\u6982\u7387\u7684\u5206\u5e03\u5177\u6709\u9c81\u68d2\u6027\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1. **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - logp_diff)` Hinge Loss \u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6 (`logp_diff`) \u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6 (`margin`)\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4e3a\u6a21\u578b\u63d0\u4f9b\u4e86\u6e05\u6670\u7684\u4f18\u5316\u65b9\u5411\u3002\n2. **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\u3002\u5728\u7236\u4ee31\u4e2d\uff0c\u6210\u672c\u5dee\u5f02\u540c\u65f6\u5f71\u54cd\u4e86`dynamic_margin`\u548c`scaled_logp_diff`\u3002\u5728\u672c\u8bbe\u8ba1\u4e2d\uff0c\u6211\u4eec\u867d\u7136\u6ca1\u6709\u76f4\u63a5\u7f29\u653e`logp_diff`\uff0c\u4f46\u901a\u8fc7\u5bf9`logp`\u548c`cost`\u8fdb\u884c\u6279\u6b21\u5185\u7684Z-Score\u5f52\u4e00\u5316\uff0c\u4f7f\u5f97`logp_diff`\u548c`cost_diff`\u7684\u8ba1\u7b97\u90fd\u9690\u5f0f\u5730\u53d7\u5230\u4e86\u6279\u6b21\u5185\u5176\u4ed6\u6837\u672c\u5206\u5e03\u7684\u5f71\u54cd\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\uff08\u548c\u6982\u7387\uff09\u5dee\u5f02\u7684\u81ea\u9002\u5e94\u611f\u77e5\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1. **\u6279\u6b21\u5185Z-Score\u5f52\u4e00\u5316 (\u8026\u5408\u70b91)**\uff1a\u8fd9\u662f\u672c\u8bbe\u8ba1\u7684\u6838\u5fc3\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `rank_gap` \u6216\u539f\u59cb\u6210\u672c\u5dee\u5f02\uff0c\u800c\u662f\u5728\u8ba1\u7b97\u4efb\u4f55\u5dee\u5f02\u4e4b\u524d\uff0c\u5148\u5bf9\u6279\u6b21\u5185\u6240\u6709\u7684`cost`\u548c`logp`\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\uff08`zscore`\u7b97\u5b50\uff09\u3002\u8fd9\u6837\u505a\u6709\u4e24\u5927\u597d\u5904\uff1a\u9996\u5148\uff0c\u5b83\u4f7f\u5f97\u635f\u5931\u5bf9`cost`\u548c`logp`\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u6781\u5927\u5730\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u80fd\u6709\u6548\u5904\u7406\u4e0d\u540c\u6279\u6b21\u95f4\u6570\u503c\u8303\u56f4\u5267\u70c8\u53d8\u5316\u7684\u60c5\u51b5\u3002\u5176\u6b21\uff0c\u5f52\u4e00\u5316\u540e\u7684\u503c\u53cd\u6620\u4e86\u6bcf\u4e2a\u6837\u672c\u5728\u5176\u6279\u6b21\u5206\u5e03\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff0c\u8fd9\u4f7f\u5f97\u540e\u7eed\u8ba1\u7b97\u7684`cost_diff`\u548c`logp_diff`\u90fd\u5177\u6709\u4e86\u201c\u4e0a\u4e0b\u6587\u611f\u77e5\u201d\u7684\u80fd\u529b\uff0c\u8ba9\u6a21\u578b\u66f4\u5173\u6ce8\u6279\u6b21\u5185\u7684\u76f8\u5bf9\u4f18\u52a3\uff0c\u800c\u975e\u7edd\u5bf9\u6570\u503c\u5dee\u5f02\u3002\n2. **\u57fa\u4e8e\u5f52\u4e00\u5316\u6210\u672c\u7684\u52a8\u6001\u88d5\u5ea6 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5c06Z-Score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_cost_diff` \u76f4\u63a5\u7528\u4f5c\u52a8\u6001\u88d5\u5ea6\u7684\u57fa\u7840\u3002\u5177\u4f53\u6765\u8bf4\uff0c`dynamic_margin = beta * z_cost_diff`\u3002\u8fd9\u4e2a\u8bbe\u8ba1\u8026\u5408\u4e86Z-Score\u5f52\u4e00\u5316\u548cHinge Loss\u7ed3\u6784\u3002\u4e0e\u7236\u4ee3\u4e2d\u57fa\u4e8e`rank_gap`\u7684\u88d5\u5ea6\u4e0d\u540c\uff0c`z_cost_diff`\u4fdd\u7559\u4e86\u66f4\u591a\u5173\u4e8e\u6210\u672c\u5dee\u5f02\u5927\u5c0f\u7684\u6bd4\u4f8b\u4fe1\u606f\uff08\u800c`rank_gap`\u53ea\u5173\u5fc3\u6392\u5e8f\uff09\uff0c\u540c\u65f6\u53c8\u901a\u8fc7\u5f52\u4e00\u5316\u907f\u514d\u4e86\u539f\u59cb\u6210\u672c\u5dee\u5f02\u53ef\u80fd\u5e26\u6765\u7684\u6781\u7aef\u503c\u95ee\u9898\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u8bbe\u5b9a\u65e2\u7a33\u5b9a\u53c8\u4fdd\u7559\u4e86\u8db3\u591f\u7684\u52a8\u6001\u6027\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5f15\u5165Z-Score\u5f52\u4e00\u5316\uff0c\u5c06\u7236\u4ee3\u4e2d\u7684Hinge Loss\u7ed3\u6784\u548c\u52a8\u6001\u88d5\u5ea6\u601d\u60f3\u63d0\u5347\u5230\u4e86\u4e00\u4e2a\u5bf9\u6570\u636e\u5206\u5e03\u66f4\u5177\u9c81\u68d2\u6027\u7684\u65b0\u5c42\u6b21\u3002\u5b83\u4e0d\u518d\u5b64\u7acb\u5730\u770b\u5f85\u6bcf\u4e00\u5bf9\u6837\u672c\uff0c\u800c\u662f\u5c06\u5b83\u4eec\u7f6e\u4e8e\u6279\u6b21\u7684\u4e0a\u4e0b\u6587\u4e2d\u8fdb\u884c\u6bd4\u8f83\uff0c\u4ece\u800c\u5b9e\u73b0\u66f4\u7a33\u5b9a\u548c\u81ea\u9002\u5e94\u7684\u504f\u597d\u5b66\u4e60\u3002", "pseudocode": "def ZScoredDynamicMarginLoss(batch_costs, batch_logps, beta):\n    # batch_costs: [cost_a1, cost_b1, cost_a2, cost_b2, ...]\n    # batch_logps: [logp_a1, logp_b1, logp_a2, logp_b2, ...]\n\n    # 1. [\u65b0\u8026\u5408\u70b91] \u5bf9\u6574\u4e2a\u6279\u6b21\u5185\u7684\u6210\u672c\u548c\u5bf9\u6570\u6982\u7387\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\n    #    \u8fd9\u4f7f\u5f97\u540e\u7eed\u8ba1\u7b97\u5bf9\u7edd\u5bf9\u5c3a\u5ea6\u4e0d\u654f\u611f\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\u3002\n    z_costs = zscore(batch_costs)\n    z_logps = zscore(batch_logps)\n\n    # \u5c06\u5f52\u4e00\u5316\u540e\u7684\u5f20\u91cf\u91cd\u65b0\u914d\u5bf9\n    z_cost_as = z_costs[0::2]\n    z_cost_bs = z_costs[1::2]\n    z_logp_as = z_logps[0::2]\n    z_logp_bs = z_logps[1::2]\n\n    # 2. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u6839\u636e\u539f\u59cb\u6210\u672c\uff08\u800c\u975e\u5f52\u4e00\u5316\u6210\u672c\uff09\u6765\u786e\u5b9a\u504f\u597d\u5173\u7cfb\u3002\n    original_cost_as = batch_costs[0::2]\n    original_cost_bs = batch_costs[1::2]\n    is_a_winner = original_cost_as < original_cost_bs\n\n    z_cost_w = where(is_a_winner, z_cost_as, z_cost_bs)\n    z_cost_l = where(is_a_winner, z_cost_bs, z_cost_as)\n    z_logp_w = where(is_a_winner, z_logp_as, z_logp_bs)\n    z_logp_l = where(is_a_winner, z_logp_bs, z_logp_as)\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u57fa\u4e8e\u5f52\u4e00\u5316\u6210\u672c\u8ba1\u7b97\u52a8\u6001\u88d5\u5ea6\n    #    \u7ee7\u627f\u81ea\u7236\u4ee30\u7684\u52a8\u6001\u88d5\u5ea6\u601d\u60f3\uff0c\u4f46\u4f5c\u7528\u4e8e\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u3002\n    #    z_cost_l - z_cost_w \u671f\u671b\u4e3a\u6b63\u503c\u3002\n    z_cost_diff = z_cost_l - z_cost_w\n    dynamic_margin = beta * z_cost_diff\n\n    # 4. \u8ba1\u7b97\u5f52\u4e00\u5316\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\n    #    \u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u4e0a\u4e0b\u6587\u611f\u77e5\u601d\u60f3\uff0c\u901a\u8fc7Z-Score\u5b9e\u73b0\u3002\n    #    z_logp_w - z_logp_l \u671f\u671b\u4e3a\u6b63\u503c\u3002\n    z_logp_diff = z_logp_w - z_logp_l\n\n    # 5. [\u7ee7\u627f] \u8ba1\u7b97Hinge Loss\n    #    \u7ee7\u627f\u81ea\u7236\u4ee30\u7684 `softplus(margin - term)` \u6838\u5fc3\u7ed3\u6784\u3002\n    #    \u5f53\u5f52\u4e00\u5316\u7684\u6982\u7387\u5dee\u5f02 z_logp_diff \u5c0f\u4e8e\u52a8\u6001\u88d5\u5ea6\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    #    \u7531\u4e8e z_cost_diff \u548c z_logp_diff \u90fd\u88ab\u5f52\u4e00\u5316\uff0c\u5b83\u4eec\u7684\u5c3a\u5ea6\u662f\u53ef\u6bd4\u8f83\u7684\uff0c\n    #    \u4f7f\u5f97\u8fd9\u79cd\u76f4\u63a5\u76f8\u51cf\u7684\u6bd4\u8f83\u66f4\u52a0\u5408\u7406\u548c\u7a33\u5b9a\u3002\n    loss = softplus(dynamic_margin - z_logp_diff)\n\n    # \u8fd4\u56de\u6279\u6b21\u4e2d\u6240\u6709\u6837\u672c\u5bf9\u7684\u5e73\u5747\u635f\u5931\n    return mean(loss)", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u7531\u4e8e\u6210\u672c\u548c\u5bf9\u6570\u6982\u7387\u90fd\u7ecf\u8fc7\u4e86Z-Score\u5f52\u4e00\u5316\uff0cbeta=1.0\u610f\u5473\u7740\u6211\u4eec\u671f\u671b\u5f52\u4e00\u5316\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u81f3\u5c11\u8981\u7b49\u4e8e\u5f52\u4e00\u5316\u7684\u6210\u672c\u5dee\u5f02\u3002"}}, "operators_used": ["zscore", "softplus"], "implementation_hint": {"expects": ["Receives two flat tensors, `batch_costs` and `batch_logps`, containing paired samples (e.g., [a1, b1, a2, b2, ...])."], "returns": "A single scalar value representing the mean loss over all pairs in the batch."}}, "fitness": {"hf_like_score": 4.02244758605957, "validation_objective": 4.02244758605957, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.9898903369903564}, "train_score_mean": 4.251730494201183, "train_loss_mean": 0.6928778979927301, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoredDynamicMarginLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u5b66\u4e60\u5f3a\u5ea6\uff0c\u53c8\u5bf9\u6210\u672c\u548c\u5bf9\u6570\u6982\u7387\u7684\u5206\u5e03\u5177\u6709\u9c81\u68d2\u6027\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1. **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - logp_diff)` Hinge Loss \u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6 (`logp_diff`) \u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6 (`margin`)\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4e3a\u6a21\u578b\u63d0\u4f9b\u4e86\u6e05\u6670\u7684\u4f18\u5316\u65b9\u5411\u3002\n2. **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\u3002\u5728\u7236\u4ee31\u4e2d\uff0c\u6210\u672c\u5dee\u5f02\u540c\u65f6\u5f71\u54cd\u4e86`dynamic_margin`\u548c`scaled_logp_diff`\u3002\u5728\u672c\u8bbe\u8ba1\u4e2d\uff0c\u6211\u4eec\u867d\u7136\u6ca1\u6709\u76f4\u63a5\u7f29\u653e`logp_diff`\uff0c\u4f46\u901a\u8fc7\u5bf9`logp`\u548c`cost`\u8fdb\u884c\u6279\u6b21\u5185\u7684Z-Score\u5f52\u4e00\u5316\uff0c\u4f7f\u5f97`logp_diff`\u548c`cost_diff`\u7684\u8ba1\u7b97\u90fd\u9690\u5f0f\u5730\u53d7\u5230\u4e86\u6279\u6b21\u5185\u5176\u4ed6\u6837\u672c\u5206\u5e03\u7684\u5f71\u54cd\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\uff08\u548c\u6982\u7387\uff09\u5dee\u5f02\u7684\u81ea\u9002\u5e94\u611f\u77e5\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1. **\u6279\u6b21\u5185Z-Score\u5f52\u4e00\u5316 (\u8026\u5408\u70b91)**\uff1a\u8fd9\u662f\u672c\u8bbe\u8ba1\u7684\u6838\u5fc3\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `rank_gap` \u6216\u539f\u59cb\u6210\u672c\u5dee\u5f02\uff0c\u800c\u662f\u5728\u8ba1\u7b97\u4efb\u4f55\u5dee\u5f02\u4e4b\u524d\uff0c\u5148\u5bf9\u6279\u6b21\u5185\u6240\u6709\u7684`cost`\u548c`logp`\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\uff08`zscore`\u7b97\u5b50\uff09\u3002\u8fd9\u6837\u505a\u6709\u4e24\u5927\u597d\u5904\uff1a\u9996\u5148\uff0c\u5b83\u4f7f\u5f97\u635f\u5931\u5bf9`cost`\u548c`logp`\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u6781\u5927\u5730\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u80fd\u6709\u6548\u5904\u7406\u4e0d\u540c\u6279\u6b21\u95f4\u6570\u503c\u8303\u56f4\u5267\u70c8\u53d8\u5316\u7684\u60c5\u51b5\u3002\u5176\u6b21\uff0c\u5f52\u4e00\u5316\u540e\u7684\u503c\u53cd\u6620\u4e86\u6bcf\u4e2a\u6837\u672c\u5728\u5176\u6279\u6b21\u5206\u5e03\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff0c\u8fd9\u4f7f\u5f97\u540e\u7eed\u8ba1\u7b97\u7684`cost_diff`\u548c`logp_diff`\u90fd\u5177\u6709\u4e86\u201c\u4e0a\u4e0b\u6587\u611f\u77e5\u201d\u7684\u80fd\u529b\uff0c\u8ba9\u6a21\u578b\u66f4\u5173\u6ce8\u6279\u6b21\u5185\u7684\u76f8\u5bf9\u4f18\u52a3\uff0c\u800c\u975e\u7edd\u5bf9\u6570\u503c\u5dee\u5f02\u3002\n2. **\u57fa\u4e8e\u5f52\u4e00\u5316\u6210\u672c\u7684\u52a8\u6001\u88d5\u5ea6 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5c06Z-Score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_cost_diff` \u76f4\u63a5\u7528\u4f5c\u52a8\u6001\u88d5\u5ea6\u7684\u57fa\u7840\u3002\u5177\u4f53\u6765\u8bf4\uff0c`dynamic_margin = beta * z_cost_diff`\u3002\u8fd9\u4e2a\u8bbe\u8ba1\u8026\u5408\u4e86Z-Score\u5f52\u4e00\u5316\u548cHinge Loss\u7ed3\u6784\u3002\u4e0e\u7236\u4ee3\u4e2d\u57fa\u4e8e`rank_gap`\u7684\u88d5\u5ea6\u4e0d\u540c\uff0c`z_cost_diff`\u4fdd\u7559\u4e86\u66f4\u591a\u5173\u4e8e\u6210\u672c\u5dee\u5f02\u5927\u5c0f\u7684\u6bd4\u4f8b\u4fe1\u606f\uff08\u800c`rank_gap`\u53ea\u5173\u5fc3\u6392\u5e8f\uff09\uff0c\u540c\u65f6\u53c8\u901a\u8fc7\u5f52\u4e00\u5316\u907f\u514d\u4e86\u539f\u59cb\u6210\u672c\u5dee\u5f02\u53ef\u80fd\u5e26\u6765\u7684\u6781\u7aef\u503c\u95ee\u9898\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u8bbe\u5b9a\u65e2\u7a33\u5b9a\u53c8\u4fdd\u7559\u4e86\u8db3\u591f\u7684\u52a8\u6001\u6027\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5f15\u5165Z-Score\u5f52\u4e00\u5316\uff0c\u5c06\u7236\u4ee3\u4e2d\u7684Hinge Loss\u7ed3\u6784\u548c\u52a8\u6001\u88d5\u5ea6\u601d\u60f3\u63d0\u5347\u5230\u4e86\u4e00\u4e2a\u5bf9\u6570\u636e\u5206\u5e03\u66f4\u5177\u9c81\u68d2\u6027\u7684\u65b0\u5c42\u6b21\u3002\u5b83\u4e0d\u518d\u5b64\u7acb\u5730\u770b\u5f85\u6bcf\u4e00\u5bf9\u6837\u672c\uff0c\u800c\u662f\u5c06\u5b83\u4eec\u7f6e\u4e8e\u6279\u6b21\u7684\u4e0a\u4e0b\u6587\u4e2d\u8fdb\u884c\u6bd4\u8f83\uff0c\u4ece\u800c\u5b9e\u73b0\u66f4\u7a33\u5b9a\u548c\u81ea\u9002\u5e94\u7684\u504f\u597d\u5b66\u4e60\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u7531\u4e8e\u6210\u672c\u548c\u5bf9\u6570\u6982\u7387\u90fd\u7ecf\u8fc7\u4e86Z-Score\u5f52\u4e00\u5316\uff0cbeta=1.0\u610f\u5473\u7740\u6211\u4eec\u671f\u671b\u5f52\u4e00\u5316\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u81f3\u5c11\u8981\u7b49\u4e8e\u5f52\u4e00\u5316\u7684\u6210\u672c\u5dee\u5f02\u3002"}}, "operators_used": ["zscore", "softplus"]}}}
{"generation": 5, "index": 7, "ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u80fd\u5728\u6279\u6b21\uff08batch\uff09\u7ea7\u522b\u81ea\u9002\u5e94\u8c03\u6574\u5b66\u4e60\u4fe1\u53f7\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u9a71\u52a8\u201d\u601d\u60f3\uff0c\u5373\u540c\u65f6\u4f7f\u7528\u4e00\u4e2a\u201c\u663e\u5f0f\u201d\u7684\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u548c\u4e00\u4e2a\u201c\u9690\u5f0f\u201d\u7684\u7f29\u653e\u56e0\u5b50\uff08scaling factor\uff09\u6765\u5171\u540c\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u91cd\u8981\u6027\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7ed3\u6784 `softplus(dynamic_margin - scaled_logp_diff)` \u88ab\u4fdd\u7559\uff0c\u8fd9\u79cd\u201c\u53cc\u91cd\u5f3a\u8c03\u201d\u7684\u8bbe\u8ba1\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u4fdd\u7559\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee `(logp_w - logp_l)` \u7684\u6280\u5de7\u3002`tanh(logp_diff)` \u5c06\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u5dee\u538b\u7f29\u5230 [-1, 1] \u533a\u95f4\uff0c\u6709\u6548\u9632\u6b62\u4e86\u68af\u5ea6\u7206\u70b8\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u8fd9\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u662f\u4e00\u4e2a\u5171\u540c\u7684\u4f18\u70b9\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u3001\u57fa\u4e8e\u6279\u6b21\u7edf\u8ba1\u7684\u5f52\u4e00\u5316\u7b97\u5b50 `zscore` \u6765\u5904\u7406\u6210\u672c\u3002\u4e0e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap` \u4e0d\u540c\uff0c`zscore(costs_in_batch)` \u4f1a\u8ba1\u7b97\u6279\u6b21\u5185\u6240\u6709\u6210\u672c\u7684\u5747\u503c\u548c\u6807\u51c6\u5dee\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u6807\u51c6\u5206\u6570\uff08Z-scores\uff09\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u5b83\u4e0d\u4ec5\u8003\u8651\u4e86\u4e00\u5bf9\u6837\u672c\u7684\u76f8\u5bf9\u5dee\u5f02\uff0c\u8fd8\u8003\u8651\u4e86\u8fd9\u5bf9\u6837\u672c\u5728\u6574\u4e2a\u6279\u6b21\u6210\u672c\u5206\u5e03\u4e2d\u7684\u4f4d\u7f6e\u3002\u6210\u672c\u5dee\u5f02\u5f88\u5927\u4f46\u90fd\u5c5e\u4e8e\u201c\u4f4e\u6210\u672c\u201d\u533a\u57df\u7684\u6837\u672c\u5bf9\uff0c\u4e0e\u540c\u6837\u5dee\u5f02\u4f46\u5c5e\u4e8e\u201c\u9ad8\u6210\u672c\u201d\u533a\u57df\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5f52\u4e00\u5316\u540e\u7684\u5dee\u5f02 (`z_cost_diff`) \u4f1a\u6709\u6240\u4e0d\u540c\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u8ba1\u7b97\u5bf9\u6279\u6b21\u7684\u6574\u4f53\u4e0a\u4e0b\u6587\u66f4\u52a0\u654f\u611f\u548c\u81ea\u9002\u5e94\u3002\n2.  **\u65b0\u7684\u88d5\u5ea6\u4e0e\u7f29\u653e\u8026\u5408\u8bbe\u8ba1 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5229\u7528 `zscore` \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_cost_diff` \u6765\u540c\u65f6\u9a71\u52a8\u52a8\u6001\u88d5\u5ea6 `dynamic_margin` \u548c\u7f29\u653e\u56e0\u5b50 `scaling_factor`\u3002\u5177\u4f53\u5730\uff0c`dynamic_margin = beta * relu(z_cost_diff)` \u4e14 `scaling_factor = softplus(z_cost_diff)`\u3002\u8fd9\u91cc\u4f7f\u7528 `relu` \u6765\u786e\u4fdd\u88d5\u5ea6\u975e\u8d1f\uff0c\u5e76\u4e14\u5f53\u6210\u672c\u5dee\u5f02\u5728\u6279\u6b21\u4e2d\u4e0d\u663e\u8457\u65f6\uff08`z_cost_diff` <= 0\uff09\uff0c\u88d5\u5ea6\u4e3a\u96f6\uff0c\u4e0d\u65bd\u52a0\u989d\u5916\u7684\u5206\u79bb\u8981\u6c42\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5c06\u4e24\u4e2a\u7236\u4ee3\u4e2d\u5206\u522b\u7528\u4e8e\u8ba1\u7b97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684 `rank_gap` \u7edf\u4e00\u4e3a\u4e86\u4e00\u4e2a\u65b0\u7684\u3001\u57fa\u4e8e\u6279\u6b21\u4e0a\u4e0b\u6587\u7684\u4fe1\u53f7\u6e90 `z_cost_diff`\uff0c\u5b9e\u73b0\u4e86\u66f4\u6df1\u5c42\u6b21\u7684\u8026\u5408\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5f15\u5165 `zscore` \u5f52\u4e00\u5316\uff0c\u4f7f\u5f97\u5b66\u4e60\u4fe1\u53f7\u80fd\u591f\u6839\u636e\u5f53\u524d\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\u8fdb\u884c\u52a8\u6001\u8c03\u6574\u3002\u5b83\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u6df7\u5408\u9a71\u52a8\u6a21\u578b\u548c\u7a33\u5b9a\u6027\u6280\u5de7\uff0c\u5e76\u901a\u8fc7\u5c06\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u4e0e\u6279\u6b21\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u76f8\u8026\u5408\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u5bf9\u6279\u6b21\u4e0a\u4e0b\u6587\u654f\u611f\u3001\u9c81\u68d2\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u65b0\u504f\u597d\u635f\u5931\u3002", "pseudocode": "def ZScoreNormalizedHybridLoss(costs_in_batch, logps_in_batch, beta):\n    # \u5047\u8bbe costs_in_batch \u548c logps_in_batch \u662f\u6210\u5bf9\u51fa\u73b0\u7684\n    # \u4f8b\u5982: [(cost_a1, cost_b1), (cost_a2, cost_b2), ...]\n\n    # 1. [\u65b0\u8026\u5408\u70b91] \u5bf9\u6279\u6b21\u5185\u6240\u6709\u6210\u672c\u8fdb\u884cZ-score\u5f52\u4e00\u5316\n    #    \u8fd9\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u7684\u8861\u91cf\u6807\u51c6\u80fd\u591f\u6839\u636e\u5f53\u524d\u6279\u6b21\u7684\u5206\u5e03\u81ea\u9002\u5e94\u8c03\u6574\u3002\n    all_costs = flatten(costs_in_batch) # \u5c06\u6240\u6709\u6210\u672c\u5c55\u5e73\u5230\u4e00\u4e2a\u5217\u8868\u4e2d\n    z_costs = zscore(all_costs)\n    z_costs_paired = unflatten_as_pairs(z_costs) # \u6062\u590d\u6210\u5bf9\u7ed3\u6784\n\n    total_loss = 0\n    for (z_cost_a, z_cost_b), (logp_a, logp_b), (cost_a, cost_b) in zip(z_costs_paired, logps_in_batch, costs_in_batch):\n        # 2. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n        if cost_a < cost_b:\n            z_cost_w, z_cost_l = z_cost_a, z_cost_b\n            logp_w, logp_l = logp_a, logp_b\n        else:\n            z_cost_w, z_cost_l = z_cost_b, z_cost_a\n            logp_w, logp_l = logp_b, logp_a\n\n        # 3. [\u65b0\u8026\u5408\u70b92] \u57fa\u4e8e\u5f52\u4e00\u5316\u6210\u672c\u8ba1\u7b97\u5dee\u5f02\n        #    z_cost_l > z_cost_w\uff0c\u6240\u4ee5 z_cost_diff \u4e3a\u6b63\n        z_cost_diff = z_cost_l - z_cost_w\n\n        # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31 + \u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u52a8\u6001\u88d5\u5ea6\n        #    \u4f7f\u7528relu\u786e\u4fdd\u88d5\u5ea6\u975e\u8d1f\uff0c\u5e76\u7531\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\u9a71\u52a8\u3002\n        dynamic_margin = beta * relu(z_cost_diff)\n\n        # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31 + \u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\n        #    \u4f7f\u7528softplus\u786e\u4fdd\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\uff0c\u540c\u6837\u7531\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\u9a71\u52a8\u3002\n        scaling_factor = softplus(z_cost_diff)\n\n        # 6. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u5dee\n        #    \u4f7f\u7528tanh\u5c06\u6a21\u578b\u7f6e\u4fe1\u5ea6\u5dee\u538b\u7f29\u5230[-1, 1]\u533a\u95f4\u3002\n        stable_logp_diff = tanh(logp_w - logp_l)\n\n        # 7. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u7f29\u653e\u7684\u5bf9\u6570\u6982\u7387\u5dee\n        #    \u8fd9\u662f\u6df7\u5408\u9a71\u52a8\u6a21\u578b\u7684\u6838\u5fc3\u90e8\u5206\uff0c\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u3002\n        scaled_logp_diff = scaling_factor * stable_logp_diff\n\n        # 8. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u6700\u7ec8\u7684Hinge-like\u635f\u5931\n        #    \u5f53\u6a21\u578b\u7684\u52a0\u6743\u7f6e\u4fe1\u5ea6(scaled_logp_diff)\u5c0f\u4e8e\u52a8\u6001\u88d5\u5ea6\u65f6\u4ea7\u751f\u60e9\u7f5a\u3002\n        pair_loss = softplus(dynamic_margin - scaled_logp_diff)\n        total_loss += pair_loss\n\n    return total_loss / len(costs_in_batch) # \u8fd4\u56de\u6279\u6b21\u5e73\u5747\u635f\u5931", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\uff08Z-score difference\uff09\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5728\u6279\u6b21\u4e2d\u6210\u672c\u5dee\u5f02\u663e\u8457\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5206\u79bb\u8981\u6c42\u3002"}}, "operators_used": ["zscore", "relu", "softplus", "tanh"], "implementation_hint": {"expects": ["A batch of preference pairs, where each pair consists of (cost_a, cost_b, logp_a, logp_b). For batch-level normalization, it's more practical to receive `costs_in_batch` (a tensor of all costs) and `logps_in_batch` (a tensor of all logps), along with indices to form pairs."], "returns": "A single scalar value representing the mean loss for the batch."}}, "fitness": {"hf_like_score": 4.030413389205933, "validation_objective": 4.030413389205933, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.000243544578552}, "train_score_mean": 4.251493819057941, "train_loss_mean": 0.692854193970561, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u80fd\u5728\u6279\u6b21\uff08batch\uff09\u7ea7\u522b\u81ea\u9002\u5e94\u8c03\u6574\u5b66\u4e60\u4fe1\u53f7\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u9a71\u52a8\u201d\u601d\u60f3\uff0c\u5373\u540c\u65f6\u4f7f\u7528\u4e00\u4e2a\u201c\u663e\u5f0f\u201d\u7684\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u548c\u4e00\u4e2a\u201c\u9690\u5f0f\u201d\u7684\u7f29\u653e\u56e0\u5b50\uff08scaling factor\uff09\u6765\u5171\u540c\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u91cd\u8981\u6027\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7ed3\u6784 `softplus(dynamic_margin - scaled_logp_diff)` \u88ab\u4fdd\u7559\uff0c\u8fd9\u79cd\u201c\u53cc\u91cd\u5f3a\u8c03\u201d\u7684\u8bbe\u8ba1\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u4fdd\u7559\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee `(logp_w - logp_l)` \u7684\u6280\u5de7\u3002`tanh(logp_diff)` \u5c06\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u5dee\u538b\u7f29\u5230 [-1, 1] \u533a\u95f4\uff0c\u6709\u6548\u9632\u6b62\u4e86\u68af\u5ea6\u7206\u70b8\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u8fd9\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u662f\u4e00\u4e2a\u5171\u540c\u7684\u4f18\u70b9\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u3001\u57fa\u4e8e\u6279\u6b21\u7edf\u8ba1\u7684\u5f52\u4e00\u5316\u7b97\u5b50 `zscore` \u6765\u5904\u7406\u6210\u672c\u3002\u4e0e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap` \u4e0d\u540c\uff0c`zscore(costs_in_batch)` \u4f1a\u8ba1\u7b97\u6279\u6b21\u5185\u6240\u6709\u6210\u672c\u7684\u5747\u503c\u548c\u6807\u51c6\u5dee\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u6807\u51c6\u5206\u6570\uff08Z-scores\uff09\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u5b83\u4e0d\u4ec5\u8003\u8651\u4e86\u4e00\u5bf9\u6837\u672c\u7684\u76f8\u5bf9\u5dee\u5f02\uff0c\u8fd8\u8003\u8651\u4e86\u8fd9\u5bf9\u6837\u672c\u5728\u6574\u4e2a\u6279\u6b21\u6210\u672c\u5206\u5e03\u4e2d\u7684\u4f4d\u7f6e\u3002\u6210\u672c\u5dee\u5f02\u5f88\u5927\u4f46\u90fd\u5c5e\u4e8e\u201c\u4f4e\u6210\u672c\u201d\u533a\u57df\u7684\u6837\u672c\u5bf9\uff0c\u4e0e\u540c\u6837\u5dee\u5f02\u4f46\u5c5e\u4e8e\u201c\u9ad8\u6210\u672c\u201d\u533a\u57df\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5f52\u4e00\u5316\u540e\u7684\u5dee\u5f02 (`z_cost_diff`) \u4f1a\u6709\u6240\u4e0d\u540c\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u8ba1\u7b97\u5bf9\u6279\u6b21\u7684\u6574\u4f53\u4e0a\u4e0b\u6587\u66f4\u52a0\u654f\u611f\u548c\u81ea\u9002\u5e94\u3002\n2.  **\u65b0\u7684\u88d5\u5ea6\u4e0e\u7f29\u653e\u8026\u5408\u8bbe\u8ba1 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5229\u7528 `zscore` \u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_cost_diff` \u6765\u540c\u65f6\u9a71\u52a8\u52a8\u6001\u88d5\u5ea6 `dynamic_margin` \u548c\u7f29\u653e\u56e0\u5b50 `scaling_factor`\u3002\u5177\u4f53\u5730\uff0c`dynamic_margin = beta * relu(z_cost_diff)` \u4e14 `scaling_factor = softplus(z_cost_diff)`\u3002\u8fd9\u91cc\u4f7f\u7528 `relu` \u6765\u786e\u4fdd\u88d5\u5ea6\u975e\u8d1f\uff0c\u5e76\u4e14\u5f53\u6210\u672c\u5dee\u5f02\u5728\u6279\u6b21\u4e2d\u4e0d\u663e\u8457\u65f6\uff08`z_cost_diff` <= 0\uff09\uff0c\u88d5\u5ea6\u4e3a\u96f6\uff0c\u4e0d\u65bd\u52a0\u989d\u5916\u7684\u5206\u79bb\u8981\u6c42\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5c06\u4e24\u4e2a\u7236\u4ee3\u4e2d\u5206\u522b\u7528\u4e8e\u8ba1\u7b97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684 `rank_gap` \u7edf\u4e00\u4e3a\u4e86\u4e00\u4e2a\u65b0\u7684\u3001\u57fa\u4e8e\u6279\u6b21\u4e0a\u4e0b\u6587\u7684\u4fe1\u53f7\u6e90 `z_cost_diff`\uff0c\u5b9e\u73b0\u4e86\u66f4\u6df1\u5c42\u6b21\u7684\u8026\u5408\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5f15\u5165 `zscore` \u5f52\u4e00\u5316\uff0c\u4f7f\u5f97\u5b66\u4e60\u4fe1\u53f7\u80fd\u591f\u6839\u636e\u5f53\u524d\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\u8fdb\u884c\u52a8\u6001\u8c03\u6574\u3002\u5b83\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u6df7\u5408\u9a71\u52a8\u6a21\u578b\u548c\u7a33\u5b9a\u6027\u6280\u5de7\uff0c\u5e76\u901a\u8fc7\u5c06\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u4e0e\u6279\u6b21\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u76f8\u8026\u5408\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u5bf9\u6279\u6b21\u4e0a\u4e0b\u6587\u654f\u611f\u3001\u9c81\u68d2\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u65b0\u504f\u597d\u635f\u5931\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\uff08Z-score difference\uff09\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5728\u6279\u6b21\u4e2d\u6210\u672c\u5dee\u5f02\u663e\u8457\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5206\u79bb\u8981\u6c42\u3002"}}, "operators_used": ["zscore", "relu", "softplus", "tanh"]}}}
{"generation": 6, "index": 0, "ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u9020\u4e00\u4e2a\u5bf9\u6a21\u578b\u8f93\u51fa\u7684\u5c3a\u5ea6\u4e0d\u654f\u611f\u3001\u540c\u65f6\u53c8\u80fd\u6839\u636e\u6210\u672c\u5dee\u5f02\u81ea\u9002\u5e94\u8c03\u6574\u5b66\u4e60\u5f3a\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6(Hybrid Margin)\u201d\u601d\u60f3\uff0c\u5373\u540c\u65f6\u4f7f\u7528\u4e00\u4e2a\u663e\u5f0f\u7684\u88d5\u5ea6\u76ee\u6807(`margin`)\u548c\u4e00\u4e2a\u9690\u5f0f\u7684\u7f29\u653e\u56e0\u5b50(`scaling_factor`)\u6765\u5171\u540c\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7ed3\u6784\u4e2d\u7684 `scaling_factor * stable_logp_diff` \u90e8\u5206\u76f4\u63a5\u6765\u6e90\u4e8e\u7236\u4ee31\uff0c\u5b83\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5bf9\u6570\u6982\u7387\u5dee\u5bf9\u68af\u5ea6\u7684\u8d21\u732e\u4e5f\u8d8a\u5927\u3002\n\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u4fdd\u7559\u4e86\u5176\u57fa\u7840\u7684\u5e73\u6ed1Hinge\u635f\u5931\u6846\u67b6 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u4e0d\u4ec5\u60e9\u7f5a\u65b9\u5411\u9519\u8bef\u7684\u9884\u6d4b\uff0c\u4e5f\u60e9\u7f5a\u90a3\u4e9b\u867d\u7136\u65b9\u5411\u6b63\u786e\u4f46\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\uff08\u672a\u8fbe\u5230`margin`\uff09\u7684\u9884\u6d4b\uff0c\u4e3a\u6a21\u578b\u5b66\u4e60\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u7f6e\u4fe1\u5ea6\u9608\u503c\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u6765\u5904\u7406\u5bf9\u6570\u6982\u7387\u5dee `(logp_w - logp_l)`\u3002\u4e0e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `tanh` \u4e0d\u540c\uff0c`zscore` \u662f\u5728\u6574\u4e2a\u6279\u6b21(batch)\u7684\u6570\u636e\u4e0a\u8fdb\u884c\u6807\u51c6\u5316\uff08\u51cf\u53bb\u5747\u503c\uff0c\u9664\u4ee5\u6807\u51c6\u5dee\uff09\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u5b83\u4f7f\u5f97\u635f\u5931\u5bf9\u6a21\u578b\u8f93\u51fa\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\u3002\u65e0\u8bba\u6a21\u578b\u7684 `logp` \u8f93\u51fa\u6574\u4f53\u504f\u5927\u8fd8\u662f\u504f\u5c0f\uff0c`zscore` \u90fd\u80fd\u5c06\u5176\u91cd\u65b0\u4e2d\u5fc3\u5316\u548c\u7f29\u653e\uff0c\u4ece\u800c\u4f7f\u8d85\u53c2\u6570 `beta` \u548c\u88d5\u5ea6\u7684\u8bbe\u5b9a\u66f4\u52a0\u9c81\u68d2\uff0c\u51cf\u5c11\u4e86\u56e0\u6a21\u578b\u8f93\u51fa\u5c3a\u5ea6\u53d8\u5316\u800c\u9700\u8981\u9891\u7e41\u8c03\u53c2\u7684\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n2.  **\u7b80\u5316\u7684\u88d5\u5ea6\u8bbe\u8ba1 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u7b80\u5316\u4e86\u52a8\u6001\u88d5\u5ea6\u7684\u8ba1\u7b97\u65b9\u5f0f\u3002\u7236\u4ee3\u90fd\u4f7f\u7528\u4e86\u4e0e\u6210\u672c\u5dee\u5f02\uff08`rank_gap`\uff09\u76f8\u5173\u7684\u52a8\u6001\u88d5\u5ea6\u3002\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u91c7\u7528\u4e86\u4e00\u4e2a\u56fa\u5b9a\u7684\u57fa\u7840\u88d5\u5ea6 `beta`\u3002\u8fd9\u4e2a\u88d5\u5ea6\u73b0\u5728\u4ee3\u8868\u4e86\u5728\u201c\u5f52\u4e00\u5316\u7a7a\u95f4\u201d\u4e2d\u7684\u76ee\u6807\u5206\u79bb\u5ea6\u3002\u56e0\u4e3a `scaled_logp_diff` \u5df2\u7ecf\u901a\u8fc7 `scaling_factor` \u5305\u542b\u4e86\u6210\u672c\u5dee\u5f02\u4fe1\u606f\uff0c\u518d\u6b21\u5728\u88d5\u5ea6\u4e2d\u5f15\u5165\u6210\u672c\u5dee\u5f02\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8fc7\u4e8e\u590d\u6742\u7684\u76f8\u4e92\u4f5c\u7528\u3002\u4f7f\u7528\u56fa\u5b9a\u88d5\u5ea6 `beta` \u4e0e `zscore` \u5f52\u4e00\u5316\u7684 `logp_diff` \u76f8\u7ed3\u5408\uff0c\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u66f4\u6e05\u6670\uff1a\u5bf9\u4e8e\u6240\u6709\u6837\u672c\u5bf9\uff0c\u6211\u4eec\u90fd\u671f\u671b\u5176\u5f52\u4e00\u5316\u540e\u7684\u3001\u7ecf\u6210\u672c\u52a0\u6743\u7684\u7f6e\u4fe1\u5ea6\u5206\u6570\u81f3\u5c11\u8981\u8d85\u8fc7\u4e00\u4e2a\u56fa\u5b9a\u7684\u9608\u503c `beta`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5c06\u6210\u672c\u5dee\u5f02\u7684\u8c03\u8282\u4f5c\u7528\u5b8c\u5168\u96c6\u4e2d\u5728 `scaling_factor` \u4e0a\uff0c\u7b80\u5316\u4e86\u6a21\u578b\u884c\u4e3a\u7684\u5206\u6790\u3002", "pseudocode": "def ZScoreNormalizedHybridLoss(costs_w, costs_l, logps_w, logps_l, beta):\n    # costs_w, costs_l, logps_w, logps_l are vectors/tensors for the entire batch.\n    # cost_w[i] < cost_l[i] for all i.\n\n    # 1. [\u7ee7\u627f] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u7528\u4e8e\u540e\u7eed\u7684\u7f29\u653e\u3002\n    #    \u8fd9\u4e2a\u601d\u60f3\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u6709\u4f53\u73b0\u3002\n    cost_rank_diffs = rank_gap(costs_w, costs_l) # Returns a vector of positive values\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u521b\u5efa\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u3002\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\u3002\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u7f29\u653e\u56e0\u5b50\u8d8a\u5927\u3002\n    scaling_factors = softplus(cost_rank_diffs)\n\n    # 3. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u5bf9\u6570\u6982\u7387\u5dee\uff0c\u5e76\u4f7f\u7528z-score\u8fdb\u884c\u6279\u6b21\u5f52\u4e00\u5316\u3002\n    #    \u8fd9\u53d6\u4ee3\u4e86\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684tanh\uff0c\u4f7f\u635f\u5931\u5bf9\u6a21\u578b\u8f93\u51fa\u7684\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\u3002\n    raw_logp_diffs = logps_w - logps_l\n    normalized_logp_diffs = zscore(raw_logp_diffs) # zscore(x) = (x - mean(x)) / std(x)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u3001\u5f52\u4e00\u5316\u7684\u7f6e\u4fe1\u5ea6\u5206\u6570\u3002\n    #    \u8fd9\u662f\u7236\u4ee31\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u601d\u60f3\u7684\u6838\u5fc3\u90e8\u5206\u3002\n    scaled_normalized_diffs = scaling_factors * normalized_logp_diffs\n\n    # 5. [\u65b0\u8026\u5408\u70b92 & \u7ee7\u627f\u81ea\u7236\u4ee30] \u4f7f\u7528\u56fa\u5b9a\u88d5\u5ea6\u8ba1\u7b97Hinge\u635f\u5931\u3002\n    #    \u6211\u4eec\u7ee7\u627f\u4e86Hinge\u635f\u5931\u7684\u6846\u67b6\uff0c\u4f46\u4f7f\u7528\u4e86\u7b80\u5316\u7684\u56fa\u5b9a\u88d5\u5ea6`beta`\u3002\n    #    \u8fd9\u4e2a\u88d5\u5ea6\u5728\u5f52\u4e00\u5316\u7a7a\u95f4\u4e2d\u8d77\u4f5c\u7528\uff0c\u76ee\u6807\u662f\u8ba9\u52a0\u6743\u7f6e\u4fe1\u5ea6\u8d85\u8fc7\u8fd9\u4e2a\u9608\u503c\u3002\n    #    softplus(x) \u662f relu(x) \u7684\u5e73\u6ed1\u8fd1\u4f3c\u3002\n    losses = softplus(beta - scaled_normalized_diffs)\n\n    # 6. \u8fd4\u56de\u6279\u6b21\u4e2d\u6240\u6709\u6837\u672c\u635f\u5931\u7684\u5747\u503c\u3002\n    return mean(losses)", "hyperparams": {"beta": {"value": 0.5, "description": "\u56fa\u5b9a\u7684\u57fa\u7840\u88d5\u5ea6\u3002\u5b83\u5728z-score\u5f52\u4e00\u5316\u7a7a\u95f4\u4e2d\u5b9a\u4e49\u4e86\u671f\u671b\u7684\u6700\u5c0f\u5206\u79bb\u5ea6\u3002\u7531\u4e8elogp_diff\u88ab\u5f52\u4e00\u5316\uff0cbeta\u7684\u53d6\u503c\u76f8\u5bf9\u7a33\u5b9a\uff0c\u901a\u5e38\u57280\u52301\u4e4b\u95f4\u3002\u5b83\u4ee3\u8868\u4e86\u6211\u4eec\u671f\u671b\u52a0\u6743\u7f6e\u4fe1\u5ea6\u5206\u6570\u8d85\u8fc7\u5176\u6279\u6b21\u5747\u503c\u7684\u591a\u5c11\u4e2a\u6807\u51c6\u5dee\u3002"}}, "operators_used": ["rank_gap", "softplus", "zscore"], "implementation_hint": {"expects": ["Expects four 1D tensors of the same length (batch size): `costs_w`, `costs_l`, `logps_w`, `logps_l`, where `costs_w[i] < costs_l[i]` for all i."], "returns": "Returns a single scalar value representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.110136032104492, "validation_objective": 4.110136032104492, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.068207740783691}, "train_score_mean": 4.233990974724293, "train_loss_mean": 0.6928641237318516, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u9020\u4e00\u4e2a\u5bf9\u6a21\u578b\u8f93\u51fa\u7684\u5c3a\u5ea6\u4e0d\u654f\u611f\u3001\u540c\u65f6\u53c8\u80fd\u6839\u636e\u6210\u672c\u5dee\u5f02\u81ea\u9002\u5e94\u8c03\u6574\u5b66\u4e60\u5f3a\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6(Hybrid Margin)\u201d\u601d\u60f3\uff0c\u5373\u540c\u65f6\u4f7f\u7528\u4e00\u4e2a\u663e\u5f0f\u7684\u88d5\u5ea6\u76ee\u6807(`margin`)\u548c\u4e00\u4e2a\u9690\u5f0f\u7684\u7f29\u653e\u56e0\u5b50(`scaling_factor`)\u6765\u5171\u540c\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7ed3\u6784\u4e2d\u7684 `scaling_factor * stable_logp_diff` \u90e8\u5206\u76f4\u63a5\u6765\u6e90\u4e8e\u7236\u4ee31\uff0c\u5b83\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5bf9\u6570\u6982\u7387\u5dee\u5bf9\u68af\u5ea6\u7684\u8d21\u732e\u4e5f\u8d8a\u5927\u3002\n\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u4fdd\u7559\u4e86\u5176\u57fa\u7840\u7684\u5e73\u6ed1Hinge\u635f\u5931\u6846\u67b6 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u4e0d\u4ec5\u60e9\u7f5a\u65b9\u5411\u9519\u8bef\u7684\u9884\u6d4b\uff0c\u4e5f\u60e9\u7f5a\u90a3\u4e9b\u867d\u7136\u65b9\u5411\u6b63\u786e\u4f46\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\uff08\u672a\u8fbe\u5230`margin`\uff09\u7684\u9884\u6d4b\uff0c\u4e3a\u6a21\u578b\u5b66\u4e60\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u7f6e\u4fe1\u5ea6\u9608\u503c\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u6765\u5904\u7406\u5bf9\u6570\u6982\u7387\u5dee `(logp_w - logp_l)`\u3002\u4e0e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `tanh` \u4e0d\u540c\uff0c`zscore` \u662f\u5728\u6574\u4e2a\u6279\u6b21(batch)\u7684\u6570\u636e\u4e0a\u8fdb\u884c\u6807\u51c6\u5316\uff08\u51cf\u53bb\u5747\u503c\uff0c\u9664\u4ee5\u6807\u51c6\u5dee\uff09\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u5b83\u4f7f\u5f97\u635f\u5931\u5bf9\u6a21\u578b\u8f93\u51fa\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\u3002\u65e0\u8bba\u6a21\u578b\u7684 `logp` \u8f93\u51fa\u6574\u4f53\u504f\u5927\u8fd8\u662f\u504f\u5c0f\uff0c`zscore` \u90fd\u80fd\u5c06\u5176\u91cd\u65b0\u4e2d\u5fc3\u5316\u548c\u7f29\u653e\uff0c\u4ece\u800c\u4f7f\u8d85\u53c2\u6570 `beta` \u548c\u88d5\u5ea6\u7684\u8bbe\u5b9a\u66f4\u52a0\u9c81\u68d2\uff0c\u51cf\u5c11\u4e86\u56e0\u6a21\u578b\u8f93\u51fa\u5c3a\u5ea6\u53d8\u5316\u800c\u9700\u8981\u9891\u7e41\u8c03\u53c2\u7684\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n2.  **\u7b80\u5316\u7684\u88d5\u5ea6\u8bbe\u8ba1 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u7b80\u5316\u4e86\u52a8\u6001\u88d5\u5ea6\u7684\u8ba1\u7b97\u65b9\u5f0f\u3002\u7236\u4ee3\u90fd\u4f7f\u7528\u4e86\u4e0e\u6210\u672c\u5dee\u5f02\uff08`rank_gap`\uff09\u76f8\u5173\u7684\u52a8\u6001\u88d5\u5ea6\u3002\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u91c7\u7528\u4e86\u4e00\u4e2a\u56fa\u5b9a\u7684\u57fa\u7840\u88d5\u5ea6 `beta`\u3002\u8fd9\u4e2a\u88d5\u5ea6\u73b0\u5728\u4ee3\u8868\u4e86\u5728\u201c\u5f52\u4e00\u5316\u7a7a\u95f4\u201d\u4e2d\u7684\u76ee\u6807\u5206\u79bb\u5ea6\u3002\u56e0\u4e3a `scaled_logp_diff` \u5df2\u7ecf\u901a\u8fc7 `scaling_factor` \u5305\u542b\u4e86\u6210\u672c\u5dee\u5f02\u4fe1\u606f\uff0c\u518d\u6b21\u5728\u88d5\u5ea6\u4e2d\u5f15\u5165\u6210\u672c\u5dee\u5f02\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8fc7\u4e8e\u590d\u6742\u7684\u76f8\u4e92\u4f5c\u7528\u3002\u4f7f\u7528\u56fa\u5b9a\u88d5\u5ea6 `beta` \u4e0e `zscore` \u5f52\u4e00\u5316\u7684 `logp_diff` \u76f8\u7ed3\u5408\uff0c\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u66f4\u6e05\u6670\uff1a\u5bf9\u4e8e\u6240\u6709\u6837\u672c\u5bf9\uff0c\u6211\u4eec\u90fd\u671f\u671b\u5176\u5f52\u4e00\u5316\u540e\u7684\u3001\u7ecf\u6210\u672c\u52a0\u6743\u7684\u7f6e\u4fe1\u5ea6\u5206\u6570\u81f3\u5c11\u8981\u8d85\u8fc7\u4e00\u4e2a\u56fa\u5b9a\u7684\u9608\u503c `beta`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5c06\u6210\u672c\u5dee\u5f02\u7684\u8c03\u8282\u4f5c\u7528\u5b8c\u5168\u96c6\u4e2d\u5728 `scaling_factor` \u4e0a\uff0c\u7b80\u5316\u4e86\u6a21\u578b\u884c\u4e3a\u7684\u5206\u6790\u3002", "hyperparams": {"beta": {"value": 0.5, "description": "\u56fa\u5b9a\u7684\u57fa\u7840\u88d5\u5ea6\u3002\u5b83\u5728z-score\u5f52\u4e00\u5316\u7a7a\u95f4\u4e2d\u5b9a\u4e49\u4e86\u671f\u671b\u7684\u6700\u5c0f\u5206\u79bb\u5ea6\u3002\u7531\u4e8elogp_diff\u88ab\u5f52\u4e00\u5316\uff0cbeta\u7684\u53d6\u503c\u76f8\u5bf9\u7a33\u5b9a\uff0c\u901a\u5e38\u57280\u52301\u4e4b\u95f4\u3002\u5b83\u4ee3\u8868\u4e86\u6211\u4eec\u671f\u671b\u52a0\u6743\u7f6e\u4fe1\u5ea6\u5206\u6570\u8d85\u8fc7\u5176\u6279\u6b21\u5747\u503c\u7684\u591a\u5c11\u4e2a\u6807\u51c6\u5dee\u3002"}}, "operators_used": ["rank_gap", "softplus", "zscore"]}}}
{"generation": 6, "index": 1, "ir": {"name": "ZScoreClippedAdaptiveHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u80fd\u9002\u5e94\u6210\u672c\u5206\u5e03\uff0c\u53c8\u80fd\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u5c06\u7236\u4ee30\u4e2d\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684\u201c\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u201d\u601d\u60f3\u4e0e\u7236\u4ee31\u4e2d\u5bf9\u6982\u7387\u5dee\u5f02\u8fdb\u884c\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u601d\u60f3\u8fdb\u884c\u878d\u5408\uff0c\u5e76\u5f15\u5165\u4e86\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u6280\u5de7\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6838\u5fc3\u7ed3\u6784\u662f`softplus(margin - term)`\u5f62\u5f0f\u7684\u5e73\u6ed1Hinge Loss\u3002\u8fd9\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u8ba1\u7b97\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c06\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u79cd\u7ed3\u6784\u5bf9\u5b66\u4e60\u76ee\u6807\u6709\u6e05\u6670\u7684\u5b9a\u4e49\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684`scaling_factor`\u6765\u52a0\u6743`logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u4e3a\u4e86\u4f7f\u52a8\u6001\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u5bf9\u6574\u4e2a\u6279\u6b21\uff08batch\uff09\u7684\u6210\u672c\u5206\u5e03\u5177\u6709\u66f4\u5f3a\u7684\u9002\u5e94\u6027\uff0c\u6211\u4eec\u653e\u5f03\u4e86\u57fa\u4e8e\u5355\u4e2a\u6837\u672c\u5bf9\u7684`rank_gap`\uff0c\u8f6c\u800c\u4f7f\u7528`zscore(cost_l - cost_w)`\u3002`zscore`\u901a\u8fc7\u51cf\u53bb\u6279\u6b21\u5747\u503c\u5e76\u9664\u4ee5\u6807\u51c6\u5dee\uff0c\u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u5206\u6570\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u8ba1\u7b97\u4e0d\u518d\u53d7\u6210\u672c\u7edd\u5bf9\u503c\u5927\u5c0f\u548c\u8303\u56f4\u7684\u5f71\u54cd\uff0c\u800c\u662f\u53d6\u51b3\u4e8e\u67d0\u4e2a\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02\u5728\u5176\u6240\u5728\u6279\u6b21\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u4e00\u4e2a\u5728\u6279\u6b21\u4e2d\u5dee\u5f02\u6781\u5927\u7684\u6837\u672c\u5bf9\u4f1a\u83b7\u5f97\u66f4\u9ad8\u7684z-score\uff0c\u4ece\u800c\u83b7\u5f97\u66f4\u9ad8\u7684\u88d5\u5ea6\u548c\u6743\u91cd\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002\u8fd9\u662f\u4e00\u79cd\u66f4\u5168\u5c40\u3001\u66f4\u5177\u9002\u5e94\u6027\u7684\u5f52\u4e00\u5316\u7b56\u7565\u3002\n2.  **\u65b0\u7684\u7a33\u5b9a\u6280\u5de7 (\u8026\u5408\u70b92)**\uff1a\u867d\u7136`tanh`\u53ef\u4ee5\u7a33\u5b9a`logp_diff`\uff0c\u4f46\u5b83\u4f1a\u5c06\u6240\u6709\u5dee\u5f02\u538b\u7f29\u5230[-1, 1]\u533a\u95f4\uff0c\u53ef\u80fd\u4e22\u5931\u4e00\u4e9b\u5927\u5e45\u5ea6\u5dee\u5f02\u7684\u4fe1\u53f7\u3002\u6211\u4eec\u5f15\u5165`clamp(logp_diff, -tau, tau)`\u4f5c\u4e3a\u66ff\u4ee3\u65b9\u6848\u3002`clamp`\u5c06\u5bf9\u6570\u6982\u7387\u5dee\u9650\u5236\u5728\u4e00\u4e2a\u7531\u8d85\u53c2\u6570`tau`\u5b9a\u4e49\u7684\u8303\u56f4\u5185 `[-tau, tau]`\u3002\u8fd9\u65e2\u80fd\u6709\u6548\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff08\u5bf9\u4e8e\u975e\u5e38\u5927\u6216\u975e\u5e38\u5c0f\u7684`logp_diff`\uff09\uff0c\u53c8\u80fd\u4fdd\u7559\u5728`[-tau, tau]`\u8303\u56f4\u5185\u7684\u539f\u59cb\u5dee\u5f02\u5e45\u5ea6\uff0c\u6bd4`tanh`\u63d0\u4f9b\u4e86\u66f4\u7075\u6d3b\u7684\u63a7\u5236\uff0c\u907f\u514d\u4e86`tanh`\u5728\u63a5\u8fd1\u00b11\u5904\u7684\u68af\u5ea6\u6d88\u5931\u95ee\u9898\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7`zscore`\u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u6279\u6b21\u81ea\u9002\u5e94\u5f52\u4e00\u5316\uff0c\u7528\u5b83\u540c\u65f6\u9a71\u52a8\u201c\u52a8\u6001\u88d5\u5ea6\u201d\u548c\u201c\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u201d\uff1b\u7136\u540e\uff0c\u5b83\u5c06\u8fd9\u4e2a\u52a0\u6743\u540e\u7684\u3001\u7ecf\u8fc7`clamp`\u7a33\u5b9a\u5316\u7684\u6982\u7387\u5dee\u5f02\u9879\u5d4c\u5165\u5230Hinge Loss\u6846\u67b6\u4e2d\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u80fd\u591f\u6839\u636e\u5f53\u524d\u6279\u6b21\u7684\u6570\u636e\u5206\u5e03\u52a8\u6001\u8c03\u6574\u5b66\u4e60\u91cd\u70b9\uff0c\u540c\u65f6\u901a\u8fc7`clamp`\u6280\u5de7\u4fdd\u8bc1\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u548c\u6548\u7387\u3002", "pseudocode": "def ZScoreClippedAdaptiveHingeLoss(cost_w_batch, cost_l_batch, logp_w_batch, logp_l_batch, beta, tau):\n    # cost_w_batch, cost_l_batch\u7b49\u662f\u6574\u4e2a\u6279\u6b21(batch)\u7684\u5411\u91cf\n    # \u786e\u4fdd cost_w < cost_l\n\n    # 1. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u6279\u6b21\u5185\u6210\u672c\u5dee\u5f02\u7684z-score\n    #    \u8fd9\u4f7f\u5f97\u540e\u7eed\u7684\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u80fd\u591f\u81ea\u9002\u5e94\u4e8e\u5f53\u524d\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\u3002\n    #    zscore(x) = (x - mean(x)) / (std(x) + epsilon)\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u5f52\u4e00\u5316\u540e\u7684\u5dee\u5f02\u975e\u8d1f\u4e14\u5e73\u6ed1\u3002\n    cost_diff_normalized = softplus(zscore(cost_l_batch - cost_w_batch))\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u57fa\u4e8e\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\uff0c\u8bbe\u8ba1\u52a8\u6001\u88d5\u5ea6\u3002\n    #    \u88d5\u5ea6\u7684\u5927\u5c0f\u4e0e\u6210\u672c\u5dee\u5f02\u5728\u6279\u6b21\u4e2d\u7684\u76f8\u5bf9\u663e\u8457\u6027\u6210\u6b63\u6bd4\u3002\n    dynamic_margin = beta * cost_diff_normalized\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u57fa\u4e8e\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\uff0c\u521b\u5efa\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u3002\n    #    \u540c\u6837\uff0c\u6210\u672c\u5dee\u5f02\u8d8a\u663e\u8457\u7684\u6837\u672c\u5bf9\uff0c\u5176\u6982\u7387\u5dee\u5f02\u7684\u6743\u91cd\u8d8a\u5927\u3002\n    #    \u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528\u5f52\u4e00\u5316\u7ed3\u679c\u4f5c\u4e3a\u7f29\u653e\u56e0\u5b50\uff0c\u7b80\u5316\u4e86\u8bbe\u8ba1\u3002\n    scaling_factor = cost_diff_normalized\n\n    # 4. \u8ba1\u7b97\u539f\u59cb\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u3002\n    logp_diff = logp_w_batch - logp_l_batch\n\n    # 5. [\u65b0\u8026\u5408\u70b92] \u4f7f\u7528clamp\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u3002\n    #    \u66ff\u4ee3tanh\uff0c\u65e2\u80fd\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u53c8\u80fd\u4fdd\u7559\u5728[-tau, tau]\u5185\u7684\u539f\u59cb\u5dee\u5f02\u5e45\u5ea6\u3002\n    #    tau\u662f\u4e00\u4e2a\u8d85\u53c2\u6570\uff0c\u5b9a\u4e49\u4e86\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u7684\u6709\u6548\u8303\u56f4\u3002\n    clamped_logp_diff = clamp(logp_diff, min=-tau, max=tau)\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u7ecf\u81ea\u9002\u5e94\u7f29\u653e\u7684\u6982\u7387\u5dee\u5f02\u9879\u3002\n    #    \u8fd9\u5c06\u6210\u672c\u5dee\u5f02\u7684\u91cd\u8981\u6027\uff08scaling_factor\uff09\u4e0e\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08clamped_logp_diff\uff09\u7ed3\u5408\u8d77\u6765\u3002\n    scaled_logp_term = scaling_factor * clamped_logp_diff\n\n    # 7. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u6700\u7ec8\u7684\u5e73\u6ed1Hinge Loss\u3002\n    #    \u5f53\u6a21\u578b\u7684\u52a0\u6743\u7f6e\u4fe1\u5ea6(scaled_logp_term)\u5c0f\u4e8e\u52a8\u6001\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    #    \u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u52a0\u6743\uff08\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u90fd\u4f9d\u8d56\u4e8e\u6210\u672c\u5dee\u5f02\uff09\u5f3a\u5316\u4e86\u5bf9\u91cd\u8981\u6837\u672c\u7684\u5b66\u4e60\u3002\n    loss = softplus(dynamic_margin - scaled_logp_term)\n\n    # \u8fd4\u56de\u6279\u6b21\u4e2d\u6240\u6709\u6837\u672c\u635f\u5931\u7684\u5747\u503c\u3002\n    return mean(loss)", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u663e\u8457\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}, "tau": {"value": 5.0, "description": "\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u88c1\u526a\u9608\u503c\u3002\u7528\u4e8e\u7a33\u5b9a\u8bad\u7ec3\uff0c\u9632\u6b62\u56e0\u6781\u7aef\u7684logp\u5dee\u5f02\u5bfc\u81f4\u68af\u5ea6\u7206\u70b8\u3002\u5b83\u5b9a\u4e49\u4e86\u6a21\u578b\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u7684\u6709\u6548\u8303\u56f4[-tau, tau]\uff0c\u5728\u8be5\u8303\u56f4\u4e4b\u5916\u7684\u68af\u5ea6\u5c06\u88ab\u88c1\u526a\u3002"}}, "operators_used": ["zscore", "softplus", "clamp"], "implementation_hint": {"expects": ["Expects batch tensors for costs and log probabilities: `cost_w_batch` (N,), `cost_l_batch` (N,), `logp_w_batch` (N,), `logp_l_batch` (N,), where N is the batch size, and `cost_w_batch[i] < cost_l_batch[i]` for all i."], "returns": "Returns a single scalar value representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.104182958602905, "validation_objective": 4.104182958602905, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.056178689002991}, "train_score_mean": 4.240127377212048, "train_loss_mean": 0.6928648594766855, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedAdaptiveHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u80fd\u9002\u5e94\u6210\u672c\u5206\u5e03\uff0c\u53c8\u80fd\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u5c06\u7236\u4ee30\u4e2d\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684\u201c\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u201d\u601d\u60f3\u4e0e\u7236\u4ee31\u4e2d\u5bf9\u6982\u7387\u5dee\u5f02\u8fdb\u884c\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u601d\u60f3\u8fdb\u884c\u878d\u5408\uff0c\u5e76\u5f15\u5165\u4e86\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u6280\u5de7\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6838\u5fc3\u7ed3\u6784\u662f`softplus(margin - term)`\u5f62\u5f0f\u7684\u5e73\u6ed1Hinge Loss\u3002\u8fd9\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u8ba1\u7b97\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c06\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u79cd\u7ed3\u6784\u5bf9\u5b66\u4e60\u76ee\u6807\u6709\u6e05\u6670\u7684\u5b9a\u4e49\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684`scaling_factor`\u6765\u52a0\u6743`logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u4e3a\u4e86\u4f7f\u52a8\u6001\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u5bf9\u6574\u4e2a\u6279\u6b21\uff08batch\uff09\u7684\u6210\u672c\u5206\u5e03\u5177\u6709\u66f4\u5f3a\u7684\u9002\u5e94\u6027\uff0c\u6211\u4eec\u653e\u5f03\u4e86\u57fa\u4e8e\u5355\u4e2a\u6837\u672c\u5bf9\u7684`rank_gap`\uff0c\u8f6c\u800c\u4f7f\u7528`zscore(cost_l - cost_w)`\u3002`zscore`\u901a\u8fc7\u51cf\u53bb\u6279\u6b21\u5747\u503c\u5e76\u9664\u4ee5\u6807\u51c6\u5dee\uff0c\u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u5206\u6570\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u8ba1\u7b97\u4e0d\u518d\u53d7\u6210\u672c\u7edd\u5bf9\u503c\u5927\u5c0f\u548c\u8303\u56f4\u7684\u5f71\u54cd\uff0c\u800c\u662f\u53d6\u51b3\u4e8e\u67d0\u4e2a\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02\u5728\u5176\u6240\u5728\u6279\u6b21\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u4e00\u4e2a\u5728\u6279\u6b21\u4e2d\u5dee\u5f02\u6781\u5927\u7684\u6837\u672c\u5bf9\u4f1a\u83b7\u5f97\u66f4\u9ad8\u7684z-score\uff0c\u4ece\u800c\u83b7\u5f97\u66f4\u9ad8\u7684\u88d5\u5ea6\u548c\u6743\u91cd\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002\u8fd9\u662f\u4e00\u79cd\u66f4\u5168\u5c40\u3001\u66f4\u5177\u9002\u5e94\u6027\u7684\u5f52\u4e00\u5316\u7b56\u7565\u3002\n2.  **\u65b0\u7684\u7a33\u5b9a\u6280\u5de7 (\u8026\u5408\u70b92)**\uff1a\u867d\u7136`tanh`\u53ef\u4ee5\u7a33\u5b9a`logp_diff`\uff0c\u4f46\u5b83\u4f1a\u5c06\u6240\u6709\u5dee\u5f02\u538b\u7f29\u5230[-1, 1]\u533a\u95f4\uff0c\u53ef\u80fd\u4e22\u5931\u4e00\u4e9b\u5927\u5e45\u5ea6\u5dee\u5f02\u7684\u4fe1\u53f7\u3002\u6211\u4eec\u5f15\u5165`clamp(logp_diff, -tau, tau)`\u4f5c\u4e3a\u66ff\u4ee3\u65b9\u6848\u3002`clamp`\u5c06\u5bf9\u6570\u6982\u7387\u5dee\u9650\u5236\u5728\u4e00\u4e2a\u7531\u8d85\u53c2\u6570`tau`\u5b9a\u4e49\u7684\u8303\u56f4\u5185 `[-tau, tau]`\u3002\u8fd9\u65e2\u80fd\u6709\u6548\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff08\u5bf9\u4e8e\u975e\u5e38\u5927\u6216\u975e\u5e38\u5c0f\u7684`logp_diff`\uff09\uff0c\u53c8\u80fd\u4fdd\u7559\u5728`[-tau, tau]`\u8303\u56f4\u5185\u7684\u539f\u59cb\u5dee\u5f02\u5e45\u5ea6\uff0c\u6bd4`tanh`\u63d0\u4f9b\u4e86\u66f4\u7075\u6d3b\u7684\u63a7\u5236\uff0c\u907f\u514d\u4e86`tanh`\u5728\u63a5\u8fd1\u00b11\u5904\u7684\u68af\u5ea6\u6d88\u5931\u95ee\u9898\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7`zscore`\u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u6279\u6b21\u81ea\u9002\u5e94\u5f52\u4e00\u5316\uff0c\u7528\u5b83\u540c\u65f6\u9a71\u52a8\u201c\u52a8\u6001\u88d5\u5ea6\u201d\u548c\u201c\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u201d\uff1b\u7136\u540e\uff0c\u5b83\u5c06\u8fd9\u4e2a\u52a0\u6743\u540e\u7684\u3001\u7ecf\u8fc7`clamp`\u7a33\u5b9a\u5316\u7684\u6982\u7387\u5dee\u5f02\u9879\u5d4c\u5165\u5230Hinge Loss\u6846\u67b6\u4e2d\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u80fd\u591f\u6839\u636e\u5f53\u524d\u6279\u6b21\u7684\u6570\u636e\u5206\u5e03\u52a8\u6001\u8c03\u6574\u5b66\u4e60\u91cd\u70b9\uff0c\u540c\u65f6\u901a\u8fc7`clamp`\u6280\u5de7\u4fdd\u8bc1\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u548c\u6548\u7387\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u663e\u8457\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}, "tau": {"value": 5.0, "description": "\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u88c1\u526a\u9608\u503c\u3002\u7528\u4e8e\u7a33\u5b9a\u8bad\u7ec3\uff0c\u9632\u6b62\u56e0\u6781\u7aef\u7684logp\u5dee\u5f02\u5bfc\u81f4\u68af\u5ea6\u7206\u70b8\u3002\u5b83\u5b9a\u4e49\u4e86\u6a21\u578b\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u7684\u6709\u6548\u8303\u56f4[-tau, tau]\uff0c\u5728\u8be5\u8303\u56f4\u4e4b\u5916\u7684\u68af\u5ea6\u5c06\u88ab\u88c1\u526a\u3002"}}, "operators_used": ["zscore", "softplus", "clamp"]}}}
{"generation": 6, "index": 3, "ir": {"name": "AdaptiveSigmoidWeightedHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u7a33\u5b9a\u53c8\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u878d\u5408\u4e86Hinge Loss\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\uff08margin\uff09\u201d\u601d\u60f3\u548cLogSigmoid\u635f\u5931\u4e2d\u5e38\u89c1\u7684\u201c\u9690\u5f0f\u52a0\u6743\u201d\u601d\u60f3\uff0c\u5e76\u901a\u8fc7\u65b0\u7684\u8026\u5408\u65b9\u5f0f\u589e\u5f3a\u4e86\u6a21\u578b\u7684\u9002\u5e94\u6027\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u5730\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u88d5\u5ea6\u4e0e\u52a0\u6743\u7684\u89e3\u8026\u8bbe\u8ba1 (\u8026\u5408\u70b91)**\uff1a\u4e0e\u7236\u4ee31\uff08`HybridMarginLogSigmoidLoss`\uff09\u4e0d\u540c\uff0c\u7236\u4ee31\u5c06\u6210\u672c\u5dee\u5f02\u540c\u65f6\u7528\u4e8e\u8ba1\u7b97`dynamic_margin`\u548c`scaled_logp_diff`\uff0c\u5f62\u6210\u4e86\u4e00\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u3002\u6211\u4eec\u8ba4\u4e3a\u8fd9\u53ef\u80fd\u5bfc\u81f4\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u8fc7\u5ea6\u654f\u611f\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5c06\u8fd9\u4e24\u8005\u89e3\u8026\uff1a\u88d5\u5ea6`margin`\u88ab\u8bbe\u8ba1\u6210\u4e00\u4e2a\u56fa\u5b9a\u7684\u8d85\u53c2\u6570`beta`\uff0c\u4ee3\u8868\u4e00\u4e2a\u5168\u5c40\u7684\u6700\u5c0f\u504f\u597d\u5dee\u8ddd\u8981\u6c42\uff1b\u800c`logp_diff`\u5219\u7531\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684`scaling_factor`\u8fdb\u884c\u52a8\u6001\u52a0\u6743\u3002\u8fd9\u79cd\u8bbe\u8ba1\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u65e2\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u201c\u57fa\u7840\u201d\u5b66\u4e60\u76ee\u6807\uff08\u88d5\u5ea6\uff09\uff0c\u53c8\u80fd\u6839\u636e\u6837\u672c\u5bf9\u7684\u91cd\u8981\u6027\uff08\u6210\u672c\u5dee\u5f02\uff09\u81ea\u9002\u5e94\u5730\u8c03\u6574\u68af\u5ea6\u5927\u5c0f\u3002\n2.  **Sigmoid\u52a0\u6743\u66ff\u4ee3\u7ebf\u6027\u52a0\u6743 (\u8026\u5408\u70b92)**\uff1a\u7236\u4ee31\u4f7f\u7528`softplus(cost_rank_diff)`\u4f5c\u4e3a\u7f29\u653e\u56e0\u5b50\uff0c\u8fd9\u662f\u4e00\u4e2a\u65e0\u754c\u7684\u7ebf\u6027\u589e\u957f\u51fd\u6570\u3002\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u8026\u5408\u70b9\uff0c\u6539\u7528`sigmoid(cost_rank_diff)`\u6765\u8ba1\u7b97`scaling_factor`\u3002`sigmoid`\u51fd\u6570\u5c06\u7f29\u653e\u56e0\u5b50\u5e73\u6ed1\u5730\u9650\u5236\u5728(0, 1)\u533a\u95f4\u5185\u3002\u8fd9\u6837\u505a\u6709\u51e0\u4e2a\u597d\u5904\uff1a\u9996\u5148\uff0c\u5b83\u4e3a\u52a0\u6743\u63d0\u4f9b\u4e86\u4e00\u4e2a\u81ea\u7136\u7684\u3001\u6709\u754c\u7684\u8303\u56f4\uff0c\u9632\u6b62\u4e86\u56e0\u6781\u5927\u6210\u672c\u5dee\u5f02\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\uff1b\u5176\u6b21\uff0c`sigmoid`\u7684S\u5f62\u66f2\u7ebf\u610f\u5473\u7740\u5f53\u6210\u672c\u5dee\u5f02\u8f83\u5c0f\u65f6\uff0c\u52a0\u6743\u56e0\u5b50\u589e\u957f\u8f83\u5feb\uff0c\u800c\u5f53\u6210\u672c\u5dee\u5f02\u975e\u5e38\u5927\u65f6\uff0c\u52a0\u6743\u56e0\u5b50\u8d8b\u4e8e\u9971\u548c\uff08\u63a5\u8fd11\uff09\uff0c\u8fd9\u4f7f\u5f97\u6a21\u578b\u80fd\u66f4\u4e13\u6ce8\u4e8e\u533a\u5206\u201c\u4e2d\u7b49\u96be\u5ea6\u201d\u7684\u6837\u672c\u5bf9\uff0c\u800c\u4e0d\u662f\u88ab\u5c11\u6570\u6781\u7aef\u56f0\u96be\u7684\u6837\u672c\u5bf9\u4e3b\u5bfc\u3002\n\n\u603b\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee30\u7684\u56fa\u5b9a\u88d5\u5ea6\u601d\u60f3\u548c\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\u8fdb\u884c\u89e3\u8026\uff0c\u5e76\u5f15\u5165`sigmoid`\u4f5c\u4e3a\u65b0\u7684\u52a0\u6743\u673a\u5236\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u9c81\u68d2\u4e14\u7075\u6d3b\u7684Hinge Loss\u53d8\u4f53\u3002\u5b83\u8981\u6c42\u6a21\u578b\u5bf9\u6240\u6709\u6837\u672c\u5bf9\u90fd\u8fbe\u5230\u4e00\u4e2a\u6700\u5c0f\u7684\u504f\u597d\u5dee\u8ddd\uff08`beta`\uff09\uff0c\u540c\u65f6\u5bf9\u6210\u672c\u5dee\u5f02\u8f83\u5927\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5927\u7684\u5b66\u4e60\u538b\u529b\uff0c\u4f46\u8fd9\u79cd\u538b\u529b\u88ab`sigmoid`\u51fd\u6570\u4f18\u96c5\u5730\u63a7\u5236\u5728\u4e00\u4e2a\u7a33\u5b9a\u7684\u8303\u56f4\u5185\u3002", "pseudocode": "def AdaptiveSigmoidWeightedHingeLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    \u8fd9\u4e2a\u601d\u60f3\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u6709\u4f53\u73b0\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u65b0\u8026\u5408\u70b91] \u8bbe\u8ba1\u4e00\u4e2a\u56fa\u5b9a\u7684\u88d5\u5ea6(margin)\u3002\n    #    \u4e0e\u7236\u4ee30\u548c1\u7684\u52a8\u6001\u88d5\u5ea6\u4e0d\u540c\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u56fa\u5b9a\u7684\u8d85\u53c2\u6570beta\u4f5c\u4e3a\u88d5\u5ea6\u3002\n    #    \u8fd9\u7ee7\u627f\u4e86Hinge Loss\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\u201d\u601d\u60f3\uff0c\u4f46\u5c06\u5176\u4e0e\u6210\u672c\u5dee\u5f02\u89e3\u8026\u3002\n    fixed_margin = beta\n\n    # 4. [\u65b0\u8026\u5408\u70b92] \u521b\u5efa\u4e00\u4e2a\u57fa\u4e8eSigmoid\u7684\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u3002\n    #    \u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u7684\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u601d\u60f3\uff0c\u4f46\u4f7f\u7528sigmoid\u4ee3\u66ffsoftplus\u3002\n    #    sigmoid\u5c06\u7f29\u653e\u56e0\u5b50\u9650\u5236\u5728(0, 1)\u8303\u56f4\u5185\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\u3002\n    scaling_factor = sigmoid(cost_rank_diff)\n\n    # 5. [\u7ee7\u627f] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\u3002\n    #    \u8fd9\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u4e2d\u7684\u5f71\u54cd\u529b\u8d8a\u5927\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 7. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u5c06\u52a0\u6743\u9879\u5d4c\u5165Hinge Loss\u6846\u67b6\u3002\n    #    \u6211\u4eec\u4f7f\u7528\u7236\u4ee30\u7684Hinge\u7ed3\u6784\uff0c\u4f46\u7528\u201c\u56fa\u5b9a\u88d5\u5ea6\u201d\u548c\u201c\u52a0\u6743\u7f6e\u4fe1\u5ea6\u9879\u201d\u8fdb\u884c\u8ba1\u7b97\u3002\n    #    \u5f53\u6a21\u578b\u7684\u52a0\u6743\u7f6e\u4fe1\u5ea6(scaled_logp_diff)\u5c0f\u4e8e\u56fa\u5b9a\u88d5\u5ea6(fixed_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    loss = softplus(fixed_margin - scaled_logp_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 0.1, "description": "\u56fa\u5b9a\u7684\u88d5\u5ea6\u8d85\u53c2\u6570\u3002\u5b83\u5b9a\u4e49\u4e86\u6a21\u578b\u9700\u8981\u8fbe\u5230\u7684\u6700\u5c0f\u504f\u597d\u5dee\u8ddd\u76ee\u6807\u3002\u4e0e\u7236\u4ee3\u4e0d\u540c\uff0c\u8fd9\u4e2a\u88d5\u5ea6\u4e0d\u968f\u6210\u672c\u5dee\u5f02\u53d8\u5316\uff0c\u4e3a\u6240\u6709\u6837\u672c\u5bf9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u6700\u4f4e\u8981\u6c42\u3002\u8f83\u5c0f\u7684beta\u503c\uff08\u59820.1-0.5\uff09\u901a\u5e38\u662f\u5408\u7406\u7684\u8d77\u70b9\u3002"}}, "operators_used": ["rank_gap", "sigmoid", "tanh", "softplus"], "implementation_hint": {"expects": ["cost_a, cost_b, logp_a, logp_b (all scalars or tensors of the same shape), and hyperparameter beta (scalar)."], "returns": "A scalar or tensor (matching input shape) representing the loss for the pair. The value is non-negative."}}, "fitness": {"hf_like_score": 4.123759031295776, "validation_objective": 4.123759031295776, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.062996864318848}, "train_score_mean": 4.290332019329071, "train_loss_mean": 0.6927931364625692, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveSigmoidWeightedHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u7a33\u5b9a\u53c8\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u878d\u5408\u4e86Hinge Loss\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\uff08margin\uff09\u201d\u601d\u60f3\u548cLogSigmoid\u635f\u5931\u4e2d\u5e38\u89c1\u7684\u201c\u9690\u5f0f\u52a0\u6743\u201d\u601d\u60f3\uff0c\u5e76\u901a\u8fc7\u65b0\u7684\u8026\u5408\u65b9\u5f0f\u589e\u5f3a\u4e86\u6a21\u578b\u7684\u9002\u5e94\u6027\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u5730\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u88d5\u5ea6\u4e0e\u52a0\u6743\u7684\u89e3\u8026\u8bbe\u8ba1 (\u8026\u5408\u70b91)**\uff1a\u4e0e\u7236\u4ee31\uff08`HybridMarginLogSigmoidLoss`\uff09\u4e0d\u540c\uff0c\u7236\u4ee31\u5c06\u6210\u672c\u5dee\u5f02\u540c\u65f6\u7528\u4e8e\u8ba1\u7b97`dynamic_margin`\u548c`scaled_logp_diff`\uff0c\u5f62\u6210\u4e86\u4e00\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u3002\u6211\u4eec\u8ba4\u4e3a\u8fd9\u53ef\u80fd\u5bfc\u81f4\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u8fc7\u5ea6\u654f\u611f\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5c06\u8fd9\u4e24\u8005\u89e3\u8026\uff1a\u88d5\u5ea6`margin`\u88ab\u8bbe\u8ba1\u6210\u4e00\u4e2a\u56fa\u5b9a\u7684\u8d85\u53c2\u6570`beta`\uff0c\u4ee3\u8868\u4e00\u4e2a\u5168\u5c40\u7684\u6700\u5c0f\u504f\u597d\u5dee\u8ddd\u8981\u6c42\uff1b\u800c`logp_diff`\u5219\u7531\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684`scaling_factor`\u8fdb\u884c\u52a8\u6001\u52a0\u6743\u3002\u8fd9\u79cd\u8bbe\u8ba1\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u65e2\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u201c\u57fa\u7840\u201d\u5b66\u4e60\u76ee\u6807\uff08\u88d5\u5ea6\uff09\uff0c\u53c8\u80fd\u6839\u636e\u6837\u672c\u5bf9\u7684\u91cd\u8981\u6027\uff08\u6210\u672c\u5dee\u5f02\uff09\u81ea\u9002\u5e94\u5730\u8c03\u6574\u68af\u5ea6\u5927\u5c0f\u3002\n2.  **Sigmoid\u52a0\u6743\u66ff\u4ee3\u7ebf\u6027\u52a0\u6743 (\u8026\u5408\u70b92)**\uff1a\u7236\u4ee31\u4f7f\u7528`softplus(cost_rank_diff)`\u4f5c\u4e3a\u7f29\u653e\u56e0\u5b50\uff0c\u8fd9\u662f\u4e00\u4e2a\u65e0\u754c\u7684\u7ebf\u6027\u589e\u957f\u51fd\u6570\u3002\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u8026\u5408\u70b9\uff0c\u6539\u7528`sigmoid(cost_rank_diff)`\u6765\u8ba1\u7b97`scaling_factor`\u3002`sigmoid`\u51fd\u6570\u5c06\u7f29\u653e\u56e0\u5b50\u5e73\u6ed1\u5730\u9650\u5236\u5728(0, 1)\u533a\u95f4\u5185\u3002\u8fd9\u6837\u505a\u6709\u51e0\u4e2a\u597d\u5904\uff1a\u9996\u5148\uff0c\u5b83\u4e3a\u52a0\u6743\u63d0\u4f9b\u4e86\u4e00\u4e2a\u81ea\u7136\u7684\u3001\u6709\u754c\u7684\u8303\u56f4\uff0c\u9632\u6b62\u4e86\u56e0\u6781\u5927\u6210\u672c\u5dee\u5f02\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\uff1b\u5176\u6b21\uff0c`sigmoid`\u7684S\u5f62\u66f2\u7ebf\u610f\u5473\u7740\u5f53\u6210\u672c\u5dee\u5f02\u8f83\u5c0f\u65f6\uff0c\u52a0\u6743\u56e0\u5b50\u589e\u957f\u8f83\u5feb\uff0c\u800c\u5f53\u6210\u672c\u5dee\u5f02\u975e\u5e38\u5927\u65f6\uff0c\u52a0\u6743\u56e0\u5b50\u8d8b\u4e8e\u9971\u548c\uff08\u63a5\u8fd11\uff09\uff0c\u8fd9\u4f7f\u5f97\u6a21\u578b\u80fd\u66f4\u4e13\u6ce8\u4e8e\u533a\u5206\u201c\u4e2d\u7b49\u96be\u5ea6\u201d\u7684\u6837\u672c\u5bf9\uff0c\u800c\u4e0d\u662f\u88ab\u5c11\u6570\u6781\u7aef\u56f0\u96be\u7684\u6837\u672c\u5bf9\u4e3b\u5bfc\u3002\n\n\u603b\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee30\u7684\u56fa\u5b9a\u88d5\u5ea6\u601d\u60f3\u548c\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\u8fdb\u884c\u89e3\u8026\uff0c\u5e76\u5f15\u5165`sigmoid`\u4f5c\u4e3a\u65b0\u7684\u52a0\u6743\u673a\u5236\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u9c81\u68d2\u4e14\u7075\u6d3b\u7684Hinge Loss\u53d8\u4f53\u3002\u5b83\u8981\u6c42\u6a21\u578b\u5bf9\u6240\u6709\u6837\u672c\u5bf9\u90fd\u8fbe\u5230\u4e00\u4e2a\u6700\u5c0f\u7684\u504f\u597d\u5dee\u8ddd\uff08`beta`\uff09\uff0c\u540c\u65f6\u5bf9\u6210\u672c\u5dee\u5f02\u8f83\u5927\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5927\u7684\u5b66\u4e60\u538b\u529b\uff0c\u4f46\u8fd9\u79cd\u538b\u529b\u88ab`sigmoid`\u51fd\u6570\u4f18\u96c5\u5730\u63a7\u5236\u5728\u4e00\u4e2a\u7a33\u5b9a\u7684\u8303\u56f4\u5185\u3002", "hyperparams": {"beta": {"value": 0.1, "description": "\u56fa\u5b9a\u7684\u88d5\u5ea6\u8d85\u53c2\u6570\u3002\u5b83\u5b9a\u4e49\u4e86\u6a21\u578b\u9700\u8981\u8fbe\u5230\u7684\u6700\u5c0f\u504f\u597d\u5dee\u8ddd\u76ee\u6807\u3002\u4e0e\u7236\u4ee3\u4e0d\u540c\uff0c\u8fd9\u4e2a\u88d5\u5ea6\u4e0d\u968f\u6210\u672c\u5dee\u5f02\u53d8\u5316\uff0c\u4e3a\u6240\u6709\u6837\u672c\u5bf9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u6700\u4f4e\u8981\u6c42\u3002\u8f83\u5c0f\u7684beta\u503c\uff08\u59820.1-0.5\uff09\u901a\u5e38\u662f\u5408\u7406\u7684\u8d77\u70b9\u3002"}}, "operators_used": ["rank_gap", "sigmoid", "tanh", "softplus"]}}}
{"generation": 6, "index": 4, "ir": {"name": "ZScoreClippedAdaptiveHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5bf9\u6781\u7aef\u6210\u672c\u503c\u548c\u6a21\u578b\u8f93\u51fa\u5177\u6709\u9ad8\u5ea6\u9c81\u68d2\u6027\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - confidence_term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08confidence_term\uff09\u5fc5\u987b\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08margin\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4e3a\u6a21\u578b\u63d0\u4f9b\u4e86\u6e05\u6670\u7684\u4f18\u5316\u65b9\u5411\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 `softplus(cost_diff)` \u4f5c\u4e3a\u7f29\u653e\u56e0\u5b50\uff0c\u8fd9\u786e\u4fdd\u4e86\u7f29\u653e\u56e0\u5b50\u662f\u5e73\u6ed1\u4e14\u975e\u8d1f\u7684\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u4e3a\u4e86\u589e\u5f3a\u5bf9\u6210\u672c\u5206\u5e03\u548c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528\u539f\u59cb\u7684\u6210\u672c\u5dee\u5f02\u6216 `rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u3002\u6211\u4eec\u9996\u5148\u5bf9\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u7684\u6240\u6709\u6210\u672c\uff08`costs`\uff09\u8ba1\u7b97\u5176\u5747\u503c\u548c\u6807\u51c6\u5dee\uff0c\u7136\u540e\u7528 `zscore(cost_w)` \u548c `zscore(cost_l)` \u5f97\u5230\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u3002\u8fd9\u6837\uff0c`cost_diff` \u53cd\u6620\u7684\u662f\u80dc\u8005\u548c\u8d25\u8005\u5728\u5f53\u524d\u6279\u6b21\u6210\u672c\u5206\u5e03\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff08\u76f8\u5dee\u591a\u5c11\u4e2a\u6807\u51c6\u5dee\uff09\uff0c\u800c\u4e0d\u662f\u7edd\u5bf9\u6570\u503c\u5dee\u5f02\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u4e0d\u654f\u611f\uff0c\u4ece\u800c\u5728\u4e0d\u540c\u95ee\u9898\u6216\u8bad\u7ec3\u9636\u6bb5\u90fd\u80fd\u4fdd\u6301\u7a33\u5b9a\u7684\u8868\u73b0\u3002\n2.  **\u5f15\u5165 `clamp` \u8fdb\u884c\u7a33\u5b9a\u6027\u63a7\u5236 (\u8026\u5408\u70b92)**\uff1a\u867d\u7136 `tanh` \u53ef\u4ee5\u7a33\u5b9a `logp_diff`\uff0c\u4f46\u5b83\u5728\u63a5\u8fd1-1\u548c1\u65f6\u68af\u5ea6\u4f1a\u6d88\u5931\u3002\u6211\u4eec\u5f15\u5165 `clamp` \u7b97\u5b50\u4f5c\u4e3a\u4e00\u79cd\u66ff\u4ee3\u7684\u3001\u66f4\u786c\u6027\u7684\u7a33\u5b9a\u6280\u5de7\u3002\u6211\u4eec\u5c06 `logp_w - logp_l` \u88c1\u526a\u5230\u4e00\u4e2a\u9884\u8bbe\u7684\u8303\u56f4 `[-gamma, gamma]` \u5185\u3002\u8fd9\u6837\u505a\u6709\u53cc\u91cd\u597d\u5904\uff1a\u9996\u5148\uff0c\u5b83\u80fd\u6709\u6548\u9632\u6b62\u7531\u4e8e `logp_diff` \u8fc7\u5927\u6216\u8fc7\u5c0f\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u6216\u6d88\u5931\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\uff1b\u5176\u6b21\uff0c\u5b83\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u201c\u6ee1\u8db3\u533a\u201d\uff0c\u5f53\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\u5df2\u7ecf\u8db3\u591f\u5f3a\uff08\u7edd\u5bf9\u503c\u8d85\u8fc7 `gamma`\uff09\u65f6\uff0c\u6211\u4eec\u5c31\u4e0d\u518d\u65bd\u52a0\u66f4\u5f3a\u7684\u68af\u5ea6\uff0c\u8ba9\u6a21\u578b\u53ef\u4ee5\u5c06\u201c\u6ce8\u610f\u529b\u201d\u96c6\u4e2d\u5728\u66f4\u96be\u533a\u5206\u7684\u6837\u672c\u5bf9\u4e0a\u3002\n\n\u603b\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7 `zscore` \u5f52\u4e00\u5316\u83b7\u5f97\u4e86\u5bf9\u6210\u672c\u5c3a\u5ea6\u7684\u9002\u5e94\u6027\uff0c\u901a\u8fc7 `clamp` \u7a33\u5b9a\u4e86\u6a21\u578b\u8f93\u51fa\u7684\u68af\u5ea6\uff0c\u5e76\u5de7\u5999\u5730\u5c06 `softplus` \u7f29\u653e\u56e0\u5b50\u4e0e\u7ecf\u5178\u7684Hinge Loss\u6846\u67b6\u7ed3\u5408\uff0c\u5b9e\u73b0\u4e86\u5728\u9c81\u68d2\u6027\u3001\u7a33\u5b9a\u6027\u548c\u5bf9\u5173\u952e\u6837\u672c\u7684\u654f\u611f\u6027\u4e4b\u95f4\u7684\u65b0\u5e73\u8861\u3002", "pseudocode": "def ZScoreClippedAdaptiveHingeLoss(costs_in_batch, cost_w, cost_l, logp_w, logp_l, beta, gamma):\n    # 1. [\u65b0\u8026\u5408\u70b91] \u5bf9\u6279\u6b21\u5185\u7684\u6210\u672c\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\n    #    \u8fd9\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u7684\u5ea6\u91cf\u76f8\u5bf9\u4e8e\u5f53\u524d\u6279\u6b21\u7684\u5206\u5e03\uff0c\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\n    norm_cost_w = zscore(cost_w, costs_in_batch)\n    norm_cost_l = zscore(cost_l, costs_in_batch)\n    # cost_w < cost_l, so norm_cost_w < norm_cost_l, and norm_cost_l - norm_cost_w > 0\n    cost_diff = norm_cost_l - norm_cost_w\n\n    # 2. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8bbe\u8ba1\u4e00\u4e2a\u57fa\u4e8e\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\u7684\u52a8\u6001\u88d5\u5ea6(margin)\n    #    \u88d5\u5ea6\u7684\u5927\u5c0f\u4e0e\u6210\u672c\u5728\u5206\u5e03\u4e2d\u7684\u76f8\u5bf9\u5dee\u8ddd\u6210\u6b63\u6bd4\u3002\n    dynamic_margin = beta * cost_diff\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u521b\u5efa\u4e00\u4e2a\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\n    #    \u4f7f\u7528softplus\u786e\u4fdd\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\uff0c\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u3002\n    scaling_factor = softplus(cost_diff)\n\n    # 4. [\u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u5e76\u88c1\u526a\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u4f7f\u7528clamp\u66ff\u4ee3tanh\uff0c\u5c06logp_diff\u9650\u5236\u5728[-gamma, gamma]\u533a\u95f4\u5185\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8/\u6d88\u5931\u3002\n    raw_logp_diff = logp_w - logp_l\n    clipped_logp_diff = clamp(raw_logp_diff, min=-gamma, max=gamma)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u7f6e\u4fe1\u5ea6\u9879\n    #    \u8fd9\u662f\u7236\u4ee31\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u601d\u60f3\u7684\u76f4\u63a5\u4f53\u73b0\u3002\n    confidence_term = scaling_factor * clipped_logp_diff\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u6700\u7ec8\u7684Hinge Loss\n    #    \u5f53\u52a0\u6743\u7f6e\u4fe1\u5ea6(confidence_term)\u5c0f\u4e8e\u52a8\u6001\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    #    \u8fd9\u878d\u5408\u4e86\u4e24\u4e2a\u7236\u4ee3\u7684\u6838\u5fc3\u8bbe\u8ba1\u3002\n    loss = softplus(dynamic_margin - confidence_term)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8eZ-Score\u5f52\u4e00\u5316\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}, "gamma": {"value": 5.0, "description": "\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u88c1\u526a\u9608\u503c\u3002\u5b83\u5b9a\u4e49\u4e86\u6a21\u578b\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08logp_w - logp_l\uff09\u7684\u6709\u6548\u8303\u56f4[-gamma, gamma]\u3002\u8fd9\u6709\u52a9\u4e8e\u7a33\u5b9a\u8bad\u7ec3\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u5e76\u8ba9\u6a21\u578b\u5728\u7f6e\u4fe1\u5ea6\u8db3\u591f\u9ad8\u65f6\u505c\u6b62\u4f18\u5316\uff0c\u8f6c\u800c\u5173\u6ce8\u66f4\u96be\u7684\u6837\u672c\u3002"}}, "operators_used": ["zscore", "softplus", "clamp"], "implementation_hint": {"expects": ["A batch of costs (`costs_in_batch`), a winner-loser pair's costs (`cost_w`, `cost_l`), and their log probabilities (`logp_w`, `logp_l`). `cost_w` must be less than `cost_l`."], "returns": "A single scalar loss value for the pair."}}, "fitness": {"hf_like_score": 4.056625008583069, "validation_objective": 4.054831504821777, "generalization_penalty": 0.001793503761291504, "generalization_objectives": {"20": 4.056625008583069}, "train_score_mean": 4.246248468756676, "train_loss_mean": 0.6928190011531115, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedAdaptiveHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5bf9\u6781\u7aef\u6210\u672c\u503c\u548c\u6a21\u578b\u8f93\u51fa\u5177\u6709\u9ad8\u5ea6\u9c81\u68d2\u6027\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - confidence_term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08confidence_term\uff09\u5fc5\u987b\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u88d5\u5ea6\uff08margin\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4e3a\u6a21\u578b\u63d0\u4f9b\u4e86\u6e05\u6670\u7684\u4f18\u5316\u65b9\u5411\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 `softplus(cost_diff)` \u4f5c\u4e3a\u7f29\u653e\u56e0\u5b50\uff0c\u8fd9\u786e\u4fdd\u4e86\u7f29\u653e\u56e0\u5b50\u662f\u5e73\u6ed1\u4e14\u975e\u8d1f\u7684\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u4e3a\u4e86\u589e\u5f3a\u5bf9\u6210\u672c\u5206\u5e03\u548c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528\u539f\u59cb\u7684\u6210\u672c\u5dee\u5f02\u6216 `rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u3002\u6211\u4eec\u9996\u5148\u5bf9\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u7684\u6240\u6709\u6210\u672c\uff08`costs`\uff09\u8ba1\u7b97\u5176\u5747\u503c\u548c\u6807\u51c6\u5dee\uff0c\u7136\u540e\u7528 `zscore(cost_w)` \u548c `zscore(cost_l)` \u5f97\u5230\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u3002\u8fd9\u6837\uff0c`cost_diff` \u53cd\u6620\u7684\u662f\u80dc\u8005\u548c\u8d25\u8005\u5728\u5f53\u524d\u6279\u6b21\u6210\u672c\u5206\u5e03\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff08\u76f8\u5dee\u591a\u5c11\u4e2a\u6807\u51c6\u5dee\uff09\uff0c\u800c\u4e0d\u662f\u7edd\u5bf9\u6570\u503c\u5dee\u5f02\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u4e0d\u654f\u611f\uff0c\u4ece\u800c\u5728\u4e0d\u540c\u95ee\u9898\u6216\u8bad\u7ec3\u9636\u6bb5\u90fd\u80fd\u4fdd\u6301\u7a33\u5b9a\u7684\u8868\u73b0\u3002\n2.  **\u5f15\u5165 `clamp` \u8fdb\u884c\u7a33\u5b9a\u6027\u63a7\u5236 (\u8026\u5408\u70b92)**\uff1a\u867d\u7136 `tanh` \u53ef\u4ee5\u7a33\u5b9a `logp_diff`\uff0c\u4f46\u5b83\u5728\u63a5\u8fd1-1\u548c1\u65f6\u68af\u5ea6\u4f1a\u6d88\u5931\u3002\u6211\u4eec\u5f15\u5165 `clamp` \u7b97\u5b50\u4f5c\u4e3a\u4e00\u79cd\u66ff\u4ee3\u7684\u3001\u66f4\u786c\u6027\u7684\u7a33\u5b9a\u6280\u5de7\u3002\u6211\u4eec\u5c06 `logp_w - logp_l` \u88c1\u526a\u5230\u4e00\u4e2a\u9884\u8bbe\u7684\u8303\u56f4 `[-gamma, gamma]` \u5185\u3002\u8fd9\u6837\u505a\u6709\u53cc\u91cd\u597d\u5904\uff1a\u9996\u5148\uff0c\u5b83\u80fd\u6709\u6548\u9632\u6b62\u7531\u4e8e `logp_diff` \u8fc7\u5927\u6216\u8fc7\u5c0f\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u6216\u6d88\u5931\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u6570\u503c\u7a33\u5b9a\u6027\uff1b\u5176\u6b21\uff0c\u5b83\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u201c\u6ee1\u8db3\u533a\u201d\uff0c\u5f53\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\u5df2\u7ecf\u8db3\u591f\u5f3a\uff08\u7edd\u5bf9\u503c\u8d85\u8fc7 `gamma`\uff09\u65f6\uff0c\u6211\u4eec\u5c31\u4e0d\u518d\u65bd\u52a0\u66f4\u5f3a\u7684\u68af\u5ea6\uff0c\u8ba9\u6a21\u578b\u53ef\u4ee5\u5c06\u201c\u6ce8\u610f\u529b\u201d\u96c6\u4e2d\u5728\u66f4\u96be\u533a\u5206\u7684\u6837\u672c\u5bf9\u4e0a\u3002\n\n\u603b\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7 `zscore` \u5f52\u4e00\u5316\u83b7\u5f97\u4e86\u5bf9\u6210\u672c\u5c3a\u5ea6\u7684\u9002\u5e94\u6027\uff0c\u901a\u8fc7 `clamp` \u7a33\u5b9a\u4e86\u6a21\u578b\u8f93\u51fa\u7684\u68af\u5ea6\uff0c\u5e76\u5de7\u5999\u5730\u5c06 `softplus` \u7f29\u653e\u56e0\u5b50\u4e0e\u7ecf\u5178\u7684Hinge Loss\u6846\u67b6\u7ed3\u5408\uff0c\u5b9e\u73b0\u4e86\u5728\u9c81\u68d2\u6027\u3001\u7a33\u5b9a\u6027\u548c\u5bf9\u5173\u952e\u6837\u672c\u7684\u654f\u611f\u6027\u4e4b\u95f4\u7684\u65b0\u5e73\u8861\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8eZ-Score\u5f52\u4e00\u5316\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}, "gamma": {"value": 5.0, "description": "\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u88c1\u526a\u9608\u503c\u3002\u5b83\u5b9a\u4e49\u4e86\u6a21\u578b\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08logp_w - logp_l\uff09\u7684\u6709\u6548\u8303\u56f4[-gamma, gamma]\u3002\u8fd9\u6709\u52a9\u4e8e\u7a33\u5b9a\u8bad\u7ec3\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u5e76\u8ba9\u6a21\u578b\u5728\u7f6e\u4fe1\u5ea6\u8db3\u591f\u9ad8\u65f6\u505c\u6b62\u4f18\u5316\uff0c\u8f6c\u800c\u5173\u6ce8\u66f4\u96be\u7684\u6837\u672c\u3002"}}, "operators_used": ["zscore", "softplus", "clamp"]}}}
{"generation": 6, "index": 6, "ir": {"name": "AdaptiveScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u80fd\u5728\u6570\u503c\u4e0a\u4fdd\u6301\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u5c06\u7236\u4ee30\u7684Hinge Loss\u7ed3\u6784\u4e0e\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\u8fdb\u884c\u4e86\u521b\u65b0\u6027\u7684\u878d\u5408\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6838\u5fc3\u7ed3\u6784\u6cbf\u7528\u4e86Hinge Loss\u7684 `softplus(margin - term)` \u5f62\u5f0f\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u5730\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u9608\u503c\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u52a8\u6001\u88d5\u5ea6\u4e0eLogSigmoid\u7684\u8026\u5408 (\u8026\u5408\u70b91)**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u5173\u952e\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee31\u90a3\u6837\u5c06\u52a0\u6743\u540e\u7684 `scaled_logp_diff` \u76f4\u63a5\u653e\u5165Hinge Loss\uff0c\u800c\u662f\u5c06\u7236\u4ee30\u7684\u52a8\u6001\u88d5\u5ea6 `dynamic_margin` \u79fb\u5165\u4e86 `logsigmoid` \u51fd\u6570\u5185\u90e8\uff0c\u5f62\u6210 `logsigmoid(logp_diff - dynamic_margin)`\u3002\u8fd9\u6837\u505a\u6709\u51e0\u4e2a\u597d\u5904\uff1a\n    *   \u5b83\u5c06Hinge Loss\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\u201d\u601d\u60f3\u8f6c\u5316\u4e3aLogSigmoid\u635f\u5931\u7684\u201c\u9690\u5f0f\u88d5\u5ea6\u201d\u3002\u73b0\u5728\uff0c\u635f\u5931\u51fd\u6570\u4e0d\u4ec5\u4ec5\u8981\u6c42 `logp_diff` \u5927\u4e8e0\uff0c\u800c\u662f\u8981\u6c42\u5b83\u663e\u8457\u5927\u4e8e `dynamic_margin`\uff0c\u624d\u80fd\u4f7f `logsigmoid` \u7684\u7ed3\u679c\u63a5\u8fd10\uff08\u5373\u635f\u5931\u6700\u5c0f\uff09\u3002\n    *   \u8fd9\u6bd4 `softplus(margin - term)` \u7ed3\u6784\u66f4\u5e73\u6ed1\uff0c\u56e0\u4e3a `logsigmoid` \u5728\u5176\u6574\u4e2a\u5b9a\u4e49\u57df\u5185\u90fd\u6709\u975e\u96f6\u68af\u5ea6\uff08\u9664\u4e86\u5728\u65e0\u7a77\u8fdc\u5904\uff09\uff0c\u6709\u52a9\u4e8e\u907f\u514d\u68af\u5ea6\u6d88\u5931\u95ee\u9898\u3002\n2.  **\u53cc\u91cd\u6210\u672c\u52a0\u6743\u673a\u5236 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5c06\u7236\u4ee31\u7684 `scaling_factor` \u5e94\u7528\u4e8e\u6574\u4e2a `logsigmoid` \u9879\u7684\u5916\u90e8\uff0c\u5373 `loss = -scaling_factor * logsigmoid(...)`\u3002\u8fd9\u521b\u9020\u4e86\u4e00\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u673a\u5236\uff1a\n    *   **\u5185\u90e8**\uff1a`dynamic_margin` \u8981\u6c42 `logp_diff` \u7684\u5206\u79bb\u7a0b\u5ea6\u4e0e\u6210\u672c\u5dee\u5f02\u6210\u6b63\u6bd4\u3002\n    *   **\u5916\u90e8**\uff1a`scaling_factor` \u518d\u6b21\u6839\u636e\u6210\u672c\u5dee\u5f02\u653e\u5927\u4e86\u6574\u4f53\u635f\u5931\u7684\u5e45\u5ea6\u3002\n    \u8fd9\u79cd\u53cc\u91cd\u52a0\u6743\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5728\u5904\u7406\u6210\u672c\u5dee\u5f02\u5de8\u5927\u7684\u6837\u672c\u5bf9\u65f6\uff0c\u4f1a\u53d7\u5230\u975e\u5e38\u5f3a\u70c8\u7684\u5b66\u4e60\u4fe1\u53f7\uff0c\u8feb\u4f7f\u5176\u4ee5\u6781\u9ad8\u7684\u7f6e\u4fe1\u5ea6\u505a\u51fa\u6b63\u786e\u533a\u5206\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06Hinge Loss\u7684\u88d5\u5ea6\u601d\u60f3\u5de7\u5999\u5730\u8fc1\u79fb\u5230LogSigmoid\u51fd\u6570\u5185\u90e8\uff0c\u5e76\u7ed3\u5408\u5916\u90e8\u7684\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u5bf9\u5173\u952e\u6837\u672c\u5bf9\uff08\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\uff09\u6781\u5176\u654f\u611f\u7684\u635f\u5931\u51fd\u6570\u3002\u5b83\u65e2\u4fdd\u7559\u4e86\u7236\u4ee3\u4eec\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u611f\u77e5\u80fd\u529b\uff0c\u53c8\u901a\u8fc7 `logsigmoid` \u7684\u5e73\u6ed1\u7279\u6027\u548c `tanh` \u7684\u7a33\u5b9a\u5316\u6280\u5de7\uff0c\u786e\u4fdd\u4e86\u6574\u4f53\u8ba1\u7b97\u7684\u7a33\u5b9a\u6027\u548c\u9c81\u68d2\u6027\u3002", "pseudocode": "def AdaptiveScaledLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    \u8fd9\u4e2a\u601d\u60f3\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u6709\u4f53\u73b0\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8bbe\u8ba1\u4e00\u4e2a\u7ebf\u6027\u7684\u52a8\u6001\u88d5\u5ea6(margin)\u3002\n    #    \u88d5\u5ea6\u7684\u5927\u5c0f\u4e0e\u6210\u672c\u7684\u79e9\u5dee\u6210\u6b63\u6bd4\u3002\n    dynamic_margin = beta * cost_rank_diff\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u521b\u5efa\u4e00\u4e2a\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u3002\n    #    \u8be5\u56e0\u5b50\u540c\u6837\u4e0e\u6210\u672c\u5dee\u5f02\u6b63\u76f8\u5173\uff0c\u7528\u4e8e\u52a0\u6743\u6574\u4f53\u635f\u5931\u3002\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\u3002\n    scaling_factor = softplus(cost_rank_diff)\n\n    # 5. [\u7ee7\u627f] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 6. [\u65b0\u8026\u5408\u70b91] \u5c06\u52a8\u6001\u88d5\u5ea6\u5d4c\u5165LogSigmoid\u51fd\u6570\u3002\n    #    \u6211\u4eec\u5c06\u7236\u4ee30\u7684\u88d5\u5ea6\u601d\u60f3 (margin) \u79fb\u5165 logsigmoid \u5185\u90e8\u3002\n    #    \u73b0\u5728\u6a21\u578b\u7684\u76ee\u6807\u662f\u8ba9 stable_logp_diff \u663e\u8457\u8d85\u8fc7 dynamic_margin\u3002\n    #    \u8fd9\u7ee7\u627f\u4e86Hinge Loss\u7684\u88d5\u5ea6\u6982\u5ff5\uff0c\u4f46\u4ee5\u66f4\u5e73\u6ed1\u7684\u65b9\u5f0f\u5b9e\u73b0\u3002\n    margin_adjusted_diff = stable_logp_diff - dynamic_margin\n    log_prob_term = logsigmoid(margin_adjusted_diff)\n\n    # 7. [\u65b0\u8026\u5408\u70b92] \u4f7f\u7528\u7f29\u653e\u56e0\u5b50\u52a0\u6743\u6574\u4f53\u635f\u5931\u3002\n    #    \u6211\u4eec\u5c06\u7236\u4ee31\u7684\u52a0\u6743\u601d\u60f3 (scaling_factor) \u5e94\u7528\u4e8e\u6574\u4e2a\u635f\u5931\u9879\u3002\n    #    \u8fd9\u5f62\u6210\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u201c\u53cc\u91cd\u201d\u52a0\u6743\uff1a\u5185\u90e8\u88d5\u5ea6\u548c\u5916\u90e8\u7f29\u653e\u3002\n    #    \u8d1f\u53f7\u662f\u56e0\u4e3alogsigmoid\u7684\u8f93\u51fa\u662f\u8d1f\u6570\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6b63\u7684\u635f\u5931\u503c\u3002\n    loss = -scaling_factor * log_prob_term\n\n    return loss", "hyperparams": {"beta": {"value": 0.5, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u5d4c\u5165logsigmoid\u51fd\u6570\u5185\u90e8\u7684\u76ee\u6807\u88d5\u5ea6\u5bf9\u6210\u672c\u79e9\u5dee\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u9700\u8981\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd(logp_diff)\u3002"}}, "operators_used": ["rank_gap", "softplus", "tanh", "logsigmoid"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor), beta (float). Tensors are of shape (B,), where B is the batch size."], "returns": "loss (Tensor): A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.053339004516602, "validation_objective": 4.053339004516602, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.039923071861267}, "train_score_mean": 4.258220985531807, "train_loss_mean": 0.6928715631365776, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u80fd\u5728\u6570\u503c\u4e0a\u4fdd\u6301\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u5c06\u7236\u4ee30\u7684Hinge Loss\u7ed3\u6784\u4e0e\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\u8fdb\u884c\u4e86\u521b\u65b0\u6027\u7684\u878d\u5408\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6838\u5fc3\u7ed3\u6784\u6cbf\u7528\u4e86Hinge Loss\u7684 `softplus(margin - term)` \u5f62\u5f0f\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u5730\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u9700\u8981\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u9608\u503c\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u52a8\u6001\u88d5\u5ea6\u4e0eLogSigmoid\u7684\u8026\u5408 (\u8026\u5408\u70b91)**\uff1a\u8fd9\u662f\u672c\u635f\u5931\u51fd\u6570\u7684\u5173\u952e\u521b\u65b0\u3002\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee31\u90a3\u6837\u5c06\u52a0\u6743\u540e\u7684 `scaled_logp_diff` \u76f4\u63a5\u653e\u5165Hinge Loss\uff0c\u800c\u662f\u5c06\u7236\u4ee30\u7684\u52a8\u6001\u88d5\u5ea6 `dynamic_margin` \u79fb\u5165\u4e86 `logsigmoid` \u51fd\u6570\u5185\u90e8\uff0c\u5f62\u6210 `logsigmoid(logp_diff - dynamic_margin)`\u3002\u8fd9\u6837\u505a\u6709\u51e0\u4e2a\u597d\u5904\uff1a\n    *   \u5b83\u5c06Hinge Loss\u7684\u201c\u663e\u5f0f\u88d5\u5ea6\u201d\u601d\u60f3\u8f6c\u5316\u4e3aLogSigmoid\u635f\u5931\u7684\u201c\u9690\u5f0f\u88d5\u5ea6\u201d\u3002\u73b0\u5728\uff0c\u635f\u5931\u51fd\u6570\u4e0d\u4ec5\u4ec5\u8981\u6c42 `logp_diff` \u5927\u4e8e0\uff0c\u800c\u662f\u8981\u6c42\u5b83\u663e\u8457\u5927\u4e8e `dynamic_margin`\uff0c\u624d\u80fd\u4f7f `logsigmoid` \u7684\u7ed3\u679c\u63a5\u8fd10\uff08\u5373\u635f\u5931\u6700\u5c0f\uff09\u3002\n    *   \u8fd9\u6bd4 `softplus(margin - term)` \u7ed3\u6784\u66f4\u5e73\u6ed1\uff0c\u56e0\u4e3a `logsigmoid` \u5728\u5176\u6574\u4e2a\u5b9a\u4e49\u57df\u5185\u90fd\u6709\u975e\u96f6\u68af\u5ea6\uff08\u9664\u4e86\u5728\u65e0\u7a77\u8fdc\u5904\uff09\uff0c\u6709\u52a9\u4e8e\u907f\u514d\u68af\u5ea6\u6d88\u5931\u95ee\u9898\u3002\n2.  **\u53cc\u91cd\u6210\u672c\u52a0\u6743\u673a\u5236 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5c06\u7236\u4ee31\u7684 `scaling_factor` \u5e94\u7528\u4e8e\u6574\u4e2a `logsigmoid` \u9879\u7684\u5916\u90e8\uff0c\u5373 `loss = -scaling_factor * logsigmoid(...)`\u3002\u8fd9\u521b\u9020\u4e86\u4e00\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u673a\u5236\uff1a\n    *   **\u5185\u90e8**\uff1a`dynamic_margin` \u8981\u6c42 `logp_diff` \u7684\u5206\u79bb\u7a0b\u5ea6\u4e0e\u6210\u672c\u5dee\u5f02\u6210\u6b63\u6bd4\u3002\n    *   **\u5916\u90e8**\uff1a`scaling_factor` \u518d\u6b21\u6839\u636e\u6210\u672c\u5dee\u5f02\u653e\u5927\u4e86\u6574\u4f53\u635f\u5931\u7684\u5e45\u5ea6\u3002\n    \u8fd9\u79cd\u53cc\u91cd\u52a0\u6743\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5728\u5904\u7406\u6210\u672c\u5dee\u5f02\u5de8\u5927\u7684\u6837\u672c\u5bf9\u65f6\uff0c\u4f1a\u53d7\u5230\u975e\u5e38\u5f3a\u70c8\u7684\u5b66\u4e60\u4fe1\u53f7\uff0c\u8feb\u4f7f\u5176\u4ee5\u6781\u9ad8\u7684\u7f6e\u4fe1\u5ea6\u505a\u51fa\u6b63\u786e\u533a\u5206\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06Hinge Loss\u7684\u88d5\u5ea6\u601d\u60f3\u5de7\u5999\u5730\u8fc1\u79fb\u5230LogSigmoid\u51fd\u6570\u5185\u90e8\uff0c\u5e76\u7ed3\u5408\u5916\u90e8\u7684\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u5bf9\u5173\u952e\u6837\u672c\u5bf9\uff08\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\uff09\u6781\u5176\u654f\u611f\u7684\u635f\u5931\u51fd\u6570\u3002\u5b83\u65e2\u4fdd\u7559\u4e86\u7236\u4ee3\u4eec\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u611f\u77e5\u80fd\u529b\uff0c\u53c8\u901a\u8fc7 `logsigmoid` \u7684\u5e73\u6ed1\u7279\u6027\u548c `tanh` \u7684\u7a33\u5b9a\u5316\u6280\u5de7\uff0c\u786e\u4fdd\u4e86\u6574\u4f53\u8ba1\u7b97\u7684\u7a33\u5b9a\u6027\u548c\u9c81\u68d2\u6027\u3002", "hyperparams": {"beta": {"value": 0.5, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u5d4c\u5165logsigmoid\u51fd\u6570\u5185\u90e8\u7684\u76ee\u6807\u88d5\u5ea6\u5bf9\u6210\u672c\u79e9\u5dee\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u9700\u8981\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd(logp_diff)\u3002"}}, "operators_used": ["rank_gap", "softplus", "tanh", "logsigmoid"]}}}
{"generation": 6, "index": 7, "ir": {"name": "AdaptiveSigmoidHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u60e9\u7f5a\u529b\u5ea6\uff0c\u53c8\u80fd\u901a\u8fc7\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u660e\u786e\u5b66\u4e60\u76ee\u6807\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u7ee7\u627f\u4e86\u7236\u4ee30\u7684Hinge Loss\u7ed3\u6784\u548c\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\uff0c\u5e76\u901a\u8fc7\u65b0\u7684\u8026\u5408\u65b9\u5f0f\u5c06\u5b83\u4eec\u878d\u5408\uff0c\u4ee5\u8fbe\u5230\u66f4\u4f18\u7684\u5e73\u8861\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u91c7\u7528\u4e86`softplus(margin - term)`\uff0c\u8fd9\u662f\u4e00\u79cd\u5e73\u6ed1\u7684Hinge Loss\u5f62\u5f0f\u3002\u8fd9\u79cd\u7ed3\u6784\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6 (`term`) \u5fc5\u987b\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u8bbe\u5b9a\u7684\u88d5\u5ea6 (`margin`)\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u79cd\u201c\u663e\u5f0f\u88d5\u5ea6\u201d\u7684\u8bbe\u8ba1\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684`scaling_factor`\u6765\u52a0\u6743\u5bf9\u6570\u6982\u7387\u5dee (`logp_diff`)\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\u8fd9\u662f\u4e00\u79cd\u201c\u9690\u5f0f\u52a0\u6743\u201d\u7684\u8bbe\u8ba1\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u88d5\u5ea6\u4e0e\u7f6e\u4fe1\u5ea6\u9879\u7684\u89e3\u8026\u4e0e\u91cd\u7ec4 (\u8026\u5408\u70b91)**\uff1a\u7236\u4ee31\u5c06`scaling_factor`\u76f4\u63a5\u4e58\u5728`logp_diff`\u4e0a\uff0c\u5f62\u6210\u4e86\u4e00\u4e2a\u590d\u6742\u7684\u7f6e\u4fe1\u5ea6\u9879`scaled_logp_diff`\u3002\u5728\u672c\u8bbe\u8ba1\u4e2d\uff0c\u6211\u4eec\u5bf9\u8fd9\u4e24\u4e2a\u90e8\u5206\u8fdb\u884c\u4e86\u201c\u89e3\u8026\u201d\u3002\u6211\u4eec\u5c06`stable_logp_diff`\u4f5c\u4e3a\u72ec\u7acb\u7684\u7f6e\u4fe1\u5ea6\u9879\uff08\u7ee7\u627f\u81ea\u7236\u4ee30\uff09\uff0c\u540c\u65f6\u5c06`scaling_factor`\u79fb\u5230Hinge Loss\u7684\u5916\u90e8\uff0c\u4f5c\u4e3a\u6574\u4e2a\u635f\u5931\u7684\u81ea\u9002\u5e94\u6743\u91cd\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u5f62\u5f0f\u53d8\u4e3a`scaling_factor * softplus(dynamic_margin - stable_logp_diff)`\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c`scaling_factor`\u4e0d\u518d\u5f71\u54cdHinge Loss\u5185\u90e8\u7684\u88d5\u5ea6\u5224\u65ad\u903b\u8f91\uff0c\u800c\u662f\u76f4\u63a5\u8c03\u8282\u6700\u7ec8\u60e9\u7f5a\u7684\u5f3a\u5ea6\u3002\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff08`scaling_factor`\u5927\uff09\uff0c\u4efb\u4f55\u672a\u6ee1\u8db3\u88d5\u5ea6\u7684\u884c\u4e3a\u90fd\u4f1a\u53d7\u5230\u66f4\u4e25\u5389\u7684\u60e9\u7f5a\u3002\n2.  **Sigmoid\u9a71\u52a8\u7684\u52a8\u6001\u88d5\u5ea6 (\u8026\u5408\u70b92)**\uff1a\u7236\u4ee30\u548c1\u90fd\u4f7f\u7528\u4e86\u7ebf\u6027\u7684`beta * rank_gap`\u4f5c\u4e3a\u88d5\u5ea6\u3002\u8fd9\u79cd\u8bbe\u8ba1\u867d\u7136\u76f4\u63a5\uff0c\u4f46\u88d5\u5ea6\u53ef\u4ee5\u65e0\u9650\u5236\u5730\u589e\u957f\uff0c\u53ef\u80fd\u5bfc\u81f4\u5bf9\u6781\u7aef\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u63d0\u51fa\u4e0d\u5207\u5b9e\u9645\u7684\u504f\u597d\u5206\u79bb\u8981\u6c42\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u65b0\u7684\u88d5\u5ea6\u8bbe\u8ba1\uff1a`dynamic_margin = beta * sigmoid(rank_gap(cost_w, cost_l))`\u3002\u6211\u4eec\u4f7f\u7528`sigmoid`\u51fd\u6570\u6765\u538b\u7f29`rank_gap`\u7684\u8f93\u51fa\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u968f\u7740\u6210\u672c\u79e9\u5dee\u7684\u589e\u52a0\u800c\u5e73\u6ed1\u589e\u957f\uff0c\u4f46\u6700\u7ec8\u4f1a\u9971\u548c\u5728\u4e00\u4e2a\u4e0a\u9650\uff08\u7531`beta`\u63a7\u5236\uff09\u3002\u8fd9\u79cd\u8bbe\u8ba1\u66f4\u52a0\u7a33\u5065\uff0c\u5b83\u627f\u8ba4\u5f53\u6210\u672c\u5dee\u5f02\u5df2\u7ecf\u5f88\u5927\u65f6\uff0c\u518d\u8fdb\u4e00\u6b65\u62c9\u5927\u6a21\u578b\u7684\u504f\u597d\u5dee\u8ddd\u53ef\u80fd\u4e0d\u662f\u6700\u9ad8\u6548\u7684\u5b66\u4e60\u65b9\u5f0f\uff0c\u4ece\u800c\u907f\u514d\u4e86\u68af\u5ea6\u7206\u70b8\u7684\u98ce\u9669\uff0c\u5e76\u4f7f\u6a21\u578b\u66f4\u4e13\u6ce8\u4e8e\u533a\u5206\u90a3\u4e9b\u5dee\u5f02\u4e0d\u90a3\u4e48\u60ac\u6b8a\u7684\u6837\u672c\u5bf9\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee31\u7684\u201c\u81ea\u9002\u5e94\u52a0\u6743\u201d\u601d\u60f3\u4f5c\u4e3a\u7236\u4ee30\u201cHinge Loss\u60e9\u7f5a\u201d\u7684\u5916\u90e8\u8c03\u8282\u5668\uff0c\u5b9e\u73b0\u4e86\u60e9\u7f5a\u529b\u5ea6\u7684\u52a8\u6001\u8c03\u6574\u3002\u540c\u65f6\uff0c\u5b83\u5f15\u5165\u4e86Sigmoid\u9971\u548c\u88d5\u5ea6\u8bbe\u8ba1\uff0c\u4f7f\u5b66\u4e60\u76ee\u6807\u66f4\u52a0\u7a33\u5065\u548c\u73b0\u5b9e\uff0c\u4ece\u800c\u5728\u7a33\u5b9a\u6027\u3001\u9c81\u68d2\u6027\u548c\u5bf9\u5173\u952e\u6837\u672c\u7684\u654f\u611f\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "pseudocode": "def AdaptiveSigmoidHingeLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    \u8fd9\u4e2a\u601d\u60f3\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u6709\u4f53\u73b0\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u4e00\u4e2a\u7531Sigmoid\u9a71\u52a8\u7684\u3001\u6709\u754c\u7684\u52a8\u6001\u88d5\u5ea6\u3002\n    #    \u7ee7\u627f\u4e86\u52a8\u6001\u88d5\u5ea6\u7684\u601d\u60f3\uff0c\u4f46\u4f7f\u7528 sigmoid \u8fdb\u884c\u538b\u7f29\uff0c\u4f7f\u5176\u5728 [0, beta] \u8303\u56f4\u5185\u9971\u548c\u3002\n    #    \u8fd9\u4f7f\u5f97\u88d5\u5ea6\u76ee\u6807\u66f4\u52a0\u7a33\u5065\uff0c\u907f\u514d\u4e86\u5bf9\u6781\u7aef\u5dee\u5f02\u6837\u672c\u63d0\u51fa\u8fc7\u9ad8\u8981\u6c42\u3002\n    dynamic_margin = beta * sigmoid(cost_rank_diff)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u521b\u5efa\u4e00\u4e2a\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u3002\n    #    \u8be5\u56e0\u5b50\u968f\u6210\u672c\u5dee\u5f02\u589e\u5927\u800c\u589e\u5927\uff0c\u7528\u4e8e\u52a0\u6743\u6700\u7ec8\u7684\u635f\u5931\u503c\u3002\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\u3002\n    scaling_factor = softplus(cost_rank_diff)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u6838\u5fc3\u7684Hinge Loss\u90e8\u5206\u3002\n    #    \u5f53\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6(stable_logp_diff)\u5c0f\u4e8e\u76ee\u6807\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    hinge_term = softplus(dynamic_margin - stable_logp_diff)\n\n    # 7. [\u65b0\u8026\u5408\u70b91] \u5c06\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u5e94\u7528\u4e8eHinge Loss\u3002\n    #    \u6211\u4eec\u5c06\u7236\u4ee31\u7684\u201c\u52a0\u6743\u601d\u60f3\u201d\u4f5c\u4e3a\u7236\u4ee30\u201cHinge\u7ed3\u6784\u201d\u7684\u5916\u90e8\u8c03\u8282\u5668\u3002\n    #    \u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u4ea7\u751f\u7684Hinge Loss\u60e9\u7f5a\u5c06\u88ab\u653e\u5927\uff0c\u4ece\u800c\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n    loss = scaling_factor * hinge_term\n\n    return loss", "hyperparams": {"beta": {"value": 2.0, "description": "\u88d5\u5ea6\u4e0a\u9650\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u7531sigmoid\u51fd\u6570\u4ea7\u751f\u7684\u52a8\u6001\u88d5\u5ea6\u7684\u6700\u5927\u503c\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5373\u4f7f\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u5f88\u5927\u7684\u6837\u672c\u5bf9\uff0c\u4e5f\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5206\u79bb\u5ea6\u3002"}}, "operators_used": ["rank_gap", "sigmoid", "softplus", "tanh"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor), beta (float)"], "returns": "loss (Tensor, scalar)"}}, "fitness": {"hf_like_score": 4.1161534786224365, "validation_objective": 4.1161534786224365, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.092671632766724}, "train_score_mean": 4.2593774273991585, "train_loss_mean": 0.6927945390343666, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveSigmoidHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u60e9\u7f5a\u529b\u5ea6\uff0c\u53c8\u80fd\u901a\u8fc7\u52a8\u6001\u88d5\u5ea6\uff08margin\uff09\u660e\u786e\u5b66\u4e60\u76ee\u6807\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u7ee7\u627f\u4e86\u7236\u4ee30\u7684Hinge Loss\u7ed3\u6784\u548c\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\uff0c\u5e76\u901a\u8fc7\u65b0\u7684\u8026\u5408\u65b9\u5f0f\u5c06\u5b83\u4eec\u878d\u5408\uff0c\u4ee5\u8fbe\u5230\u66f4\u4f18\u7684\u5e73\u8861\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6838\u5fc3\u635f\u5931\u7ed3\u6784\u91c7\u7528\u4e86`softplus(margin - term)`\uff0c\u8fd9\u662f\u4e00\u79cd\u5e73\u6ed1\u7684Hinge Loss\u5f62\u5f0f\u3002\u8fd9\u79cd\u7ed3\u6784\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6 (`term`) \u5fc5\u987b\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u8bbe\u5b9a\u7684\u88d5\u5ea6 (`margin`)\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u79cd\u201c\u663e\u5f0f\u88d5\u5ea6\u201d\u7684\u8bbe\u8ba1\u4f7f\u5f97\u5b66\u4e60\u76ee\u6807\u975e\u5e38\u6e05\u6670\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u57fa\u4e8e\u6210\u672c\u5dee\u5f02\u7684`scaling_factor`\u6765\u52a0\u6743\u5bf9\u6570\u6982\u7387\u5dee (`logp_diff`)\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\u8fd9\u662f\u4e00\u79cd\u201c\u9690\u5f0f\u52a0\u6743\u201d\u7684\u8bbe\u8ba1\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u88d5\u5ea6\u4e0e\u7f6e\u4fe1\u5ea6\u9879\u7684\u89e3\u8026\u4e0e\u91cd\u7ec4 (\u8026\u5408\u70b91)**\uff1a\u7236\u4ee31\u5c06`scaling_factor`\u76f4\u63a5\u4e58\u5728`logp_diff`\u4e0a\uff0c\u5f62\u6210\u4e86\u4e00\u4e2a\u590d\u6742\u7684\u7f6e\u4fe1\u5ea6\u9879`scaled_logp_diff`\u3002\u5728\u672c\u8bbe\u8ba1\u4e2d\uff0c\u6211\u4eec\u5bf9\u8fd9\u4e24\u4e2a\u90e8\u5206\u8fdb\u884c\u4e86\u201c\u89e3\u8026\u201d\u3002\u6211\u4eec\u5c06`stable_logp_diff`\u4f5c\u4e3a\u72ec\u7acb\u7684\u7f6e\u4fe1\u5ea6\u9879\uff08\u7ee7\u627f\u81ea\u7236\u4ee30\uff09\uff0c\u540c\u65f6\u5c06`scaling_factor`\u79fb\u5230Hinge Loss\u7684\u5916\u90e8\uff0c\u4f5c\u4e3a\u6574\u4e2a\u635f\u5931\u7684\u81ea\u9002\u5e94\u6743\u91cd\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u5f62\u5f0f\u53d8\u4e3a`scaling_factor * softplus(dynamic_margin - stable_logp_diff)`\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c`scaling_factor`\u4e0d\u518d\u5f71\u54cdHinge Loss\u5185\u90e8\u7684\u88d5\u5ea6\u5224\u65ad\u903b\u8f91\uff0c\u800c\u662f\u76f4\u63a5\u8c03\u8282\u6700\u7ec8\u60e9\u7f5a\u7684\u5f3a\u5ea6\u3002\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff08`scaling_factor`\u5927\uff09\uff0c\u4efb\u4f55\u672a\u6ee1\u8db3\u88d5\u5ea6\u7684\u884c\u4e3a\u90fd\u4f1a\u53d7\u5230\u66f4\u4e25\u5389\u7684\u60e9\u7f5a\u3002\n2.  **Sigmoid\u9a71\u52a8\u7684\u52a8\u6001\u88d5\u5ea6 (\u8026\u5408\u70b92)**\uff1a\u7236\u4ee30\u548c1\u90fd\u4f7f\u7528\u4e86\u7ebf\u6027\u7684`beta * rank_gap`\u4f5c\u4e3a\u88d5\u5ea6\u3002\u8fd9\u79cd\u8bbe\u8ba1\u867d\u7136\u76f4\u63a5\uff0c\u4f46\u88d5\u5ea6\u53ef\u4ee5\u65e0\u9650\u5236\u5730\u589e\u957f\uff0c\u53ef\u80fd\u5bfc\u81f4\u5bf9\u6781\u7aef\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u63d0\u51fa\u4e0d\u5207\u5b9e\u9645\u7684\u504f\u597d\u5206\u79bb\u8981\u6c42\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u65b0\u7684\u88d5\u5ea6\u8bbe\u8ba1\uff1a`dynamic_margin = beta * sigmoid(rank_gap(cost_w, cost_l))`\u3002\u6211\u4eec\u4f7f\u7528`sigmoid`\u51fd\u6570\u6765\u538b\u7f29`rank_gap`\u7684\u8f93\u51fa\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u968f\u7740\u6210\u672c\u79e9\u5dee\u7684\u589e\u52a0\u800c\u5e73\u6ed1\u589e\u957f\uff0c\u4f46\u6700\u7ec8\u4f1a\u9971\u548c\u5728\u4e00\u4e2a\u4e0a\u9650\uff08\u7531`beta`\u63a7\u5236\uff09\u3002\u8fd9\u79cd\u8bbe\u8ba1\u66f4\u52a0\u7a33\u5065\uff0c\u5b83\u627f\u8ba4\u5f53\u6210\u672c\u5dee\u5f02\u5df2\u7ecf\u5f88\u5927\u65f6\uff0c\u518d\u8fdb\u4e00\u6b65\u62c9\u5927\u6a21\u578b\u7684\u504f\u597d\u5dee\u8ddd\u53ef\u80fd\u4e0d\u662f\u6700\u9ad8\u6548\u7684\u5b66\u4e60\u65b9\u5f0f\uff0c\u4ece\u800c\u907f\u514d\u4e86\u68af\u5ea6\u7206\u70b8\u7684\u98ce\u9669\uff0c\u5e76\u4f7f\u6a21\u578b\u66f4\u4e13\u6ce8\u4e8e\u533a\u5206\u90a3\u4e9b\u5dee\u5f02\u4e0d\u90a3\u4e48\u60ac\u6b8a\u7684\u6837\u672c\u5bf9\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u7236\u4ee31\u7684\u201c\u81ea\u9002\u5e94\u52a0\u6743\u201d\u601d\u60f3\u4f5c\u4e3a\u7236\u4ee30\u201cHinge Loss\u60e9\u7f5a\u201d\u7684\u5916\u90e8\u8c03\u8282\u5668\uff0c\u5b9e\u73b0\u4e86\u60e9\u7f5a\u529b\u5ea6\u7684\u52a8\u6001\u8c03\u6574\u3002\u540c\u65f6\uff0c\u5b83\u5f15\u5165\u4e86Sigmoid\u9971\u548c\u88d5\u5ea6\u8bbe\u8ba1\uff0c\u4f7f\u5b66\u4e60\u76ee\u6807\u66f4\u52a0\u7a33\u5065\u548c\u73b0\u5b9e\uff0c\u4ece\u800c\u5728\u7a33\u5b9a\u6027\u3001\u9c81\u68d2\u6027\u548c\u5bf9\u5173\u952e\u6837\u672c\u7684\u654f\u611f\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "hyperparams": {"beta": {"value": 2.0, "description": "\u88d5\u5ea6\u4e0a\u9650\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u7531sigmoid\u51fd\u6570\u4ea7\u751f\u7684\u52a8\u6001\u88d5\u5ea6\u7684\u6700\u5927\u503c\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5373\u4f7f\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u5f88\u5927\u7684\u6837\u672c\u5bf9\uff0c\u4e5f\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5206\u79bb\u5ea6\u3002"}}, "operators_used": ["rank_gap", "sigmoid", "softplus", "tanh"]}}}
{"generation": 7, "index": 1, "ir": {"name": "AdaptiveLogSigmoidHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u4f18\u52bf\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u6709\u660e\u786e\u5b66\u4e60\u76ee\u6807\uff0c\u53c8\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u60e9\u7f5a\u529b\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - term)` \u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u5fc5\u987b\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u9608\u503c\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u53d7\u5230\u60e9\u7f5a\u3002\u8fd9\u4e3a\u6a21\u578b\u63d0\u4f9b\u4e86\u6e05\u6670\u7684\u4f18\u5316\u65b9\u5411\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 - \u94f0\u94fe\u7ed3\u6784\u4e0eLogSigmoid\u7684\u878d\u5408**\uff1a\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee31\u90a3\u6837\u5c06 `scaled_logp_diff` \u76f4\u63a5\u653e\u5165\u94f0\u94fe\u635f\u5931\u4e2d\uff0c\u800c\u662f\u5c06 `logsigmoid(scaled_logp_diff)` \u4f5c\u4e3a\u7f6e\u4fe1\u5ea6\u9879 `term`\u3002`logsigmoid(x)` \u51fd\u6570\u5929\u7136\u5730\u5c06\u4e00\u4e2a\u4ece `(-inf, +inf)` \u7684\u8f93\u5165\u6620\u5c04\u5230 `(-inf, 0)` \u7684\u5bf9\u6570\u6982\u7387\u7a7a\u95f4\uff0c\u5e76\u4e14\u5f53 `x > 0` \u65f6\uff0c\u51fd\u6570\u503c\u63a5\u8fd10\uff1b\u5f53 `x < 0` \u65f6\uff0c\u51fd\u6570\u503c\u8d8b\u5411\u8d1f\u65e0\u7a77\u3002\u8fd9\u610f\u5473\u7740\uff0c\u53ea\u6709\u5f53\u6a21\u578b\u7684\u504f\u597d\u9884\u6d4b\u65b9\u5411\u9519\u8bef\u6216\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\uff08\u5373 `scaled_logp_diff` \u4e0d\u591f\u5927\uff09\u65f6\uff0c`logsigmoid` \u7684\u8f93\u51fa\u624d\u4f1a\u663e\u8457\u5c0f\u4e8e0\uff0c\u4ece\u800c\u5728\u94f0\u94fe\u635f\u5931 `softplus(margin - logsigmoid(...))` \u4e2d\u4ea7\u751f\u4e00\u4e2a\u8f83\u5927\u7684\u60e9\u7f5a\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7ed3\u5408\u4e86\u94f0\u94fe\u635f\u5931\u7684\u201c\u9608\u503c\u201d\u6982\u5ff5\u548cLogSigmoid\u635f\u5931\u5bf9\u8d1f\u503c\u7684\u654f\u611f\u6027\uff0c\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u5728\u6a21\u578b\u9884\u6d4b\u65b9\u5411\u6b63\u786e\u4e14\u7f6e\u4fe1\u5ea6\u8db3\u591f\u9ad8\u65f6\u8fc5\u901f\u9971\u548c\u81f30\uff0c\u800c\u5728\u9884\u6d4b\u9519\u8bef\u65f6\u7ed9\u4e88\u5f3a\u70c8\u7684\u60e9\u7f5a\u4fe1\u53f7\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 - \u52a8\u6001\u88d5\u5ea6\u4e0eLogSigmoid\u7684\u534f\u540c**\uff1a\u4e0e\u7236\u4ee30\u548c1\u4e0d\u540c\uff0c\u6211\u4eec\u5c06\u88d5\u5ea6 `margin` \u8bbe\u8ba1\u4e3a\u8d1f\u503c\uff0c\u5373 `margin = -beta * softplus(cost_rank_diff)`\u3002\u8fd9\u4e2a\u8d1f\u88d5\u5ea6\u4e0e `logsigmoid` \u7684\u8f93\u51fa\u8303\u56f4 `(-inf, 0)` \u5b8c\u7f8e\u5339\u914d\u3002`cost_rank_diff` \u8d8a\u5927\uff0c`margin` \u5c31\u8d8a\u63a5\u8fd10\u3002\u635f\u5931 `softplus(margin - logsigmoid(scaled_logp_diff))` \u7684\u76ee\u6807\u662f\u8ba9 `logsigmoid(...)` \u7684\u503c\u5927\u4e8e `margin`\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff0c\u6a21\u578b\u9700\u8981\u4ea7\u751f\u4e00\u4e2a\u975e\u5e38\u63a5\u8fd10\u7684 `logsigmoid` \u8f93\u51fa\uff08\u5373\u4e00\u4e2a\u975e\u5e38\u5927\u7684 `scaled_logp_diff`\uff09\uff0c\u624d\u80fd\u907f\u514d\u60e9\u7f5a\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5de7\u5999\u5730\u5c06\u6210\u672c\u5dee\u5f02\u7684\u91cd\u8981\u6027\u540c\u65f6\u7f16\u7801\u5230\u4e86\u88d5\u5ea6 `margin` \u548c\u7f29\u653e\u56e0\u5b50 `scaling_factor` \u4e2d\uff0c\u5b9e\u73b0\u4e86\u5bf9\u5173\u952e\u6837\u672c\u5bf9\u7684\u53cc\u91cd\u5f3a\u8c03\uff0c\u540c\u65f6\u4fdd\u6301\u4e86\u6570\u503c\u7684\u7a33\u5b9a\u6027\u548c\u68af\u5ea6\u7684\u5e73\u6ed1\u6027\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u81ea\u9002\u5e94\u7f29\u653e\u7684 `logp_diff` \u8f93\u5165\u5230\u4e00\u4e2a `logsigmoid` \u51fd\u6570\uff0c\u5e76\u5c06\u5176\u7ed3\u679c\u7f6e\u4e8e\u4e00\u4e2a\u5177\u6709\u52a8\u6001\u8d1f\u88d5\u5ea6\u7684\u94f0\u94fe\u635f\u5931\u6846\u67b6\u4e2d\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u65b0\u9896\u7684\u8026\u5408\u673a\u5236\u3002\u5b83\u65e2\u6709\u94f0\u94fe\u635f\u5931\u7684\u660e\u786e\u4f18\u5316\u76ee\u6807\uff0c\u53c8\u878d\u5165\u4e86LogSigmoid\u635f\u5931\u7684\u6982\u7387\u89e3\u91ca\u548c\u81ea\u9002\u5e94\u52a0\u6743\u7279\u6027\uff0c\u4ece\u800c\u5728\u9c81\u68d2\u6027\u3001\u7a33\u5b9a\u6027\u548c\u5bf9\u5173\u952e\u6837\u672c\u7684\u654f\u611f\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "pseudocode": "def AdaptiveLogSigmoidHingeLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    \u8fd9\u4e2a\u601d\u60f3\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u6709\u4f53\u73b0\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u4e00\u4e2a\u52a8\u6001\u7684\u3001\u975e\u6b63\u7684\u88d5\u5ea6(margin)\u3002\n    #    \u6210\u672c\u7684\u79e9\u5dee\u5f02\u8d8a\u5927\uff0c\u88d5\u5ea6\u8d8a\u63a5\u8fd10\uff08\u60e9\u7f5a\u8981\u6c42\u8d8a\u9ad8\uff09\u3002\n    #    \u4f7f\u7528 -softplus \u786e\u4fdd\u88d5\u5ea6\u5e73\u6ed1\u4e14 <= 0\uff0c\u4e0e logsigmoid \u7684\u8f93\u51fa\u8303\u56f4\u5339\u914d\u3002\n    dynamic_margin = -beta * softplus(cost_rank_diff)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u521b\u5efa\u4e00\u4e2a\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u3002\n    #    \u8be5\u56e0\u5b50\u4e0e\u6210\u672c\u5dee\u5f02\u6b63\u76f8\u5173\uff0c\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\u3002\n    scaling_factor = softplus(cost_rank_diff)\n\n    # 5. [\u7ee7\u627f] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 6. \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\u3002\n    #    \u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u8be5\u9879\u7684\u5f71\u54cd\u529b\u8d8a\u5927\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 7. [\u65b0\u8026\u5408\u70b91] \u5c06\u52a0\u6743\u9879\u901a\u8fc7 logsigmoid \u8f6c\u6362\u4e3a\u5bf9\u6570\u6982\u7387\u7f6e\u4fe1\u5ea6\u3002\n    #    logsigmoid(x) \u7684\u8f93\u51fa\u8303\u56f4\u662f (-inf, 0]\u3002\u5f53 scaled_logp_diff > 0 \u65f6\uff0c\u8f93\u51fa\u63a5\u8fd10\u3002\n    #    \u5f53 scaled_logp_diff < 0 \u65f6\uff0c\u8f93\u51fa\u4e3a\u8f83\u5927\u7684\u8d1f\u6570\uff0c\u8868\u793a\u4f4e\u7f6e\u4fe1\u5ea6\u6216\u65b9\u5411\u9519\u8bef\u3002\n    log_prob_confidence = logsigmoid(scaled_logp_diff)\n\n    # 8. [\u65b0\u8026\u5408\u70b91 & 2] \u5c06\u5bf9\u6570\u6982\u7387\u7f6e\u4fe1\u5ea6\u5d4c\u5165Hinge Loss\u6846\u67b6\u3002\n    #    \u6211\u4eec\u4f7f\u7528\u7236\u4ee30\u7684Hinge\u7ed3\u6784\uff0c\u4f46\u7528 log_prob_confidence \u4f5c\u4e3a\u7f6e\u4fe1\u5ea6\u9879\u3002\n    #    \u5f53\u7f6e\u4fe1\u5ea6(log_prob_confidence)\u4f4e\u4e8e\u76ee\u6807\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    #    \u7531\u4e8e\u4e24\u8005\u90fd\u4e3a\u8d1f\uff0c\u8fd9\u8981\u6c42\u7f6e\u4fe1\u5ea6\u201c\u4e0d\u591f\u8d1f\u201d\uff0c\u5373\u6a21\u578b\u9700\u8981\u5bf9\u6b63\u786e\u7684\u504f\u597d\u6709\u8db3\u591f\u9ad8\u7684\u4fe1\u5fc3\u3002\n    loss = softplus(dynamic_margin - log_prob_confidence)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u8d1f\u88d5\u5ea6\u7684\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\u88ab\u8f6c\u5316\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u79e9\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u4e25\u683c\u7684\u504f\u597d\u5b66\u4e60\u8981\u6c42\uff08\u5373\u88d5\u5ea6\u66f4\u63a5\u8fd10\uff09\uff0c\u8feb\u4f7f\u6a21\u578b\u4ea7\u751f\u66f4\u9ad8\u7684\u7f6e\u4fe1\u5ea6\u3002"}}, "operators_used": ["rank_gap", "tanh", "softplus", "logsigmoid"], "implementation_hint": {"expects": ["cost_a (Tensor), cost_b (Tensor), logp_a (Tensor), logp_b (Tensor), and hyperparameter beta (float). Tensors are expected to be of the same shape, e.g., (batch_size,)."], "returns": "A scalar Tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.092729091644287, "validation_objective": 4.092729091644287, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.082930326461792}, "train_score_mean": 4.327537328004837, "train_loss_mean": 0.6928266640752554, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveLogSigmoidHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u4f18\u52bf\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u6709\u660e\u786e\u5b66\u4e60\u76ee\u6807\uff0c\u53c8\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u60e9\u7f5a\u529b\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - term)` \u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\uff08`term`\uff09\u5fc5\u987b\u8d85\u8fc7\u4e00\u4e2a\u52a8\u6001\u7684\u9608\u503c\uff08`margin`\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u53d7\u5230\u60e9\u7f5a\u3002\u8fd9\u4e3a\u6a21\u578b\u63d0\u4f9b\u4e86\u6e05\u6670\u7684\u4f18\u5316\u65b9\u5411\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684 `scaling_factor` \u6765\u52a0\u6743 `logp_diff`\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 - \u94f0\u94fe\u7ed3\u6784\u4e0eLogSigmoid\u7684\u878d\u5408**\uff1a\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee31\u90a3\u6837\u5c06 `scaled_logp_diff` \u76f4\u63a5\u653e\u5165\u94f0\u94fe\u635f\u5931\u4e2d\uff0c\u800c\u662f\u5c06 `logsigmoid(scaled_logp_diff)` \u4f5c\u4e3a\u7f6e\u4fe1\u5ea6\u9879 `term`\u3002`logsigmoid(x)` \u51fd\u6570\u5929\u7136\u5730\u5c06\u4e00\u4e2a\u4ece `(-inf, +inf)` \u7684\u8f93\u5165\u6620\u5c04\u5230 `(-inf, 0)` \u7684\u5bf9\u6570\u6982\u7387\u7a7a\u95f4\uff0c\u5e76\u4e14\u5f53 `x > 0` \u65f6\uff0c\u51fd\u6570\u503c\u63a5\u8fd10\uff1b\u5f53 `x < 0` \u65f6\uff0c\u51fd\u6570\u503c\u8d8b\u5411\u8d1f\u65e0\u7a77\u3002\u8fd9\u610f\u5473\u7740\uff0c\u53ea\u6709\u5f53\u6a21\u578b\u7684\u504f\u597d\u9884\u6d4b\u65b9\u5411\u9519\u8bef\u6216\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\uff08\u5373 `scaled_logp_diff` \u4e0d\u591f\u5927\uff09\u65f6\uff0c`logsigmoid` \u7684\u8f93\u51fa\u624d\u4f1a\u663e\u8457\u5c0f\u4e8e0\uff0c\u4ece\u800c\u5728\u94f0\u94fe\u635f\u5931 `softplus(margin - logsigmoid(...))` \u4e2d\u4ea7\u751f\u4e00\u4e2a\u8f83\u5927\u7684\u60e9\u7f5a\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7ed3\u5408\u4e86\u94f0\u94fe\u635f\u5931\u7684\u201c\u9608\u503c\u201d\u6982\u5ff5\u548cLogSigmoid\u635f\u5931\u5bf9\u8d1f\u503c\u7684\u654f\u611f\u6027\uff0c\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u5728\u6a21\u578b\u9884\u6d4b\u65b9\u5411\u6b63\u786e\u4e14\u7f6e\u4fe1\u5ea6\u8db3\u591f\u9ad8\u65f6\u8fc5\u901f\u9971\u548c\u81f30\uff0c\u800c\u5728\u9884\u6d4b\u9519\u8bef\u65f6\u7ed9\u4e88\u5f3a\u70c8\u7684\u60e9\u7f5a\u4fe1\u53f7\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 - \u52a8\u6001\u88d5\u5ea6\u4e0eLogSigmoid\u7684\u534f\u540c**\uff1a\u4e0e\u7236\u4ee30\u548c1\u4e0d\u540c\uff0c\u6211\u4eec\u5c06\u88d5\u5ea6 `margin` \u8bbe\u8ba1\u4e3a\u8d1f\u503c\uff0c\u5373 `margin = -beta * softplus(cost_rank_diff)`\u3002\u8fd9\u4e2a\u8d1f\u88d5\u5ea6\u4e0e `logsigmoid` \u7684\u8f93\u51fa\u8303\u56f4 `(-inf, 0)` \u5b8c\u7f8e\u5339\u914d\u3002`cost_rank_diff` \u8d8a\u5927\uff0c`margin` \u5c31\u8d8a\u63a5\u8fd10\u3002\u635f\u5931 `softplus(margin - logsigmoid(scaled_logp_diff))` \u7684\u76ee\u6807\u662f\u8ba9 `logsigmoid(...)` \u7684\u503c\u5927\u4e8e `margin`\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff0c\u6a21\u578b\u9700\u8981\u4ea7\u751f\u4e00\u4e2a\u975e\u5e38\u63a5\u8fd10\u7684 `logsigmoid` \u8f93\u51fa\uff08\u5373\u4e00\u4e2a\u975e\u5e38\u5927\u7684 `scaled_logp_diff`\uff09\uff0c\u624d\u80fd\u907f\u514d\u60e9\u7f5a\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5de7\u5999\u5730\u5c06\u6210\u672c\u5dee\u5f02\u7684\u91cd\u8981\u6027\u540c\u65f6\u7f16\u7801\u5230\u4e86\u88d5\u5ea6 `margin` \u548c\u7f29\u653e\u56e0\u5b50 `scaling_factor` \u4e2d\uff0c\u5b9e\u73b0\u4e86\u5bf9\u5173\u952e\u6837\u672c\u5bf9\u7684\u53cc\u91cd\u5f3a\u8c03\uff0c\u540c\u65f6\u4fdd\u6301\u4e86\u6570\u503c\u7684\u7a33\u5b9a\u6027\u548c\u68af\u5ea6\u7684\u5e73\u6ed1\u6027\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5c06\u81ea\u9002\u5e94\u7f29\u653e\u7684 `logp_diff` \u8f93\u5165\u5230\u4e00\u4e2a `logsigmoid` \u51fd\u6570\uff0c\u5e76\u5c06\u5176\u7ed3\u679c\u7f6e\u4e8e\u4e00\u4e2a\u5177\u6709\u52a8\u6001\u8d1f\u88d5\u5ea6\u7684\u94f0\u94fe\u635f\u5931\u6846\u67b6\u4e2d\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u65b0\u9896\u7684\u8026\u5408\u673a\u5236\u3002\u5b83\u65e2\u6709\u94f0\u94fe\u635f\u5931\u7684\u660e\u786e\u4f18\u5316\u76ee\u6807\uff0c\u53c8\u878d\u5165\u4e86LogSigmoid\u635f\u5931\u7684\u6982\u7387\u89e3\u91ca\u548c\u81ea\u9002\u5e94\u52a0\u6743\u7279\u6027\uff0c\u4ece\u800c\u5728\u9c81\u68d2\u6027\u3001\u7a33\u5b9a\u6027\u548c\u5bf9\u5173\u952e\u6837\u672c\u7684\u654f\u611f\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u65b0\u7684\u5e73\u8861\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u8d1f\u88d5\u5ea6\u7684\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\u88ab\u8f6c\u5316\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u79e9\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u4e25\u683c\u7684\u504f\u597d\u5b66\u4e60\u8981\u6c42\uff08\u5373\u88d5\u5ea6\u66f4\u63a5\u8fd10\uff09\uff0c\u8feb\u4f7f\u6a21\u578b\u4ea7\u751f\u66f4\u9ad8\u7684\u7f6e\u4fe1\u5ea6\u3002"}}, "operators_used": ["rank_gap", "tanh", "softplus", "logsigmoid"]}}}
{"generation": 7, "index": 2, "ir": {"name": "AdaptiveSigmoidHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u8bbe\u8ba1\u7684\u4f18\u70b9\uff0c\u540c\u65f6\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\uff0c\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u5177\u6709\u81ea\u9002\u5e94\u60e9\u7f5a\u5f3a\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u662f\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u53e6\u4e00\u4e2a\u662f\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff08\u5373\u91cd\u8981\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u8bbe\u8ba1\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u9879\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u7a33\u5b9a\u7684\u533a\u95f4 `[-1, 1]` \u5185\uff0c\u6709\u6548\u9632\u6b62\u4e86\u7531\u4e8e\u6982\u7387\u5dee\u5f02\u8fc7\u5927\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u81ea\u9002\u5e94\u60e9\u7f5a\u5f3a\u5ea6)**\uff1a\u6211\u4eec\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `softplus(margin - term)` \u8fd9\u79cdHinge Loss\u7ed3\u6784\uff0c\u800c\u662f\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u8026\u5408\u9879 `sigmoid(cost_rank_diff)`\u3002\u6211\u4eec\u5c06 `(dynamic_margin - scaled_logp_diff)` \u4f5c\u4e3a `logsigmoid` \u7684\u8f93\u5165\u3002`logsigmoid(x)` \u7b49\u4ef7\u4e8e `-softplus(-x)`\uff0c\u5f53 `x` \u5f88\u5927\u65f6\uff0c\u5176\u503c\u8d8b\u8fd1\u4e8e0\uff1b\u5f53 `x` \u5f88\u5c0f\u65f6\uff0c\u5176\u503c\u8d8b\u8fd1\u4e8e\u8d1f\u65e0\u7a77\u3002\u8fd9\u610f\u5473\u7740\u5f53\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6 `scaled_logp_diff` \u8fdc\u8d85\u76ee\u6807\u88d5\u5ea6 `dynamic_margin` \u65f6\uff0c\u635f\u5931\u63a5\u8fd1\u4e8e0\u3002\u7136\u800c\uff0c\u5f53\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\u65f6\uff0c\u635f\u5931\u4f1a\u663e\u8457\u589e\u52a0\u3002\u6700\u5173\u952e\u7684\u662f\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a `logsigmoid` \u635f\u5931\u4e58\u4ee5\u4e86\u4e00\u4e2a\u81ea\u9002\u5e94\u7684\u6743\u91cd `sigmoid(cost_rank_diff)`\u3002\u8fd9\u4e2a\u6743\u91cd\u9879\u610f\u5473\u7740\uff1a\u6210\u672c\u79e9\u5dee\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u60e9\u7f5a\u7684\u201c\u57fa\u7840\u529b\u5ea6\u201d\u5c31\u8d8a\u5927\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u80fd\u66f4\u667a\u80fd\u5730\u5206\u914d\u68af\u5ea6\uff1a\u5bf9\u4e8e\u533a\u5206\u5ea6\u672c\u5e94\u5f88\u660e\u663e\u7684\u6837\u672c\u5bf9\uff0c\u5982\u679c\u6a21\u578b\u505a\u9519\u4e86\uff0c\u4f1a\u53d7\u5230\u66f4\u4e25\u5389\u7684\u60e9\u7f5a\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u7edf\u4e00\u7684\u88d5\u5ea6\u4e0e\u7f29\u653e)**\uff1a\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\uff0c`dynamic_margin` \u548c `scaling_factor` \u7684\u8ba1\u7b97\u65b9\u5f0f\u7565\u6709\u4e0d\u540c\uff08\u4e00\u4e2a\u7528 `beta * rank_gap`\uff0c\u4e00\u4e2a\u7528 `softplus(rank_gap)`\uff09\u3002\u6211\u4eec\u7edf\u4e00\u5e76\u7b80\u5316\u4e86\u8fd9\u4e2a\u8bbe\u8ba1\u3002\u6211\u4eec\u4f7f\u7528 `beta * rank_gap` \u540c\u65f6\u4f5c\u4e3a `dynamic_margin` \u548c `scaling_factor`\u3002\u8fd9\u57fa\u4e8e\u4e00\u4e2a\u7b80\u6d01\u7684\u5047\u8bbe\uff1a\u76ee\u6807\u88d5\u5ea6\u548c\u6982\u7387\u5dee\u5f02\u7684\u7f29\u653e\u56e0\u5b50\u5e94\u8be5\u4e0e\u6210\u672c\u79e9\u5dee\u5448\u7b80\u5355\u7684\u7ebf\u6027\u5173\u7cfb\u3002\u8fd9\u51cf\u5c11\u4e86\u8d85\u53c2\u6570\u548c\u4e0d\u5fc5\u8981\u7684\u975e\u7ebf\u6027\u53d8\u6362\uff0c\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u7684\u5f71\u54cd\u8def\u5f84\u66f4\u52a0\u76f4\u63a5\u548c\u53ef\u89e3\u91ca\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`AdaptiveSigmoidHingeLoss` \u901a\u8fc7\u5c06\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u601d\u60f3\u4e0e `logsigmoid` \u635f\u5931\u6846\u67b6\u76f8\u7ed3\u5408\uff0c\u5e76\u5f15\u5165\u4e00\u4e2a\u7531\u6210\u672c\u79e9\u5dee\u9a71\u52a8\u7684\u81ea\u9002\u5e94\u60e9\u7f5a\u6743\u91cd\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u65b0\u9896\u7684\u635f\u5931\u51fd\u6570\u3002\u5b83\u65e2\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u7a33\u5b9a\u6027\u548c\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u6027\uff0c\u53c8\u901a\u8fc7\u65b0\u7684\u8026\u5408\u673a\u5236\u5b9e\u73b0\u4e86\u5bf9\u4e0d\u540c\u91cd\u8981\u7a0b\u5ea6\u6837\u672c\u7684\u5dee\u5f02\u5316\u60e9\u7f5a\uff0c\u65e8\u5728\u63d0\u5347\u5b66\u4e60\u6548\u7387\u548c\u6700\u7ec8\u6027\u80fd\u3002", "pseudocode": "def AdaptiveSigmoidHingeLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u7ee7\u627f] \u8ba1\u7b97\u57fa\u4e8e\u79e9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u4ee5\u589e\u5f3a\u9c81\u68d2\u6027\u3002\n    #    \u8fd9\u4e2a\u601d\u60f3\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\u90fd\u6709\u4f53\u73b0\u3002\n    cost_rank_diff = rank_gap(cost_w, cost_l)\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u7edf\u4e00\u7684\u52a8\u6001\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u3002\n    #    \u6211\u4eec\u7b80\u5316\u4e86\u7236\u4ee3\u7684\u8bbe\u8ba1\uff0c\u8ba9\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u90fd\u4e0e\u6210\u672c\u79e9\u5dee\u7ebf\u6027\u76f8\u5173\u3002\n    #    \u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u4e2d\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u7684\u6838\u5fc3\u6982\u5ff5\u3002\n    dynamic_margin = beta * cost_rank_diff\n    scaling_factor = beta * cost_rank_diff\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\u3002\n    #    \u8fd9\u4f53\u73b0\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u7ed9\u4e88\u66f4\u591a\u5173\u6ce8\u7684\u601d\u60f3\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 6. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u6838\u5fc3\u7684\u88d5\u5ea6\u5dee\u5f02\u9879\u3002\n    #    \u8fd9\u662fHinge-like\u635f\u5931\u7684\u6838\u5fc3\uff0c\u8861\u91cf\u4e86\u6a21\u578b\u7684\u8868\u73b0\u4e0e\u76ee\u6807\u88d5\u5ea6\u7684\u5dee\u8ddd\u3002\n    margin_gap = scaled_logp_diff - dynamic_margin\n\n    # 7. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u81ea\u9002\u5e94\u7684\u60e9\u7f5a\u6743\u91cd\u3002\n    #    \u6210\u672c\u79e9\u5dee\u8d8a\u5927\uff0csigmoid\u8f93\u51fa\u8d8a\u63a5\u8fd11\uff0c\u60e9\u7f5a\u529b\u5ea6\u8d8a\u5927\u3002\n    #    \u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u91cd\u8981\u6837\u672c\u7684\u9519\u8bef\u66f4\u654f\u611f\u3002\n    adaptive_penalty_weight = sigmoid(cost_rank_diff)\n\n    # 8. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u6700\u7ec8\u7684\u635f\u5931\u3002\n    #    \u6211\u4eec\u4f7f\u7528 logsigmoid(margin_gap) \u4f5c\u4e3a\u57fa\u7840\u635f\u5931\u3002logsigmoid(x) = -softplus(-x)\uff0c\n    #    \u5b83\u60e9\u7f5a margin_gap < 0 \u7684\u60c5\u51b5\u3002\u7136\u540e\u7528\u81ea\u9002\u5e94\u6743\u91cd\u8fdb\u884c\u7f29\u653e\u3002\n    #    \u6ce8\u610f\uff1alogsigmoid\u7684\u8f93\u51fa\u662f\u8d1f\u6570\uff0c\u56e0\u6b64\u4e58\u4ee5-1\u6765\u5f97\u5230\u4e00\u4e2a\u6b63\u7684\u635f\u5931\u503c\u3002\n    loss = -adaptive_penalty_weight * logsigmoid(margin_gap)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u7edf\u4e00\u7684\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6210\u672c\u79e9\u5dee\u8f6c\u6362\u4e3a\u76ee\u6807\u88d5\u5ea6\u548c\u6982\u7387\u9879\u6743\u91cd\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5dee\u5f02\u66f4\u654f\u611f\uff0c\u8981\u6c42\u6a21\u578b\u4e3a\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}}, "operators_used": ["rank_gap", "tanh", "sigmoid", "logsigmoid"], "implementation_hint": {"expects": ["cost_a, cost_b, logp_a, logp_b (all scalars or tensors of the same shape), and a scalar hyperparameter beta."], "returns": "A scalar loss value (or a tensor of the same shape as inputs) that is non-negative and differentiable."}}, "fitness": {"hf_like_score": 4.011749744415283, "validation_objective": 4.011749744415283, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.9749022722244263}, "train_score_mean": 4.228639662265778, "train_loss_mean": 0.6928490921854973, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "AdaptiveSigmoidHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u8bbe\u8ba1\u7684\u4f18\u70b9\uff0c\u540c\u65f6\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\uff0c\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u5177\u6709\u81ea\u9002\u5e94\u60e9\u7f5a\u5f3a\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u662f\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u53e6\u4e00\u4e2a\u662f\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff08\u5373\u91cd\u8981\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u8bbe\u8ba1\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u9879\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u7a33\u5b9a\u7684\u533a\u95f4 `[-1, 1]` \u5185\uff0c\u6709\u6548\u9632\u6b62\u4e86\u7531\u4e8e\u6982\u7387\u5dee\u5f02\u8fc7\u5927\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u81ea\u9002\u5e94\u60e9\u7f5a\u5f3a\u5ea6)**\uff1a\u6211\u4eec\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `softplus(margin - term)` \u8fd9\u79cdHinge Loss\u7ed3\u6784\uff0c\u800c\u662f\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u8026\u5408\u9879 `sigmoid(cost_rank_diff)`\u3002\u6211\u4eec\u5c06 `(dynamic_margin - scaled_logp_diff)` \u4f5c\u4e3a `logsigmoid` \u7684\u8f93\u5165\u3002`logsigmoid(x)` \u7b49\u4ef7\u4e8e `-softplus(-x)`\uff0c\u5f53 `x` \u5f88\u5927\u65f6\uff0c\u5176\u503c\u8d8b\u8fd1\u4e8e0\uff1b\u5f53 `x` \u5f88\u5c0f\u65f6\uff0c\u5176\u503c\u8d8b\u8fd1\u4e8e\u8d1f\u65e0\u7a77\u3002\u8fd9\u610f\u5473\u7740\u5f53\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6 `scaled_logp_diff` \u8fdc\u8d85\u76ee\u6807\u88d5\u5ea6 `dynamic_margin` \u65f6\uff0c\u635f\u5931\u63a5\u8fd1\u4e8e0\u3002\u7136\u800c\uff0c\u5f53\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\u65f6\uff0c\u635f\u5931\u4f1a\u663e\u8457\u589e\u52a0\u3002\u6700\u5173\u952e\u7684\u662f\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a `logsigmoid` \u635f\u5931\u4e58\u4ee5\u4e86\u4e00\u4e2a\u81ea\u9002\u5e94\u7684\u6743\u91cd `sigmoid(cost_rank_diff)`\u3002\u8fd9\u4e2a\u6743\u91cd\u9879\u610f\u5473\u7740\uff1a\u6210\u672c\u79e9\u5dee\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5176\u60e9\u7f5a\u7684\u201c\u57fa\u7840\u529b\u5ea6\u201d\u5c31\u8d8a\u5927\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u80fd\u66f4\u667a\u80fd\u5730\u5206\u914d\u68af\u5ea6\uff1a\u5bf9\u4e8e\u533a\u5206\u5ea6\u672c\u5e94\u5f88\u660e\u663e\u7684\u6837\u672c\u5bf9\uff0c\u5982\u679c\u6a21\u578b\u505a\u9519\u4e86\uff0c\u4f1a\u53d7\u5230\u66f4\u4e25\u5389\u7684\u60e9\u7f5a\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u7edf\u4e00\u7684\u88d5\u5ea6\u4e0e\u7f29\u653e)**\uff1a\u5728\u4e24\u4e2a\u7236\u4ee3\u4e2d\uff0c`dynamic_margin` \u548c `scaling_factor` \u7684\u8ba1\u7b97\u65b9\u5f0f\u7565\u6709\u4e0d\u540c\uff08\u4e00\u4e2a\u7528 `beta * rank_gap`\uff0c\u4e00\u4e2a\u7528 `softplus(rank_gap)`\uff09\u3002\u6211\u4eec\u7edf\u4e00\u5e76\u7b80\u5316\u4e86\u8fd9\u4e2a\u8bbe\u8ba1\u3002\u6211\u4eec\u4f7f\u7528 `beta * rank_gap` \u540c\u65f6\u4f5c\u4e3a `dynamic_margin` \u548c `scaling_factor`\u3002\u8fd9\u57fa\u4e8e\u4e00\u4e2a\u7b80\u6d01\u7684\u5047\u8bbe\uff1a\u76ee\u6807\u88d5\u5ea6\u548c\u6982\u7387\u5dee\u5f02\u7684\u7f29\u653e\u56e0\u5b50\u5e94\u8be5\u4e0e\u6210\u672c\u79e9\u5dee\u5448\u7b80\u5355\u7684\u7ebf\u6027\u5173\u7cfb\u3002\u8fd9\u51cf\u5c11\u4e86\u8d85\u53c2\u6570\u548c\u4e0d\u5fc5\u8981\u7684\u975e\u7ebf\u6027\u53d8\u6362\uff0c\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u7684\u5f71\u54cd\u8def\u5f84\u66f4\u52a0\u76f4\u63a5\u548c\u53ef\u89e3\u91ca\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`AdaptiveSigmoidHingeLoss` \u901a\u8fc7\u5c06\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u601d\u60f3\u4e0e `logsigmoid` \u635f\u5931\u6846\u67b6\u76f8\u7ed3\u5408\uff0c\u5e76\u5f15\u5165\u4e00\u4e2a\u7531\u6210\u672c\u79e9\u5dee\u9a71\u52a8\u7684\u81ea\u9002\u5e94\u60e9\u7f5a\u6743\u91cd\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u65b0\u9896\u7684\u635f\u5931\u51fd\u6570\u3002\u5b83\u65e2\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u7a33\u5b9a\u6027\u548c\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u6027\uff0c\u53c8\u901a\u8fc7\u65b0\u7684\u8026\u5408\u673a\u5236\u5b9e\u73b0\u4e86\u5bf9\u4e0d\u540c\u91cd\u8981\u7a0b\u5ea6\u6837\u672c\u7684\u5dee\u5f02\u5316\u60e9\u7f5a\uff0c\u65e8\u5728\u63d0\u5347\u5b66\u4e60\u6548\u7387\u548c\u6700\u7ec8\u6027\u80fd\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u7edf\u4e00\u7684\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6210\u672c\u79e9\u5dee\u8f6c\u6362\u4e3a\u76ee\u6807\u88d5\u5ea6\u548c\u6982\u7387\u9879\u6743\u91cd\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5dee\u5f02\u66f4\u654f\u611f\uff0c\u8981\u6c42\u6a21\u578b\u4e3a\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}}, "operators_used": ["rank_gap", "tanh", "sigmoid", "logsigmoid"]}}}
{"generation": 7, "index": 3, "ir": {"name": "ZScoreClippedSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u5b66\u4e60\u5f3a\u5ea6\uff0c\u53c8\u5177\u5907\u6781\u9ad8\u6570\u503c\u7a33\u5b9a\u6027\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u6280\u5de7\uff0c\u5bf9\u5173\u952e\u9879\u8fdb\u884c\u7cbe\u7ec6\u63a7\u5236\uff0c\u4ee5\u9002\u5e94\u4e0d\u540c\u5206\u5e03\u7684\u6210\u672c\u548c\u6a21\u578b\u8f93\u51fa\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u4f7f\u7528`tanh`\u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee `(logp_w - logp_l)` \u7684\u6838\u5fc3\u6280\u5de7\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u9879\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u6709\u754c\u7684\u8303\u56f4\u5185\uff08[-1, 1]\uff09\uff0c\u4ece\u800c\u9632\u6b62\u4e86\u56e0\u6982\u7387\u5dee\u5f02\u8fc7\u5927\u800c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684 `scaling_factor` \u6765\u52a0\u6743\u5bf9\u6570\u6982\u7387\u5dee\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u8fc7\u7a0b\u80fd\u591f\u805a\u7126\u4e8e\u4fe1\u606f\u91cf\u6700\u5927\u7684\u6837\u672c\u5bf9\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u3001\u66f4\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u5f52\u4e00\u5316\u65b9\u6cd5\u3002\u4e0d\u540c\u4e8e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684`rank_gap`\uff0c\u6211\u4eec\u91c7\u7528\u4e86`zscore`\u5f52\u4e00\u5316\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u8ba1\u7b97 `(cost_l - cost_w)` \u5728\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u7684 z-score\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u8003\u8651\u4e86\u6210\u672c\u5dee\u5f02\u7684\u76f8\u5bf9\u5927\u5c0f\uff08\u5982`rank_gap`\uff09\uff0c\u8fd8\u8003\u8651\u4e86\u6574\u4e2a\u6279\u6b21\u5185\u6210\u672c\u5dee\u5f02\u7684\u5206\u5e03\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u3002\u8fd9\u4f7f\u5f97 `scaling_factor` \u80fd\u591f\u81ea\u9002\u5e94\u5730\u8c03\u6574\uff0c\u4f7f\u5176\u5728\u4e00\u4e2a\u6279\u6b21\u5185\u5927\u81f4\u670d\u4ece\u6807\u51c6\u6b63\u6001\u5206\u5e03\u3002\u8fd9\u6bd4`rank_gap`\u66f4\u80fd\u62b5\u6297\u5f02\u5e38\u503c\uff0c\u5e76\u4f7f `scaling_factor` \u7684\u5c3a\u5ea6\u66f4\u52a0\u6807\u51c6\u5316\u548c\u53ef\u63a7\u3002\n2.  **\u65b0\u7684\u7a33\u5b9a\u6280\u5de7 (\u8026\u5408\u70b92)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u6211\u4eec\u5bf9\u52a0\u6743\u540e\u7684\u5bf9\u6570\u6982\u7387\u5dee `scaled_logp_diff` \u8fdb\u884c\u4e86`clamp`\u64cd\u4f5c\uff0c\u5c06\u5176\u9650\u5236\u5728 `[-M, M]` \u7684\u8303\u56f4\u5185\uff08\u5176\u4e2d M \u662f\u4e00\u4e2a\u8d85\u53c2\u6570\uff09\u3002\u8fd9\u4e00\u6b65\u9aa4\u53d1\u751f\u5728\u6838\u5fc3\u7684 `logsigmoid` \u8ba1\u7b97\u4e4b\u524d\u3002\u8fd9\u4e48\u505a\u7684\u52a8\u673a\u662f\uff0c\u5373\u4f7f `scaling_factor` \u7ecf\u8fc7\u4e86 z-score \u5f52\u4e00\u5316\uff0c\u5b83\u5728\u67d0\u4e9b\u6781\u7aef\u60c5\u51b5\u4e0b\u4ecd\u53ef\u80fd\u4ea7\u751f\u8f83\u5927\u7684\u503c\u3002\u901a\u8fc7`clamp`\uff0c\u6211\u4eec\u4e3a `logsigmoid` \u7684\u8f93\u5165\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edd\u5bf9\u7684\u4e0a\u754c\u548c\u4e0b\u754c\uff0c\u5f7b\u5e95\u675c\u7edd\u4e86\u56e0\u8f93\u5165\u503c\u8fc7\u5927\u6216\u8fc7\u5c0f\u800c\u53ef\u80fd\u5bfc\u81f4\u7684\u6570\u503c\u6ea2\u51fa\uff08NaN/Inf\uff09\u98ce\u9669\uff0c\u786e\u4fdd\u4e86\u6574\u4e2a\u635f\u5931\u8ba1\u7b97\u8fc7\u7a0b\u7684\u7aef\u5230\u7aef\u7a33\u5b9a\u6027\u3002\n3.  **\u635f\u5931\u6846\u67b6\u7684\u878d\u5408**\uff1a\u6211\u4eec\u5c06\u4e0a\u8ff0\u7ecf\u8fc7\u5c42\u5c42\u7a33\u5b9a\u5316\u5904\u7406\u7684\u9879 `clipped_term` \u6700\u7ec8\u8f93\u5165\u5230\u7ecf\u5178\u7684 `-logsigmoid(x)` \u6846\u67b6\u4e2d\u3002\u8fd9\u4e0e\u7236\u4ee31\u7684`softplus`\u6846\u67b6\u4e0d\u540c\uff0c`logsigmoid`\u635f\u5931\u5929\u7136\u5730\u60e9\u7f5a\u6240\u6709\u65b9\u5411\u9519\u8bef\u6216\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\u7684\u9884\u6d4b\uff0c\u4e14\u5bf9\u4e8e\u7f6e\u4fe1\u5ea6\u975e\u5e38\u9ad8\u7684\u6b63\u786e\u9884\u6d4b\uff0c\u5176\u68af\u5ea6\u4f1a\u81ea\u7136\u6d88\u5931\uff0c\u8fd9\u662f\u4e00\u79cd\u5e73\u6ed1\u4e14\u9ad8\u6548\u7684\u60e9\u7f5a\u673a\u5236\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreClippedSigmoidLoss` \u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u7a33\u5b9a\u5316\u548c\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\uff0c\u5e76\u901a\u8fc7\u5f15\u5165 z-score \u5f52\u4e00\u5316\u548c\u663e\u5f0f\u88c1\u526a\uff08clamp\uff09\u8fd9\u4e24\u4e2a\u65b0\u7684\u8026\u5408\u70b9\uff0c\u6781\u5927\u5730\u63d0\u5347\u4e86\u635f\u5931\u51fd\u6570\u5bf9\u4e0d\u540c\u6570\u636e\u5206\u5e03\u7684\u9002\u5e94\u6027\u548c\u6570\u503c\u9c81\u68d2\u6027\uff0c\u6700\u7ec8\u5f62\u6210\u4e86\u4e00\u4e2a\u7a33\u5b9a\u3001\u81ea\u9002\u5e94\u4e14\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u635f\u5931\u3002", "pseudocode": "def ZScoreClippedSigmoidLoss(cost_a, cost_b, logp_a, logp_b, M):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u7684z-score\u4f5c\u4e3a\u7f29\u653e\u56e0\u5b50\n    #    zscore(cost_l - cost_w) \u4f1a\u5728\u6574\u4e2a\u6279\u6b21\u4e0a\u8ba1\u7b97\u8be5\u5dee\u5f02\u503c\u7684z-score\u3002\n    #    \u8fd9\u4f7f\u5f97\u7f29\u653e\u56e0\u5b50\u80fd\u81ea\u9002\u5e94\u6279\u6b21\u5185\u6210\u672c\u5dee\u5f02\u7684\u5206\u5e03\uff0c\u6bd4rank_gap\u66f4\u9c81\u68d2\u3002\n    scaling_factor = zscore(cost_l - cost_w)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u52a0\u6743\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u9879\n    #    \u8fd9\u7ee7\u627f\u4e86\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u601d\u60f3\uff0c\u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u8be5\u9879\u5f71\u54cd\u8d8a\u5927\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 5. [\u65b0\u8026\u5408\u70b92] \u5bf9\u52a0\u6743\u9879\u8fdb\u884c\u88c1\u526a\uff0c\u63d0\u4f9b\u7edd\u5bf9\u7684\u6570\u503c\u8fb9\u754c\n    #    \u4f7f\u7528 clamp \u64cd\u4f5c\u786e\u4fdd\u8f93\u5165\u5230logsigsmoid\u7684\u9879\u4e0d\u4f1a\u8fc7\u5927\u6216\u8fc7\u5c0f\uff0c\n    #    \u4ece\u800c\u5f7b\u5e95\u907f\u514d NaN/Inf \u95ee\u9898\u3002\n    clipped_term = clamp(scaled_logp_diff, min=-M, max=M)\n\n    # 6. \u8ba1\u7b97\u6700\u7ec8\u7684 LogSigmoid \u635f\u5931\n    #    -logsigmoid(x) \u7b49\u4ef7\u4e8e softplus(-x)\uff0c\u662f\u4e00\u79cd\u5e73\u6ed1\u4e14\u7a33\u5b9a\u7684\u635f\u5931\u5f62\u5f0f\u3002\n    #    \u6211\u4eec\u671f\u671b clipped_term \u5c3d\u53ef\u80fd\u5927\uff0c\u5f53\u5176\u4e3a\u8d1f\u6570\u6216\u4e0d\u591f\u5927\u65f6\uff0c\u635f\u5931\u4f1a\u589e\u52a0\u3002\n    loss = -logsigmoid(clipped_term)\n\n    return loss", "hyperparams": {"M": {"value": 10.0, "description": "\u88c1\u526a\u8fb9\u754c\u503c\u3002\u6b64\u53c2\u6570\u7528\u4e8e\u9650\u5236`scaled_logp_diff`\u7684\u8303\u56f4\uff0c\u9632\u6b62\u5176\u8fdb\u5165`logsigmoid`\u51fd\u6570\u540e\u4ea7\u751f\u6570\u503c\u4e0d\u7a33\u5b9a\u95ee\u9898\u3002\u4e00\u4e2a\u9002\u4e2d\u7684\u503c\uff08\u59825.0\u621610.0\uff09\u53ef\u4ee5\u5728\u4fdd\u8bc1\u7a33\u5b9a\u6027\u7684\u540c\u65f6\uff0c\u4e0d\u8fc7\u5ea6\u9650\u5236\u6a21\u578b\u7684\u5b66\u4e60\u80fd\u529b\u3002"}}, "operators_used": ["zscore", "tanh", "clamp", "logsigmoid"], "implementation_hint": {"expects": ["cost_a, cost_b, logp_a, logp_b: Tensors of shape [batch_size]. The zscore operator is expected to compute statistics over the batch dimension."], "returns": "loss: A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.063826322555542, "validation_objective": 4.063826322555542, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.027307748794556}, "train_score_mean": 4.230242989957333, "train_loss_mean": 0.6928546689450741, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u5b66\u4e60\u5f3a\u5ea6\uff0c\u53c8\u5177\u5907\u6781\u9ad8\u6570\u503c\u7a33\u5b9a\u6027\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u6280\u5de7\uff0c\u5bf9\u5173\u952e\u9879\u8fdb\u884c\u7cbe\u7ec6\u63a7\u5236\uff0c\u4ee5\u9002\u5e94\u4e0d\u540c\u5206\u5e03\u7684\u6210\u672c\u548c\u6a21\u578b\u8f93\u51fa\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u4f7f\u7528`tanh`\u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee `(logp_w - logp_l)` \u7684\u6838\u5fc3\u6280\u5de7\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u9879\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u6709\u754c\u7684\u8303\u56f4\u5185\uff08[-1, 1]\uff09\uff0c\u4ece\u800c\u9632\u6b62\u4e86\u56e0\u6982\u7387\u5dee\u5f02\u8fc7\u5927\u800c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u7f29\u653e\u201d\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5373\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684 `scaling_factor` \u6765\u52a0\u6743\u5bf9\u6570\u6982\u7387\u5dee\u3002\u8fd9\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u8d8a\u5927\u7684\u6837\u672c\u5bf9\uff0c\u5728\u635f\u5931\u8ba1\u7b97\u4e2d\u7684\u91cd\u8981\u6027\u4e5f\u8d8a\u5927\uff0c\u6a21\u578b\u9700\u8981\u66f4\u52aa\u529b\u5730\u53bb\u6b63\u786e\u533a\u5206\u5b83\u4eec\u3002\u8fd9\u4f7f\u5f97\u5b66\u4e60\u8fc7\u7a0b\u80fd\u591f\u805a\u7126\u4e8e\u4fe1\u606f\u91cf\u6700\u5927\u7684\u6837\u672c\u5bf9\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u3001\u66f4\u9c81\u68d2\u7684\u6210\u672c\u5dee\u5f02\u5f52\u4e00\u5316\u65b9\u6cd5\u3002\u4e0d\u540c\u4e8e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684`rank_gap`\uff0c\u6211\u4eec\u91c7\u7528\u4e86`zscore`\u5f52\u4e00\u5316\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u8ba1\u7b97 `(cost_l - cost_w)` \u5728\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u7684 z-score\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u8003\u8651\u4e86\u6210\u672c\u5dee\u5f02\u7684\u76f8\u5bf9\u5927\u5c0f\uff08\u5982`rank_gap`\uff09\uff0c\u8fd8\u8003\u8651\u4e86\u6574\u4e2a\u6279\u6b21\u5185\u6210\u672c\u5dee\u5f02\u7684\u5206\u5e03\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u3002\u8fd9\u4f7f\u5f97 `scaling_factor` \u80fd\u591f\u81ea\u9002\u5e94\u5730\u8c03\u6574\uff0c\u4f7f\u5176\u5728\u4e00\u4e2a\u6279\u6b21\u5185\u5927\u81f4\u670d\u4ece\u6807\u51c6\u6b63\u6001\u5206\u5e03\u3002\u8fd9\u6bd4`rank_gap`\u66f4\u80fd\u62b5\u6297\u5f02\u5e38\u503c\uff0c\u5e76\u4f7f `scaling_factor` \u7684\u5c3a\u5ea6\u66f4\u52a0\u6807\u51c6\u5316\u548c\u53ef\u63a7\u3002\n2.  **\u65b0\u7684\u7a33\u5b9a\u6280\u5de7 (\u8026\u5408\u70b92)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u6211\u4eec\u5bf9\u52a0\u6743\u540e\u7684\u5bf9\u6570\u6982\u7387\u5dee `scaled_logp_diff` \u8fdb\u884c\u4e86`clamp`\u64cd\u4f5c\uff0c\u5c06\u5176\u9650\u5236\u5728 `[-M, M]` \u7684\u8303\u56f4\u5185\uff08\u5176\u4e2d M \u662f\u4e00\u4e2a\u8d85\u53c2\u6570\uff09\u3002\u8fd9\u4e00\u6b65\u9aa4\u53d1\u751f\u5728\u6838\u5fc3\u7684 `logsigmoid` \u8ba1\u7b97\u4e4b\u524d\u3002\u8fd9\u4e48\u505a\u7684\u52a8\u673a\u662f\uff0c\u5373\u4f7f `scaling_factor` \u7ecf\u8fc7\u4e86 z-score \u5f52\u4e00\u5316\uff0c\u5b83\u5728\u67d0\u4e9b\u6781\u7aef\u60c5\u51b5\u4e0b\u4ecd\u53ef\u80fd\u4ea7\u751f\u8f83\u5927\u7684\u503c\u3002\u901a\u8fc7`clamp`\uff0c\u6211\u4eec\u4e3a `logsigmoid` \u7684\u8f93\u5165\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edd\u5bf9\u7684\u4e0a\u754c\u548c\u4e0b\u754c\uff0c\u5f7b\u5e95\u675c\u7edd\u4e86\u56e0\u8f93\u5165\u503c\u8fc7\u5927\u6216\u8fc7\u5c0f\u800c\u53ef\u80fd\u5bfc\u81f4\u7684\u6570\u503c\u6ea2\u51fa\uff08NaN/Inf\uff09\u98ce\u9669\uff0c\u786e\u4fdd\u4e86\u6574\u4e2a\u635f\u5931\u8ba1\u7b97\u8fc7\u7a0b\u7684\u7aef\u5230\u7aef\u7a33\u5b9a\u6027\u3002\n3.  **\u635f\u5931\u6846\u67b6\u7684\u878d\u5408**\uff1a\u6211\u4eec\u5c06\u4e0a\u8ff0\u7ecf\u8fc7\u5c42\u5c42\u7a33\u5b9a\u5316\u5904\u7406\u7684\u9879 `clipped_term` \u6700\u7ec8\u8f93\u5165\u5230\u7ecf\u5178\u7684 `-logsigmoid(x)` \u6846\u67b6\u4e2d\u3002\u8fd9\u4e0e\u7236\u4ee31\u7684`softplus`\u6846\u67b6\u4e0d\u540c\uff0c`logsigmoid`\u635f\u5931\u5929\u7136\u5730\u60e9\u7f5a\u6240\u6709\u65b9\u5411\u9519\u8bef\u6216\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\u7684\u9884\u6d4b\uff0c\u4e14\u5bf9\u4e8e\u7f6e\u4fe1\u5ea6\u975e\u5e38\u9ad8\u7684\u6b63\u786e\u9884\u6d4b\uff0c\u5176\u68af\u5ea6\u4f1a\u81ea\u7136\u6d88\u5931\uff0c\u8fd9\u662f\u4e00\u79cd\u5e73\u6ed1\u4e14\u9ad8\u6548\u7684\u60e9\u7f5a\u673a\u5236\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreClippedSigmoidLoss` \u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u7a33\u5b9a\u5316\u548c\u81ea\u9002\u5e94\u52a0\u6743\u601d\u60f3\uff0c\u5e76\u901a\u8fc7\u5f15\u5165 z-score \u5f52\u4e00\u5316\u548c\u663e\u5f0f\u88c1\u526a\uff08clamp\uff09\u8fd9\u4e24\u4e2a\u65b0\u7684\u8026\u5408\u70b9\uff0c\u6781\u5927\u5730\u63d0\u5347\u4e86\u635f\u5931\u51fd\u6570\u5bf9\u4e0d\u540c\u6570\u636e\u5206\u5e03\u7684\u9002\u5e94\u6027\u548c\u6570\u503c\u9c81\u68d2\u6027\uff0c\u6700\u7ec8\u5f62\u6210\u4e86\u4e00\u4e2a\u7a33\u5b9a\u3001\u81ea\u9002\u5e94\u4e14\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u635f\u5931\u3002", "hyperparams": {"M": {"value": 10.0, "description": "\u88c1\u526a\u8fb9\u754c\u503c\u3002\u6b64\u53c2\u6570\u7528\u4e8e\u9650\u5236`scaled_logp_diff`\u7684\u8303\u56f4\uff0c\u9632\u6b62\u5176\u8fdb\u5165`logsigmoid`\u51fd\u6570\u540e\u4ea7\u751f\u6570\u503c\u4e0d\u7a33\u5b9a\u95ee\u9898\u3002\u4e00\u4e2a\u9002\u4e2d\u7684\u503c\uff08\u59825.0\u621610.0\uff09\u53ef\u4ee5\u5728\u4fdd\u8bc1\u7a33\u5b9a\u6027\u7684\u540c\u65f6\uff0c\u4e0d\u8fc7\u5ea6\u9650\u5236\u6a21\u578b\u7684\u5b66\u4e60\u80fd\u529b\u3002"}}, "operators_used": ["zscore", "tanh", "clamp", "logsigmoid"]}}}
{"generation": 7, "index": 5, "ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u80fd\u5229\u7528\u6210\u5bf9\u6837\u672c\u7684\u5168\u5c40\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u53c8\u80fd\u5728\u6570\u503c\u4e0a\u4fdd\u6301\u7a33\u5b9a\u548c\u9c81\u68d2\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u8bbe\u8ba1\uff0c\u5373\u635f\u5931\u51fd\u6570\u540c\u65f6\u5305\u542b\u4e00\u4e2a\u663e\u5f0f\u7684\u76ee\u6807\u88d5\u5ea6 (`dynamic_margin`) \u548c\u4e00\u4e2a\u5bf9\u6a21\u578b\u7f6e\u4fe1\u5ea6\u8fdb\u884c\u9690\u5f0f\u52a0\u6743\u7684\u9879 (`scaled_logp_diff`)\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\u5177\u4f53\u8868\u73b0\u4e3a `softplus(dynamic_margin - scaled_logp_diff)` \u7684\u7ed3\u6784\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u4f7f\u7528 `softplus` \u4f5c\u4e3a\u5e73\u6ed1\u7684 Hinge Loss \u66ff\u4ee3\u65b9\u6848\u7684\u6846\u67b6\uff0c\u8fd9\u786e\u4fdd\u4e86\u635f\u5931\u51fd\u6570\u5904\u5904\u53ef\u5bfc\u3002\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u7ee7\u627f\u4e86\u4f7f\u7528 `tanh` \u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee (`logp_w - logp_l`) \u7684\u6280\u5de7\uff0c\u5c06\u5176\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u6709\u6548\u9632\u6b62\u4e86\u68af\u5ea6\u7206\u70b8\u95ee\u9898\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u5168\u65b0\u7684\u3001\u57fa\u4e8e\u5168\u5c40\u4e0a\u4e0b\u6587\u7684\u6210\u672c\u5dee\u5f02\u5f52\u4e00\u5316\u65b9\u6cd5\u2014\u2014`zscore`\u3002\u4e0e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap` \u4e0d\u540c\uff0c`zscore` \u4e0d\u4ec5\u8003\u8651\u4e86\u5f53\u524d\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u8fd8\u8003\u8651\u4e86\u8fd9\u4e2a\u5dee\u5f02\u5728\u4e00\u6574\u4e2a\u6279\u6b21\uff08batch\uff09\u6570\u636e\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff08\u5373\u504f\u79bb\u5747\u503c\u7684\u6807\u51c6\u5dee\u500d\u6570\uff09\u3002`zscore(cost_l - cost_w)` \u4f1a\u8fd4\u56de\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u5dee\u5f02\u503c\u3002\u8fd9\u79cd\u505a\u6cd5\u4f7f\u5f97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u8ba1\u7b97\u5bf9\u6574\u4e2a\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\u66f4\u52a0\u654f\u611f\u548c\u81ea\u9002\u5e94\u3002\u4f8b\u5982\uff0c\u5728\u4e00\u4e2a\u6210\u672c\u5dee\u5f02\u666e\u904d\u8f83\u5c0f\u7684\u6279\u6b21\u4e2d\uff0c\u4e00\u4e2a\u4e2d\u7b49\u5927\u5c0f\u7684\u5dee\u5f02\u4f1a\u88ab\u653e\u5927\uff1b\u800c\u5728\u4e00\u4e2a\u6210\u672c\u5dee\u5f02\u666e\u904d\u5f88\u5927\u7684\u6279\u6b21\u4e2d\uff0c\u540c\u6837\u5927\u5c0f\u7684\u5dee\u5f02\u53ef\u80fd\u88ab\u89c6\u4e3a\u4e0d\u91cd\u8981\u3002\n2.  **\u8026\u5408 `zscore` \u5230\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5c06 `zscore` \u7684\u8f93\u51fa\u540c\u65f6\u7528\u4e8e\u8ba1\u7b97\u52a8\u6001\u88d5\u5ea6 (`dynamic_margin`) \u548c\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50 (`scaling_factor`)\u3002\u5177\u4f53\u6765\u8bf4\uff0c`dynamic_margin = beta * z_diff` \u548c `scaling_factor = softplus(z_diff)`\u3002\u8fd9\u4e0e\u7236\u4ee3\u4e2d\u76f4\u63a5\u4f7f\u7528 `rank_gap` \u7684\u505a\u6cd5\u4e0d\u540c\uff0c\u5b83\u5c06 `zscore` \u8fd9\u4e00\u65b0\u7684\u5f52\u4e00\u5316\u7b97\u5b50\u6df1\u5ea6\u8026\u5408\u5230\u4e86\u7236\u4ee31\u7684\u6df7\u5408\u88d5\u5ea6\u6846\u67b6\u4e2d\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7edf\u4e00\u4e86\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\u7684\u6765\u6e90\uff0c\u5e76\u5229\u7528\u5176\u7edf\u8ba1\u7279\u6027\u6765\u6307\u5bfc\u5b66\u4e60\uff0c\u589e\u5f3a\u4e86\u635f\u5931\u5bf9\u6279\u6b21\u6570\u636e\u52a8\u6001\u7684\u9002\u5e94\u6027\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5f15\u5165 `zscore` \u5f52\u4e00\u5316\uff0c\u5c06\u7236\u4ee3\u4e2d\u57fa\u4e8e\u5c40\u90e8\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02\u8ba1\u7b97\uff0c\u5347\u7ea7\u4e3a\u57fa\u4e8e\u5168\u5c40\u6279\u6b21\u4e0a\u4e0b\u6587\u7684\u7edf\u8ba1\u5dee\u5f02\u8ba1\u7b97\u3002\u7136\u540e\uff0c\u5b83\u5c06\u8fd9\u4e2a\u66f4\u5177\u9c81\u68d2\u6027\u7684\u7edf\u8ba1\u4fe1\u53f7\uff0c\u65e0\u7f1d\u5730\u8026\u5408\u5230\u7236\u4ee31\u7684\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u8bbe\u8ba1\u548c\u7236\u4ee30\u7684\u7a33\u5b9a Hinge Loss \u6846\u67b6\u4e2d\uff0c\u4ece\u800c\u521b\u9020\u51fa\u4e00\u4e2a\u5bf9\u6279\u6b21\u6570\u636e\u5206\u5e03\u81ea\u9002\u5e94\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u5b66\u4e60\u76ee\u6807\u660e\u786e\u7684\u65b0\u578b\u504f\u597d\u635f\u5931\u3002", "pseudocode": "def ZScoreNormalizedHybridLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # \u5047\u8bbe cost_a, cost_b, logp_a, logp_b \u90fd\u662f\u4e00\u4e2a\u6279\u6b21(batch)\u7684\u5411\u91cf\u3002\n\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    is_a_winner = cost_a < cost_b\n    cost_w = where(is_a_winner, cost_a, cost_b)\n    cost_l = where(is_a_winner, cost_b, cost_a)\n    logp_w = where(is_a_winner, logp_a, logp_b)\n    logp_l = where(is_a_winner, logp_b, logp_a)\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u7684Z-Score\n    #    \u4f7f\u7528 zscore \u5bf9\u6279\u6b21\u5185\u7684\u6210\u672c\u5dee\u5f02 (cost_l - cost_w) \u8fdb\u884c\u5f52\u4e00\u5316\u3002\n    #    \u8fd9\u4f7f\u5f97\u5dee\u5f02\u7684\u5ea6\u91cf\u80fd\u591f\u81ea\u9002\u5e94\u6279\u6b21\u6570\u636e\u7684\u7edf\u8ba1\u7279\u6027\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u3002\n    #    zscore\u7684\u8f93\u51fa\u671f\u671b\u662f\u4e00\u4e2a\u5747\u503c\u4e3a0\uff0c\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\u3002\n    cost_diff = cost_l - cost_w\n    z_diff = zscore(cost_diff)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee31 + \u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u57fa\u4e8eZ-Score\u7684\u52a8\u6001\u88d5\u5ea6(margin)\n    #    \u88d5\u5ea6\u7684\u5927\u5c0f\u4e0e\u6210\u672c\u5dee\u5f02\u5728\u6279\u6b21\u4e2d\u7684\u7edf\u8ba1\u663e\u8457\u6027\u6210\u6b63\u6bd4\u3002\n    dynamic_margin = beta * z_diff\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31 + \u65b0\u8026\u5408\u70b92] \u521b\u5efa\u57fa\u4e8eZ-Score\u7684\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\n    #    \u4f7f\u7528 softplus \u786e\u4fdd\u7f29\u653e\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\u3002\n    scaling_factor = softplus(z_diff)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\n    #    \u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u7684\u201c\u9690\u5f0f\u52a0\u6743\u201d\u601d\u60f3\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 7. [\u7ee7\u627f\u81ea\u7236\u4ee30\u548c1] \u5c06\u52a0\u6743\u9879\u5d4c\u5165Hinge Loss\u6846\u67b6\n    #    \u8fd9\u7ee7\u627f\u4e86\u7236\u4ee31\u7684\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u6838\u5fc3\u7ed3\u6784\u548c\u7236\u4ee30\u7684\u5e73\u6ed1Hinge Loss\u6846\u67b6\u3002\n    #    \u5f53\u6a21\u578b\u7684\u52a0\u6743\u7f6e\u4fe1\u5ea6(scaled_logp_diff)\u5c0f\u4e8e\u57fa\u4e8eZ-Score\u7684\u52a8\u6001\u88d5\u5ea6\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    loss = softplus(dynamic_margin - scaled_logp_diff)\n\n    # \u8fd4\u56de\u8be5\u6279\u6b21\u6240\u6709\u6837\u672c\u5bf9\u7684\u5e73\u5747\u635f\u5931\n    return mean(loss)", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6210\u672c\u5dee\u5f02\u7684Z-Score\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u7edf\u8ba1\u663e\u8457\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}}, "operators_used": ["zscore", "softplus", "tanh"], "implementation_hint": {"expects": ["Tensors cost_a, cost_b, logp_a, logp_b of shape [batch_size]. The `zscore` operator should compute statistics over the batch dimension."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.033277750015259, "validation_objective": 4.033277750015259, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.984681725502014}, "train_score_mean": 4.25944958627224, "train_loss_mean": 0.6927903853356838, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u80fd\u5229\u7528\u6210\u5bf9\u6837\u672c\u7684\u5168\u5c40\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u53c8\u80fd\u5728\u6570\u503c\u4e0a\u4fdd\u6301\u7a33\u5b9a\u548c\u9c81\u68d2\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u8bbe\u8ba1\uff0c\u5373\u635f\u5931\u51fd\u6570\u540c\u65f6\u5305\u542b\u4e00\u4e2a\u663e\u5f0f\u7684\u76ee\u6807\u88d5\u5ea6 (`dynamic_margin`) \u548c\u4e00\u4e2a\u5bf9\u6a21\u578b\u7f6e\u4fe1\u5ea6\u8fdb\u884c\u9690\u5f0f\u52a0\u6743\u7684\u9879 (`scaled_logp_diff`)\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\u5177\u4f53\u8868\u73b0\u4e3a `softplus(dynamic_margin - scaled_logp_diff)` \u7684\u7ed3\u6784\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u7ee7\u627f\u4e86\u5176\u4f7f\u7528 `softplus` \u4f5c\u4e3a\u5e73\u6ed1\u7684 Hinge Loss \u66ff\u4ee3\u65b9\u6848\u7684\u6846\u67b6\uff0c\u8fd9\u786e\u4fdd\u4e86\u635f\u5931\u51fd\u6570\u5904\u5904\u53ef\u5bfc\u3002\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u7ee7\u627f\u4e86\u4f7f\u7528 `tanh` \u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee (`logp_w - logp_l`) \u7684\u6280\u5de7\uff0c\u5c06\u5176\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u6709\u6548\u9632\u6b62\u4e86\u68af\u5ea6\u7206\u70b8\u95ee\u9898\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u5168\u65b0\u7684\u3001\u57fa\u4e8e\u5168\u5c40\u4e0a\u4e0b\u6587\u7684\u6210\u672c\u5dee\u5f02\u5f52\u4e00\u5316\u65b9\u6cd5\u2014\u2014`zscore`\u3002\u4e0e\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap` \u4e0d\u540c\uff0c`zscore` \u4e0d\u4ec5\u8003\u8651\u4e86\u5f53\u524d\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02\uff0c\u8fd8\u8003\u8651\u4e86\u8fd9\u4e2a\u5dee\u5f02\u5728\u4e00\u6574\u4e2a\u6279\u6b21\uff08batch\uff09\u6570\u636e\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff08\u5373\u504f\u79bb\u5747\u503c\u7684\u6807\u51c6\u5dee\u500d\u6570\uff09\u3002`zscore(cost_l - cost_w)` \u4f1a\u8fd4\u56de\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u5dee\u5f02\u503c\u3002\u8fd9\u79cd\u505a\u6cd5\u4f7f\u5f97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u8ba1\u7b97\u5bf9\u6574\u4e2a\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\u66f4\u52a0\u654f\u611f\u548c\u81ea\u9002\u5e94\u3002\u4f8b\u5982\uff0c\u5728\u4e00\u4e2a\u6210\u672c\u5dee\u5f02\u666e\u904d\u8f83\u5c0f\u7684\u6279\u6b21\u4e2d\uff0c\u4e00\u4e2a\u4e2d\u7b49\u5927\u5c0f\u7684\u5dee\u5f02\u4f1a\u88ab\u653e\u5927\uff1b\u800c\u5728\u4e00\u4e2a\u6210\u672c\u5dee\u5f02\u666e\u904d\u5f88\u5927\u7684\u6279\u6b21\u4e2d\uff0c\u540c\u6837\u5927\u5c0f\u7684\u5dee\u5f02\u53ef\u80fd\u88ab\u89c6\u4e3a\u4e0d\u91cd\u8981\u3002\n2.  **\u8026\u5408 `zscore` \u5230\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50 (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5c06 `zscore` \u7684\u8f93\u51fa\u540c\u65f6\u7528\u4e8e\u8ba1\u7b97\u52a8\u6001\u88d5\u5ea6 (`dynamic_margin`) \u548c\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50 (`scaling_factor`)\u3002\u5177\u4f53\u6765\u8bf4\uff0c`dynamic_margin = beta * z_diff` \u548c `scaling_factor = softplus(z_diff)`\u3002\u8fd9\u4e0e\u7236\u4ee3\u4e2d\u76f4\u63a5\u4f7f\u7528 `rank_gap` \u7684\u505a\u6cd5\u4e0d\u540c\uff0c\u5b83\u5c06 `zscore` \u8fd9\u4e00\u65b0\u7684\u5f52\u4e00\u5316\u7b97\u5b50\u6df1\u5ea6\u8026\u5408\u5230\u4e86\u7236\u4ee31\u7684\u6df7\u5408\u88d5\u5ea6\u6846\u67b6\u4e2d\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7edf\u4e00\u4e86\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\u7684\u6765\u6e90\uff0c\u5e76\u5229\u7528\u5176\u7edf\u8ba1\u7279\u6027\u6765\u6307\u5bfc\u5b66\u4e60\uff0c\u589e\u5f3a\u4e86\u635f\u5931\u5bf9\u6279\u6b21\u6570\u636e\u52a8\u6001\u7684\u9002\u5e94\u6027\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7\u5f15\u5165 `zscore` \u5f52\u4e00\u5316\uff0c\u5c06\u7236\u4ee3\u4e2d\u57fa\u4e8e\u5c40\u90e8\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02\u8ba1\u7b97\uff0c\u5347\u7ea7\u4e3a\u57fa\u4e8e\u5168\u5c40\u6279\u6b21\u4e0a\u4e0b\u6587\u7684\u7edf\u8ba1\u5dee\u5f02\u8ba1\u7b97\u3002\u7136\u540e\uff0c\u5b83\u5c06\u8fd9\u4e2a\u66f4\u5177\u9c81\u68d2\u6027\u7684\u7edf\u8ba1\u4fe1\u53f7\uff0c\u65e0\u7f1d\u5730\u8026\u5408\u5230\u7236\u4ee31\u7684\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u8bbe\u8ba1\u548c\u7236\u4ee30\u7684\u7a33\u5b9a Hinge Loss \u6846\u67b6\u4e2d\uff0c\u4ece\u800c\u521b\u9020\u51fa\u4e00\u4e2a\u5bf9\u6279\u6b21\u6570\u636e\u5206\u5e03\u81ea\u9002\u5e94\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u5b66\u4e60\u76ee\u6807\u660e\u786e\u7684\u65b0\u578b\u504f\u597d\u635f\u5931\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6210\u672c\u5dee\u5f02\u7684Z-Score\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u7edf\u8ba1\u663e\u8457\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}}, "operators_used": ["zscore", "softplus", "tanh"]}}}
{"generation": 7, "index": 6, "ir": {"name": "ZScoreClippedAdaptiveHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u6784\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\uff0c\u5e76\u4e14\u80fd\u591f\u81ea\u9002\u5e94\u5730\u8c03\u6574\u60e9\u7f5a\u529b\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6 (`term`) \u9700\u8981\u8d85\u8d8a\u4e00\u4e2a\u52a8\u6001\u9608\u503c (`margin`)\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4e3a\u6a21\u578b\u63d0\u4f9b\u4e86\u6e05\u6670\u7684\u4f18\u5316\u65b9\u5411\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u53cc\u91cd\u5f3a\u8c03\u201d\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\u3002\u5728\u7236\u4ee31\u4e2d\uff0c\u6210\u672c\u5dee\u5f02\u540c\u65f6\u5f71\u54cd\u4e86`dynamic_margin`\u548c`scaled_logp_diff`\u3002\u5728\u672c\u8bbe\u8ba1\u4e2d\uff0c\u6211\u4eec\u5c06\u8fd9\u79cd\u601d\u60f3\u8f6c\u5316\u4e3a\uff1a\u6210\u672c\u5dee\u5f02\u4e0d\u4ec5\u7528\u4e8e\u8ba1\u7b97\u4e00\u4e2a\u57fa\u7840\u7684\u52a8\u6001\u88d5\u5ea6\uff0c\u8fd8\u901a\u8fc7\u4e00\u4e2a\u65b0\u7684\u8026\u5408\u70b9\uff08\u81ea\u9002\u5e94\u7f29\u653e\uff09\u6765\u8c03\u8282\u5bf9\u6570\u6982\u7387\u5dee\u7684\u60e9\u7f5a\u5f3a\u5ea6\uff0c\u5b9e\u73b0\u4e86\u5bf9\u91cd\u8981\u6837\u672c\u5bf9\u7684\u201c\u53cc\u91cd\u5173\u6ce8\u201d\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u4e3a\u4e86\u589e\u5f3a\u5bf9\u6279\u6b21\u5185\uff08in-batch\uff09\u6210\u672c\u5206\u5e03\u7684\u9002\u5e94\u6027\uff0c\u6211\u4eec\u653e\u5f03\u4e86\u57fa\u4e8e\u6392\u5e8f\u7684`rank_gap`\uff0c\u8f6c\u800c\u91c7\u7528`zscore`\u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884c\u5f52\u4e00\u5316\u3002`zscore(cost_l - cost_w)`\u8ba1\u7b97\u7684\u662f\u6210\u672c\u5dee\u503c\u5728\u8be5\u6279\u6b21\u6570\u636e\u4e2d\u7684\u6807\u51c6\u5316\u5206\u6570\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6`dynamic_margin`\u7684\u5c3a\u5ea6\u80fd\u591f\u6839\u636e\u5f53\u524d\u6279\u6b21\u7684\u6210\u672c\u5dee\u5f02\u5206\u5e03\u52a8\u6001\u8c03\u6574\u3002\u5982\u679c\u67d0\u4e2a\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u503c\u8fdc\u5927\u4e8e\u5f53\u524d\u6279\u6b21\u7684\u5e73\u5747\u5dee\u503c\uff0c\u5b83\u5c06\u83b7\u5f97\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u88d5\u5ea6\u76ee\u6807\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002\u8fd9\u6bd4`rank_gap`\u66f4\u80fd\u6355\u6349\u76f8\u5bf9\u91cd\u8981\u6027\u3002\n2.  **\u81ea\u9002\u5e94\u7f29\u653e\u4e0e\u88c1\u526a (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50`adaptive_scale`\uff0c\u5b83\u76f4\u63a5\u7531\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02`z_cost_diff`\u901a\u8fc7`softplus`\u51fd\u6570\u751f\u6210\u3002\u8fd9\u4e2a\u7f29\u653e\u56e0\u5b50\u968f\u540e\u88ab\u7528\u4e8e\u52a0\u6743\u5bf9\u6570\u6982\u7387\u5dee`logp_diff`\u3002\u66f4\u5173\u952e\u7684\u662f\uff0c\u6211\u4eec\u4f7f\u7528`clamp`\u7b97\u5b50\u5bf9\u8fd9\u4e2a\u52a0\u6743\u9879\u8fdb\u884c\u4e86\u88c1\u526a\uff08`clamp(..., min=-gamma, max=gamma)`\uff09\u3002\u8fd9\u6837\u505a\u6709\u53cc\u91cd\u76ee\u7684\uff1a(a) \u5b83\u7ee7\u627f\u4e86\u7236\u4ee31\u4e2d\u7528\u6210\u672c\u5dee\u5f02\u52a0\u6743`logp_diff`\u7684\u601d\u60f3\uff0c\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u7684\u68af\u5ea6\u66f4\u5927\uff1b(b) `clamp`\u64cd\u4f5c\u53d6\u4ee3\u4e86\u7236\u4ee3\u4e2d\u7684`tanh`\uff0c\u4f5c\u4e3a\u4e00\u79cd\u65b0\u7684\u3001\u66f4\u7075\u6d3b\u7684\u7a33\u5b9a\u6280\u5de7\u3002`tanh`\u5c06\u503c\u57df\u56fa\u5b9a\u5728[-1, 1]\uff0c\u800c`clamp`\u5141\u8bb8\u6211\u4eec\u901a\u8fc7\u8d85\u53c2\u6570`gamma`\u6765\u63a7\u5236\u68af\u5ea6\u7684\u6700\u5927/\u6700\u5c0f\u8d21\u732e\uff0c\u9632\u6b62\u6781\u7aef`logp_diff`\u503c\u5728\u4e0e`adaptive_scale`\u76f8\u4e58\u540e\u5bfc\u81f4\u68af\u5ea6\u7206\u70b8\uff0c\u540c\u65f6\u4fdd\u7559\u4e86\u6bd4`tanh`\u66f4\u5927\u7684\u7ebf\u6027\u54cd\u5e94\u533a\u95f4\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7`zscore`\u5b9e\u73b0\u4e86\u5bf9\u6279\u6b21\u5185\u6210\u672c\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u901a\u8fc7`clamp`\u548c\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u521b\u9020\u4e86\u4e00\u4e2a\u65e2\u80fd\u54cd\u5e94\u6210\u672c\u5dee\u5f02\u53c8\u80fd\u6709\u6548\u63a7\u5236\u68af\u5ea6\u7684\u7a33\u5b9a\u673a\u5236\uff0c\u5e76\u5c06\u8fd9\u4e9b\u65b0\u8bbe\u8ba1\u65e0\u7f1d\u5730\u878d\u5165\u4e86\u7ecf\u5178\u7684Hinge Loss\u6846\u67b6\u4e2d\uff0c\u65e8\u5728\u5b9e\u73b0\u66f4\u7a33\u5065\u3001\u66f4\u81ea\u9002\u5e94\u7684\u504f\u597d\u5b66\u4e60\u3002", "pseudocode": "def ZScoreClippedAdaptiveHingeLoss(cost_a, cost_b, logp_a, logp_b, beta, gamma):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u4f7f\u7528z-score\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\n    #    zscore(x) \u8ba1\u7b97x\u5728\u5f53\u524d\u6279\u6b21\u4e2d\u7684\u6807\u51c6\u5316\u5206\u6570\u3002\n    #    \u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u5c3a\u5ea6\u80fd\u81ea\u9002\u5e94\u4e8e\u5f53\u524d\u6279\u6b21\u7684\u6210\u672c\u5dee\u5f02\u5206\u5e03\u3002\n    z_cost_diff = zscore(cost_l - cost_w)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u57fa\u4e8ez-score\u7684\u52a8\u6001\u88d5\u5ea6(margin)\n    #    beta \u63a7\u5236\u88d5\u5ea6\u5bf9\u6807\u51c6\u5316\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u3002\n    #    z_cost_diff > 0 \u65f6\uff0c\u88d5\u5ea6\u4e3a\u6b63\u3002\n    dynamic_margin = beta * z_cost_diff\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee31 & \u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\n    #    \u7ee7\u627f\u4e86\u7528\u6210\u672c\u5dee\u5f02\u4fe1\u606f\u52a0\u6743\u6982\u7387\u7684\u601d\u60f3\u3002softplus\u786e\u4fdd\u7f29\u653e\u56e0\u5b50\u5e73\u6ed1\u4e14\u975e\u8d1f\u3002\n    adaptive_scale = softplus(z_cost_diff)\n\n    # 5. [\u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u3001\u7f29\u653e\u5e76\u88c1\u526a\u5bf9\u6570\u6982\u7387\u5dee\n    #    logp_w - logp_l \u671f\u671b\u4e3a\u6b63\u3002\n    #    \u4f7f\u7528adaptive_scale\u8fdb\u884c\u52a0\u6743\uff0c\u7136\u540e\u7528clamp\u66ff\u4ee3tanh\u8fdb\u884c\u7a33\u5b9a\u5316\u3002\n    #    gamma \u63a7\u5236\u4e86\u8be5\u9879\u7684\u6700\u5927\u8d21\u732e\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\u3002\n    logp_diff = logp_w - logp_l\n    clipped_scaled_logp_diff = clamp(adaptive_scale * logp_diff, min=-gamma, max=gamma)\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u6700\u7ec8\u7684Hinge Loss\n    #    \u5c06\u65b0\u7684\u52a8\u6001\u88d5\u5ea6\u548c\u7a33\u5b9a\u5316\u7684\u6982\u7387\u5dee\u5f02\u9879\u4ee3\u5165\u7ecf\u5178\u7684Hinge\u7ed3\u6784\u3002\n    #    \u5f53\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6(clipped_scaled_logp_diff)\u4e0d\u8db3\u4ee5\u6ee1\u8db3\u76ee\u6807\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    loss = softplus(dynamic_margin - clipped_scaled_logp_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5dee\u5f02\u8f83\u5927\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}, "gamma": {"value": 5.0, "description": "\u88c1\u526a\u9608\u503c\u3002\u5b83\u7528\u4e8e\u9650\u5236\u52a0\u6743\u540e\u5bf9\u6570\u6982\u7387\u5dee\u7684\u7edd\u5bf9\u503c\u4e0a\u9650\uff0c\u4f5c\u4e3a\u4e00\u79cd\u7a33\u5b9a\u5316\u6280\u5de7\uff0c\u9632\u6b62\u56e0\u6781\u7aef\u6982\u7387\u9884\u6d4b\u800c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u3002\u5b83\u5b9a\u4e49\u4e86\u6a21\u578b\u7f6e\u4fe1\u5ea6\u9879\u5bf9\u603b\u635f\u5931\u7684\u6700\u5927\u8d21\u732e\u3002"}}, "operators_used": ["zscore", "softplus", "clamp"], "implementation_hint": {"expects": ["cost_a, cost_b, logp_a, logp_b: Tensors of shape (batch_size,). The `zscore` operator is expected to compute statistics over the batch dimension."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.02526593208313, "validation_objective": 4.02526593208313, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.971907615661621}, "train_score_mean": 4.212033174932003, "train_loss_mean": 0.6928308047354221, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedAdaptiveHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u6784\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\uff0c\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5065\uff0c\u5e76\u4e14\u80fd\u591f\u81ea\u9002\u5e94\u5730\u8c03\u6574\u60e9\u7f5a\u529b\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u6211\u4eec\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784 `softplus(margin - term)`\u3002\u8fd9\u79cd\u7ed3\u6784\u660e\u786e\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u5b66\u4e60\u76ee\u6807\uff1a\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6 (`term`) \u9700\u8981\u8d85\u8d8a\u4e00\u4e2a\u52a8\u6001\u9608\u503c (`margin`)\uff0c\u5426\u5219\u5c31\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u4e3a\u6a21\u578b\u63d0\u4f9b\u4e86\u6e05\u6670\u7684\u4f18\u5316\u65b9\u5411\u3002\n2.  **\u7ee7\u627f\u81ea `HybridMarginLogSigmoidLoss` (\u7236\u4ee31)**\uff1a\u6211\u4eec\u501f\u9274\u4e86\u5176\u201c\u53cc\u91cd\u5f3a\u8c03\u201d\u6210\u672c\u5dee\u5f02\u7684\u601d\u60f3\u3002\u5728\u7236\u4ee31\u4e2d\uff0c\u6210\u672c\u5dee\u5f02\u540c\u65f6\u5f71\u54cd\u4e86`dynamic_margin`\u548c`scaled_logp_diff`\u3002\u5728\u672c\u8bbe\u8ba1\u4e2d\uff0c\u6211\u4eec\u5c06\u8fd9\u79cd\u601d\u60f3\u8f6c\u5316\u4e3a\uff1a\u6210\u672c\u5dee\u5f02\u4e0d\u4ec5\u7528\u4e8e\u8ba1\u7b97\u4e00\u4e2a\u57fa\u7840\u7684\u52a8\u6001\u88d5\u5ea6\uff0c\u8fd8\u901a\u8fc7\u4e00\u4e2a\u65b0\u7684\u8026\u5408\u70b9\uff08\u81ea\u9002\u5e94\u7f29\u653e\uff09\u6765\u8c03\u8282\u5bf9\u6570\u6982\u7387\u5dee\u7684\u60e9\u7f5a\u5f3a\u5ea6\uff0c\u5b9e\u73b0\u4e86\u5bf9\u91cd\u8981\u6837\u672c\u5bf9\u7684\u201c\u53cc\u91cd\u5173\u6ce8\u201d\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f (\u8026\u5408\u70b91)**\uff1a\u4e3a\u4e86\u589e\u5f3a\u5bf9\u6279\u6b21\u5185\uff08in-batch\uff09\u6210\u672c\u5206\u5e03\u7684\u9002\u5e94\u6027\uff0c\u6211\u4eec\u653e\u5f03\u4e86\u57fa\u4e8e\u6392\u5e8f\u7684`rank_gap`\uff0c\u8f6c\u800c\u91c7\u7528`zscore`\u5bf9\u6210\u672c\u5dee\u5f02\u8fdb\u884c\u5f52\u4e00\u5316\u3002`zscore(cost_l - cost_w)`\u8ba1\u7b97\u7684\u662f\u6210\u672c\u5dee\u503c\u5728\u8be5\u6279\u6b21\u6570\u636e\u4e2d\u7684\u6807\u51c6\u5316\u5206\u6570\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6`dynamic_margin`\u7684\u5c3a\u5ea6\u80fd\u591f\u6839\u636e\u5f53\u524d\u6279\u6b21\u7684\u6210\u672c\u5dee\u5f02\u5206\u5e03\u52a8\u6001\u8c03\u6574\u3002\u5982\u679c\u67d0\u4e2a\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u503c\u8fdc\u5927\u4e8e\u5f53\u524d\u6279\u6b21\u7684\u5e73\u5747\u5dee\u503c\uff0c\u5b83\u5c06\u83b7\u5f97\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u88d5\u5ea6\u76ee\u6807\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002\u8fd9\u6bd4`rank_gap`\u66f4\u80fd\u6355\u6349\u76f8\u5bf9\u91cd\u8981\u6027\u3002\n2.  **\u81ea\u9002\u5e94\u7f29\u653e\u4e0e\u88c1\u526a (\u8026\u5408\u70b92)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50`adaptive_scale`\uff0c\u5b83\u76f4\u63a5\u7531\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02`z_cost_diff`\u901a\u8fc7`softplus`\u51fd\u6570\u751f\u6210\u3002\u8fd9\u4e2a\u7f29\u653e\u56e0\u5b50\u968f\u540e\u88ab\u7528\u4e8e\u52a0\u6743\u5bf9\u6570\u6982\u7387\u5dee`logp_diff`\u3002\u66f4\u5173\u952e\u7684\u662f\uff0c\u6211\u4eec\u4f7f\u7528`clamp`\u7b97\u5b50\u5bf9\u8fd9\u4e2a\u52a0\u6743\u9879\u8fdb\u884c\u4e86\u88c1\u526a\uff08`clamp(..., min=-gamma, max=gamma)`\uff09\u3002\u8fd9\u6837\u505a\u6709\u53cc\u91cd\u76ee\u7684\uff1a(a) \u5b83\u7ee7\u627f\u4e86\u7236\u4ee31\u4e2d\u7528\u6210\u672c\u5dee\u5f02\u52a0\u6743`logp_diff`\u7684\u601d\u60f3\uff0c\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u7684\u68af\u5ea6\u66f4\u5927\uff1b(b) `clamp`\u64cd\u4f5c\u53d6\u4ee3\u4e86\u7236\u4ee3\u4e2d\u7684`tanh`\uff0c\u4f5c\u4e3a\u4e00\u79cd\u65b0\u7684\u3001\u66f4\u7075\u6d3b\u7684\u7a33\u5b9a\u6280\u5de7\u3002`tanh`\u5c06\u503c\u57df\u56fa\u5b9a\u5728[-1, 1]\uff0c\u800c`clamp`\u5141\u8bb8\u6211\u4eec\u901a\u8fc7\u8d85\u53c2\u6570`gamma`\u6765\u63a7\u5236\u68af\u5ea6\u7684\u6700\u5927/\u6700\u5c0f\u8d21\u732e\uff0c\u9632\u6b62\u6781\u7aef`logp_diff`\u503c\u5728\u4e0e`adaptive_scale`\u76f8\u4e58\u540e\u5bfc\u81f4\u68af\u5ea6\u7206\u70b8\uff0c\u540c\u65f6\u4fdd\u7559\u4e86\u6bd4`tanh`\u66f4\u5927\u7684\u7ebf\u6027\u54cd\u5e94\u533a\u95f4\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u8fd9\u4e2a\u5b50\u4ee3\u635f\u5931\u901a\u8fc7`zscore`\u5b9e\u73b0\u4e86\u5bf9\u6279\u6b21\u5185\u6210\u672c\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u901a\u8fc7`clamp`\u548c\u81ea\u9002\u5e94\u7f29\u653e\u56e0\u5b50\u521b\u9020\u4e86\u4e00\u4e2a\u65e2\u80fd\u54cd\u5e94\u6210\u672c\u5dee\u5f02\u53c8\u80fd\u6709\u6548\u63a7\u5236\u68af\u5ea6\u7684\u7a33\u5b9a\u673a\u5236\uff0c\u5e76\u5c06\u8fd9\u4e9b\u65b0\u8bbe\u8ba1\u65e0\u7f1d\u5730\u878d\u5165\u4e86\u7ecf\u5178\u7684Hinge Loss\u6846\u67b6\u4e2d\uff0c\u65e8\u5728\u5b9e\u73b0\u66f4\u7a33\u5065\u3001\u66f4\u81ea\u9002\u5e94\u7684\u504f\u597d\u5b66\u4e60\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5dee\u5f02\u8f83\u5927\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}, "gamma": {"value": 5.0, "description": "\u88c1\u526a\u9608\u503c\u3002\u5b83\u7528\u4e8e\u9650\u5236\u52a0\u6743\u540e\u5bf9\u6570\u6982\u7387\u5dee\u7684\u7edd\u5bf9\u503c\u4e0a\u9650\uff0c\u4f5c\u4e3a\u4e00\u79cd\u7a33\u5b9a\u5316\u6280\u5de7\uff0c\u9632\u6b62\u56e0\u6781\u7aef\u6982\u7387\u9884\u6d4b\u800c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u3002\u5b83\u5b9a\u4e49\u4e86\u6a21\u578b\u7f6e\u4fe1\u5ea6\u9879\u5bf9\u603b\u635f\u5931\u7684\u6700\u5927\u8d21\u732e\u3002"}}, "operators_used": ["zscore", "softplus", "clamp"]}}}
{"generation": 8, "index": 1, "ir": {"name": "ZScoreNormalizedAdaptiveHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u8bbe\u8ba1\u7684\u4f18\u70b9\uff0c\u5e76\u5f15\u5165\u66f4\u9c81\u68d2\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\u548c\u66f4\u7cbe\u7ec6\u7684\u60e9\u7f5a\u673a\u5236\uff0c\u4ee5\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u5206\u5e03\u53d8\u5316\u4e0d\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u9ad8\u6548\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784\uff0c\u5373 `softplus(margin - term)`\u3002\u8fd9\u79cd\u5f62\u5f0f\u4e3a\u6a21\u578b\u5b66\u4e60\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\uff1a\u53ea\u8981\u6a21\u578b\u7684\u504f\u597d\u5dee\u5f02\uff08`term`\uff09\u8d85\u8fc7\u4e86\u52a8\u6001\u8bbe\u5b9a\u7684\u9608\u503c\uff08`margin`\uff09\uff0c\u635f\u5931\u5c31\u8d8b\u8fd1\u4e8e\u96f6\u3002\u8fd9\u63d0\u4f9b\u4e86\u4e00\u79cd\u7a33\u5b9a\u4e14\u6613\u4e8e\u89e3\u91ca\u7684\u60e9\u7f5a\u673a\u5236\u3002\n2.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u60e9\u7f5a\u6743\u91cd\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u56e0\u5b50 `adaptive_penalty_weight` \u6765\u7f29\u653e\u6700\u7ec8\u7684\u635f\u5931\u503c\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u80fd\u591f\u5bf9\u90a3\u4e9b\u201c\u672c\u5e94\u8f7b\u6613\u533a\u5206\u201d\u4f46\u6a21\u578b\u5374\u641e\u9519\u4e86\u7684\u6837\u672c\u5bf9\uff08\u5373\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u91cd\u7684\u60e9\u7f5a\uff0c\u4ece\u800c\u5c06\u5b66\u4e60\u7684\u201c\u6ce8\u610f\u529b\u201d\u96c6\u4e2d\u5728\u6700\u91cd\u8981\u7684\u9519\u8bef\u4e0a\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u57fa\u4e8eZ-Score\u7684\u6210\u672c\u5f52\u4e00\u5316)**\uff1a\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee3\u90a3\u6837\u4f7f\u7528 `rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u7b97\u5b50\u6765\u5bf9\u6279\u6b21\u5185\u7684\u6210\u672c\u8fdb\u884c\u5f52\u4e00\u5316\u3002`z_score_diff = zscore(cost_l) - zscore(cost_w)`\u3002\u8fd9\u4e00\u6539\u52a8\u6709\u51e0\u4e2a\u4f18\u70b9\uff1a(1) \u5b83\u4e0d\u4ec5\u8003\u8651\u4e86\u6210\u672c\u7684\u6392\u5e8f\uff0c\u8fd8\u8003\u8651\u4e86\u5b83\u4eec\u5728\u5f53\u524d\u6279\u6b21\u5206\u5e03\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff08\u5373\u504f\u79bb\u5747\u503c\u7684\u6807\u51c6\u5dee\u500d\u6570\uff09\uff0c\u4f7f\u5f97\u5dee\u5f02\u4fe1\u53f7\u66f4\u52a0\u4e30\u5bcc\uff1b(2) \u5b83\u5bf9\u6574\u4e2a\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\u8fdb\u884c\u4e2d\u5fc3\u5316\u548c\u7f29\u653e\uff0c\u4ece\u800c\u4f7f\u635f\u5931\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u589e\u5f3a\u4e86\u5728\u4e0d\u540c\u73af\u5883\u6216\u4efb\u52a1\u9636\u6bb5\u7684\u9c81\u68d2\u6027\uff1b(3) `zscore` \u7684\u8f93\u51fa\u901a\u5e38\u5728\u4e00\u4e2a\u53ef\u63a7\u7684\u8303\u56f4\u5185\uff0c\u6709\u52a9\u4e8e\u540e\u7eed\u8ba1\u7b97\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u53cc\u91cdSigmoid\u8026\u5408\u7684\u52a8\u6001\u88d5\u5ea6)**\uff1a\u6211\u4eec\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u65b0\u7684\u52a8\u6001\u88d5\u5ea6 `dynamic_margin` \u8ba1\u7b97\u65b9\u5f0f\u3002\u9996\u5148\uff0c\u6211\u4eec\u5c06Z-Score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_score_diff` \u901a\u8fc7\u4e00\u4e2a `sigmoid` \u51fd\u6570\u8fdb\u884c\u538b\u7f29\uff0c\u5f97\u5230\u4e00\u4e2a\u5728 `[0, 1]` \u8303\u56f4\u5185\u7684\u57fa\u7840\u88d5\u5ea6\u4fe1\u53f7 `base_margin`\u3002\u8fd9\u6837\u505a\u53ef\u4ee5\u5e73\u6ed1\u6781\u7aef\u5dee\u5f02\u503c\u7684\u5f71\u54cd\u3002\u7136\u540e\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a `base_margin` \u4e58\u4ee5\u8d85\u53c2\u6570 `beta`\uff0c\u518d\u901a\u8fc7\u53e6\u4e00\u4e2a `sigmoid` \u51fd\u6570\u8fdb\u884c\u7f29\u653e\uff0c`dynamic_margin = sigmoid(beta * base_margin)`\u3002\u8fd9\u79cd\u201c\u53cc\u91cdSigmoid\u201d\u8bbe\u8ba1\u521b\u5efa\u4e86\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u6709\u754c\u7684\uff08`[0.5, 1]`\uff09\u4e14\u975e\u7ebf\u6027\u7684\u88d5\u5ea6\uff0c\u5b83\u5728\u6210\u672c\u5dee\u5f02\u8f83\u5c0f\u65f6\u589e\u957f\u7f13\u6162\uff0c\u5728\u4e2d\u95f4\u533a\u57df\u5feb\u901f\u589e\u957f\uff0c\u7136\u540e\u9971\u548c\u3002\u8fd9\u4f7f\u5f97\u6a21\u578b\u5728\u5904\u7406\u5fae\u5c0f\u6210\u672c\u5dee\u5f02\u65f6\u4e0d\u4f1a\u88ab\u8fc7\u5927\u7684\u88d5\u5ea6\u76ee\u6807\u56f0\u6270\uff0c\u540c\u65f6\u5bf9\u4e2d\u7b49\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u7ed9\u4e88\u8db3\u591f\u7684\u5b66\u4e60\u538b\u529b\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreNormalizedAdaptiveHingeLoss` \u901a\u8fc7Z-Score\u5f52\u4e00\u5316\u83b7\u5f97\u4e86\u5bf9\u6210\u672c\u5206\u5e03\u53d8\u5316\u7684\u9c81\u68d2\u6027\uff0c\u901a\u8fc7\u53cc\u91cdSigmoid\u8026\u5408\u8bbe\u8ba1\u4e86\u66f4\u7cbe\u7ec6\u7684\u52a8\u6001\u88d5\u5ea6\uff0c\u5e76\u7ed3\u5408\u4e86\u7236\u4ee3\u7684\u81ea\u9002\u5e94\u60e9\u7f5a\u548cHinge Loss\u6846\u67b6\uff0c\u65e8\u5728\u5b9e\u73b0\u7a33\u5b9a\u3001\u9c81\u68d2\u4e14\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u3002", "pseudocode": "def ZScoreNormalizedAdaptiveHingeLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u5bf9\u6210\u672c\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\u5e76\u8ba1\u7b97\u5dee\u5f02\n    #    zscore\u5728\u6279\u6b21\u7ea7\u522b\u4e0a\u64cd\u4f5c\uff0c\u4f7f\u635f\u5931\u5bf9\u6210\u672c\u7684\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\u3002\n    #    z_score_diff > 0\n    z_score_diff = zscore(cost_l) - zscore(cost_w)\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u53cc\u91cdSigmoid\u8026\u5408\u7684\u52a8\u6001\u88d5\u5ea6\n    #    \u7b2c\u4e00\u5c42sigmoid\u5e73\u6ed1z_score_diff\uff0c\u7b2c\u4e8c\u5c42sigmoid\u5728beta\u7684\u63a7\u5236\u4e0b\u521b\u5efa\u975e\u7ebf\u6027\u3001\u6709\u754c\u7684\u88d5\u5ea6\u3002\n    base_margin = sigmoid(z_score_diff)\n    dynamic_margin = sigmoid(beta * base_margin)\n\n    # 4. \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528\u539f\u59cb\u7684\u5bf9\u6570\u6982\u7387\u5dee\uff0c\u56e0\u4e3a\u5b83\u5c06\u88ab\u653e\u5165softplus\u4e2d\uff0c\u672c\u8eab\u662f\u7a33\u5b9a\u7684\u3002\n    #    \u671f\u671b (logp_w - logp_l) > 0\u3002\n    logp_diff = logp_w - logp_l\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u6838\u5fc3\u7684Hinge-like\u635f\u5931\n    #    \u5f53\u6a21\u578b\u7684\u504f\u597d\u5dee\u5f02 logp_diff \u5c0f\u4e8e\u76ee\u6807\u88d5\u5ea6 dynamic_margin \u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    #    softplus(x) \u662f relu(x) \u7684\u5e73\u6ed1\u8fd1\u4f3c\uff0c\u786e\u4fdd\u53ef\u5bfc\u6027\u3002\n    base_loss = softplus(dynamic_margin - logp_diff)\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u81ea\u9002\u5e94\u60e9\u7f5a\u6743\u91cd\n    #    \u4f7f\u7528\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 z_score_diff \u6765\u51b3\u5b9a\u60e9\u7f5a\u7684\u529b\u5ea6\u3002\n    #    \u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u6743\u91cd\u8d8a\u63a5\u8fd11\uff0c\u60e9\u7f5a\u8d8a\u91cd\u3002\n    adaptive_penalty_weight = sigmoid(z_score_diff)\n\n    # 7. \u8ba1\u7b97\u6700\u7ec8\u7684\u52a0\u6743\u635f\u5931\n    #    \u5c06\u57fa\u7840\u635f\u5931\u4e0e\u81ea\u9002\u5e94\u6743\u91cd\u76f8\u4e58\uff0c\u5b9e\u73b0\u5bf9\u91cd\u8981\u6837\u672c\u7684\u5dee\u5f02\u5316\u60e9\u7f5a\u3002\n    loss = adaptive_penalty_weight * base_loss\n\n    return loss", "hyperparams": {"beta": {"value": 3.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u52a8\u6001\u88d5\u5ea6\u5bf9\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u4f1a\u4f7f\u88d5\u5ea6\u66f4\u5feb\u5730\u8fbe\u5230\u9971\u548c\u533a\uff08\u63a5\u8fd11\uff09\uff0c\u5bf9\u4e2d\u7b49\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5927\u7684\u5b66\u4e60\u538b\u529b\u3002\u8f83\u5c0f\u7684\u503c\u5219\u4ea7\u751f\u66f4\u5e73\u7f13\u7684\u88d5\u5ea6\u66f2\u7ebf\u3002"}}, "operators_used": ["zscore", "sigmoid", "softplus"], "implementation_hint": {"expects": ["cost_a, cost_b, logp_a, logp_b are tensors of shape (N,). cost_a and cost_b contain the costs for a batch of pairs. The zscore operator is expected to compute statistics (mean, std) across the combined 2N cost values in the batch."], "returns": "A single scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.113049507141113, "validation_objective": 4.113049507141113, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.054208517074585}, "train_score_mean": 4.250592879951, "train_loss_mean": 0.6928606312721968, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreNormalizedAdaptiveHingeLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u8bbe\u8ba1\u7684\u4f18\u70b9\uff0c\u5e76\u5f15\u5165\u66f4\u9c81\u68d2\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\u548c\u66f4\u7cbe\u7ec6\u7684\u60e9\u7f5a\u673a\u5236\uff0c\u4ee5\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u5206\u5e03\u53d8\u5316\u4e0d\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u9ad8\u6548\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u5176\u6838\u5fc3\u7684Hinge Loss\u7ed3\u6784\uff0c\u5373 `softplus(margin - term)`\u3002\u8fd9\u79cd\u5f62\u5f0f\u4e3a\u6a21\u578b\u5b66\u4e60\u8bbe\u5b9a\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\uff1a\u53ea\u8981\u6a21\u578b\u7684\u504f\u597d\u5dee\u5f02\uff08`term`\uff09\u8d85\u8fc7\u4e86\u52a8\u6001\u8bbe\u5b9a\u7684\u9608\u503c\uff08`margin`\uff09\uff0c\u635f\u5931\u5c31\u8d8b\u8fd1\u4e8e\u96f6\u3002\u8fd9\u63d0\u4f9b\u4e86\u4e00\u79cd\u7a33\u5b9a\u4e14\u6613\u4e8e\u89e3\u91ca\u7684\u60e9\u7f5a\u673a\u5236\u3002\n2.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u60e9\u7f5a\u6743\u91cd\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u56e0\u5b50 `adaptive_penalty_weight` \u6765\u7f29\u653e\u6700\u7ec8\u7684\u635f\u5931\u503c\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u80fd\u591f\u5bf9\u90a3\u4e9b\u201c\u672c\u5e94\u8f7b\u6613\u533a\u5206\u201d\u4f46\u6a21\u578b\u5374\u641e\u9519\u4e86\u7684\u6837\u672c\u5bf9\uff08\u5373\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u91cd\u7684\u60e9\u7f5a\uff0c\u4ece\u800c\u5c06\u5b66\u4e60\u7684\u201c\u6ce8\u610f\u529b\u201d\u96c6\u4e2d\u5728\u6700\u91cd\u8981\u7684\u9519\u8bef\u4e0a\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (\u57fa\u4e8eZ-Score\u7684\u6210\u672c\u5f52\u4e00\u5316)**\uff1a\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee3\u90a3\u6837\u4f7f\u7528 `rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u7b97\u5b50\u6765\u5bf9\u6279\u6b21\u5185\u7684\u6210\u672c\u8fdb\u884c\u5f52\u4e00\u5316\u3002`z_score_diff = zscore(cost_l) - zscore(cost_w)`\u3002\u8fd9\u4e00\u6539\u52a8\u6709\u51e0\u4e2a\u4f18\u70b9\uff1a(1) \u5b83\u4e0d\u4ec5\u8003\u8651\u4e86\u6210\u672c\u7684\u6392\u5e8f\uff0c\u8fd8\u8003\u8651\u4e86\u5b83\u4eec\u5728\u5f53\u524d\u6279\u6b21\u5206\u5e03\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff08\u5373\u504f\u79bb\u5747\u503c\u7684\u6807\u51c6\u5dee\u500d\u6570\uff09\uff0c\u4f7f\u5f97\u5dee\u5f02\u4fe1\u53f7\u66f4\u52a0\u4e30\u5bcc\uff1b(2) \u5b83\u5bf9\u6574\u4e2a\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\u8fdb\u884c\u4e2d\u5fc3\u5316\u548c\u7f29\u653e\uff0c\u4ece\u800c\u4f7f\u635f\u5931\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u589e\u5f3a\u4e86\u5728\u4e0d\u540c\u73af\u5883\u6216\u4efb\u52a1\u9636\u6bb5\u7684\u9c81\u68d2\u6027\uff1b(3) `zscore` \u7684\u8f93\u51fa\u901a\u5e38\u5728\u4e00\u4e2a\u53ef\u63a7\u7684\u8303\u56f4\u5185\uff0c\u6709\u52a9\u4e8e\u540e\u7eed\u8ba1\u7b97\u7684\u6570\u503c\u7a33\u5b9a\u6027\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u53cc\u91cdSigmoid\u8026\u5408\u7684\u52a8\u6001\u88d5\u5ea6)**\uff1a\u6211\u4eec\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u65b0\u7684\u52a8\u6001\u88d5\u5ea6 `dynamic_margin` \u8ba1\u7b97\u65b9\u5f0f\u3002\u9996\u5148\uff0c\u6211\u4eec\u5c06Z-Score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02 `z_score_diff` \u901a\u8fc7\u4e00\u4e2a `sigmoid` \u51fd\u6570\u8fdb\u884c\u538b\u7f29\uff0c\u5f97\u5230\u4e00\u4e2a\u5728 `[0, 1]` \u8303\u56f4\u5185\u7684\u57fa\u7840\u88d5\u5ea6\u4fe1\u53f7 `base_margin`\u3002\u8fd9\u6837\u505a\u53ef\u4ee5\u5e73\u6ed1\u6781\u7aef\u5dee\u5f02\u503c\u7684\u5f71\u54cd\u3002\u7136\u540e\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a `base_margin` \u4e58\u4ee5\u8d85\u53c2\u6570 `beta`\uff0c\u518d\u901a\u8fc7\u53e6\u4e00\u4e2a `sigmoid` \u51fd\u6570\u8fdb\u884c\u7f29\u653e\uff0c`dynamic_margin = sigmoid(beta * base_margin)`\u3002\u8fd9\u79cd\u201c\u53cc\u91cdSigmoid\u201d\u8bbe\u8ba1\u521b\u5efa\u4e86\u4e00\u4e2a\u5e73\u6ed1\u7684\u3001\u6709\u754c\u7684\uff08`[0.5, 1]`\uff09\u4e14\u975e\u7ebf\u6027\u7684\u88d5\u5ea6\uff0c\u5b83\u5728\u6210\u672c\u5dee\u5f02\u8f83\u5c0f\u65f6\u589e\u957f\u7f13\u6162\uff0c\u5728\u4e2d\u95f4\u533a\u57df\u5feb\u901f\u589e\u957f\uff0c\u7136\u540e\u9971\u548c\u3002\u8fd9\u4f7f\u5f97\u6a21\u578b\u5728\u5904\u7406\u5fae\u5c0f\u6210\u672c\u5dee\u5f02\u65f6\u4e0d\u4f1a\u88ab\u8fc7\u5927\u7684\u88d5\u5ea6\u76ee\u6807\u56f0\u6270\uff0c\u540c\u65f6\u5bf9\u4e2d\u7b49\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u7ed9\u4e88\u8db3\u591f\u7684\u5b66\u4e60\u538b\u529b\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreNormalizedAdaptiveHingeLoss` \u901a\u8fc7Z-Score\u5f52\u4e00\u5316\u83b7\u5f97\u4e86\u5bf9\u6210\u672c\u5206\u5e03\u53d8\u5316\u7684\u9c81\u68d2\u6027\uff0c\u901a\u8fc7\u53cc\u91cdSigmoid\u8026\u5408\u8bbe\u8ba1\u4e86\u66f4\u7cbe\u7ec6\u7684\u52a8\u6001\u88d5\u5ea6\uff0c\u5e76\u7ed3\u5408\u4e86\u7236\u4ee3\u7684\u81ea\u9002\u5e94\u60e9\u7f5a\u548cHinge Loss\u6846\u67b6\uff0c\u65e8\u5728\u5b9e\u73b0\u7a33\u5b9a\u3001\u9c81\u68d2\u4e14\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u3002", "hyperparams": {"beta": {"value": 3.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u52a8\u6001\u88d5\u5ea6\u5bf9\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u4f1a\u4f7f\u88d5\u5ea6\u66f4\u5feb\u5730\u8fbe\u5230\u9971\u548c\u533a\uff08\u63a5\u8fd11\uff09\uff0c\u5bf9\u4e2d\u7b49\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5927\u7684\u5b66\u4e60\u538b\u529b\u3002\u8f83\u5c0f\u7684\u503c\u5219\u4ea7\u751f\u66f4\u5e73\u7f13\u7684\u88d5\u5ea6\u66f2\u7ebf\u3002"}}, "operators_used": ["zscore", "sigmoid", "softplus"]}}}
{"generation": 8, "index": 3, "ir": {"name": "ZScoreClippedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u7684\u4f18\u70b9\uff0c\u521b\u9020\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u9c81\u68d2\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u6280\u672f\u6765\u4f18\u5316\u5b66\u4e60\u8fc7\u7a0b\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u601d\u60f3\u3002\u8fd9\u610f\u5473\u7740\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u662f\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u53e6\u4e00\u4e2a\u662f\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u91cd\u8981\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `softplus(margin - term)` \u8fd9\u79cd\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u4f5c\u4e3a\u57fa\u7840\u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u76f4\u89c2\u5730\u60e9\u7f5a\u90a3\u4e9b\u6a21\u578b\u7f6e\u4fe1\u5ea6\uff08`logp_diff`\uff09\u672a\u8fbe\u5230\u76ee\u6807\u88d5\u5ea6\uff08`margin`\uff09\u7684\u60c5\u51b5\uff0c\u5e76\u4e14 `softplus` \u4fdd\u8bc1\u4e86\u635f\u5931\u7684\u5e73\u6ed1\u6027\u548c\u53ef\u5bfc\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\uff08\u8026\u5408\u70b91\uff09**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u3002`zscore(cost_w, cost_l)` \u8ba1\u7b97\u7684\u662f\u5728\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\uff0c\u80dc\u8005\u548c\u8d25\u8005\u6210\u672c\u7684 z-score \u5dee\u5f02\u3002\u8fd9\u79cd\u65b9\u6cd5\u6709\u4e24\u4e2a\u4f18\u70b9\uff1a\u9996\u5148\uff0c\u5b83\u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4e00\u4e2a\u4e0e\u6279\u6b21\u5185\u7edf\u8ba1\u5206\u5e03\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u76f8\u5173\u7684\u76f8\u5bf9\u5ea6\u91cf\uff0c\u4f7f\u5f97\u635f\u5931\u5bf9\u4e0d\u540c\u6279\u6b21\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u4e0d\u654f\u611f\uff0c\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\u5176\u6b21\uff0cz-score \u5dee\u5f02\u53ef\u4ee5\u4e3a\u6b63\u4e5f\u53ef\u4ee5\u4e3a\u8d1f\uff0c\u8fd9\u4e3a\u88d5\u5ea6\u7684\u8bbe\u8ba1\u63d0\u4f9b\u4e86\u66f4\u4e30\u5bcc\u7684\u4fe1\u606f\uff08\u4f8b\u5982\uff0c\u5f53\u80dc\u8005\u548c\u8d25\u8005\u7684\u6210\u672c\u90fd\u8fdc\u9ad8\u4e8e\u5e73\u5747\u503c\u65f6\uff0c\u5b83\u4eec\u7684\u5dee\u5f02\u53ef\u80fd\u4e0d\u90a3\u4e48\u91cd\u8981\uff09\u3002\u6211\u4eec\u901a\u8fc7 `softplus` \u786e\u4fdd\u6700\u7ec8\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7 `cost_diff_signal` \u4e3a\u975e\u8d1f\u503c\uff0c\u540c\u65f6\u4fdd\u7559\u4e86\u5bf9\u8f83\u5927 z-score \u5dee\u5f02\u7684\u654f\u611f\u6027\u3002\n2.  **\u65b0\u7684\u7a33\u5b9a\u6280\u5de7\uff08\u8026\u5408\u70b92\uff09**\uff1a\u7236\u4ee3\u635f\u5931\u4f7f\u7528\u4e86 `tanh` \u6765\u538b\u7f29\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)`\uff0c\u867d\u7136\u8fd9\u80fd\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u4f46\u4e5f\u5c06\u6240\u6709\u5dee\u5f02\u90fd\u9650\u5236\u5728 `[-1, 1]` \u533a\u95f4\u5185\uff0c\u53ef\u80fd\u4f1a\u4e22\u5931\u5927\u5e45\u5ea6\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u7684\u4fe1\u53f7\u3002\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u7a33\u5b9a\u6280\u5de7\uff1a\u4f7f\u7528 `clamp` \u7b97\u5b50\u3002`clamped_logp_diff = clamp(logp_w - logp_l, min=-gamma, max=gamma)`\u3002\u8fd9\u79cd\u65b9\u6cd5\u5728\u4fdd\u7559\u4e86\u5927\u90e8\u5206\u7ebf\u6027\u533a\u95f4\u7684\u540c\u65f6\uff0c\u4ec5\u5bf9\u6781\u7aef\u503c\u8fdb\u884c\u88c1\u526a\uff0c\u9632\u6b62\u4e86\u68af\u5ea6\u7206\u70b8\uff0c\u4f46\u53c8\u4e0d\u4f1a\u50cf `tanh` \u90a3\u6837\u8fc7\u5ea6\u538b\u7f29\u201c\u6b63\u5e38\u201d\u8303\u56f4\u5185\u7684\u4fe1\u53f7\u3002\u8fd9\u5728\u4fdd\u6301\u6570\u503c\u7a33\u5b9a\u6027\u548c\u4fdd\u7559\u6709\u6548\u68af\u5ea6\u4fe1\u606f\u4e4b\u95f4\u53d6\u5f97\u4e86\u66f4\u597d\u7684\u5e73\u8861\u3002\n\n\u603b\u4e4b\uff0c`ZScoreClippedHybridLoss` \u901a\u8fc7 z-score \u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u81ea\u9002\u5e94\u611f\u77e5\uff0c\u901a\u8fc7 `clamp` \u6280\u5de7\u7a33\u5b9a\u4e86\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff0c\u5e76\u7ee7\u627f\u4e86\u7236\u4ee3\u4e2d\u6709\u6548\u7684\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u548c\u5e73\u6ed1\u94f0\u94fe\u635f\u5931\u7ed3\u6784\uff0c\u65e8\u5728\u5b9e\u73b0\u66f4\u7a33\u5b9a\u548c\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u3002", "pseudocode": "def ZScoreClippedHybridLoss(cost_a, cost_b, logp_a, logp_b, beta, gamma):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u57fa\u4e8ez-score\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\n    #    zscore(cost)\u8fd4\u56de\u8be5\u6210\u672c\u5728\u5f53\u524d\u6279\u6b21\u4e2d\u7684z-score\u3002\n    #    \u8fd9\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u6210\u4e3a\u4e00\u4e2a\u76f8\u5bf9\u5ea6\u91cf\uff0c\u589e\u5f3a\u4e86\u5bf9\u4e0d\u540c\u6279\u6b21\u6210\u672c\u5c3a\u5ea6\u7684\u9c81\u68d2\u6027\u3002\n    zscore_diff = zscore(cost_w) - zscore(cost_l) # \u671f\u671b\u4e3a\u8d1f\u503c\n    #    \u4f7f\u7528softplus\u786e\u4fdd\u4fe1\u53f7\u4e3a\u6b63\uff0c\u4e14\u5bf9\u5927\u7684\u8d1f\u5dee\u5f02\u54cd\u5e94\u66f4\u5f3a\u3002\n    cost_diff_signal = softplus(-zscore_diff)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8bbe\u8ba1\u6df7\u5408\u88d5\u5ea6\n    #    \u52a8\u6001\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u5747\u4e0e\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\u7ebf\u6027\u76f8\u5173\u3002\n    dynamic_margin = beta * cost_diff_signal\n    scaling_factor = beta * cost_diff_signal\n\n    # 4. [\u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u5e76\u88c1\u526a\u7a33\u5b9a\u5316\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\n    #    \u4e0e\u4f7f\u7528tanh\u76f8\u6bd4\uff0cclamp\u5728\u4fdd\u7559\u7ebf\u6027\u68af\u5ea6\u7684\u540c\u65f6\u9632\u6b62\u4e86\u6781\u7aef\u503c\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u3002\n    #    (logp_w - logp_l) \u671f\u671b\u4e3a\u6b63\u3002\n    raw_logp_diff = logp_w - logp_l\n    clamped_logp_diff = clamp(raw_logp_diff, min=-gamma, max=gamma)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\u3002\n    #    \u8fd9\u4f53\u73b0\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u7ed9\u4e88\u66f4\u591a\u5173\u6ce8\u7684\u601d\u60f3\u3002\n    scaled_logp_diff = scaling_factor * clamped_logp_diff\n\n    # 6. \u8ba1\u7b97\u88d5\u5ea6\u5dee\u8ddd (margin gap)\n    #    \u8fd9\u662f\u6a21\u578b\u8868\u73b0\u4e0e\u76ee\u6807\u88d5\u5ea6\u7684\u6838\u5fc3\u5dee\u5f02\u9879\u3002\n    margin_gap = dynamic_margin - scaled_logp_diff\n\n    # 7. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u6700\u7ec8\u7684\u5e73\u6ed1\u94f0\u94fe\u635f\u5931\n    #    \u5f53\u6a21\u578b\u7684\u52a0\u6743\u7f6e\u4fe1\u5ea6(scaled_logp_diff)\u5c0f\u4e8e\u76ee\u6807\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    loss = softplus(margin_gap)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u7cfb\u6570\u3002\u5b83\u63a7\u5236\u4e86z-score\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u548c\u6982\u7387\u9879\u6743\u91cd\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u76f8\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\u3002"}, "gamma": {"value": 5.0, "description": "\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u88c1\u526a\u9608\u503c\u3002\u7528\u4e8e\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u540c\u65f6\u907f\u514d\u50cftanh\u90a3\u6837\u8fc7\u5ea6\u538b\u7f29\u68af\u5ea6\u3002\u8be5\u503c\u5b9a\u4e49\u4e86logp\u5dee\u5f02\u7684\u6709\u6548\u7ebf\u6027\u8303\u56f4[-gamma, gamma]\u3002"}}, "operators_used": ["zscore", "softplus", "clamp"], "implementation_hint": {"expects": ["cost_a, cost_b, logp_a, logp_b are tensors of shape [batch_size]. The `zscore` operator is expected to compute statistics over the batch dimension."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.083256959915161, "validation_objective": 4.083256959915161, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.051023721694946}, "train_score_mean": 4.268753416836262, "train_loss_mean": 0.6928365472704172, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u7684\u4f18\u70b9\uff0c\u521b\u9020\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u9c81\u68d2\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u6280\u672f\u6765\u4f18\u5316\u5b66\u4e60\u8fc7\u7a0b\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u601d\u60f3\u3002\u8fd9\u610f\u5473\u7740\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u662f\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u53e6\u4e00\u4e2a\u662f\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u91cd\u8981\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `softplus(margin - term)` \u8fd9\u79cd\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u4f5c\u4e3a\u57fa\u7840\u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u76f4\u89c2\u5730\u60e9\u7f5a\u90a3\u4e9b\u6a21\u578b\u7f6e\u4fe1\u5ea6\uff08`logp_diff`\uff09\u672a\u8fbe\u5230\u76ee\u6807\u88d5\u5ea6\uff08`margin`\uff09\u7684\u60c5\u51b5\uff0c\u5e76\u4e14 `softplus` \u4fdd\u8bc1\u4e86\u635f\u5931\u7684\u5e73\u6ed1\u6027\u548c\u53ef\u5bfc\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\uff08\u8026\u5408\u70b91\uff09**\uff1a\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u3002`zscore(cost_w, cost_l)` \u8ba1\u7b97\u7684\u662f\u5728\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\uff0c\u80dc\u8005\u548c\u8d25\u8005\u6210\u672c\u7684 z-score \u5dee\u5f02\u3002\u8fd9\u79cd\u65b9\u6cd5\u6709\u4e24\u4e2a\u4f18\u70b9\uff1a\u9996\u5148\uff0c\u5b83\u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4e00\u4e2a\u4e0e\u6279\u6b21\u5185\u7edf\u8ba1\u5206\u5e03\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u76f8\u5173\u7684\u76f8\u5bf9\u5ea6\u91cf\uff0c\u4f7f\u5f97\u635f\u5931\u5bf9\u4e0d\u540c\u6279\u6b21\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u4e0d\u654f\u611f\uff0c\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\u5176\u6b21\uff0cz-score \u5dee\u5f02\u53ef\u4ee5\u4e3a\u6b63\u4e5f\u53ef\u4ee5\u4e3a\u8d1f\uff0c\u8fd9\u4e3a\u88d5\u5ea6\u7684\u8bbe\u8ba1\u63d0\u4f9b\u4e86\u66f4\u4e30\u5bcc\u7684\u4fe1\u606f\uff08\u4f8b\u5982\uff0c\u5f53\u80dc\u8005\u548c\u8d25\u8005\u7684\u6210\u672c\u90fd\u8fdc\u9ad8\u4e8e\u5e73\u5747\u503c\u65f6\uff0c\u5b83\u4eec\u7684\u5dee\u5f02\u53ef\u80fd\u4e0d\u90a3\u4e48\u91cd\u8981\uff09\u3002\u6211\u4eec\u901a\u8fc7 `softplus` \u786e\u4fdd\u6700\u7ec8\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7 `cost_diff_signal` \u4e3a\u975e\u8d1f\u503c\uff0c\u540c\u65f6\u4fdd\u7559\u4e86\u5bf9\u8f83\u5927 z-score \u5dee\u5f02\u7684\u654f\u611f\u6027\u3002\n2.  **\u65b0\u7684\u7a33\u5b9a\u6280\u5de7\uff08\u8026\u5408\u70b92\uff09**\uff1a\u7236\u4ee3\u635f\u5931\u4f7f\u7528\u4e86 `tanh` \u6765\u538b\u7f29\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)`\uff0c\u867d\u7136\u8fd9\u80fd\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u4f46\u4e5f\u5c06\u6240\u6709\u5dee\u5f02\u90fd\u9650\u5236\u5728 `[-1, 1]` \u533a\u95f4\u5185\uff0c\u53ef\u80fd\u4f1a\u4e22\u5931\u5927\u5e45\u5ea6\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u7684\u4fe1\u53f7\u3002\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u7a33\u5b9a\u6280\u5de7\uff1a\u4f7f\u7528 `clamp` \u7b97\u5b50\u3002`clamped_logp_diff = clamp(logp_w - logp_l, min=-gamma, max=gamma)`\u3002\u8fd9\u79cd\u65b9\u6cd5\u5728\u4fdd\u7559\u4e86\u5927\u90e8\u5206\u7ebf\u6027\u533a\u95f4\u7684\u540c\u65f6\uff0c\u4ec5\u5bf9\u6781\u7aef\u503c\u8fdb\u884c\u88c1\u526a\uff0c\u9632\u6b62\u4e86\u68af\u5ea6\u7206\u70b8\uff0c\u4f46\u53c8\u4e0d\u4f1a\u50cf `tanh` \u90a3\u6837\u8fc7\u5ea6\u538b\u7f29\u201c\u6b63\u5e38\u201d\u8303\u56f4\u5185\u7684\u4fe1\u53f7\u3002\u8fd9\u5728\u4fdd\u6301\u6570\u503c\u7a33\u5b9a\u6027\u548c\u4fdd\u7559\u6709\u6548\u68af\u5ea6\u4fe1\u606f\u4e4b\u95f4\u53d6\u5f97\u4e86\u66f4\u597d\u7684\u5e73\u8861\u3002\n\n\u603b\u4e4b\uff0c`ZScoreClippedHybridLoss` \u901a\u8fc7 z-score \u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u81ea\u9002\u5e94\u611f\u77e5\uff0c\u901a\u8fc7 `clamp` \u6280\u5de7\u7a33\u5b9a\u4e86\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff0c\u5e76\u7ee7\u627f\u4e86\u7236\u4ee3\u4e2d\u6709\u6548\u7684\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u548c\u5e73\u6ed1\u94f0\u94fe\u635f\u5931\u7ed3\u6784\uff0c\u65e8\u5728\u5b9e\u73b0\u66f4\u7a33\u5b9a\u548c\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u7cfb\u6570\u3002\u5b83\u63a7\u5236\u4e86z-score\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u548c\u6982\u7387\u9879\u6743\u91cd\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u76f8\u5bf9\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\u3002"}, "gamma": {"value": 5.0, "description": "\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u88c1\u526a\u9608\u503c\u3002\u7528\u4e8e\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u540c\u65f6\u907f\u514d\u50cftanh\u90a3\u6837\u8fc7\u5ea6\u538b\u7f29\u68af\u5ea6\u3002\u8be5\u503c\u5b9a\u4e49\u4e86logp\u5dee\u5f02\u7684\u6709\u6548\u7ebf\u6027\u8303\u56f4[-gamma, gamma]\u3002"}}, "operators_used": ["zscore", "softplus", "clamp"]}}}
{"generation": 8, "index": 4, "ir": {"name": "ZScoreClippedDynamicMarginLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u7a33\u5b9a\u673a\u5236\uff0c\u521b\u9020\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u5bf9\u5f02\u5e38\u503c\u4e0d\u654f\u611f\u3001\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u65b0\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - logp_diff)` \u7ed3\u6784\u3002\u8fd9\u662f\u4e00\u79cd\u5e73\u6ed1\u7684Hinge Loss\u5f62\u5f0f\uff0c\u5f53\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\uff08\u4f53\u73b0\u5728`logp_diff`\uff09\u672a\u8fbe\u5230\u52a8\u6001\u8bbe\u5b9a\u7684\u76ee\u6807\u88d5\u5ea6\uff08`margin`\uff09\u65f6\uff0c\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u79cd\u7ed3\u6784\u7b80\u5355\u3001\u6709\u6548\uff0c\u4e14\u6613\u4e8e\u7406\u89e3\u3002\n2.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u7684\u601d\u60f3\uff0c\u5373\u6210\u672c\u5dee\u5f02\u4e0d\u4ec5\u7528\u4e8e\u8bbe\u5b9a\u76ee\u6807\u88d5\u5ea6\uff08`dynamic_margin`\uff09\uff0c\u8fd8\u7528\u4e8e\u7f29\u653e\u6a21\u578b\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff08`scaled_logp_diff`\uff09\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u4f7f\u7528\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\u7684\u8bbe\u8ba1\uff0c\u53ef\u4ee5\u6709\u6548\u653e\u5927\u6a21\u578b\u5bf9\u91cd\u8981\u6837\u672c\u5bf9\uff08\u5373\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff09\u7684\u5b66\u4e60\u529b\u5ea6\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u4e24\u4e2a\u7236\u4ee3\u90fd\u4f7f\u7528\u4e86`rank_gap`\u6765\u589e\u5f3a\u5bf9\u6210\u672c\u7edd\u5bf9\u503c\u7684\u9c81\u68d2\u6027\u3002\u6211\u4eec\u5728\u6b64\u57fa\u7840\u4e0a\u5f15\u5165`zscore(cost_diff)`\u4f5c\u4e3a\u65b0\u7684\u8026\u5408\u70b9\u3002`zscore`\u901a\u8fc7\u51cf\u53bb\u5747\u503c\u3001\u9664\u4ee5\u6807\u51c6\u5dee\uff0c\u5c06\u4e00\u4e2a\u6279\u6b21\u5185\u7684\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6807\u51c6\u6b63\u6001\u5206\u5e03\u3002\u8fd9\u6837\u505a\u6709\u51e0\u4e2a\u597d\u5904\uff1a(1) \u5b83\u4e0d\u4ec5\u8003\u8651\u4e86\u5e8f\u5173\u7cfb\uff0c\u8fd8\u4fdd\u7559\u4e86\u5dee\u5f02\u7684\u76f8\u5bf9\u5927\u5c0f\u4fe1\u606f\u3002(2) \u5b83\u4f7f\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u8ba1\u7b97\u5bf9\u6574\u4e2a\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\u81ea\u9002\u5e94\uff0c\u800c\u4e0d\u662f\u4ec5\u4f9d\u8d56\u4e8e\u5355\u4e2a\u6837\u672c\u5bf9\uff0c\u4ece\u800c\u8fdb\u4e00\u6b65\u589e\u5f3a\u4e86\u5bf9\u5f02\u5e38\u6210\u672c\u503c\u7684\u9c81\u68d2\u6027\u3002(3) \u5b83\u5c06\u8f93\u5165\u4fe1\u53f7\u6807\u51c6\u5316\uff0c\u4f7f\u5f97\u8d85\u53c2\u6570`beta`\u7684\u8c03\u4f18\u53ef\u80fd\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u548c\u901a\u7528\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Clipped Logp\u7f29\u653e)**\uff1a\u7236\u4ee30\u4f7f\u7528\u4e86`tanh`\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff0c\u7236\u4ee31\u5219\u5c06`tanh`\u7684\u8f93\u51fa\u76f4\u63a5\u4e58\u4ee5\u4e00\u4e2a\u53ef\u80fd\u5f88\u5927\u7684\u7f29\u653e\u56e0\u5b50\uff0c\u8fd9\u53ef\u80fd\u4f1a\u91cd\u65b0\u653e\u5927\u68af\u5ea6\u3002\u4e3a\u4e86\u7ed3\u5408\u7a33\u5b9a\u6027\u548c\u6709\u6548\u7684\u7f29\u653e\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u8026\u5408\u6280\u5de7\u3002\u6211\u4eec\u9996\u5148\u8ba1\u7b97\u539f\u59cb\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02`logp_w - logp_l`\uff0c\u7136\u540e\u4f7f\u7528`clamp`\u7b97\u5b50\u5c06\u5176\u9650\u5236\u5728\u4e00\u4e2a\u5bf9\u79f0\u533a\u95f4`[-gamma, gamma]`\u5185\u3002\u8fd9\u4e2a\u88ab\u88c1\u526a\uff08clipped\uff09\u7684`logp_diff`\u968f\u540e\u518d\u4e0e\u81ea\u9002\u5e94\u7684`scaling_factor`\u76f8\u4e58\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7684\u597d\u5904\u662f\uff1a(1) \u5b83\u50cf`tanh`\u4e00\u6837\u9632\u6b62\u4e86`logp_diff`\u8fc7\u5927\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\u3002(2) \u4e0e`tanh`\u5728\u8f93\u5165\u8f83\u5927\u65f6\u68af\u5ea6\u8d8b\u4e8e0\u4e0d\u540c\uff0c`clamp`\u5728\u533a\u95f4\u5185\u4fdd\u6301\u4e86\u68af\u5ea6\u4e3a1\uff0c\u5141\u8bb8\u68af\u5ea6\u4fe1\u53f7\u66f4\u76f4\u63a5\u5730\u4f20\u9012\u3002(3) \u5b83\u5141\u8bb8\u6211\u4eec\u63a7\u5236`logp_diff`\u7684\u6700\u5927\u5f71\u54cd\u8303\u56f4\uff0c\u589e\u52a0\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreClippedDynamicMarginLoss`\u901a\u8fc7`zscore`\u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6279\u6b21\u5185\u6210\u672c\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u901a\u8fc7`clamp`\u548c\u7f29\u653e\u56e0\u5b50\u8026\u5408\u4e86\u7a33\u5b9a\u6027\u548c\u68af\u5ea6\u4f20\u9012\u6548\u7387\uff0c\u5e76\u7ee7\u627f\u4e86\u7236\u4ee3\u4e2d\u6210\u719f\u7684Hinge Loss\u7ed3\u6784\u548c\u6df7\u5408\u88d5\u5ea6\u601d\u60f3\uff0c\u65e8\u5728\u5b9e\u73b0\u4e00\u79cd\u66f4\u9c81\u68d2\u3001\u7a33\u5b9a\u4e14\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u3002", "pseudocode": "def ZScoreClippedDynamicMarginLoss(cost_a, cost_b, logp_a, logp_b, beta, gamma):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u5e76\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\n    #    zscore\u5c06\u6279\u6b21\u5185\u7684\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u5747\u503c\u4e3a0\u3001\u65b9\u5dee\u4e3a1\u7684\u5206\u5e03\uff0c\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\n    #    zscore(cost_l - cost_w) \u7684\u8f93\u51fa\u671f\u671b\u4e3a\u6b63\u3002\n    cost_diff_signal = zscore(cost_l - cost_w)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8bbe\u8ba1\u52a8\u6001\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\n    #    \u4f7f\u7528\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u4fe1\u53f7\u6765\u540c\u65f6\u9a71\u52a8\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\uff0c\u8fd9\u7ee7\u627f\u4e86\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u7684\u601d\u60f3\u3002\n    dynamic_margin = beta * cost_diff_signal\n    scaling_factor = beta * cost_diff_signal\n\n    # 4. [\u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u3001\u88c1\u526a\u5e76\u7f29\u653e\u5bf9\u6570\u6982\u7387\u5dee\u5f02\n    #    \u9996\u5148\u8ba1\u7b97\u539f\u59cb\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff0c\u6211\u4eec\u671f\u671b logp_w > logp_l\u3002\n    raw_logp_diff = logp_w - logp_l\n    #    \u4f7f\u7528 clamp \u5c06\u5176\u9650\u5236\u5728 [-gamma, gamma] \u533a\u95f4\u5185\uff0c\u9632\u6b62\u68af\u5ea6\u7206\u70b8\uff0c\u540c\u65f6\u4fdd\u7559\u533a\u95f4\u5185\u7684\u68af\u5ea6\u3002\n    clipped_logp_diff = clamp(raw_logp_diff, min=-gamma, max=gamma)\n    #    \u4f7f\u7528\u7f29\u653e\u56e0\u5b50\u5bf9\u88c1\u526a\u540e\u7684logp\u5dee\u5f02\u8fdb\u884c\u52a0\u6743\u3002\n    scaled_logp_diff = scaling_factor * clipped_logp_diff\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u6838\u5fc3\u7684\u5e73\u6ed1Hinge Loss\n    #    \u8fd9\u662f\u7236\u4ee30\u7684\u6838\u5fc3\u7ed3\u6784\uff0c\u60e9\u7f5a\u6a21\u578b\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\u7684\u60c5\u51b5\u3002\n    #    \u5f53 scaled_logp_diff < dynamic_margin \u65f6\uff0c\u635f\u5931\u4e3a\u6b63\u3002\n    loss = softplus(dynamic_margin - scaled_logp_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u548c\u7f29\u653e\u7684\u654f\u611f\u5ea6\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u548c\u6982\u7387\u7f29\u653e\u6743\u91cd\u7684\u7a0b\u5ea6\u3002\u7531\u4e8e\u8f93\u5165\u662fz-score\u6807\u51c6\u5316\u7684\uff0cbeta\u7684\u53d6\u503c\u76f8\u5bf9\u7a33\u5b9a\u3002"}, "gamma": {"value": 5.0, "description": "\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u88c1\u526a\u9608\u503c\u3002\u7528\u4e8e\u5c06`logp_w - logp_l`\u9650\u5236\u5728`[-gamma, gamma]`\u533a\u95f4\u5185\uff0c\u4ee5\u9632\u6b62\u6781\u7aef\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u5bfc\u81f4\u7684\u6570\u503c\u4e0d\u7a33\u5b9a\u548c\u68af\u5ea6\u7206\u70b8\u3002\u8fd9\u662f\u4e00\u4e2a\u7a33\u5b9a\u6027\u63a7\u5236\u53c2\u6570\u3002"}}, "operators_used": ["zscore", "clamp", "softplus"], "implementation_hint": {"expects": ["cost_a, cost_b, logp_a, logp_b: Tensors of shape (B,), where B is the batch size. beta, gamma: float hyperparameters."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.043935060501099, "validation_objective": 4.043935060501099, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.033303141593933}, "train_score_mean": 4.266269259154797, "train_loss_mean": 0.6928329225629568, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedDynamicMarginLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u7a33\u5b9a\u673a\u5236\uff0c\u521b\u9020\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u5bf9\u5f02\u5e38\u503c\u4e0d\u654f\u611f\u3001\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u65b0\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - logp_diff)` \u7ed3\u6784\u3002\u8fd9\u662f\u4e00\u79cd\u5e73\u6ed1\u7684Hinge Loss\u5f62\u5f0f\uff0c\u5f53\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\uff08\u4f53\u73b0\u5728`logp_diff`\uff09\u672a\u8fbe\u5230\u52a8\u6001\u8bbe\u5b9a\u7684\u76ee\u6807\u88d5\u5ea6\uff08`margin`\uff09\u65f6\uff0c\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u79cd\u7ed3\u6784\u7b80\u5355\u3001\u6709\u6548\uff0c\u4e14\u6613\u4e8e\u7406\u89e3\u3002\n2.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u7684\u601d\u60f3\uff0c\u5373\u6210\u672c\u5dee\u5f02\u4e0d\u4ec5\u7528\u4e8e\u8bbe\u5b9a\u76ee\u6807\u88d5\u5ea6\uff08`dynamic_margin`\uff09\uff0c\u8fd8\u7528\u4e8e\u7f29\u653e\u6a21\u578b\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff08`scaled_logp_diff`\uff09\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u4f7f\u7528\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\u7684\u8bbe\u8ba1\uff0c\u53ef\u4ee5\u6709\u6548\u653e\u5927\u6a21\u578b\u5bf9\u91cd\u8981\u6837\u672c\u5bf9\uff08\u5373\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff09\u7684\u5b66\u4e60\u529b\u5ea6\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u4e24\u4e2a\u7236\u4ee3\u90fd\u4f7f\u7528\u4e86`rank_gap`\u6765\u589e\u5f3a\u5bf9\u6210\u672c\u7edd\u5bf9\u503c\u7684\u9c81\u68d2\u6027\u3002\u6211\u4eec\u5728\u6b64\u57fa\u7840\u4e0a\u5f15\u5165`zscore(cost_diff)`\u4f5c\u4e3a\u65b0\u7684\u8026\u5408\u70b9\u3002`zscore`\u901a\u8fc7\u51cf\u53bb\u5747\u503c\u3001\u9664\u4ee5\u6807\u51c6\u5dee\uff0c\u5c06\u4e00\u4e2a\u6279\u6b21\u5185\u7684\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6807\u51c6\u6b63\u6001\u5206\u5e03\u3002\u8fd9\u6837\u505a\u6709\u51e0\u4e2a\u597d\u5904\uff1a(1) \u5b83\u4e0d\u4ec5\u8003\u8651\u4e86\u5e8f\u5173\u7cfb\uff0c\u8fd8\u4fdd\u7559\u4e86\u5dee\u5f02\u7684\u76f8\u5bf9\u5927\u5c0f\u4fe1\u606f\u3002(2) \u5b83\u4f7f\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u8ba1\u7b97\u5bf9\u6574\u4e2a\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\u81ea\u9002\u5e94\uff0c\u800c\u4e0d\u662f\u4ec5\u4f9d\u8d56\u4e8e\u5355\u4e2a\u6837\u672c\u5bf9\uff0c\u4ece\u800c\u8fdb\u4e00\u6b65\u589e\u5f3a\u4e86\u5bf9\u5f02\u5e38\u6210\u672c\u503c\u7684\u9c81\u68d2\u6027\u3002(3) \u5b83\u5c06\u8f93\u5165\u4fe1\u53f7\u6807\u51c6\u5316\uff0c\u4f7f\u5f97\u8d85\u53c2\u6570`beta`\u7684\u8c03\u4f18\u53ef\u80fd\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u548c\u901a\u7528\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Clipped Logp\u7f29\u653e)**\uff1a\u7236\u4ee30\u4f7f\u7528\u4e86`tanh`\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff0c\u7236\u4ee31\u5219\u5c06`tanh`\u7684\u8f93\u51fa\u76f4\u63a5\u4e58\u4ee5\u4e00\u4e2a\u53ef\u80fd\u5f88\u5927\u7684\u7f29\u653e\u56e0\u5b50\uff0c\u8fd9\u53ef\u80fd\u4f1a\u91cd\u65b0\u653e\u5927\u68af\u5ea6\u3002\u4e3a\u4e86\u7ed3\u5408\u7a33\u5b9a\u6027\u548c\u6709\u6548\u7684\u7f29\u653e\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u8026\u5408\u6280\u5de7\u3002\u6211\u4eec\u9996\u5148\u8ba1\u7b97\u539f\u59cb\u7684\u5bf9\u6570\u6982\u7387\u5dee\u5f02`logp_w - logp_l`\uff0c\u7136\u540e\u4f7f\u7528`clamp`\u7b97\u5b50\u5c06\u5176\u9650\u5236\u5728\u4e00\u4e2a\u5bf9\u79f0\u533a\u95f4`[-gamma, gamma]`\u5185\u3002\u8fd9\u4e2a\u88ab\u88c1\u526a\uff08clipped\uff09\u7684`logp_diff`\u968f\u540e\u518d\u4e0e\u81ea\u9002\u5e94\u7684`scaling_factor`\u76f8\u4e58\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7684\u597d\u5904\u662f\uff1a(1) \u5b83\u50cf`tanh`\u4e00\u6837\u9632\u6b62\u4e86`logp_diff`\u8fc7\u5927\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\u3002(2) \u4e0e`tanh`\u5728\u8f93\u5165\u8f83\u5927\u65f6\u68af\u5ea6\u8d8b\u4e8e0\u4e0d\u540c\uff0c`clamp`\u5728\u533a\u95f4\u5185\u4fdd\u6301\u4e86\u68af\u5ea6\u4e3a1\uff0c\u5141\u8bb8\u68af\u5ea6\u4fe1\u53f7\u66f4\u76f4\u63a5\u5730\u4f20\u9012\u3002(3) \u5b83\u5141\u8bb8\u6211\u4eec\u63a7\u5236`logp_diff`\u7684\u6700\u5927\u5f71\u54cd\u8303\u56f4\uff0c\u589e\u52a0\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreClippedDynamicMarginLoss`\u901a\u8fc7`zscore`\u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6279\u6b21\u5185\u6210\u672c\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u901a\u8fc7`clamp`\u548c\u7f29\u653e\u56e0\u5b50\u8026\u5408\u4e86\u7a33\u5b9a\u6027\u548c\u68af\u5ea6\u4f20\u9012\u6548\u7387\uff0c\u5e76\u7ee7\u627f\u4e86\u7236\u4ee3\u4e2d\u6210\u719f\u7684Hinge Loss\u7ed3\u6784\u548c\u6df7\u5408\u88d5\u5ea6\u601d\u60f3\uff0c\u65e8\u5728\u5b9e\u73b0\u4e00\u79cd\u66f4\u9c81\u68d2\u3001\u7a33\u5b9a\u4e14\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u548c\u7f29\u653e\u7684\u654f\u611f\u5ea6\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u4fe1\u53f7\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u548c\u6982\u7387\u7f29\u653e\u6743\u91cd\u7684\u7a0b\u5ea6\u3002\u7531\u4e8e\u8f93\u5165\u662fz-score\u6807\u51c6\u5316\u7684\uff0cbeta\u7684\u53d6\u503c\u76f8\u5bf9\u7a33\u5b9a\u3002"}, "gamma": {"value": 5.0, "description": "\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u88c1\u526a\u9608\u503c\u3002\u7528\u4e8e\u5c06`logp_w - logp_l`\u9650\u5236\u5728`[-gamma, gamma]`\u533a\u95f4\u5185\uff0c\u4ee5\u9632\u6b62\u6781\u7aef\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u5bfc\u81f4\u7684\u6570\u503c\u4e0d\u7a33\u5b9a\u548c\u68af\u5ea6\u7206\u70b8\u3002\u8fd9\u662f\u4e00\u4e2a\u7a33\u5b9a\u6027\u63a7\u5236\u53c2\u6570\u3002"}}, "operators_used": ["zscore", "clamp", "softplus"]}}}
{"generation": 8, "index": 6, "ir": {"name": "ZScoreScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u540c\u65f6\u5f15\u5165\u66f4\u5148\u8fdb\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u6280\u672f\uff0c\u4ee5\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u5206\u5e03\u53d8\u5316\u4e0d\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u80fd\u6709\u6548\u533a\u5206\u4e0d\u540c\u96be\u5ea6\u6837\u672c\u5bf9\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u635f\u5931\u7ed3\u6784\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u5f62\u5f0f\u662f `-weight * logsigmoid(margin_gap)`\u3002\u8fd9\u79cd\u7ed3\u6784\u5929\u7136\u5730\u60e9\u7f5a\u6a21\u578b\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\uff08`margin_gap < 0`\uff09\u7684\u60c5\u51b5\uff0c\u5e76\u4e14\u901a\u8fc7 `logsigmoid` \u63d0\u4f9b\u4e86\u5e73\u6ed1\u4e14\u6709\u754c\u7684\u68af\u5ea6\u3002\u6b64\u5916\uff0c\u8fd8\u7ee7\u627f\u4e86\u5176\u81ea\u9002\u5e94\u60e9\u7f5a\u6743\u91cd `adaptive_penalty_weight` \u7684\u601d\u60f3\uff0c\u5373\u635f\u5931\u7684\u5927\u5c0f\u5e94\u8be5\u4e0e\u6837\u672c\u5bf9\u7684\u91cd\u8981\u6027\uff08\u6210\u672c\u5dee\u5f02\uff09\u76f8\u5173\u8054\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u538b\u7f29\u548c\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u8bbe\u8ba1\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u9884\u6d4b\u7684\u7f6e\u4fe1\u5ea6\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u7a33\u5b9a\u7684 `[-1, 1]` \u533a\u95f4\u5185\uff0c\u6709\u6548\u9632\u6b62\u4e86\u56e0\u6982\u7387\u5dee\u5f02\u8fc7\u5927\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u6211\u4eec\u7528 `zscore(cost_w, cost_l)` \u66ff\u6362\u4e86\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\u3002`rank_gap` \u5bf9\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\uff0c\u4f46\u5b83\u4e22\u5931\u4e86\u6210\u672c\u5dee\u5f02\u7684\u5e45\u5ea6\u4fe1\u606f\u3002`zscore` \u5219\u662f\u4e00\u79cd\u66f4\u9ad8\u7ea7\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\uff0c\u5b83\u901a\u8fc7\u51cf\u53bb\u6279\u6b21\u5747\u503c\u5e76\u9664\u4ee5\u6807\u51c6\u5dee\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\uff0c\u8fd9\u4f7f\u5f97\u52a8\u6001\u88d5\u5ea6 `dynamic_margin` \u5bf9\u5f53\u524d\u6279\u6b21\u5185\u6210\u672c\u7684\u6574\u4f53\u5206\u5e03\u548c\u6ce2\u52a8\u6027\u81ea\u9002\u5e94\u3002\u5982\u679c\u6279\u6b21\u5185\u6210\u672c\u5dee\u5f02\u666e\u904d\u5f88\u5927\uff0c`zscore` \u540e\u7684\u503c\u4f1a\u76f8\u5bf9\u6536\u7f29\uff1b\u53cd\u4e4b\uff0c\u5982\u679c\u5dee\u5f02\u5f88\u5c0f\uff0c`zscore` \u4f1a\u653e\u5927\u8fd9\u4e9b\u7ec6\u5fae\u5dee\u5f02\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u4e0d\u540c\u6210\u672c\u5c3a\u5ea6\uff08scale\uff09\u548c\u504f\u79fb\uff08shift\uff09\u66f4\u52a0\u9c81\u68d2\uff0c\u5b66\u4e60\u4fe1\u53f7\u4e5f\u66f4\u7a33\u5b9a\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Softplus\u6fc0\u6d3b\u7684\u81ea\u9002\u5e94\u6743\u91cd)**\uff1a\u5728\u7236\u4ee31\u4e2d\uff0c\u81ea\u9002\u5e94\u6743\u91cd\u7531 `sigmoid(cost_rank_diff)` \u8ba1\u7b97\uff0c\u5176\u4e0a\u9650\u4e3a1\u3002\u6211\u4eec\u5c06\u5176\u4fee\u6539\u4e3a `softplus(zscored_cost_diff)`\u3002`softplus` \u662f\u4e00\u4e2a\u975e\u8d1f\u3001\u65e0\u4e0a\u754c\u7684\u5e73\u6ed1\u51fd\u6570\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u6781\u5927\u7684\u201c\u5f02\u5e38\u201d\u91cd\u8981\u6837\u672c\u5bf9\uff08\u5176 `zscore` \u503c\u4f1a\u5f88\u9ad8\uff09\uff0c\u5176\u60e9\u7f5a\u6743\u91cd\u53ef\u4ee5\u65e0\u9650\u5236\u5730\u7ebf\u6027\u589e\u957f\uff0c\u4ece\u800c\u65bd\u52a0\u4e00\u4e2a\u8fdc\u8d85\u666e\u901a\u6837\u672c\u5bf9\u7684\u3001\u975e\u5e38\u5f3a\u7684\u5b66\u4e60\u4fe1\u53f7\u3002\u8fd9\u4f7f\u5f97\u6a21\u578b\u80fd\u591f\u66f4\u96c6\u4e2d\u5730\u7ea0\u6b63\u90a3\u4e9b\u6700\u5173\u952e\u3001\u6700\u660e\u663e\u7684\u9519\u8bef\uff0c\u76f8\u6bd4 `sigmoid` \u7684\u9971\u548c\u6548\u5e94\uff0c\u63d0\u4f9b\u4e86\u66f4\u5927\u7684\u52a8\u6001\u60e9\u7f5a\u8303\u56f4\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreScaledLogSigmoidLoss` \u901a\u8fc7\u5f15\u5165 Z-Score \u5f52\u4e00\u5316\uff0c\u4f7f\u635f\u5931\u80fd\u81ea\u9002\u5e94\u4e8e\u6279\u6b21\u6570\u636e\u7684\u7edf\u8ba1\u7279\u6027\uff0c\u589e\u5f3a\u4e86\u5bf9\u6210\u672c\u5206\u5e03\u53d8\u5316\u7684\u9c81\u68d2\u6027\u3002\u540c\u65f6\uff0c\u901a\u8fc7\u5c06\u81ea\u9002\u5e94\u6743\u91cd\u51fd\u6570\u4ece\u6709\u754c\u7684 `sigmoid` \u66ff\u6362\u4e3a\u65e0\u754c\u7684 `softplus`\uff0c\u5b9e\u73b0\u4e86\u5bf9\u6781\u91cd\u8981\u6837\u672c\u7684\u201c\u8d85\u7ea7\u60e9\u7f5a\u201d\u673a\u5236\u3002\u5b83\u7ed3\u5408\u4e86\u7236\u4ee3\u4e2d `logsigmoid` \u6846\u67b6\u548c `tanh` \u7a33\u5b9a\u5316\u7684\u4f18\u70b9\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u65e2\u7a33\u5b9a\u53c8\u5177\u6709\u9ad8\u5ea6\u81ea\u9002\u5e94\u6027\u7684\u65b0\u4e00\u4ee3\u504f\u597d\u635f\u5931\u3002", "pseudocode": "def ZScoreScaledLogSigmoidLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u4f7f\u7528Z-Score\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\n    #    zscore(cost_l, cost_w) = (cost_l - cost_w - mean(costs)) / std(costs)\n    #    \u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u8ba1\u7b97\u5bf9\u5f53\u524d\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\u5177\u6709\u81ea\u9002\u5e94\u6027\uff0c\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\n    zscored_cost_diff = zscore(cost_l, cost_w)\n\n    # 3. \u57fa\u4e8e\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\uff0c\u8ba1\u7b97\u52a8\u6001\u88d5\u5ea6\n    #    beta \u63a7\u5236\u88d5\u5ea6\u5bf9\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\u7684\u654f\u611f\u5ea6\u3002\n    dynamic_margin = beta * zscored_cost_diff\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. \u8ba1\u7b97\u6838\u5fc3\u7684\u88d5\u5ea6\u5dee\u8ddd (margin gap)\n    #    \u8fd9\u662f\u6a21\u578b\u8868\u73b0 (stable_logp_diff) \u4e0e\u671f\u671b\u76ee\u6807 (dynamic_margin) \u4e4b\u95f4\u7684\u5dee\u8ddd\u3002\n    #    \u6211\u4eec\u671f\u671b\u6a21\u578b\u4ea7\u751f\u7684\u6982\u7387\u5dee\u81f3\u5c11\u8981\u8fbe\u5230\u52a8\u6001\u88d5\u5ea6\u3002\n    margin_gap = stable_logp_diff - dynamic_margin\n\n    # 6. [\u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u81ea\u9002\u5e94\u60e9\u7f5a\u6743\u91cd\n    #    \u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u81ea\u9002\u5e94\u6743\u91cd\u601d\u60f3\uff0c\u4f46\u4f7f\u7528 softplus \u66ff\u6362 sigmoid\u3002\n    #    softplus(x) = log(1 + exp(x))\uff0c\u65e0\u4e0a\u754c\uff0c\u5141\u8bb8\u5bf9\u6781\u91cd\u8981\u7684\u6837\u672c\u65bd\u52a0\u5f3a\u529b\u60e9\u7f5a\u3002\n    adaptive_penalty_weight = softplus(zscored_cost_diff)\n\n    # 7. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u6700\u7ec8\u7684\u52a0\u6743logsigmoid\u635f\u5931\n    #    logsigmoid(x) \u60e9\u7f5a x < 0 \u7684\u60c5\u51b5\u3002\u5f53 margin_gap \u4e3a\u8d1f\u65f6\uff0c\u8868\u793a\u6a21\u578b\u672a\u8fbe\u5230\u76ee\u6807\uff0c\u4ea7\u751f\u635f\u5931\u3002\n    #    \u4e58\u4ee5\u81ea\u9002\u5e94\u6743\u91cd\uff0c\u4f7f\u5f97\u5bf9\u91cd\u8981\u6837\u672c\u7684\u60e9\u7f5a\u66f4\u5927\u3002\n    #    \u4e58\u4ee5 -1 \u5c06\u8d1f\u7684logsigmoid\u503c\u8f6c\u4e3a\u6b63\u7684\u635f\u5931\u503c\u3002\n    loss = -adaptive_penalty_weight * logsigmoid(margin_gap)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86Z-Score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u6982\u7387\u5206\u79bb\u3002"}}, "operators_used": ["zscore", "tanh", "softplus", "logsigmoid"], "implementation_hint": {"expects": ["cost_a, cost_b, logp_a, logp_b: Tensors of shape (B,), where B is the batch size. The zscore operator is expected to compute statistics (mean, std) across the batch dimension."], "returns": "A scalar Tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.235669374465942, "validation_objective": 4.235669374465942, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.1924498081207275}, "train_score_mean": 4.296352401375771, "train_loss_mean": 0.6928614415228367, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreScaledLogSigmoidLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u540c\u65f6\u5f15\u5165\u66f4\u5148\u8fdb\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u6280\u672f\uff0c\u4ee5\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u5206\u5e03\u53d8\u5316\u4e0d\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u80fd\u6709\u6548\u533a\u5206\u4e0d\u540c\u96be\u5ea6\u6837\u672c\u5bf9\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684 `logsigmoid` \u635f\u5931\u7ed3\u6784\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u5f62\u5f0f\u662f `-weight * logsigmoid(margin_gap)`\u3002\u8fd9\u79cd\u7ed3\u6784\u5929\u7136\u5730\u60e9\u7f5a\u6a21\u578b\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\uff08`margin_gap < 0`\uff09\u7684\u60c5\u51b5\uff0c\u5e76\u4e14\u901a\u8fc7 `logsigmoid` \u63d0\u4f9b\u4e86\u5e73\u6ed1\u4e14\u6709\u754c\u7684\u68af\u5ea6\u3002\u6b64\u5916\uff0c\u8fd8\u7ee7\u627f\u4e86\u5176\u81ea\u9002\u5e94\u60e9\u7f5a\u6743\u91cd `adaptive_penalty_weight` \u7684\u601d\u60f3\uff0c\u5373\u635f\u5931\u7684\u5927\u5c0f\u5e94\u8be5\u4e0e\u6837\u672c\u5bf9\u7684\u91cd\u8981\u6027\uff08\u6210\u672c\u5dee\u5f02\uff09\u76f8\u5173\u8054\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u538b\u7f29\u548c\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u8bbe\u8ba1\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u9884\u6d4b\u7684\u7f6e\u4fe1\u5ea6\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u7a33\u5b9a\u7684 `[-1, 1]` \u533a\u95f4\u5185\uff0c\u6709\u6548\u9632\u6b62\u4e86\u56e0\u6982\u7387\u5dee\u5f02\u8fc7\u5927\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u6211\u4eec\u7528 `zscore(cost_w, cost_l)` \u66ff\u6362\u4e86\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 `rank_gap`\u3002`rank_gap` \u5bf9\u7edd\u5bf9\u503c\u4e0d\u654f\u611f\uff0c\u4f46\u5b83\u4e22\u5931\u4e86\u6210\u672c\u5dee\u5f02\u7684\u5e45\u5ea6\u4fe1\u606f\u3002`zscore` \u5219\u662f\u4e00\u79cd\u66f4\u9ad8\u7ea7\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\uff0c\u5b83\u901a\u8fc7\u51cf\u53bb\u6279\u6b21\u5747\u503c\u5e76\u9664\u4ee5\u6807\u51c6\u5dee\u6765\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\uff0c\u8fd9\u4f7f\u5f97\u52a8\u6001\u88d5\u5ea6 `dynamic_margin` \u5bf9\u5f53\u524d\u6279\u6b21\u5185\u6210\u672c\u7684\u6574\u4f53\u5206\u5e03\u548c\u6ce2\u52a8\u6027\u81ea\u9002\u5e94\u3002\u5982\u679c\u6279\u6b21\u5185\u6210\u672c\u5dee\u5f02\u666e\u904d\u5f88\u5927\uff0c`zscore` \u540e\u7684\u503c\u4f1a\u76f8\u5bf9\u6536\u7f29\uff1b\u53cd\u4e4b\uff0c\u5982\u679c\u5dee\u5f02\u5f88\u5c0f\uff0c`zscore` \u4f1a\u653e\u5927\u8fd9\u4e9b\u7ec6\u5fae\u5dee\u5f02\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u5bf9\u4e0d\u540c\u6210\u672c\u5c3a\u5ea6\uff08scale\uff09\u548c\u504f\u79fb\uff08shift\uff09\u66f4\u52a0\u9c81\u68d2\uff0c\u5b66\u4e60\u4fe1\u53f7\u4e5f\u66f4\u7a33\u5b9a\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Softplus\u6fc0\u6d3b\u7684\u81ea\u9002\u5e94\u6743\u91cd)**\uff1a\u5728\u7236\u4ee31\u4e2d\uff0c\u81ea\u9002\u5e94\u6743\u91cd\u7531 `sigmoid(cost_rank_diff)` \u8ba1\u7b97\uff0c\u5176\u4e0a\u9650\u4e3a1\u3002\u6211\u4eec\u5c06\u5176\u4fee\u6539\u4e3a `softplus(zscored_cost_diff)`\u3002`softplus` \u662f\u4e00\u4e2a\u975e\u8d1f\u3001\u65e0\u4e0a\u754c\u7684\u5e73\u6ed1\u51fd\u6570\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u6781\u5927\u7684\u201c\u5f02\u5e38\u201d\u91cd\u8981\u6837\u672c\u5bf9\uff08\u5176 `zscore` \u503c\u4f1a\u5f88\u9ad8\uff09\uff0c\u5176\u60e9\u7f5a\u6743\u91cd\u53ef\u4ee5\u65e0\u9650\u5236\u5730\u7ebf\u6027\u589e\u957f\uff0c\u4ece\u800c\u65bd\u52a0\u4e00\u4e2a\u8fdc\u8d85\u666e\u901a\u6837\u672c\u5bf9\u7684\u3001\u975e\u5e38\u5f3a\u7684\u5b66\u4e60\u4fe1\u53f7\u3002\u8fd9\u4f7f\u5f97\u6a21\u578b\u80fd\u591f\u66f4\u96c6\u4e2d\u5730\u7ea0\u6b63\u90a3\u4e9b\u6700\u5173\u952e\u3001\u6700\u660e\u663e\u7684\u9519\u8bef\uff0c\u76f8\u6bd4 `sigmoid` \u7684\u9971\u548c\u6548\u5e94\uff0c\u63d0\u4f9b\u4e86\u66f4\u5927\u7684\u52a8\u6001\u60e9\u7f5a\u8303\u56f4\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreScaledLogSigmoidLoss` \u901a\u8fc7\u5f15\u5165 Z-Score \u5f52\u4e00\u5316\uff0c\u4f7f\u635f\u5931\u80fd\u81ea\u9002\u5e94\u4e8e\u6279\u6b21\u6570\u636e\u7684\u7edf\u8ba1\u7279\u6027\uff0c\u589e\u5f3a\u4e86\u5bf9\u6210\u672c\u5206\u5e03\u53d8\u5316\u7684\u9c81\u68d2\u6027\u3002\u540c\u65f6\uff0c\u901a\u8fc7\u5c06\u81ea\u9002\u5e94\u6743\u91cd\u51fd\u6570\u4ece\u6709\u754c\u7684 `sigmoid` \u66ff\u6362\u4e3a\u65e0\u754c\u7684 `softplus`\uff0c\u5b9e\u73b0\u4e86\u5bf9\u6781\u91cd\u8981\u6837\u672c\u7684\u201c\u8d85\u7ea7\u60e9\u7f5a\u201d\u673a\u5236\u3002\u5b83\u7ed3\u5408\u4e86\u7236\u4ee3\u4e2d `logsigmoid` \u6846\u67b6\u548c `tanh` \u7a33\u5b9a\u5316\u7684\u4f18\u70b9\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u65e2\u7a33\u5b9a\u53c8\u5177\u6709\u9ad8\u5ea6\u81ea\u9002\u5e94\u6027\u7684\u65b0\u4e00\u4ee3\u504f\u597d\u635f\u5931\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86Z-Score\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u6982\u7387\u5206\u79bb\u3002"}}, "operators_used": ["zscore", "tanh", "softplus", "logsigmoid"]}}}
{"generation": 8, "index": 7, "ir": {"name": "ZScoreClippedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u9c81\u68d2\u6027\u673a\u5236\uff0c\u4ee5\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u60e9\u7f5a\u529b\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u662f\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u53e6\u4e00\u4e2a\u662f\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff08\u5373\u91cd\u8981\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u8bbe\u8ba1\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u9879\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u7a33\u5b9a\u7684\u533a\u95f4 `[-1, 1]` \u5185\uff0c\u6709\u6548\u9632\u6b62\u4e86\u7531\u4e8e\u6982\u7387\u5dee\u5f02\u8fc7\u5927\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u5bf9\u6210\u672c\u5206\u5e03\u548c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\u3002\u6211\u4eec\u4e0d\u518d\u76f4\u63a5\u4f7f\u7528 `rank_gap`\uff0c\u800c\u662f\u5bf9\u6279\u6b21\u5185\uff08in-batch\uff09\u6240\u6709\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02 `(cost_l - cost_w)` \u8ba1\u7b97Z-Score\uff08`zscore`\u7b97\u5b50\uff09\u3002`zscore`\u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\uff0c\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u8ba1\u7b97\u4e0d\u518d\u53d7\u6210\u672c\u7edd\u5bf9\u503c\u5927\u5c0f\u7684\u5f71\u54cd\uff0c\u800c\u662f\u4f9d\u8d56\u4e8e\u5176\u5728\u5f53\u524d\u6279\u6b21\u5185\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u8fd9\u4f7f\u5f97\u8d85\u53c2\u6570 `beta` \u7684\u8bbe\u5b9a\u66f4\u52a0\u901a\u7528\uff0c\u4e0d\u6613\u53d7\u5230\u4e0d\u540c\u4efb\u52a1\u6210\u672c\u5c3a\u5ea6\u53d8\u5316\u7684\u5f71\u54cd\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Clipped Softplus\u88d5\u5ea6)**\uff1a\u6211\u4eec\u5bf9\u7236\u4ee3\u4e2d\u88d5\u5ea6\u7684\u7ebf\u6027\u8bbe\u8ba1\u8fdb\u884c\u4e86\u6539\u8fdb\u3002\u867d\u7136\u6211\u4eec\u4ecd\u7136\u4f7f\u7528 `beta * cost_diff_norm` \u4f5c\u4e3a\u57fa\u7840\u88d5\u5ea6\uff0c\u4f46\u6211\u4eec\u901a\u8fc7 `softplus` \u548c `clamp` \u7b97\u5b50\u5bf9\u5176\u8fdb\u884c\u4e86\u975e\u7ebf\u6027\u53d8\u6362\uff08`dynamic_margin = clamp(softplus(beta * cost_diff_norm), max=gamma)`\uff09\u3002`softplus` \u4fdd\u8bc1\u4e86\u88d5\u5ea6\u59cb\u7ec8\u4e3a\u6b63\uff0c\u4e14\u5728\u6210\u672c\u5dee\u5f02\u8f83\u5c0f\u65f6\u589e\u957f\u5e73\u7f13\uff1b`clamp` \u5219\u4e3a\u88d5\u5ea6\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u4e0a\u9650 `gamma`\uff0c\u8fd9\u53ef\u4ee5\u9632\u6b62\u6781\u7aef\u5927\u7684\u6210\u672c\u5dee\u5f02\u5bfc\u81f4\u8fc7\u5927\u7684\u76ee\u6807\u88d5\u5ea6\uff0c\u4ece\u800c\u907f\u514d\u6a21\u578b\u5728\u8fd9\u4e9b\u6837\u672c\u4e0a\u4ea7\u751f\u8fc7\u5927\u7684\u68af\u5ea6\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u4e86\u6570\u503c\u7a33\u5b9a\u6027\u3002\u8fd9\u79cd\u201cClipped Softplus\u201d\u8bbe\u8ba1\u5728\u9f13\u52b1\u6a21\u578b\u533a\u5206\u6210\u672c\u5dee\u5f02\u7684\u540c\u65f6\uff0c\u4e5f\u9650\u5236\u4e86\u5176\u5b66\u4e60\u76ee\u6807\u7684\u4e0a\u9650\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreClippedHybridLoss` \u901a\u8fc7Z-Score\u5f52\u4e00\u5316\u83b7\u5f97\u4e86\u5bf9\u6210\u672c\u5c3a\u5ea6\u7684\u4e0d\u654f\u611f\u6027\uff0c\u901a\u8fc7Clipped Softplus\u88d5\u5ea6\u8bbe\u8ba1\u5e73\u8861\u4e86\u654f\u611f\u6027\u4e0e\u7a33\u5b9a\u6027\u3002\u5b83\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u6df7\u5408\u88d5\u5ea6\u601d\u60f3\u548c`tanh`\u7a33\u5b9a\u6280\u5de7\uff0c\u6700\u7ec8\u5f62\u6210\u4e86\u4e00\u4e2a\u9c81\u68d2\u3001\u7a33\u5b9a\u4e14\u9ad8\u6548\u7684\u65b0\u578b\u504f\u597d\u635f\u5931\u3002", "pseudocode": "def ZScoreClippedHybridLoss(cost_a, cost_b, logp_a, logp_b, beta, gamma):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u6279\u5185\u6210\u672c\u5dee\u5f02\u7684Z-Score\u5f52\u4e00\u5316\u503c\u3002\n    #    zscore(cost_l - cost_w) \u4f1a\u5728\u6279\u6b21\u7ef4\u5ea6\u4e0a\u8ba1\u7b97\u5747\u503c\u548c\u6807\u51c6\u5dee\uff0c\u5e76\u8fd4\u56de\u5f52\u4e00\u5316\u540e\u7684\u503c\u3002\n    #    \u8fd9\u4f7f\u5f97\u88d5\u5ea6\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u4e0d\u654f\u611f\u3002\n    cost_diff_norm = zscore(cost_l - cost_w)\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u4e00\u4e2a\u7ecf\u8fc7\u88c1\u526a\u7684\u3001\u975e\u7ebf\u6027\u7684\u52a8\u6001\u88d5\u5ea6\u3002\n    #    \u7ee7\u627f\u4e86\u7236\u4ee31\u7684\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u601d\u60f3\uff0c\u4f46\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u8ba1\u7b97\u65b9\u5f0f\u88ab\u6539\u8fdb\u3002\n    #    softplus\u786e\u4fdd\u88d5\u5ea6\u4e3a\u6b63\uff0cclamp\u9632\u6b62\u88d5\u5ea6\u8fc7\u5927\uff0c\u589e\u5f3a\u7a33\u5b9a\u6027\u3002\n    base_margin = beta * cost_diff_norm\n    dynamic_margin = clamp(softplus(base_margin), max=gamma)\n    # \u6df7\u5408\u88d5\u5ea6\u8bbe\u8ba1\u4e2d\uff0c\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u5171\u4eab\u76f8\u540c\u7684\u8bbe\u8ba1\n    scaling_factor = dynamic_margin \n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\u3002\n    #    \u4f7f\u7528 tanh \u5c06\u5dee\u5f02\u538b\u7f29\u5230 [-1, 1]\uff0c\u9632\u6b62\u6570\u503c\u7206\u70b8\u3002\n    stable_logp_diff = tanh(logp_w - logp_l)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\u3002\n    #    \u8fd9\u4f53\u73b0\u4e86\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u7ed9\u4e88\u66f4\u591a\u5173\u6ce8\u7684\u601d\u60f3\u3002\n    scaled_logp_diff = scaling_factor * stable_logp_diff\n\n    # 6. \u8ba1\u7b97\u6838\u5fc3\u7684\u88d5\u5ea6\u5dee\u5f02\u9879 (Hinge-like core)\u3002\n    #    \u8fd9\u662f\u7236\u4ee3\u635f\u5931\u7ed3\u6784\u7684\u6838\u5fc3\uff0c\u8861\u91cf\u4e86\u6a21\u578b\u8868\u73b0\u4e0e\u76ee\u6807\u88d5\u5ea6\u7684\u5dee\u8ddd\u3002\n    margin_gap = scaled_logp_diff - dynamic_margin\n\n    # 7. \u8ba1\u7b97\u6700\u7ec8\u7684\u635f\u5931\u3002\n    #    \u6211\u4eec\u4f7f\u7528 logsigmoid(x) = -softplus(-x) \u4f5c\u4e3a\u57fa\u7840\u635f\u5931\u51fd\u6570\u3002\n    #    \u5b83\u60e9\u7f5a margin_gap < 0 \u7684\u60c5\u51b5\u3002\u4e58\u4ee5-1\u5f97\u5230\u4e00\u4e2a\u6b63\u7684\u635f\u5931\u503c\u3002\n    #    \u8fd9\u4e0e\u7236\u4ee31\u7684\u6700\u7ec8\u635f\u5931\u5f62\u5f0f\u4fdd\u6301\u4e00\u81f4\uff0c\u4f46\u5185\u90e8\u9879\u7684\u8bbe\u8ba1\u5df2\u5b8c\u5168\u4e0d\u540c\u3002\n    loss = -logsigmoid(margin_gap)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\uff08Z-Score\uff09\u8f6c\u5316\u4e3a\u57fa\u7840\u88d5\u5ea6\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u7684\u76f8\u5bf9\u5927\u5c0f\u5bf9\u76ee\u6807\u88d5\u5ea6\u6709\u66f4\u5927\u7684\u5f71\u54cd\u3002"}, "gamma": {"value": 5.0, "description": "\u88d5\u5ea6\u4e0a\u9650\u3002\u6b64\u53c2\u6570\u901a\u8fc7`clamp`\u64cd\u4f5c\u9650\u5236\u4e86`dynamic_margin`\u548c`scaling_factor`\u7684\u6700\u5927\u503c\u3002\u8fd9\u53ef\u4ee5\u9632\u6b62\u5177\u6709\u6781\u7aef\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u4ea7\u751f\u8fc7\u5927\u7684\u68af\u5ea6\uff0c\u4ece\u800c\u63d0\u9ad8\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002"}}, "operators_used": ["zscore", "softplus", "clamp", "tanh", "logsigmoid"], "implementation_hint": {"expects": ["Tensors `cost_a`, `cost_b`, `logp_a`, `logp_b` of shape (B,), where B is the batch size. The `zscore` operator is expected to compute statistics over this batch dimension."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.073483943939209, "validation_objective": 4.073483943939209, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.0029215812683105}, "train_score_mean": 4.241837851703167, "train_loss_mean": 0.6928020138293505, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u9c81\u68d2\u6027\u673a\u5236\uff0c\u4ee5\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u80fd\u81ea\u9002\u5e94\u8c03\u6574\u60e9\u7f5a\u529b\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u662f\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u53e6\u4e00\u4e2a\u662f\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff08\u5373\u91cd\u8981\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `tanh` \u51fd\u6570\u6765\u7a33\u5b9a\u5bf9\u6570\u6982\u7387\u5dee\u5f02 `(logp_w - logp_l)` \u7684\u8bbe\u8ba1\u3002\u8fd9\u786e\u4fdd\u4e86\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u9879\u88ab\u9650\u5236\u5728\u4e00\u4e2a\u7a33\u5b9a\u7684\u533a\u95f4 `[-1, 1]` \u5185\uff0c\u6709\u6548\u9632\u6b62\u4e86\u7531\u4e8e\u6982\u7387\u5dee\u5f02\u8fc7\u5927\u5bfc\u81f4\u7684\u68af\u5ea6\u7206\u70b8\u95ee\u9898\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u5bf9\u6210\u672c\u5206\u5e03\u548c\u5f02\u5e38\u503c\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\u3002\u6211\u4eec\u4e0d\u518d\u76f4\u63a5\u4f7f\u7528 `rank_gap`\uff0c\u800c\u662f\u5bf9\u6279\u6b21\u5185\uff08in-batch\uff09\u6240\u6709\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02 `(cost_l - cost_w)` \u8ba1\u7b97Z-Score\uff08`zscore`\u7b97\u5b50\uff09\u3002`zscore`\u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\uff0c\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u8ba1\u7b97\u4e0d\u518d\u53d7\u6210\u672c\u7edd\u5bf9\u503c\u5927\u5c0f\u7684\u5f71\u54cd\uff0c\u800c\u662f\u4f9d\u8d56\u4e8e\u5176\u5728\u5f53\u524d\u6279\u6b21\u5185\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u8fd9\u4f7f\u5f97\u8d85\u53c2\u6570 `beta` \u7684\u8bbe\u5b9a\u66f4\u52a0\u901a\u7528\uff0c\u4e0d\u6613\u53d7\u5230\u4e0d\u540c\u4efb\u52a1\u6210\u672c\u5c3a\u5ea6\u53d8\u5316\u7684\u5f71\u54cd\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Clipped Softplus\u88d5\u5ea6)**\uff1a\u6211\u4eec\u5bf9\u7236\u4ee3\u4e2d\u88d5\u5ea6\u7684\u7ebf\u6027\u8bbe\u8ba1\u8fdb\u884c\u4e86\u6539\u8fdb\u3002\u867d\u7136\u6211\u4eec\u4ecd\u7136\u4f7f\u7528 `beta * cost_diff_norm` \u4f5c\u4e3a\u57fa\u7840\u88d5\u5ea6\uff0c\u4f46\u6211\u4eec\u901a\u8fc7 `softplus` \u548c `clamp` \u7b97\u5b50\u5bf9\u5176\u8fdb\u884c\u4e86\u975e\u7ebf\u6027\u53d8\u6362\uff08`dynamic_margin = clamp(softplus(beta * cost_diff_norm), max=gamma)`\uff09\u3002`softplus` \u4fdd\u8bc1\u4e86\u88d5\u5ea6\u59cb\u7ec8\u4e3a\u6b63\uff0c\u4e14\u5728\u6210\u672c\u5dee\u5f02\u8f83\u5c0f\u65f6\u589e\u957f\u5e73\u7f13\uff1b`clamp` \u5219\u4e3a\u88d5\u5ea6\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u4e0a\u9650 `gamma`\uff0c\u8fd9\u53ef\u4ee5\u9632\u6b62\u6781\u7aef\u5927\u7684\u6210\u672c\u5dee\u5f02\u5bfc\u81f4\u8fc7\u5927\u7684\u76ee\u6807\u88d5\u5ea6\uff0c\u4ece\u800c\u907f\u514d\u6a21\u578b\u5728\u8fd9\u4e9b\u6837\u672c\u4e0a\u4ea7\u751f\u8fc7\u5927\u7684\u68af\u5ea6\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u4e86\u6570\u503c\u7a33\u5b9a\u6027\u3002\u8fd9\u79cd\u201cClipped Softplus\u201d\u8bbe\u8ba1\u5728\u9f13\u52b1\u6a21\u578b\u533a\u5206\u6210\u672c\u5dee\u5f02\u7684\u540c\u65f6\uff0c\u4e5f\u9650\u5236\u4e86\u5176\u5b66\u4e60\u76ee\u6807\u7684\u4e0a\u9650\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreClippedHybridLoss` \u901a\u8fc7Z-Score\u5f52\u4e00\u5316\u83b7\u5f97\u4e86\u5bf9\u6210\u672c\u5c3a\u5ea6\u7684\u4e0d\u654f\u611f\u6027\uff0c\u901a\u8fc7Clipped Softplus\u88d5\u5ea6\u8bbe\u8ba1\u5e73\u8861\u4e86\u654f\u611f\u6027\u4e0e\u7a33\u5b9a\u6027\u3002\u5b83\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u6df7\u5408\u88d5\u5ea6\u601d\u60f3\u548c`tanh`\u7a33\u5b9a\u6280\u5de7\uff0c\u6700\u7ec8\u5f62\u6210\u4e86\u4e00\u4e2a\u9c81\u68d2\u3001\u7a33\u5b9a\u4e14\u9ad8\u6548\u7684\u65b0\u578b\u504f\u597d\u635f\u5931\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\uff08Z-Score\uff09\u8f6c\u5316\u4e3a\u57fa\u7840\u88d5\u5ea6\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u6210\u672c\u5dee\u5f02\u7684\u76f8\u5bf9\u5927\u5c0f\u5bf9\u76ee\u6807\u88d5\u5ea6\u6709\u66f4\u5927\u7684\u5f71\u54cd\u3002"}, "gamma": {"value": 5.0, "description": "\u88d5\u5ea6\u4e0a\u9650\u3002\u6b64\u53c2\u6570\u901a\u8fc7`clamp`\u64cd\u4f5c\u9650\u5236\u4e86`dynamic_margin`\u548c`scaling_factor`\u7684\u6700\u5927\u503c\u3002\u8fd9\u53ef\u4ee5\u9632\u6b62\u5177\u6709\u6781\u7aef\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u4ea7\u751f\u8fc7\u5927\u7684\u68af\u5ea6\uff0c\u4ece\u800c\u63d0\u9ad8\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002"}}, "operators_used": ["zscore", "softplus", "clamp", "tanh", "logsigmoid"]}}}
{"generation": 9, "index": 0, "ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u8bbe\u8ba1\u7684\u6838\u5fc3\u4f18\u52bf\uff0c\u540c\u65f6\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\uff0c\u4ee5\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u9ad8\u5ea6\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u80fd\u81ea\u9002\u5e94\u60e9\u7f5a\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5177\u4f53\u800c\u8a00\uff0c\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u4ee5\u53ca\u4e00\u4e2a\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff08\u5373\u91cd\u8981\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u5176\u57fa\u7840\u7684 `softplus(margin - term)` Hinge Loss \u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5e73\u6ed1\u4e14\u9c81\u68d2\u7684\u60e9\u7f5a\u673a\u5236\uff1a\u53ea\u6709\u5f53\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`scaled_logp_diff`\uff09\u672a\u80fd\u8fbe\u5230\u76ee\u6807\u88d5\u5ea6\uff08`dynamic_margin`\uff09\u65f6\uff0c\u624d\u4f1a\u4ea7\u751f\u635f\u5931\uff0c\u4ece\u800c\u9f13\u52b1\u6a21\u578b\u6709\u6548\u5730\u533a\u5206\u4f18\u52a3\u89e3\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score \u5f52\u4e00\u5316)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u5bf9\u6210\u672c\u5206\u5e03\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\u3002\u6211\u4eec\u4e0d\u518d\u76f4\u63a5\u4f7f\u7528 `rank_gap`\uff0c\u800c\u662f\u8ba1\u7b97\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u6240\u6709\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02 `(cost_l - cost_w)`\uff0c\u7136\u540e\u5bf9\u8fd9\u4e9b\u5dee\u5f02\u8fdb\u884c Z-Score \u5f52\u4e00\u5316\uff08`zscore`\uff09\u3002`zscore` \u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4ee50\u4e3a\u5747\u503c\u30011\u4e3a\u6807\u51c6\u5dee\u7684\u5206\u5e03\u3002\u8fd9\u79cd\u65b9\u6cd5\u7684\u597d\u5904\u662f\uff0c\u5b83\u4e0d\u4ec5\u8003\u8651\u4e86\u5355\u4e2a\u6837\u672c\u5bf9\u7684\u5dee\u5f02\uff0c\u8fd8\u5c06\u5176\u7f6e\u4e8e\u6574\u4e2a\u6279\u6b21\u7684\u4e0a\u4e0b\u6587\u4e2d\u8fdb\u884c\u8bc4\u4f30\u3002\u4e00\u4e2a\u5728\u6279\u6b21\u5185\u201c\u5f02\u5e38\u201d\u5927\u7684\u6210\u672c\u5dee\u5f02\u4f1a\u83b7\u5f97\u66f4\u9ad8\u7684 Z-Score\uff0c\u4ece\u800c\u88ab\u8d4b\u4e88\u66f4\u5927\u7684\u88d5\u5ea6\u548c\u6743\u91cd\uff0c\u8fd9\u6bd4 `rank_gap` \u5bf9\u4e0a\u4e0b\u6587\u4fe1\u606f\u7684\u5229\u7528\u66f4\u5145\u5206\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u975e\u7ebf\u6027\u88d5\u5ea6\u4e0e\u7f29\u653e)**\uff1a\u7236\u4ee3\u8bbe\u8ba1\u4e3b\u8981\u91c7\u7528\u7ebf\u6027\u65b9\u5f0f\uff08`beta * diff`\uff09\u5c06\u6210\u672c\u5dee\u5f02\u6620\u5c04\u5230\u88d5\u5ea6\u3002\u6211\u4eec\u5f15\u5165\u4e86 `softplus` \u51fd\u6570\u6765\u521b\u5efa\u975e\u7ebf\u6027\u7684\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\uff1a`dynamic_margin = beta * softplus(cost_diff_norm)` \u548c `scaling_factor = softplus(cost_diff_norm)`\u3002`softplus` \u7684\u7279\u6027\u662f\uff0c\u5f53\u8f93\u5165\u8f83\u5c0f\u65f6\uff0c\u5176\u884c\u4e3a\u63a5\u8fd1\u7ebf\u6027\uff1b\u5f53\u8f93\u5165\u8f83\u5927\u65f6\uff0c\u5176\u589e\u957f\u7387\u4f1a\u653e\u7f13\u3002\u8fd9\u610f\u5473\u7740\uff1a\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u8f83\u5c0f\u7684\u6837\u672c\u5bf9\uff0c\u88d5\u5ea6\u8981\u6c42\u6e29\u548c\u589e\u957f\uff1b\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u6781\u5927\u7684\u6837\u672c\u5bf9\uff0c\u88d5\u5ea6\u8981\u6c42\u4e0d\u4f1a\u65e0\u9650\u7ebf\u6027\u589e\u957f\uff0c\u4ece\u800c\u9632\u6b62\u4e86\u6781\u7aef\u6210\u672c\u5dee\u5f02\u5bf9\u635f\u5931\u51fd\u6570\u9020\u6210\u4e0d\u6210\u6bd4\u4f8b\u7684\u4e3b\u5bfc\u5f71\u54cd\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\u540c\u65f6\uff0c\u6211\u4eec\u89e3\u8026\u4e86 `beta` \u7684\u4f5c\u7528\uff0c\u4f7f\u5176\u53ea\u63a7\u5236 `dynamic_margin`\uff0c\u800c `scaling_factor` \u76f4\u63a5\u7531\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u51b3\u5b9a\uff0c\u7b80\u5316\u4e86\u8d85\u53c2\u7684\u8bed\u4e49\u3002\n\n\u603b\u4e4b\uff0c`ZScoreNormalizedHybridLoss` \u901a\u8fc7\u5728\u6279\u6b21\u7ea7\u522b\u4e0a\u4f7f\u7528 `zscore` \u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\uff0c\u83b7\u5f97\u4e86\u66f4\u5177\u4e0a\u4e0b\u6587\u611f\u77e5\u80fd\u529b\u7684\u504f\u597d\u4fe1\u53f7\u3002\u7136\u540e\uff0c\u5b83\u901a\u8fc7\u975e\u7ebf\u6027\u7684 `softplus` \u53d8\u6362\uff0c\u5c06\u8be5\u4fe1\u53f7\u8f6c\u5316\u4e3a\u4e00\u4e2a\u65e2\u7a33\u5b9a\u53c8\u654f\u611f\u7684\u52a8\u6001\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u3002\u6700\u540e\uff0c\u5b83\u5c06\u8fd9\u4e9b\u7ec4\u4ef6\u878d\u5165\u5230\u7ecf\u5178\u7684\u201c\u6df7\u5408\u88d5\u5ea6\u201dHinge Loss \u6846\u67b6\u4e2d\uff0c\u5b9e\u73b0\u4e86\u5bf9\u7236\u4ee3\u601d\u60f3\u7684\u6709\u6548\u7ee7\u627f\u548c\u521b\u65b0\u6027\u8026\u5408\u3002", "pseudocode": "def ZScoreNormalizedHybridLoss(costs_a, costs_b, logps_a, logps_b, beta):\n    # \u5047\u8bbe costs_a, costs_b, logps_a, logps_b \u90fd\u662f\u4e00\u4e2a\u6279\u6b21(batch)\u7684\u5f20\u91cf\n    # 1. \u8bc6\u522b\u6279\u6b21\u4e2d\u6bcf\u4e2a\u6837\u672c\u5bf9\u7684\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    is_a_winner = costs_a < costs_b\n    costs_w = where(is_a_winner, costs_a, costs_b)\n    costs_l = where(is_a_winner, costs_b, costs_a)\n    logps_w = where(is_a_winner, logps_a, logps_b)\n    logps_l = where(is_a_winner, logps_b, logps_a)\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u6279\u6b21\u5185\u6210\u672c\u5dee\u5f02\u5e76\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\n    #    \u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u8ba1\u7b97\u80fd\u591f\u611f\u77e5\u5f53\u524d\u6279\u6b21\u7684\u6570\u636e\u5206\u5e03\uff0c\u66f4\u5177\u9c81\u68d2\u6027\u3002\n    cost_diffs = costs_l - costs_w\n    cost_diff_norm = zscore(cost_diffs) # \u5bf9\u6574\u4e2a\u6279\u6b21\u7684\u5dee\u5f02\u8fdb\u884c\u5f52\u4e00\u5316\n    # zscore\u540e\uff0c\u5927\u90e8\u5206\u503c\u5728[-3, 3]\u533a\u95f4\uff0c\u4e14\u5747\u503c\u4e3a0\u3002\u4e3a\u786e\u4fdd\u88d5\u5ea6\u4e3a\u6b63\uff0c\u4f7f\u7528relu\u3002\n    cost_diff_norm = relu(cost_diff_norm)\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u975e\u7ebf\u6027\u7684\u52a8\u6001\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\n    #    \u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u601d\u60f3\uff0c\u4f46\u4f7f\u7528softplus\u8fdb\u884c\u975e\u7ebf\u6027\u53d8\u6362\u3002\n    #    softplus(x)\u5728x>0\u65f6\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u53ef\u4ee5\u9632\u6b62\u88d5\u5ea6\u65e0\u9650\u589e\u957f\u3002\n    dynamic_margin = beta * softplus(cost_diff_norm)\n    scaling_factor = softplus(cost_diff_norm)\n\n    # 4. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u8fd9\u91cc\u6211\u4eec\u4e0d\u4f7f\u7528tanh\uff0c\u800c\u662f\u76f4\u63a5\u8ba1\u7b97\u5dee\u503c\uff0c\u4f9d\u8d56\u540e\u7eed\u7684Hinge\u7ed3\u6784\u6765\u5904\u7406\u3002\n    #    \u8fd9\u7b80\u5316\u4e86\u8bbe\u8ba1\uff0c\u56e0\u4e3asoftplus\u672c\u8eab\u5bf9\u5927\u7684\u8d1f\u8f93\u5165\u4e0d\u654f\u611f\u3002\n    logp_diff = logps_w - logps_l # \u671f\u671b\u4e3a\u6b63\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\n    #    \u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u5bf9\u6a21\u578b\u504f\u597d\u7f6e\u4fe1\u5ea6\u7684\u8981\u6c42\u8d8a\u9ad8\u3002\n    scaled_logp_diff = scaling_factor * logp_diff\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e73\u6ed1\u7684Hinge\u635f\u5931\n    #    \u8fd9\u662f\u7236\u4ee30\u7684\u6838\u5fc3\u7ed3\u6784\uff0c\u60e9\u7f5a\u90a3\u4e9b\u6a21\u578b\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\u7684\u6837\u672c\u5bf9\u3002\n    #    \u5f53 scaled_logp_diff < dynamic_margin \u65f6\uff0c\u4ea7\u751f\u635f\u5931\u3002\n    loss_per_sample = softplus(dynamic_margin - scaled_logp_diff)\n\n    # 7. \u8fd4\u56de\u6279\u6b21\u7684\u5e73\u5747\u635f\u5931\n    return mean(loss_per_sample)", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u7f6e\u4fe1\u5ea6\u5dee\u8ddd\u3002"}}, "operators_used": ["zscore", "relu", "softplus"], "implementation_hint": {"expects": ["Tensors `costs_a`, `costs_b`, `logps_a`, `logps_b` of shape [batch_size], and a float `beta`."], "returns": "A single scalar tensor representing the mean loss for the batch."}}, "fitness": {"hf_like_score": 4.054229736328125, "validation_objective": 4.054229736328125, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.002422094345093}, "train_score_mean": 4.28532924503088, "train_loss_mean": 0.6928491313010454, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u878d\u5408\u4e24\u79cd\u7236\u4ee3\u8bbe\u8ba1\u7684\u6838\u5fc3\u4f18\u52bf\uff0c\u540c\u65f6\u5f15\u5165\u65b0\u7684\u8026\u5408\u673a\u5236\uff0c\u4ee5\u521b\u5efa\u4e00\u4e2a\u5bf9\u6210\u672c\u5dee\u5f02\u9ad8\u5ea6\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u80fd\u81ea\u9002\u5e94\u60e9\u7f5a\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5177\u4f53\u800c\u8a00\uff0c\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u4ee5\u53ca\u4e00\u4e2a\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff08\u5373\u91cd\u8981\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u5176\u57fa\u7840\u7684 `softplus(margin - term)` Hinge Loss \u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5e73\u6ed1\u4e14\u9c81\u68d2\u7684\u60e9\u7f5a\u673a\u5236\uff1a\u53ea\u6709\u5f53\u6a21\u578b\u7684\u504f\u597d\u7f6e\u4fe1\u5ea6\uff08`scaled_logp_diff`\uff09\u672a\u80fd\u8fbe\u5230\u76ee\u6807\u88d5\u5ea6\uff08`dynamic_margin`\uff09\u65f6\uff0c\u624d\u4f1a\u4ea7\u751f\u635f\u5931\uff0c\u4ece\u800c\u9f13\u52b1\u6a21\u578b\u6709\u6548\u5730\u533a\u5206\u4f18\u52a3\u89e3\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score \u5f52\u4e00\u5316)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u5bf9\u6210\u672c\u5206\u5e03\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\u3002\u6211\u4eec\u4e0d\u518d\u76f4\u63a5\u4f7f\u7528 `rank_gap`\uff0c\u800c\u662f\u8ba1\u7b97\u4e00\u4e2a\u6279\u6b21\uff08batch\uff09\u5185\u6240\u6709\u6837\u672c\u5bf9\u7684\u6210\u672c\u5dee\u5f02 `(cost_l - cost_w)`\uff0c\u7136\u540e\u5bf9\u8fd9\u4e9b\u5dee\u5f02\u8fdb\u884c Z-Score \u5f52\u4e00\u5316\uff08`zscore`\uff09\u3002`zscore` \u5c06\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u4ee50\u4e3a\u5747\u503c\u30011\u4e3a\u6807\u51c6\u5dee\u7684\u5206\u5e03\u3002\u8fd9\u79cd\u65b9\u6cd5\u7684\u597d\u5904\u662f\uff0c\u5b83\u4e0d\u4ec5\u8003\u8651\u4e86\u5355\u4e2a\u6837\u672c\u5bf9\u7684\u5dee\u5f02\uff0c\u8fd8\u5c06\u5176\u7f6e\u4e8e\u6574\u4e2a\u6279\u6b21\u7684\u4e0a\u4e0b\u6587\u4e2d\u8fdb\u884c\u8bc4\u4f30\u3002\u4e00\u4e2a\u5728\u6279\u6b21\u5185\u201c\u5f02\u5e38\u201d\u5927\u7684\u6210\u672c\u5dee\u5f02\u4f1a\u83b7\u5f97\u66f4\u9ad8\u7684 Z-Score\uff0c\u4ece\u800c\u88ab\u8d4b\u4e88\u66f4\u5927\u7684\u88d5\u5ea6\u548c\u6743\u91cd\uff0c\u8fd9\u6bd4 `rank_gap` \u5bf9\u4e0a\u4e0b\u6587\u4fe1\u606f\u7684\u5229\u7528\u66f4\u5145\u5206\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u975e\u7ebf\u6027\u88d5\u5ea6\u4e0e\u7f29\u653e)**\uff1a\u7236\u4ee3\u8bbe\u8ba1\u4e3b\u8981\u91c7\u7528\u7ebf\u6027\u65b9\u5f0f\uff08`beta * diff`\uff09\u5c06\u6210\u672c\u5dee\u5f02\u6620\u5c04\u5230\u88d5\u5ea6\u3002\u6211\u4eec\u5f15\u5165\u4e86 `softplus` \u51fd\u6570\u6765\u521b\u5efa\u975e\u7ebf\u6027\u7684\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\uff1a`dynamic_margin = beta * softplus(cost_diff_norm)` \u548c `scaling_factor = softplus(cost_diff_norm)`\u3002`softplus` \u7684\u7279\u6027\u662f\uff0c\u5f53\u8f93\u5165\u8f83\u5c0f\u65f6\uff0c\u5176\u884c\u4e3a\u63a5\u8fd1\u7ebf\u6027\uff1b\u5f53\u8f93\u5165\u8f83\u5927\u65f6\uff0c\u5176\u589e\u957f\u7387\u4f1a\u653e\u7f13\u3002\u8fd9\u610f\u5473\u7740\uff1a\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u8f83\u5c0f\u7684\u6837\u672c\u5bf9\uff0c\u88d5\u5ea6\u8981\u6c42\u6e29\u548c\u589e\u957f\uff1b\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u6781\u5927\u7684\u6837\u672c\u5bf9\uff0c\u88d5\u5ea6\u8981\u6c42\u4e0d\u4f1a\u65e0\u9650\u7ebf\u6027\u589e\u957f\uff0c\u4ece\u800c\u9632\u6b62\u4e86\u6781\u7aef\u6210\u672c\u5dee\u5f02\u5bf9\u635f\u5931\u51fd\u6570\u9020\u6210\u4e0d\u6210\u6bd4\u4f8b\u7684\u4e3b\u5bfc\u5f71\u54cd\uff0c\u589e\u5f3a\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u3002\u540c\u65f6\uff0c\u6211\u4eec\u89e3\u8026\u4e86 `beta` \u7684\u4f5c\u7528\uff0c\u4f7f\u5176\u53ea\u63a7\u5236 `dynamic_margin`\uff0c\u800c `scaling_factor` \u76f4\u63a5\u7531\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u51b3\u5b9a\uff0c\u7b80\u5316\u4e86\u8d85\u53c2\u7684\u8bed\u4e49\u3002\n\n\u603b\u4e4b\uff0c`ZScoreNormalizedHybridLoss` \u901a\u8fc7\u5728\u6279\u6b21\u7ea7\u522b\u4e0a\u4f7f\u7528 `zscore` \u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\uff0c\u83b7\u5f97\u4e86\u66f4\u5177\u4e0a\u4e0b\u6587\u611f\u77e5\u80fd\u529b\u7684\u504f\u597d\u4fe1\u53f7\u3002\u7136\u540e\uff0c\u5b83\u901a\u8fc7\u975e\u7ebf\u6027\u7684 `softplus` \u53d8\u6362\uff0c\u5c06\u8be5\u4fe1\u53f7\u8f6c\u5316\u4e3a\u4e00\u4e2a\u65e2\u7a33\u5b9a\u53c8\u654f\u611f\u7684\u52a8\u6001\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u3002\u6700\u540e\uff0c\u5b83\u5c06\u8fd9\u4e9b\u7ec4\u4ef6\u878d\u5165\u5230\u7ecf\u5178\u7684\u201c\u6df7\u5408\u88d5\u5ea6\u201dHinge Loss \u6846\u67b6\u4e2d\uff0c\u5b9e\u73b0\u4e86\u5bf9\u7236\u4ee3\u601d\u60f3\u7684\u6709\u6548\u7ee7\u627f\u548c\u521b\u65b0\u6027\u8026\u5408\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u5177\u6709\u8f83\u5927\u6210\u672c\u5dee\u5f02\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u504f\u597d\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u7f6e\u4fe1\u5ea6\u5dee\u8ddd\u3002"}}, "operators_used": ["zscore", "relu", "softplus"]}}}
{"generation": 9, "index": 2, "ir": {"name": "ZScoreNormalizedHybridMarginLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\uff0c\u53c8\u80fd\u81ea\u9002\u5e94\u5730\u8c03\u6574\u60e9\u7f5a\u529b\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u662f\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u53e6\u4e00\u4e2a\u662f\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff08\u5373\u91cd\u8981\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `softplus(margin - term)` \u8fd9\u79cd\u5e73\u6ed1\u7684Hinge Loss\u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u4e3a\u6a21\u578b\u63d0\u4f9b\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u5b66\u4e60\u76ee\u6807\uff1a\u53ea\u8981\u6a21\u578b\u7684\u504f\u597d\u5f97\u5206\uff08`scaled_logp_diff`\uff09\u8d85\u8fc7\u4e86\u52a8\u6001\u88d5\u5ea6\uff08`dynamic_margin`\uff09\uff0c\u635f\u5931\u5c31\u8d8b\u8fd1\u4e8e\u96f6\uff0c\u4ece\u800c\u8ba9\u6a21\u578b\u4e13\u6ce8\u4e8e\u5b66\u4e60\u90a3\u4e9b\u5c1a\u672a\u6ee1\u8db3\u88d5\u5ea6\u8981\u6c42\u7684\u56f0\u96be\u6837\u672c\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u5bf9\u6210\u672c\u5206\u5e03\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\u3002\u4e0d\u540c\u4e8e\u7236\u4ee3\u4f7f\u7528\u7684 `rank_gap`\uff0c\u6211\u4eec\u4f7f\u7528 `zscore(cost)` \u5bf9\u6279\u6b21\u5185\u6240\u6709\u6837\u672c\u7684\u6210\u672c\u8fdb\u884c\u6807\u51c6\u5316\u3002`zscore` \u5c06\u6210\u672c\u8f6c\u6362\u4e3a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\uff0c\u8fd9\u4f7f\u5f97\u6210\u672c\u5dee\u5f02 `cost_diff = zscore(cost_l) - zscore(cost_w)` \u5bf9\u539f\u59cb\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u66f4\u5173\u6ce8\u5176\u5728\u5f53\u524d\u6279\u6b21\u5185\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u8ba1\u7b97\u5728\u4e0d\u540c\u6279\u6b21\u95f4\u66f4\u52a0\u4e00\u81f4\u548c\u7a33\u5b9a\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u975e\u5bf9\u79f0\u88d5\u5ea6\u8bbe\u8ba1)**\uff1a\u5728\u7236\u4ee3\u7684\u8bbe\u8ba1\u4e2d\uff0c`dynamic_margin` \u548c `scaling_factor` \u901a\u5e38\u88ab\u8bbe\u8ba1\u4e3a\u5bf9\u79f0\u7684\uff0c\u4f8b\u5982\u90fd\u7b49\u4e8e `beta * cost_diff`\u3002\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u975e\u5bf9\u79f0\u8bbe\u8ba1\uff0c\u5c06\u4e8c\u8005\u89e3\u8026\u3002\u6211\u4eec\u5c06\u88d5\u5ea6 `dynamic_margin` \u8bbe\u8ba1\u4e3a `beta * cost_diff`\uff0c\u8fd9\u662f\u4e00\u4e2a\u7ebf\u6027\u7684\u3001\u52a8\u6001\u7684\u76ee\u6807\u3002\u800c `scaling_factor` \u5219\u901a\u8fc7 `softplus(cost_diff)` \u8ba1\u7b97\u3002`softplus` \u7684\u975e\u7ebf\u6027\u7279\u6027\u4f7f\u5f97\u5f53\u6210\u672c\u5dee\u5f02\u8f83\u5c0f\u65f6\uff0c\u7f29\u653e\u56e0\u5b50\u589e\u957f\u7f13\u6162\uff1b\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff0c\u7f29\u653e\u56e0\u5b50\u8fd1\u4f3c\u7ebf\u6027\u589e\u957f\u3002\u8fd9\u79cd\u8bbe\u8ba1\u610f\u5473\u7740\uff0c\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u6781\u5c0f\u7684\u201c\u6a21\u7cca\u201d\u6837\u672c\u5bf9\uff0c\u6211\u4eec\u4e0d\u5e0c\u671b\u8fc7\u5ea6\u653e\u5927\u5176\u6982\u7387\u5dee\u5f02\uff0c\u907f\u514d\u566a\u58f0\u5e72\u6270\uff1b\u800c\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u663e\u8457\u7684\u201c\u6e05\u6670\u201d\u6837\u672c\u5bf9\uff0c\u5219\u7ed9\u4e88\u66f4\u5927\u7684\u6743\u91cd\u3002\u8fd9\u79cd\u975e\u5bf9\u79f0\u8bbe\u8ba1\u5728\u9c81\u68d2\u6027\u548c\u654f\u611f\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u66f4\u597d\u7684\u5e73\u8861\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreNormalizedHybridMarginLoss` \u901a\u8fc7Z-Score\u5f52\u4e00\u5316\u83b7\u5f97\u4e86\u5bf9\u6210\u672c\u5c3a\u5ea6\u4e0d\u654f\u611f\u7684\u5dee\u5f02\u4fe1\u53f7\uff0c\u5e76\u5229\u7528\u975e\u5bf9\u79f0\u7684\u6df7\u5408\u88d5\u5ea6\u8bbe\u8ba1\uff0c\u7cbe\u7ec6\u5730\u8c03\u6574\u4e86\u5bf9\u4e0d\u540c\u96be\u5ea6\u6837\u672c\u5bf9\u7684\u5b66\u4e60\u5f3a\u5ea6\u3002\u6700\u7ec8\uff0c\u5b83\u5c06\u8fd9\u4e9b\u4fe1\u53f7\u6574\u5408\u8fdb\u4e00\u4e2a\u5e73\u6ed1\u7684Hinge Loss\u6846\u67b6\u4e2d\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u9c81\u68d2\u3001\u9ad8\u6548\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u504f\u597d\u5b66\u4e60\u76ee\u6807\u3002", "pseudocode": "def ZScoreNormalizedHybridMarginLoss(costs, logps, beta):\n    # costs: [cost_a, cost_b, ...], logps: [logp_a, logp_b, ...]\n    # \u5047\u8bbe cost_a < cost_b \u662f\u504f\u597d\u5bf9\n    cost_w, cost_l = cost_a, cost_b\n    logp_w, logp_l = logp_a, logp_b\n\n    # 1. [\u65b0\u8026\u5408\u70b91] \u5bf9\u6279\u6b21\u5185\u7684\u6210\u672c\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\n    #    \u8fd9\u4f7f\u5f97\u6210\u672c\u5dee\u5f02\u7684\u8ba1\u7b97\u5bf9\u539f\u59cb\u6210\u672c\u7684\u5c3a\u5ea6\u548c\u504f\u79fb\u5177\u6709\u9c81\u68d2\u6027\u3002\n    zscore_costs = zscore(costs) # \u5bf9\u6574\u4e2a\u6279\u6b21\u7684costs\u8fdb\u884c\u5f52\u4e00\u5316\n    zscore_cost_w = zscore_costs[index_of_w]\n    zscore_cost_l = zscore_costs[index_of_l]\n    \n    # 2. \u8ba1\u7b97\u5f52\u4e00\u5316\u540e\u7684\u6210\u672c\u5dee\u5f02\n    #    zscore_cost_l \u901a\u5e38\u4f1a\u5927\u4e8e zscore_cost_w\uff0c\u6240\u4ee5\u5dee\u503c\u4e3a\u6b63\n    cost_diff = zscore_cost_l - zscore_cost_w\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee31] & [\u65b0\u8026\u5408\u70b92] \u8bbe\u8ba1\u975e\u5bf9\u79f0\u7684\u6df7\u5408\u88d5\u5ea6\n    #    \u7ee7\u627f\u4e86\u6df7\u5408\u88d5\u5ea6\u601d\u60f3\uff0c\u4f46\u5c06\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u89e3\u8026\u3002\n    #    a) \u52a8\u6001\u88d5\u5ea6\uff1a\u4e0e\u6210\u672c\u5dee\u5f02\u7ebf\u6027\u76f8\u5173\uff0c\u8bbe\u5b9a\u4e00\u4e2a\u6e05\u6670\u7684\u76ee\u6807\u3002\n    dynamic_margin = beta * cost_diff\n    \n    #    b) \u7f29\u653e\u56e0\u5b50\uff1a\u4f7f\u7528softplus\uff0c\u5bf9\u5fae\u5c0f\u6210\u672c\u5dee\u5f02\u4e0d\u654f\u611f\uff0c\u5bf9\u5927\u5dee\u5f02\u5219\u653e\u5927\u3002\n    scaling_factor = softplus(cost_diff)\n\n    # 4. \u8ba1\u7b97\u5bf9\u6570\u6982\u7387\u5dee\n    #    \u8fd9\u662f\u6a21\u578b\u504f\u597d\u7684\u76f4\u63a5\u4f53\u73b0\uff0c\u671f\u671b logp_w > logp_l\n    logp_diff = logp_w - logp_l\n    \n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u52a0\u6743\u7684\u5bf9\u6570\u6982\u7387\u5dee\n    #    \u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u5bf9\u6a21\u578b\u504f\u597d\u5f97\u5206\u7684\u7f29\u653e\u4e5f\u8d8a\u5927\u3002\n    scaled_logp_diff = scaling_factor * logp_diff\n    \n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u5e73\u6ed1\u7684Hinge Loss\n    #    \u5f53\u6a21\u578b\u7684\u52a0\u6743\u504f\u597d\u5f97\u5206(scaled_logp_diff)\u672a\u80fd\u8d85\u8fc7\u52a8\u6001\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u635f\u5931\u3002\n    #    softplus(x) = log(1 + exp(x)) \u662f relu(x) \u7684\u5e73\u6ed1\u8fd1\u4f3c\u3002\n    loss = softplus(dynamic_margin - scaled_logp_diff)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5dee\u5f02\u66f4\u654f\u611f\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}}, "operators_used": ["zscore", "softplus"], "implementation_hint": {"expects": ["A batch of preference pairs. For each pair, you need `cost_w` (cost of the winner), `cost_l` (cost of the loser), `logp_w` (log-probability of the winner), `logp_l` (log-probability of the loser), and the costs of all samples in the batch to perform z-scoring."], "returns": "A single scalar value representing the mean loss for the batch."}}, "fitness": {"hf_like_score": 4.031317949295044, "validation_objective": 4.031317949295044, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.013678550720215}, "train_score_mean": 4.246005803346634, "train_loss_mean": 0.6928283348679543, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreNormalizedHybridMarginLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u6570\u503c\u7a33\u5b9a\uff0c\u53c8\u80fd\u81ea\u9002\u5e94\u5730\u8c03\u6574\u60e9\u7f5a\u529b\u5ea6\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u662f\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u53e6\u4e00\u4e2a\u662f\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff08\u5373\u91cd\u8981\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `softplus(margin - term)` \u8fd9\u79cd\u5e73\u6ed1\u7684Hinge Loss\u7ed3\u6784\u3002\u8fd9\u79cd\u7ed3\u6784\u4e3a\u6a21\u578b\u63d0\u4f9b\u4e86\u4e00\u4e2a\u660e\u786e\u7684\u5b66\u4e60\u76ee\u6807\uff1a\u53ea\u8981\u6a21\u578b\u7684\u504f\u597d\u5f97\u5206\uff08`scaled_logp_diff`\uff09\u8d85\u8fc7\u4e86\u52a8\u6001\u88d5\u5ea6\uff08`dynamic_margin`\uff09\uff0c\u635f\u5931\u5c31\u8d8b\u8fd1\u4e8e\u96f6\uff0c\u4ece\u800c\u8ba9\u6a21\u578b\u4e13\u6ce8\u4e8e\u5b66\u4e60\u90a3\u4e9b\u5c1a\u672a\u6ee1\u8db3\u88d5\u5ea6\u8981\u6c42\u7684\u56f0\u96be\u6837\u672c\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u5bf9\u6210\u672c\u5206\u5e03\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u5f0f\u3002\u4e0d\u540c\u4e8e\u7236\u4ee3\u4f7f\u7528\u7684 `rank_gap`\uff0c\u6211\u4eec\u4f7f\u7528 `zscore(cost)` \u5bf9\u6279\u6b21\u5185\u6240\u6709\u6837\u672c\u7684\u6210\u672c\u8fdb\u884c\u6807\u51c6\u5316\u3002`zscore` \u5c06\u6210\u672c\u8f6c\u6362\u4e3a\u5747\u503c\u4e3a0\u3001\u6807\u51c6\u5dee\u4e3a1\u7684\u5206\u5e03\uff0c\u8fd9\u4f7f\u5f97\u6210\u672c\u5dee\u5f02 `cost_diff = zscore(cost_l) - zscore(cost_w)` \u5bf9\u539f\u59cb\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u548c\u504f\u79fb\u4e0d\u654f\u611f\uff0c\u66f4\u5173\u6ce8\u5176\u5728\u5f53\u524d\u6279\u6b21\u5185\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u7684\u8ba1\u7b97\u5728\u4e0d\u540c\u6279\u6b21\u95f4\u66f4\u52a0\u4e00\u81f4\u548c\u7a33\u5b9a\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u975e\u5bf9\u79f0\u88d5\u5ea6\u8bbe\u8ba1)**\uff1a\u5728\u7236\u4ee3\u7684\u8bbe\u8ba1\u4e2d\uff0c`dynamic_margin` \u548c `scaling_factor` \u901a\u5e38\u88ab\u8bbe\u8ba1\u4e3a\u5bf9\u79f0\u7684\uff0c\u4f8b\u5982\u90fd\u7b49\u4e8e `beta * cost_diff`\u3002\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u79cd\u975e\u5bf9\u79f0\u8bbe\u8ba1\uff0c\u5c06\u4e8c\u8005\u89e3\u8026\u3002\u6211\u4eec\u5c06\u88d5\u5ea6 `dynamic_margin` \u8bbe\u8ba1\u4e3a `beta * cost_diff`\uff0c\u8fd9\u662f\u4e00\u4e2a\u7ebf\u6027\u7684\u3001\u52a8\u6001\u7684\u76ee\u6807\u3002\u800c `scaling_factor` \u5219\u901a\u8fc7 `softplus(cost_diff)` \u8ba1\u7b97\u3002`softplus` \u7684\u975e\u7ebf\u6027\u7279\u6027\u4f7f\u5f97\u5f53\u6210\u672c\u5dee\u5f02\u8f83\u5c0f\u65f6\uff0c\u7f29\u653e\u56e0\u5b50\u589e\u957f\u7f13\u6162\uff1b\u5f53\u6210\u672c\u5dee\u5f02\u5927\u65f6\uff0c\u7f29\u653e\u56e0\u5b50\u8fd1\u4f3c\u7ebf\u6027\u589e\u957f\u3002\u8fd9\u79cd\u8bbe\u8ba1\u610f\u5473\u7740\uff0c\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u6781\u5c0f\u7684\u201c\u6a21\u7cca\u201d\u6837\u672c\u5bf9\uff0c\u6211\u4eec\u4e0d\u5e0c\u671b\u8fc7\u5ea6\u653e\u5927\u5176\u6982\u7387\u5dee\u5f02\uff0c\u907f\u514d\u566a\u58f0\u5e72\u6270\uff1b\u800c\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u663e\u8457\u7684\u201c\u6e05\u6670\u201d\u6837\u672c\u5bf9\uff0c\u5219\u7ed9\u4e88\u66f4\u5927\u7684\u6743\u91cd\u3002\u8fd9\u79cd\u975e\u5bf9\u79f0\u8bbe\u8ba1\u5728\u9c81\u68d2\u6027\u548c\u654f\u611f\u6027\u4e4b\u95f4\u53d6\u5f97\u4e86\u66f4\u597d\u7684\u5e73\u8861\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreNormalizedHybridMarginLoss` \u901a\u8fc7Z-Score\u5f52\u4e00\u5316\u83b7\u5f97\u4e86\u5bf9\u6210\u672c\u5c3a\u5ea6\u4e0d\u654f\u611f\u7684\u5dee\u5f02\u4fe1\u53f7\uff0c\u5e76\u5229\u7528\u975e\u5bf9\u79f0\u7684\u6df7\u5408\u88d5\u5ea6\u8bbe\u8ba1\uff0c\u7cbe\u7ec6\u5730\u8c03\u6574\u4e86\u5bf9\u4e0d\u540c\u96be\u5ea6\u6837\u672c\u5bf9\u7684\u5b66\u4e60\u5f3a\u5ea6\u3002\u6700\u7ec8\uff0c\u5b83\u5c06\u8fd9\u4e9b\u4fe1\u53f7\u6574\u5408\u8fdb\u4e00\u4e2a\u5e73\u6ed1\u7684Hinge Loss\u6846\u67b6\u4e2d\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u9c81\u68d2\u3001\u9ad8\u6548\u4e14\u6570\u503c\u7a33\u5b9a\u7684\u504f\u597d\u5b66\u4e60\u76ee\u6807\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u5b83\u63a7\u5236\u4e86\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u88ab\u653e\u5927\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5dee\u5f02\u66f4\u654f\u611f\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u504f\u597d\u5dee\u8ddd\u3002"}}, "operators_used": ["zscore", "softplus"]}}}
{"generation": 9, "index": 4, "ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u7684\u4f18\u70b9\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u9c81\u68d2\u53c8\u5bf9\u504f\u597d\u4fe1\u53f7\u654f\u611f\u7684\u65b0\u578b\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\u548c\u8026\u5408\u673a\u5236\uff0c\u4f18\u5316\u4e86\u6a21\u578b\u5bf9\u4e0d\u540c\u6210\u672c\u5206\u5e03\u7684\u9002\u5e94\u80fd\u529b\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u662f\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u53e6\u4e00\u4e2a\u662f\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u91cd\u8981\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `softplus(margin_gap)` \u8fd9\u79cd\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u7ed3\u6784\u4f5c\u4e3a\u60e9\u7f5a\u51fd\u6570\u3002\u5f53\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\uff08\u7ecf\u8fc7\u7f29\u653e\u7684 `scaled_logp_diff`\uff09\u4f4e\u4e8e\u76ee\u6807\u88d5\u5ea6 `dynamic_margin` \u65f6\uff0c`softplus` \u4f1a\u4ea7\u751f\u4e00\u4e2a\u975e\u96f6\u7684\u3001\u5e73\u6ed1\u589e\u957f\u7684\u60e9\u7f5a\uff0c\u8fd9\u6bd4 `logsigmoid` \u7684\u60e9\u7f5a\u5728\u6570\u503c\u4e0a\u66f4\u76f4\u63a5\uff0c\u4e14\u5bf9\u4e8e\u8f83\u5927\u7684\u8d1f\u8f93\u5165\uff08\u5373\u6a21\u578b\u8868\u73b0\u5f88\u5dee\u65f6\uff09\u68af\u5ea6\u4e0d\u4f1a\u6d88\u5931\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u5168\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\u6765\u5904\u7406\u6210\u672c\u5dee\u5f02\u3002\u7236\u4ee3\u90fd\u4f7f\u7528\u4e86 `rank_gap`\uff0c\u5b83\u5bf9\u6392\u5e8f\u654f\u611f\u4f46\u5ffd\u7565\u4e86\u6570\u503c\u7684\u5c3a\u5ea6\u3002\u4e3a\u4e86\u4f7f\u635f\u5931\u5bf9\u6210\u672c\u7684\u5206\u5e03\u7279\u5f81\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u66f4\u654f\u611f\uff0c\u6211\u4eec\u91c7\u7528\u4e86 `zscore(cost_l) - zscore(cost_w)`\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u8003\u8651\u4e86\u6392\u5e8f\uff0c\u8fd8\u8003\u8651\u4e86\u6bcf\u4e2a\u6210\u672c\u503c\u5728\u5176\u6240\u5728\u6279\u6b21\uff08batch\uff09\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u5982\u679c\u4e00\u4e2a\u201cwinner\u201d\u7684\u6210\u672c\u8fdc\u4f4e\u4e8e\u6279\u6b21\u5747\u503c\uff0c\u800c\u201closer\u201d\u7684\u6210\u672c\u8fdc\u9ad8\u4e8e\u6279\u6b21\u5747\u503c\uff0c\u5b83\u4eec\u7684Z-Score\u5dee\u5f02\u4f1a\u975e\u5e38\u5927\uff0c\u4ece\u800c\u4ea7\u751f\u4e00\u4e2a\u975e\u5e38\u5f3a\u7684\u5b66\u4e60\u4fe1\u53f7\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u80fd\u591f\u81ea\u9002\u5e94\u4e8e\u5f53\u524d\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\uff0c\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u53cc\u5c42\u975e\u7ebf\u6027\u7f29\u653e)**\uff1a\u4e3a\u4e86\u66f4\u7cbe\u7ec6\u5730\u63a7\u5236\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\uff0c\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee3\u90a3\u6837\u76f4\u63a5\u4f7f\u7528\u7ebf\u6027\u7f29\u653e (`beta * diff`)\u3002\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u53cc\u5c42\u975e\u7ebf\u6027\u53d8\u6362\uff1a`softplus` \u540e\u9762\u8ddf\u7740 `tanh`\u3002\u9996\u5148\uff0c`softplus(z_score_diff)` \u786e\u4fdd\u57fa\u7840\u4fe1\u53f7\u975e\u8d1f\u4e14\u5e73\u6ed1\u3002\u7136\u540e\uff0c`tanh(...)` \u5c06\u8fd9\u4e2a\u4fe1\u53f7\u538b\u7f29\u5230 `[0, 1]` \u533a\u95f4\u3002\u8fd9\u4e2a `[0, 1]` \u7684\u503c\u518d\u4e58\u4ee5\u8d85\u53c2\u6570 `beta`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7684\u597d\u5904\u662f\uff1a`beta` \u6210\u4e3a\u4e86\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u660e\u786e\u201c\u4e0a\u9650\u201d\uff0c\u4f7f\u5f97\u8d85\u53c2\u6570\u7684\u8c03\u6574\u66f4\u76f4\u89c2\u3001\u66f4\u7a33\u5b9a\u3002\u540c\u65f6\uff0c`tanh` \u7684\u9971\u548c\u7279\u6027\u610f\u5473\u7740\uff0c\u5f53Z-Score\u5dee\u5f02\u6781\u5927\u65f6\uff0c\u88d5\u5ea6\u4e0d\u4f1a\u65e0\u9650\u589e\u957f\uff0c\u4ece\u800c\u9632\u6b62\u4e86\u6781\u7aef\u6837\u672c\u5bf9\u68af\u5ea6\u7684\u8fc7\u5ea6\u4e3b\u5bfc\u3002\n\n\u603b\u4e4b\uff0c`ZScoreNormalizedHybridLoss` \u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u6df7\u5408\u88d5\u5ea6\u601d\u60f3\u548c\u5e73\u6ed1\u94f0\u94fe\u635f\u5931\u7ed3\u6784\uff0c\u4f46\u901a\u8fc7\u5f15\u5165\u65b0\u9896\u7684Z-Score\u5f52\u4e00\u5316\u548c\u53cc\u5c42\u975e\u7ebf\u6027\u7f29\u653e\u673a\u5236\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u80fd\u81ea\u9002\u5e94\u6279\u6b21\u6570\u636e\u5206\u5e03\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u8d85\u53c2\u6570\u53ef\u89e3\u91ca\u6027\u5f3a\u7684\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u3002", "pseudocode": "def ZScoreNormalizedHybridLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u57fa\u4e8eZ-Score\u7684\u6210\u672c\u5dee\u5f02\n    #    zscore() \u5728\u4e00\u4e2a\u6279\u6b21\u7684\u6570\u636e\u4e0a\u8ba1\u7b97\uff0c\u589e\u5f3a\u5bf9\u5206\u5e03\u7684\u9002\u5e94\u6027\u3002\n    #    \u8fd9\u53d6\u4ee3\u4e86\u7236\u4ee3\u4e2d\u4f7f\u7528\u7684 rank_gap\u3002\n    z_score_diff = zscore(cost_l) - zscore(cost_w)\n\n    # 3. [\u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u975e\u7ebf\u6027\u7f29\u653e\u7684\u52a8\u6001\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\n    #    \u7ee7\u627f\u81ea\u7236\u4ee31\u7684\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u601d\u60f3\uff0c\u4f46\u91c7\u7528\u65b0\u7684\u8026\u5408\u65b9\u5f0f\u3002\n    #    softplus\u786e\u4fdd\u8f93\u5165\u4e3a\u6b63\uff0ctanh\u538b\u7f29\u5230[0,1]\uff0cbeta\u8bbe\u5b9a\u4e0a\u9650\u3002\n    #    \u8fd9\u79cd\u8bbe\u8ba1\u6bd4\u76f4\u63a5\u7ebf\u6027\u7f29\u653e\u66f4\u7a33\u5b9a\u3002\n    base_factor = tanh(softplus(z_score_diff))\n    dynamic_margin = beta * base_factor\n    scaling_factor = beta * base_factor\n\n    # 4. \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u5bf9\u6570\u6982\u7387\u7684\u5dee\u5f02\n    #    \u4e0e\u7236\u4ee3\u4e0d\u540c\uff0c\u6211\u4eec\u4e0d\u4f7f\u7528tanh\u538b\u7f29\uff0c\u56e0\u4e3a\u540e\u7eed\u7684softplus\u7ed3\u6784\u5bf9\u5927\u7684\u8f93\u5165\u4e0d\u654f\u611f\u3002\n    #    \u76f4\u63a5\u4f7f\u7528\u539f\u59cb\u5dee\u5f02\uff0c\u8ba9\u4fe1\u53f7\u66f4\u76f4\u63a5\u3002\n    logp_diff = logp_w - logp_l\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u6982\u7387\u5dee\u5f02\u9879\n    #    \u8fd9\u662f\u201c\u6df7\u5408\u88d5\u5ea6\u201d\u601d\u60f3\u7684\u4f53\u73b0\u3002\n    scaled_logp_diff = scaling_factor * logp_diff\n\n    # 6. \u8ba1\u7b97\u6838\u5fc3\u7684\u88d5\u5ea6\u5dee\u8ddd (margin gap)\n    #    \u8fd9\u662f\u540e\u7eedHinge-like\u635f\u5931\u7684\u6838\u5fc3\u8f93\u5165\u3002\n    margin_gap = dynamic_margin - scaled_logp_diff\n\n    # 7. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u6700\u7ec8\u7684\u5e73\u6ed1\u94f0\u94fe\u635f\u5931\n    #    \u5f53\u6a21\u578b\u7684\u8868\u73b0(scaled_logp_diff)\u4f4e\u4e8e\u76ee\u6807\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\n    #    \u5373 margin_gap > 0 \u65f6\uff0c\u4ea7\u751f\u4e00\u4e2a\u5e73\u6ed1\u7684\u60e9\u7f5a\u3002\n    loss = softplus(margin_gap)\n\n    return loss", "hyperparams": {"beta": {"value": 2.0, "description": "\u52a8\u6001\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u4e0a\u9650\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8eZ-Score\u6210\u672c\u5dee\u5f02\u7684\u4fe1\u53f7\u6240\u80fd\u8fbe\u5230\u7684\u6700\u5927\u5f3a\u5ea6\u3002\u8f83\u9ad8\u7684beta\u503c\u610f\u5473\u7740\u5373\u4f7f\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u4e0d\u5927\u7684\u6837\u672c\u5bf9\uff0c\u4e5f\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u663e\u8457\u7684\u504f\u597d\u5dee\u5f02\u3002"}}, "operators_used": ["zscore", "softplus", "tanh"], "implementation_hint": {"expects": ["Tensors: cost_a, cost_b, logp_a, logp_b, all of shape (N,). The `zscore` operator is expected to compute statistics over the batch dimension of its inputs."], "returns": "A scalar tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.044223785400391, "validation_objective": 4.044223785400391, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.9841102361679077}, "train_score_mean": 4.2337209060788155, "train_loss_mean": 0.6928269919008017, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u7684\u4f18\u70b9\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u9c81\u68d2\u53c8\u5bf9\u504f\u597d\u4fe1\u53f7\u654f\u611f\u7684\u65b0\u578b\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\u548c\u8026\u5408\u673a\u5236\uff0c\u4f18\u5316\u4e86\u6a21\u578b\u5bf9\u4e0d\u540c\u6210\u672c\u5206\u5e03\u7684\u9002\u5e94\u80fd\u529b\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u662f\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `dynamic_margin`\uff0c\u53e6\u4e00\u4e2a\u662f\u7528\u4e8e\u52a0\u6743\u6982\u7387\u5dee\u5f02\u7684 `scaling_factor`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u91cd\u8981\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `softplus(margin_gap)` \u8fd9\u79cd\u5e73\u6ed1\u7684\u94f0\u94fe\u635f\u5931\uff08Hinge Loss\uff09\u7ed3\u6784\u4f5c\u4e3a\u60e9\u7f5a\u51fd\u6570\u3002\u5f53\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\uff08\u7ecf\u8fc7\u7f29\u653e\u7684 `scaled_logp_diff`\uff09\u4f4e\u4e8e\u76ee\u6807\u88d5\u5ea6 `dynamic_margin` \u65f6\uff0c`softplus` \u4f1a\u4ea7\u751f\u4e00\u4e2a\u975e\u96f6\u7684\u3001\u5e73\u6ed1\u589e\u957f\u7684\u60e9\u7f5a\uff0c\u8fd9\u6bd4 `logsigmoid` \u7684\u60e9\u7f5a\u5728\u6570\u503c\u4e0a\u66f4\u76f4\u63a5\uff0c\u4e14\u5bf9\u4e8e\u8f83\u5927\u7684\u8d1f\u8f93\u5165\uff08\u5373\u6a21\u578b\u8868\u73b0\u5f88\u5dee\u65f6\uff09\u68af\u5ea6\u4e0d\u4f1a\u6d88\u5931\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u5168\u65b0\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\u6765\u5904\u7406\u6210\u672c\u5dee\u5f02\u3002\u7236\u4ee3\u90fd\u4f7f\u7528\u4e86 `rank_gap`\uff0c\u5b83\u5bf9\u6392\u5e8f\u654f\u611f\u4f46\u5ffd\u7565\u4e86\u6570\u503c\u7684\u5c3a\u5ea6\u3002\u4e3a\u4e86\u4f7f\u635f\u5931\u5bf9\u6210\u672c\u7684\u5206\u5e03\u7279\u5f81\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u66f4\u654f\u611f\uff0c\u6211\u4eec\u91c7\u7528\u4e86 `zscore(cost_l) - zscore(cost_w)`\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u8003\u8651\u4e86\u6392\u5e8f\uff0c\u8fd8\u8003\u8651\u4e86\u6bcf\u4e2a\u6210\u672c\u503c\u5728\u5176\u6240\u5728\u6279\u6b21\uff08batch\uff09\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u5982\u679c\u4e00\u4e2a\u201cwinner\u201d\u7684\u6210\u672c\u8fdc\u4f4e\u4e8e\u6279\u6b21\u5747\u503c\uff0c\u800c\u201closer\u201d\u7684\u6210\u672c\u8fdc\u9ad8\u4e8e\u6279\u6b21\u5747\u503c\uff0c\u5b83\u4eec\u7684Z-Score\u5dee\u5f02\u4f1a\u975e\u5e38\u5927\uff0c\u4ece\u800c\u4ea7\u751f\u4e00\u4e2a\u975e\u5e38\u5f3a\u7684\u5b66\u4e60\u4fe1\u53f7\u3002\u8fd9\u4f7f\u5f97\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u80fd\u591f\u81ea\u9002\u5e94\u4e8e\u5f53\u524d\u6279\u6b21\u7684\u6210\u672c\u5206\u5e03\uff0c\u589e\u5f3a\u4e86\u9c81\u68d2\u6027\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (\u53cc\u5c42\u975e\u7ebf\u6027\u7f29\u653e)**\uff1a\u4e3a\u4e86\u66f4\u7cbe\u7ec6\u5730\u63a7\u5236\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\uff0c\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee3\u90a3\u6837\u76f4\u63a5\u4f7f\u7528\u7ebf\u6027\u7f29\u653e (`beta * diff`)\u3002\u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u53cc\u5c42\u975e\u7ebf\u6027\u53d8\u6362\uff1a`softplus` \u540e\u9762\u8ddf\u7740 `tanh`\u3002\u9996\u5148\uff0c`softplus(z_score_diff)` \u786e\u4fdd\u57fa\u7840\u4fe1\u53f7\u975e\u8d1f\u4e14\u5e73\u6ed1\u3002\u7136\u540e\uff0c`tanh(...)` \u5c06\u8fd9\u4e2a\u4fe1\u53f7\u538b\u7f29\u5230 `[0, 1]` \u533a\u95f4\u3002\u8fd9\u4e2a `[0, 1]` \u7684\u503c\u518d\u4e58\u4ee5\u8d85\u53c2\u6570 `beta`\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7684\u597d\u5904\u662f\uff1a`beta` \u6210\u4e3a\u4e86\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u660e\u786e\u201c\u4e0a\u9650\u201d\uff0c\u4f7f\u5f97\u8d85\u53c2\u6570\u7684\u8c03\u6574\u66f4\u76f4\u89c2\u3001\u66f4\u7a33\u5b9a\u3002\u540c\u65f6\uff0c`tanh` \u7684\u9971\u548c\u7279\u6027\u610f\u5473\u7740\uff0c\u5f53Z-Score\u5dee\u5f02\u6781\u5927\u65f6\uff0c\u88d5\u5ea6\u4e0d\u4f1a\u65e0\u9650\u589e\u957f\uff0c\u4ece\u800c\u9632\u6b62\u4e86\u6781\u7aef\u6837\u672c\u5bf9\u68af\u5ea6\u7684\u8fc7\u5ea6\u4e3b\u5bfc\u3002\n\n\u603b\u4e4b\uff0c`ZScoreNormalizedHybridLoss` \u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u6df7\u5408\u88d5\u5ea6\u601d\u60f3\u548c\u5e73\u6ed1\u94f0\u94fe\u635f\u5931\u7ed3\u6784\uff0c\u4f46\u901a\u8fc7\u5f15\u5165\u65b0\u9896\u7684Z-Score\u5f52\u4e00\u5316\u548c\u53cc\u5c42\u975e\u7ebf\u6027\u7f29\u653e\u673a\u5236\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u80fd\u81ea\u9002\u5e94\u6279\u6b21\u6570\u636e\u5206\u5e03\u3001\u6570\u503c\u7a33\u5b9a\u4e14\u8d85\u53c2\u6570\u53ef\u89e3\u91ca\u6027\u5f3a\u7684\u5b50\u4ee3\u635f\u5931\u51fd\u6570\u3002", "hyperparams": {"beta": {"value": 2.0, "description": "\u52a8\u6001\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u4e0a\u9650\u3002\u5b83\u63a7\u5236\u4e86\u57fa\u4e8eZ-Score\u6210\u672c\u5dee\u5f02\u7684\u4fe1\u53f7\u6240\u80fd\u8fbe\u5230\u7684\u6700\u5927\u5f3a\u5ea6\u3002\u8f83\u9ad8\u7684beta\u503c\u610f\u5473\u7740\u5373\u4f7f\u5bf9\u4e8e\u6210\u672c\u5dee\u5f02\u4e0d\u5927\u7684\u6837\u672c\u5bf9\uff0c\u4e5f\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u663e\u8457\u7684\u504f\u597d\u5dee\u5f02\u3002"}}, "operators_used": ["zscore", "softplus", "tanh"]}}}
{"generation": 9, "index": 6, "ir": {"name": "ZScoreClippedDynamicMarginLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u6280\u5de7\uff0c\u5bf9\u7236\u4ee3\u7684\u6838\u5fc3\u601d\u60f3\u8fdb\u884c\u4e86\u65b0\u7684\u8026\u5408\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - term)` \u7ed3\u6784\uff0c\u8fd9\u662f\u4e00\u79cd\u5e73\u6ed1\u7684Hinge Loss\u5f62\u5f0f\u3002\u5f53\u6a21\u578b\u7684\u504f\u597d\u5f3a\u5ea6\uff08`term`\uff09\u4f4e\u4e8e\u52a8\u6001\u8bbe\u5b9a\u7684\u76ee\u6807\u88d5\u5ea6\uff08`margin`\uff09\u65f6\uff0c\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u79cd\u7ed3\u6784\u7b80\u5355\u6709\u6548\uff0c\u6613\u4e8e\u89e3\u91ca\u3002\n2.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u60e9\u7f5a\u6743\u91cd\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u5927\u5c0f\u4e0d\u4ec5\u53d6\u51b3\u4e8e\u6a21\u578b\u504f\u597d\u4e0e\u76ee\u6807\u88d5\u5ea6\u7684\u5dee\u8ddd\uff0c\u8fd8\u88ab\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u6743\u91cd\u9879 `adaptive_weight` \u6240\u8c03\u5236\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u80fd\u591f\u5bf9\u533a\u5206\u5ea6\u66f4\u660e\u663e\u7684\u6837\u672c\u5bf9\uff08\u5373\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u5927\u7684\u5b66\u4e60\u538b\u529b\uff0c\u4ece\u800c\u66f4\u667a\u80fd\u5730\u5206\u914d\u68af\u5ea6\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u4e3a\u4e86\u589e\u5f3a\u5bf9\u6210\u672c\u5206\u5e03\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore(cost_diff)`\u3002`zscore`\u901a\u8fc7\u51cf\u53bb\u5747\u503c\u5e76\u9664\u4ee5\u6807\u51c6\u5dee\uff0c\u5c06\u539f\u59cb\u7684\u6210\u672c\u5dee\u5f02 `(cost_l - cost_w)` \u8f6c\u6362\u5230\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u7a7a\u95f4\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c`dynamic_margin` \u548c `adaptive_weight` \u7684\u8ba1\u7b97\u4e0d\u518d\u53d7\u6210\u672c\u7edd\u5bf9\u503c\u5927\u5c0f\u7684\u5f71\u54cd\uff0c\u800c\u662f\u53d6\u51b3\u4e8e\u8be5\u6210\u672c\u5dee\u5f02\u5728\u5176\u6240\u5728\u6279\u6b21\uff08batch\uff09\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u8fd9\u4f7f\u5f97\u8d85\u53c2\u6570 `beta` \u548c `gamma` \u7684\u9009\u62e9\u66f4\u52a0\u901a\u7528\uff0c\u4e0d\u6613\u53d7\u5230\u4e0d\u540c\u4efb\u52a1\u6216\u4e0d\u540c\u6279\u6b21\u6210\u672c\u5c3a\u5ea6\u5267\u70c8\u53d8\u5316\u7684\u5f71\u54cd\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Clipped LogP\u5dee\u5f02)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `tanh` \u6765\u538b\u7f29\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff0c\u800c\u662f\u91c7\u7528\u4e86 `clamp(logp_w - logp_l, min=-clip_value, max=clip_value)`\u3002`clamp` \u7b97\u5b50\u521b\u5efa\u4e86\u4e00\u4e2a\u786c\u8fb9\u754c\uff0c\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u6781\u7aef\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u5bfc\u81f4\u7684\u68af\u5ea6\u6d88\u5931\uff08\u5728 `tanh` \u7684\u9971\u548c\u533a\uff09\u6216\u6f5c\u5728\u7684\u6570\u503c\u4e0d\u7a33\u5b9a\u95ee\u9898\u3002\u4e0e `tanh` \u76f8\u6bd4\uff0c`clamp` \u5728 `[-clip_value, clip_value]` \u533a\u95f4\u5185\u4fdd\u6301\u4e86\u7ebf\u6027\u7684\u68af\u5ea6\u6d41\uff0c\u8fd9\u53ef\u80fd\u6709\u52a9\u4e8e\u5728\u6a21\u578b\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\u65f6\u8fdb\u884c\u66f4\u6709\u6548\u7684\u5b66\u4e60\u3002\u540c\u65f6\uff0c\u5b83\u4e5f\u907f\u514d\u4e86\u6781\u7aef\u6837\u672c\u5bf9\uff08\u6a21\u578b\u5bf9\u5176\u504f\u597d\u5224\u65ad\u6781\u5ea6\u81ea\u4fe1\u6216\u9519\u8bef\uff09\u4e0d\u6210\u6bd4\u4f8b\u5730\u4e3b\u5bfc\u6574\u4e2a\u6279\u6b21\u7684\u68af\u5ea6\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreClippedDynamicMarginLoss` \u7ee7\u627f\u4e86\u7236\u4ee3\u4e2d\u6709\u6548\u7684Hinge Loss\u7ed3\u6784\u548c\u81ea\u9002\u5e94\u60e9\u7f5a\u601d\u60f3\uff0c\u5e76\u901a\u8fc7\u5f15\u5165Z-Score\u5f52\u4e00\u5316\u548cClipped LogP\u5dee\u5f02\u8fd9\u4e24\u79cd\u65b0\u7684\u8026\u5408\u673a\u5236\uff0c\u663e\u8457\u63d0\u5347\u4e86\u635f\u5931\u51fd\u6570\u5bf9\u6210\u672c\u5c3a\u5ea6\u548c\u6781\u7aef\u6982\u7387\u503c\u7684\u9c81\u68d2\u6027\u548c\u6570\u503c\u7a33\u5b9a\u6027\u3002", "pseudocode": "def ZScoreClippedDynamicMarginLoss(cost_a, cost_b, logp_a, logp_b, beta, gamma, clip_value):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u8ba1\u7b97\u6210\u672c\u5dee\u5f02\u5e76\u8fdb\u884cZ-Score\u5f52\u4e00\u5316\n    #    \u8fd9\u4f7f\u5f97\u540e\u7eed\u8ba1\u7b97\u5bf9\u6210\u672c\u7684\u7edd\u5bf9\u5c3a\u5ea6\u4e0d\u654f\u611f\u3002\n    #    zscore\u7684\u8ba1\u7b97\u9700\u8981\u57fa\u4e8e\u4e00\u4e2a\u6279\u6b21\u5185\u7684\u7edf\u8ba1\u91cf\uff08\u5747\u503c\u548c\u6807\u51c6\u5dee\uff09\u3002\n    cost_diff = cost_l - cost_w\n    zscored_cost_diff = zscore(cost_diff)\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u57fa\u4e8e\u5f52\u4e00\u5316\u6210\u672c\u5dee\u5f02\uff0c\u8ba1\u7b97\u52a8\u6001\u88d5\u5ea6\n    #    \u88d5\u5ea6\u7684\u5927\u5c0f\u4e0e\u6210\u672c\u5dee\u5f02\u5728\u6279\u6b21\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\u6210\u6b63\u6bd4\u3002\n    dynamic_margin = beta * relu(zscored_cost_diff)\n\n    # 4. [\u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u5e76\u88c1\u526a\u5bf9\u6570\u6982\u7387\u5dee\u5f02\n    #    \u4f7f\u7528clamp\u66ff\u4ee3tanh\uff0c\u63d0\u4f9b\u786c\u8fb9\u754c\u4ee5\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u540c\u65f6\u5728\u533a\u95f4\u5185\u4fdd\u6301\u7ebf\u6027\u68af\u5ea6\u3002\n    #    (logp_w - logp_l) \u671f\u671b\u4e3a\u6b63\u3002\n    logp_diff = logp_w - logp_l\n    clipped_logp_diff = clamp(logp_diff, min=-clip_value, max=clip_value)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u81ea\u9002\u5e94\u60e9\u7f5a\u6743\u91cd\n    #    \u6210\u672c\u5dee\u5f02\u8d8a\u5927\uff0c\u6743\u91cd\u8d8a\u5927\uff0c\u5bf9\u8be5\u6837\u672c\u5bf9\u7684\u60e9\u7f5a\u4e5f\u8d8a\u91cd\u3002\n    #    \u4f7f\u7528softplus\u786e\u4fdd\u6743\u91cd\u975e\u8d1f\u4e14\u5e73\u6ed1\u3002\n    adaptive_weight = softplus(gamma * zscored_cost_diff)\n\n    # 6. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u6838\u5fc3\u7684Hinge-like\u635f\u5931\u9879\n    #    \u5f53\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6(clipped_logp_diff)\u4f4e\u4e8e\u76ee\u6807\u88d5\u5ea6(dynamic_margin)\u65f6\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    #    softplus(x) \u662f relu(x) \u7684\u5e73\u6ed1\u8fd1\u4f3c\u3002\n    hinge_term = softplus(dynamic_margin - clipped_logp_diff)\n\n    # 7. \u8ba1\u7b97\u6700\u7ec8\u7684\u52a0\u6743\u635f\u5931\n    #    \u5c06Hinge\u635f\u5931\u9879\u4e0e\u81ea\u9002\u5e94\u6743\u91cd\u76f8\u4e58\uff0c\u5b9e\u73b0\u5bf9\u91cd\u8981\u6837\u672c\u7684\u5dee\u5f02\u5316\u60e9\u7f5a\u3002\n    loss = adaptive_weight * hinge_term\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u63a7\u5236\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u8981\u6c42\u66f4\u9ad8\u7684\u6a21\u578b\u7f6e\u4fe1\u5ea6\u5dee\u8ddd\u3002"}, "gamma": {"value": 1.0, "description": "\u81ea\u9002\u5e94\u6743\u91cd\u7f29\u653e\u56e0\u5b50\u3002\u63a7\u5236\u6807\u51c6\u5316\u6210\u672c\u5dee\u5f02\u5bf9\u6700\u7ec8\u635f\u5931\u6743\u91cd\u7684\u8d21\u732e\u5ea6\u3002\u8f83\u5927\u7684gamma\u503c\u4f1a\u653e\u5927\u91cd\u8981\u6837\u672c\u5bf9\uff08\u6210\u672c\u5dee\u5f02\u5927\uff09\u5728\u603b\u635f\u5931\u4e2d\u7684\u5f71\u54cd\u3002"}, "clip_value": {"value": 5.0, "description": "\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u88c1\u526a\u8fb9\u754c\u3002\u7528\u4e8e\u9632\u6b62\u6781\u7aeflogp\u5dee\u5f02\u503c\u4e3b\u5bfc\u68af\u5ea6\uff0c\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\u3002\u8be5\u503c\u5b9a\u4e49\u4e86[min, max]\u7684\u88c1\u526a\u8303\u56f4\u3002"}}, "operators_used": ["zscore", "relu", "clamp", "softplus"], "implementation_hint": {"expects": ["Tensors cost_a, cost_b, logp_a, logp_b, all of shape (N,). Scalars beta, gamma, clip_value."], "returns": "A scalar tensor representing the mean loss over the batch. Note that the 'zscore' operator is expected to compute statistics (mean, std) over the batch dimension (N)."}}, "fitness": {"hf_like_score": 4.038100242614746, "validation_objective": 4.038100242614746, "generalization_penalty": 0.0, "generalization_objectives": {"20": 3.991642951965332}, "train_score_mean": 4.228332906961441, "train_loss_mean": 0.6928412802517414, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreClippedDynamicMarginLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u4e24\u79cd\u7236\u4ee3\u635f\u5931\u7684\u4f18\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65e2\u5bf9\u6210\u672c\u5dee\u5f02\u654f\u611f\u3001\u53c8\u5728\u6570\u503c\u4e0a\u6781\u5176\u7a33\u5b9a\u7684\u504f\u597d\u635f\u5931\u3002\u5b83\u901a\u8fc7\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u6280\u5de7\uff0c\u5bf9\u7236\u4ee3\u7684\u6838\u5fc3\u601d\u60f3\u8fdb\u884c\u4e86\u65b0\u7684\u8026\u5408\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u5176\u6838\u5fc3\u7684 `softplus(margin - term)` \u7ed3\u6784\uff0c\u8fd9\u662f\u4e00\u79cd\u5e73\u6ed1\u7684Hinge Loss\u5f62\u5f0f\u3002\u5f53\u6a21\u578b\u7684\u504f\u597d\u5f3a\u5ea6\uff08`term`\uff09\u4f4e\u4e8e\u52a8\u6001\u8bbe\u5b9a\u7684\u76ee\u6807\u88d5\u5ea6\uff08`margin`\uff09\u65f6\uff0c\u4f1a\u4ea7\u751f\u60e9\u7f5a\u3002\u8fd9\u79cd\u7ed3\u6784\u7b80\u5355\u6709\u6548\uff0c\u6613\u4e8e\u89e3\u91ca\u3002\n2.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u201c\u81ea\u9002\u5e94\u60e9\u7f5a\u6743\u91cd\u201d\u7684\u6838\u5fc3\u601d\u60f3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u635f\u5931\u7684\u5927\u5c0f\u4e0d\u4ec5\u53d6\u51b3\u4e8e\u6a21\u578b\u504f\u597d\u4e0e\u76ee\u6807\u88d5\u5ea6\u7684\u5dee\u8ddd\uff0c\u8fd8\u88ab\u4e00\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u6743\u91cd\u9879 `adaptive_weight` \u6240\u8c03\u5236\u3002\u8fd9\u4f7f\u5f97\u635f\u5931\u51fd\u6570\u80fd\u591f\u5bf9\u533a\u5206\u5ea6\u66f4\u660e\u663e\u7684\u6837\u672c\u5bf9\uff08\u5373\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\uff09\u65bd\u52a0\u66f4\u5927\u7684\u5b66\u4e60\u538b\u529b\uff0c\u4ece\u800c\u66f4\u667a\u80fd\u5730\u5206\u914d\u68af\u5ea6\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u4e3a\u4e86\u589e\u5f3a\u5bf9\u6210\u672c\u5206\u5e03\u7684\u9c81\u68d2\u6027\uff0c\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `rank_gap`\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore(cost_diff)`\u3002`zscore`\u901a\u8fc7\u51cf\u53bb\u5747\u503c\u5e76\u9664\u4ee5\u6807\u51c6\u5dee\uff0c\u5c06\u539f\u59cb\u7684\u6210\u672c\u5dee\u5f02 `(cost_l - cost_w)` \u8f6c\u6362\u5230\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u7a7a\u95f4\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c`dynamic_margin` \u548c `adaptive_weight` \u7684\u8ba1\u7b97\u4e0d\u518d\u53d7\u6210\u672c\u7edd\u5bf9\u503c\u5927\u5c0f\u7684\u5f71\u54cd\uff0c\u800c\u662f\u53d6\u51b3\u4e8e\u8be5\u6210\u672c\u5dee\u5f02\u5728\u5176\u6240\u5728\u6279\u6b21\uff08batch\uff09\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002\u8fd9\u4f7f\u5f97\u8d85\u53c2\u6570 `beta` \u548c `gamma` \u7684\u9009\u62e9\u66f4\u52a0\u901a\u7528\uff0c\u4e0d\u6613\u53d7\u5230\u4e0d\u540c\u4efb\u52a1\u6216\u4e0d\u540c\u6279\u6b21\u6210\u672c\u5c3a\u5ea6\u5267\u70c8\u53d8\u5316\u7684\u5f71\u54cd\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Clipped LogP\u5dee\u5f02)**\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\uff0c\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `tanh` \u6765\u538b\u7f29\u5bf9\u6570\u6982\u7387\u5dee\u5f02\uff0c\u800c\u662f\u91c7\u7528\u4e86 `clamp(logp_w - logp_l, min=-clip_value, max=clip_value)`\u3002`clamp` \u7b97\u5b50\u521b\u5efa\u4e86\u4e00\u4e2a\u786c\u8fb9\u754c\uff0c\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u6781\u7aef\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u5bfc\u81f4\u7684\u68af\u5ea6\u6d88\u5931\uff08\u5728 `tanh` \u7684\u9971\u548c\u533a\uff09\u6216\u6f5c\u5728\u7684\u6570\u503c\u4e0d\u7a33\u5b9a\u95ee\u9898\u3002\u4e0e `tanh` \u76f8\u6bd4\uff0c`clamp` \u5728 `[-clip_value, clip_value]` \u533a\u95f4\u5185\u4fdd\u6301\u4e86\u7ebf\u6027\u7684\u68af\u5ea6\u6d41\uff0c\u8fd9\u53ef\u80fd\u6709\u52a9\u4e8e\u5728\u6a21\u578b\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\u65f6\u8fdb\u884c\u66f4\u6709\u6548\u7684\u5b66\u4e60\u3002\u540c\u65f6\uff0c\u5b83\u4e5f\u907f\u514d\u4e86\u6781\u7aef\u6837\u672c\u5bf9\uff08\u6a21\u578b\u5bf9\u5176\u504f\u597d\u5224\u65ad\u6781\u5ea6\u81ea\u4fe1\u6216\u9519\u8bef\uff09\u4e0d\u6210\u6bd4\u4f8b\u5730\u4e3b\u5bfc\u6574\u4e2a\u6279\u6b21\u7684\u68af\u5ea6\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreClippedDynamicMarginLoss` \u7ee7\u627f\u4e86\u7236\u4ee3\u4e2d\u6709\u6548\u7684Hinge Loss\u7ed3\u6784\u548c\u81ea\u9002\u5e94\u60e9\u7f5a\u601d\u60f3\uff0c\u5e76\u901a\u8fc7\u5f15\u5165Z-Score\u5f52\u4e00\u5316\u548cClipped LogP\u5dee\u5f02\u8fd9\u4e24\u79cd\u65b0\u7684\u8026\u5408\u673a\u5236\uff0c\u663e\u8457\u63d0\u5347\u4e86\u635f\u5931\u51fd\u6570\u5bf9\u6210\u672c\u5c3a\u5ea6\u548c\u6781\u7aef\u6982\u7387\u503c\u7684\u9c81\u68d2\u6027\u548c\u6570\u503c\u7a33\u5b9a\u6027\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u52a8\u6001\u88d5\u5ea6\u7f29\u653e\u56e0\u5b50\u3002\u63a7\u5236\u6807\u51c6\u5316\u7684\u6210\u672c\u5dee\u5f02\u8f6c\u6362\u4e3a\u76ee\u6807\u88d5\u5ea6\u7684\u7a0b\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u6837\u672c\u5bf9\u8981\u6c42\u66f4\u9ad8\u7684\u6a21\u578b\u7f6e\u4fe1\u5ea6\u5dee\u8ddd\u3002"}, "gamma": {"value": 1.0, "description": "\u81ea\u9002\u5e94\u6743\u91cd\u7f29\u653e\u56e0\u5b50\u3002\u63a7\u5236\u6807\u51c6\u5316\u6210\u672c\u5dee\u5f02\u5bf9\u6700\u7ec8\u635f\u5931\u6743\u91cd\u7684\u8d21\u732e\u5ea6\u3002\u8f83\u5927\u7684gamma\u503c\u4f1a\u653e\u5927\u91cd\u8981\u6837\u672c\u5bf9\uff08\u6210\u672c\u5dee\u5f02\u5927\uff09\u5728\u603b\u635f\u5931\u4e2d\u7684\u5f71\u54cd\u3002"}, "clip_value": {"value": 5.0, "description": "\u5bf9\u6570\u6982\u7387\u5dee\u5f02\u7684\u88c1\u526a\u8fb9\u754c\u3002\u7528\u4e8e\u9632\u6b62\u6781\u7aeflogp\u5dee\u5f02\u503c\u4e3b\u5bfc\u68af\u5ea6\uff0c\u589e\u5f3a\u6570\u503c\u7a33\u5b9a\u6027\u3002\u8be5\u503c\u5b9a\u4e49\u4e86[min, max]\u7684\u88c1\u526a\u8303\u56f4\u3002"}}, "operators_used": ["zscore", "relu", "clamp", "softplus"]}}}
{"generation": 9, "index": 7, "ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u673a\u5236\uff0c\u521b\u9020\u4e00\u4e2a\u5bf9\u6210\u672c\u5206\u5e03\u548c\u6a21\u578b\u7f6e\u4fe1\u5ea6\u90fd\u975e\u5e38\u654f\u611f\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u601d\u60f3\u3002\u8fd9\u610f\u5473\u7740\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `target_margin`\uff0c\u4ee5\u53ca\u4e00\u4e2a\u7528\u4e8e\u52a0\u6743\u6a21\u578b\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u7684\u7f29\u653e\u56e0\u5b50 `confidence_scale`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u91cd\u8981\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `softplus(margin_gap)` \u8fd9\u79cd\u5e73\u6ed1\u7684Hinge\u635f\u5931\u7ed3\u6784\u3002\u8fd9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6e05\u6670\u7684\u60e9\u7f5a\u673a\u5236\uff1a\u53ea\u6709\u5f53\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u672a\u80fd\u8fbe\u5230\u76ee\u6807\u88d5\u5ea6\u65f6\uff0c\u624d\u4f1a\u4ea7\u751f\u635f\u5931\u3002`softplus` \u4f5c\u4e3a `relu` \u7684\u5e73\u6ed1\u8fd1\u4f3c\uff0c\u4fdd\u8bc1\u4e86\u635f\u5931\u51fd\u6570\u5904\u5904\u53ef\u5bfc\uff0c\u6709\u5229\u4e8e\u68af\u5ea6\u4f18\u5316\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee3\u4e00\u6837\u4f7f\u7528 `rank_gap` \u6765\u8861\u91cf\u6210\u672c\u5dee\u5f02\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u3002`zscore(cost_w, cost_l)` \u4f1a\u8ba1\u7b97\u5728\u5f53\u524d\u6279\u6b21(batch)\u4e2d\uff0c\u80dc\u8005\u548c\u8d25\u8005\u7684\u6210\u672c\u76f8\u5bf9\u4e8e\u6279\u6b21\u5747\u503c\u548c\u6807\u51c6\u5dee\u7684\u4f4d\u7f6e\u3002\u5176\u5dee\u503c `cost_z_diff` \u4e0d\u4ec5\u53cd\u6620\u4e86\u4e8c\u8005\u7684\u76f8\u5bf9\u4f18\u52a3\uff0c\u8fd8\u5305\u542b\u4e86\u5b83\u4eec\u5728\u6574\u4e2a\u6279\u6b21\u6210\u672c\u5206\u5e03\u4e2d\u7684\u663e\u8457\u6027\u4fe1\u606f\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u6210\u672c\u6781\u4f4e\uff08z-score\u4e3a\u8d1f\uff09\u7684\u80dc\u8005\u548c\u4e00\u4e2a\u6210\u672c\u6781\u9ad8\uff08z-score\u4e3a\u6b63\uff09\u7684\u8d25\u8005\uff0c\u5176 `cost_z_diff` \u4f1a\u975e\u5e38\u5927\uff0c\u8868\u660e\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u201c\u660e\u786e\u201d\u7684\u504f\u597d\u5bf9\uff0c\u5e94\u8be5\u53d7\u5230\u66f4\u591a\u5173\u6ce8\u3002\u8fd9\u79cd\u65b9\u5f0f\u5c06\u88d5\u5ea6\u7684\u8bbe\u5b9a\u4e0e\u6574\u4e2a\u6279\u6b21\u7684\u7edf\u8ba1\u7279\u6027\u52a8\u6001\u5730\u8026\u5408\u8d77\u6765\uff0c\u4f7f\u5176\u5bf9\u6210\u672c\u7684\u5168\u5c40\u5206\u5e03\u66f4\u52a0\u654f\u611f\u548c\u81ea\u9002\u5e94\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Softplus\u9971\u548c\u7f29\u653e)**\uff1a\u4e3a\u4e86\u7a33\u5b9a\u6a21\u578b\u7f6e\u4fe1\u5ea6 `(logp_w - logp_l)`\uff0c\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `tanh` \u5c06\u5176\u5f3a\u5236\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u800c\u662f\u5f15\u5165\u4e86 `softplus` \u8fdb\u884c\u975e\u5bf9\u79f0\u7684\u9971\u548c\u5904\u7406\u3002\u6211\u4eec\u8ba1\u7b97 `softplus(logp_w - logp_l)`\u3002`softplus` \u51fd\u6570\u6709\u4e00\u4e2a\u7279\u6027\uff1a\u5f53\u8f93\u5165\u4e3a\u6b63\u6570\u65f6\uff0c\u5b83\u8fd1\u4f3c\u4e8e\u7ebf\u6027\u589e\u957f\uff1b\u5f53\u8f93\u5165\u4e3a\u8d1f\u6570\uff08\u5373\u6a21\u578b\u9884\u6d4b\u9519\u8bef\uff09\u65f6\uff0c\u5b83\u4f1a\u8fc5\u901f\u8d8b\u8fd1\u4e8e0\u3002\u8fd9\u5e26\u6765\u4e86\u4e00\u4e2a\u7406\u60f3\u7684\u6548\u679c\uff1a\u5bf9\u4e8e\u6a21\u578b\u5df2\u7ecf\u6b63\u786e\u9884\u6d4b\u7684\u504f\u597d\uff08`logp_w > logp_l`\uff09\uff0c\u6211\u4eec\u5141\u8bb8\u5176\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u7ee7\u7eed\u589e\u957f\uff0c\u4ece\u800c\u66f4\u7cbe\u786e\u5730\u5efa\u6a21\uff1b\u800c\u5bf9\u4e8e\u6a21\u578b\u9884\u6d4b\u9519\u8bef\u7684\u504f\u597d\uff0c`softplus` \u4f1a\u5c06\u5176\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u201c\u538b\u5e73\u201d\u5230\u63a5\u8fd10\uff0c\u8fd9\u53ef\u4ee5\u9632\u6b62\u9519\u8bef\u7684\u3001\u8fc7\u5927\u7684\u8d1f\u68af\u5ea6\u4e3b\u5bfc\u8bad\u7ec3\u8fc7\u7a0b\uff0c\u4ece\u800c\u8d77\u5230\u7a33\u5b9a\u68af\u5ea6\u7684\u4f5c\u7528\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreNormalizedHybridLoss` \u901a\u8fc7z-score\u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6279\u6b21\u5185\u6210\u672c\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u901a\u8fc7softplus\u9971\u548c\u5904\u7406\u7a33\u5b9a\u4e86\u6a21\u578b\u7f6e\u4fe1\u5ea6\u7684\u68af\u5ea6\uff0c\u540c\u65f6\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u6df7\u5408\u88d5\u5ea6\u6846\u67b6\u548c\u5e73\u6ed1Hinge\u635f\u5931\u7ed3\u6784\uff0c\u65e8\u5728\u5b9e\u73b0\u4e00\u4e2a\u65e2\u9c81\u68d2\u53c8\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u76ee\u6807\u3002", "pseudocode": "def ZScoreNormalizedHybridLoss(cost_a, cost_b, logp_a, logp_b, beta):\n    # 1. \u8bc6\u522b\u4f18\u80dc\u8005(winner)\u548c\u5931\u8d25\u8005(loser)\n    #    \u786e\u4fdd cost_w < cost_l\n    if cost_a < cost_b:\n        cost_w, cost_l = cost_a, cost_b\n        logp_w, logp_l = logp_a, logp_b\n    else:\n        cost_w, cost_l = cost_b, cost_a\n        logp_w, logp_l = logp_b, logp_a\n\n    # 2. [\u65b0\u8026\u5408\u70b91] \u57fa\u4e8eZ-Score\u8ba1\u7b97\u6210\u672c\u5dee\u5f02\n    #    zscore() \u5728\u6279\u6b21(batch)\u7ef4\u5ea6\u4e0a\u8ba1\u7b97\u6210\u672c\u7684\u5747\u503c\u548c\u6807\u51c6\u5dee\uff0c\u5e76\u8fdb\u884c\u5f52\u4e00\u5316\u3002\n    #    cost_z_diff \u53cd\u6620\u4e86\u80dc\u8005\u548c\u8d25\u8005\u5728\u6279\u6b21\u6210\u672c\u5206\u5e03\u4e2d\u7684\u76f8\u5bf9\u5206\u79bb\u7a0b\u5ea6\u3002\n    #    \u671f\u671b cost_z_w < cost_z_l, \u56e0\u6b64 cost_z_diff < 0\u3002\u6211\u4eec\u53d6\u5176\u76f8\u53cd\u6570\u5f97\u5230\u6b63\u503c\u3002\n    z_w = zscore(cost_w)\n    z_l = zscore(cost_l)\n    cost_z_diff = -(z_w - z_l) # \u786e\u4fdd\u4e3a\u6b63\u503c\n\n    # 3. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8bbe\u8ba1\u6df7\u5408\u88d5\u5ea6\u9879\n    #    \u76ee\u6807\u88d5\u5ea6\u548c\u7f6e\u4fe1\u5ea6\u7f29\u653e\u56e0\u5b50\u90fd\u4e0e\u6210\u672c\u7684z-score\u5dee\u5f02\u7ebf\u6027\u76f8\u5173\u3002\n    target_margin = beta * cost_z_diff\n    confidence_scale = beta * cost_z_diff\n\n    # 4. [\u65b0\u8026\u5408\u70b92] \u8ba1\u7b97\u5e76\u7a33\u5b9a\u5316\u6a21\u578b\u7f6e\u4fe1\u5ea6\u5dee\u5f02\n    #    \u4f7f\u7528 softplus \u66ff\u4ee3 tanh\u3002\u5f53 logp_w > logp_l \u65f6\uff0c\u5b83\u8fd1\u4f3c\u7ebf\u6027\u589e\u957f\uff1b\n    #    \u5f53 logp_w < logp_l \u65f6\uff0c\u5b83\u8d8b\u8fd1\u4e8e0\uff0c\u53ef\u4ee5\u9632\u6b62\u8fc7\u5927\u7684\u8d1f\u68af\u5ea6\uff0c\u8d77\u5230\u7a33\u5b9a\u4f5c\u7528\u3002\n    logp_diff = logp_w - logp_l\n    stable_confidence = softplus(logp_diff)\n\n    # 5. [\u7ee7\u627f\u81ea\u7236\u4ee31] \u8ba1\u7b97\u88ab\u6210\u672c\u5dee\u5f02\u52a0\u6743\u7684\u7f6e\u4fe1\u5ea6\n    #    \u8fd9\u662f\u6df7\u5408\u88d5\u5ea6\u601d\u60f3\u7684\u4f53\u73b0\uff0c\u91cd\u8981\u7684\u6837\u672c\u5bf9\uff08cost_z_diff\u5927\uff09\u5176\u7f6e\u4fe1\u5ea6\u4f1a\u88ab\u653e\u5927\u3002\n    scaled_confidence = confidence_scale * stable_confidence\n\n    # 6. \u8ba1\u7b97\u88d5\u5ea6\u7f3a\u53e3 (Margin Gap)\n    #    \u8861\u91cf\u4e86\u52a0\u6743\u540e\u7684\u6a21\u578b\u7f6e\u4fe1\u5ea6\u4e0e\u76ee\u6807\u88d5\u5ea6\u4e4b\u95f4\u7684\u5dee\u8ddd\u3002\n    #    \u6211\u4eec\u671f\u671b scaled_confidence >= target_margin\u3002\n    margin_gap = target_margin - scaled_confidence\n\n    # 7. [\u7ee7\u627f\u81ea\u7236\u4ee30] \u8ba1\u7b97\u6700\u7ec8\u7684\u5e73\u6ed1Hinge\u635f\u5931\n    #    \u5f53 scaled_confidence < target_margin \u65f6 (margin_gap > 0)\uff0c\u4ea7\u751f\u60e9\u7f5a\u3002\n    #    softplus(x) \u662f relu(x) \u7684\u5e73\u6ed1\u8fd1\u4f3c\uff0c\u4fdd\u8bc1\u4e86\u635f\u5931\u5904\u5904\u53ef\u5bfc\u3002\n    loss = softplus(margin_gap)\n\n    return loss", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u7edf\u4e00\u7cfb\u6570\u3002\u5b83\u63a7\u5236\u4e86\u6210\u672c\u7684z-score\u5dee\u5f02\u8f6c\u5316\u4e3a\u76ee\u6807\u88d5\u5ea6\u548c\u7f6e\u4fe1\u5ea6\u6743\u91cd\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5206\u5e03\u4e2d\u5206\u79bb\u5ea6\u9ad8\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u3002"}}, "operators_used": ["zscore", "softplus"], "implementation_hint": {"expects": ["cost_a, cost_b, logp_a, logp_b: Tensors of shape (B,), where B is the batch size. The zscore operator is expected to compute statistics over this batch dimension."], "returns": "A scalar Tensor representing the mean loss over the batch."}}, "fitness": {"hf_like_score": 4.100567579269409, "validation_objective": 4.100567579269409, "generalization_penalty": 0.0, "generalization_objectives": {"20": 4.046774864196777}, "train_score_mean": 4.244085565209389, "train_loss_mean": 0.6928507909178734, "config": {"hf": {"problem": "tsp", "hf_steps": 32, "train_problem_size": 20, "valid_problem_sizes": [20], "train_batch_size": 64, "pomo_size": 64, "learning_rate": 0.0003, "weight_decay": 1e-06, "alpha": 0.05, "device": "cuda", "seed": 1234, "num_validation_episodes": 128, "validation_batch_size": 64, "generalization_penalty_weight": 1.0, "pool_version": "v0"}, "free_loss": {"f1_steps": 32, "f2_steps": 100, "f3_enabled": false}}, "loss_ir": {"name": "ZScoreNormalizedHybridLoss", "intuition": "\u8be5\u635f\u5931\u51fd\u6570\u65e8\u5728\u7ed3\u5408\u7236\u4ee3\u635f\u5931\u7684\u9c81\u68d2\u6027\u548c\u81ea\u9002\u5e94\u6027\uff0c\u5e76\u5f15\u5165\u65b0\u7684\u5f52\u4e00\u5316\u548c\u7a33\u5b9a\u5316\u673a\u5236\uff0c\u521b\u9020\u4e00\u4e2a\u5bf9\u6210\u672c\u5206\u5e03\u548c\u6a21\u578b\u7f6e\u4fe1\u5ea6\u90fd\u975e\u5e38\u654f\u611f\u7684\u504f\u597d\u635f\u5931\u3002\n\n**\u7ee7\u627f\u70b9**\uff1a\n1.  **\u7ee7\u627f\u81ea `AdaptiveSigmoidHingeLoss` (\u7236\u4ee31)**\uff1a\u91c7\u7eb3\u4e86\u5176\u6838\u5fc3\u7684\u201c\u6df7\u5408\u88d5\u5ea6 (Hybrid Margin)\u201d\u601d\u60f3\u3002\u8fd9\u610f\u5473\u7740\u635f\u5931\u7684\u8ba1\u7b97\u540c\u65f6\u5305\u542b\u4e86\u4e24\u4e2a\u4e0e\u6210\u672c\u5dee\u5f02\u76f8\u5173\u7684\u9879\uff1a\u4e00\u4e2a\u660e\u786e\u7684\u76ee\u6807\u88d5\u5ea6 `target_margin`\uff0c\u4ee5\u53ca\u4e00\u4e2a\u7528\u4e8e\u52a0\u6743\u6a21\u578b\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u7684\u7f29\u653e\u56e0\u5b50 `confidence_scale`\u3002\u8fd9\u79cd\u201c\u53cc\u91cd\u201d\u5f3a\u8c03\u6210\u672c\u5dee\u5f02\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u6a21\u578b\u5bf9\u6210\u672c\u5dee\u5f02\u5927\u7684\u91cd\u8981\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\u3002\n2.  **\u7ee7\u627f\u81ea `RankGapScaledHingeLoss` (\u7236\u4ee30)**\uff1a\u4fdd\u7559\u4e86\u4f7f\u7528 `softplus(margin_gap)` \u8fd9\u79cd\u5e73\u6ed1\u7684Hinge\u635f\u5931\u7ed3\u6784\u3002\u8fd9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6e05\u6670\u7684\u60e9\u7f5a\u673a\u5236\uff1a\u53ea\u6709\u5f53\u6a21\u578b\u7684\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u672a\u80fd\u8fbe\u5230\u76ee\u6807\u88d5\u5ea6\u65f6\uff0c\u624d\u4f1a\u4ea7\u751f\u635f\u5931\u3002`softplus` \u4f5c\u4e3a `relu` \u7684\u5e73\u6ed1\u8fd1\u4f3c\uff0c\u4fdd\u8bc1\u4e86\u635f\u5931\u51fd\u6570\u5904\u5904\u53ef\u5bfc\uff0c\u6709\u5229\u4e8e\u68af\u5ea6\u4f18\u5316\u3002\n\n**\u65b0\u7684\u8026\u5408\u4e0e\u6539\u52a8**\uff1a\n1.  **\u65b0\u7684\u8026\u5408\u70b91 (Z-Score\u5f52\u4e00\u5316)**\uff1a\u6211\u4eec\u6ca1\u6709\u50cf\u7236\u4ee3\u4e00\u6837\u4f7f\u7528 `rank_gap` \u6765\u8861\u91cf\u6210\u672c\u5dee\u5f02\uff0c\u800c\u662f\u5f15\u5165\u4e86 `zscore` \u5f52\u4e00\u5316\u3002`zscore(cost_w, cost_l)` \u4f1a\u8ba1\u7b97\u5728\u5f53\u524d\u6279\u6b21(batch)\u4e2d\uff0c\u80dc\u8005\u548c\u8d25\u8005\u7684\u6210\u672c\u76f8\u5bf9\u4e8e\u6279\u6b21\u5747\u503c\u548c\u6807\u51c6\u5dee\u7684\u4f4d\u7f6e\u3002\u5176\u5dee\u503c `cost_z_diff` \u4e0d\u4ec5\u53cd\u6620\u4e86\u4e8c\u8005\u7684\u76f8\u5bf9\u4f18\u52a3\uff0c\u8fd8\u5305\u542b\u4e86\u5b83\u4eec\u5728\u6574\u4e2a\u6279\u6b21\u6210\u672c\u5206\u5e03\u4e2d\u7684\u663e\u8457\u6027\u4fe1\u606f\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u6210\u672c\u6781\u4f4e\uff08z-score\u4e3a\u8d1f\uff09\u7684\u80dc\u8005\u548c\u4e00\u4e2a\u6210\u672c\u6781\u9ad8\uff08z-score\u4e3a\u6b63\uff09\u7684\u8d25\u8005\uff0c\u5176 `cost_z_diff` \u4f1a\u975e\u5e38\u5927\uff0c\u8868\u660e\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u201c\u660e\u786e\u201d\u7684\u504f\u597d\u5bf9\uff0c\u5e94\u8be5\u53d7\u5230\u66f4\u591a\u5173\u6ce8\u3002\u8fd9\u79cd\u65b9\u5f0f\u5c06\u88d5\u5ea6\u7684\u8bbe\u5b9a\u4e0e\u6574\u4e2a\u6279\u6b21\u7684\u7edf\u8ba1\u7279\u6027\u52a8\u6001\u5730\u8026\u5408\u8d77\u6765\uff0c\u4f7f\u5176\u5bf9\u6210\u672c\u7684\u5168\u5c40\u5206\u5e03\u66f4\u52a0\u654f\u611f\u548c\u81ea\u9002\u5e94\u3002\n2.  **\u65b0\u7684\u8026\u5408\u70b92 (Softplus\u9971\u548c\u7f29\u653e)**\uff1a\u4e3a\u4e86\u7a33\u5b9a\u6a21\u578b\u7f6e\u4fe1\u5ea6 `(logp_w - logp_l)`\uff0c\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u7236\u4ee3\u4e2d\u7684 `tanh` \u5c06\u5176\u5f3a\u5236\u538b\u7f29\u5230 `[-1, 1]` \u533a\u95f4\uff0c\u800c\u662f\u5f15\u5165\u4e86 `softplus` \u8fdb\u884c\u975e\u5bf9\u79f0\u7684\u9971\u548c\u5904\u7406\u3002\u6211\u4eec\u8ba1\u7b97 `softplus(logp_w - logp_l)`\u3002`softplus` \u51fd\u6570\u6709\u4e00\u4e2a\u7279\u6027\uff1a\u5f53\u8f93\u5165\u4e3a\u6b63\u6570\u65f6\uff0c\u5b83\u8fd1\u4f3c\u4e8e\u7ebf\u6027\u589e\u957f\uff1b\u5f53\u8f93\u5165\u4e3a\u8d1f\u6570\uff08\u5373\u6a21\u578b\u9884\u6d4b\u9519\u8bef\uff09\u65f6\uff0c\u5b83\u4f1a\u8fc5\u901f\u8d8b\u8fd1\u4e8e0\u3002\u8fd9\u5e26\u6765\u4e86\u4e00\u4e2a\u7406\u60f3\u7684\u6548\u679c\uff1a\u5bf9\u4e8e\u6a21\u578b\u5df2\u7ecf\u6b63\u786e\u9884\u6d4b\u7684\u504f\u597d\uff08`logp_w > logp_l`\uff09\uff0c\u6211\u4eec\u5141\u8bb8\u5176\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u7ee7\u7eed\u589e\u957f\uff0c\u4ece\u800c\u66f4\u7cbe\u786e\u5730\u5efa\u6a21\uff1b\u800c\u5bf9\u4e8e\u6a21\u578b\u9884\u6d4b\u9519\u8bef\u7684\u504f\u597d\uff0c`softplus` \u4f1a\u5c06\u5176\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u201c\u538b\u5e73\u201d\u5230\u63a5\u8fd10\uff0c\u8fd9\u53ef\u4ee5\u9632\u6b62\u9519\u8bef\u7684\u3001\u8fc7\u5927\u7684\u8d1f\u68af\u5ea6\u4e3b\u5bfc\u8bad\u7ec3\u8fc7\u7a0b\uff0c\u4ece\u800c\u8d77\u5230\u7a33\u5b9a\u68af\u5ea6\u7684\u4f5c\u7528\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c`ZScoreNormalizedHybridLoss` \u901a\u8fc7z-score\u5f52\u4e00\u5316\u5b9e\u73b0\u4e86\u5bf9\u6279\u6b21\u5185\u6210\u672c\u5206\u5e03\u7684\u81ea\u9002\u5e94\uff0c\u901a\u8fc7softplus\u9971\u548c\u5904\u7406\u7a33\u5b9a\u4e86\u6a21\u578b\u7f6e\u4fe1\u5ea6\u7684\u68af\u5ea6\uff0c\u540c\u65f6\u7ee7\u627f\u4e86\u7236\u4ee3\u7684\u6df7\u5408\u88d5\u5ea6\u6846\u67b6\u548c\u5e73\u6ed1Hinge\u635f\u5931\u7ed3\u6784\uff0c\u65e8\u5728\u5b9e\u73b0\u4e00\u4e2a\u65e2\u9c81\u68d2\u53c8\u9ad8\u6548\u7684\u504f\u597d\u5b66\u4e60\u76ee\u6807\u3002", "hyperparams": {"beta": {"value": 1.0, "description": "\u88d5\u5ea6\u548c\u7f29\u653e\u56e0\u5b50\u7684\u7edf\u4e00\u7cfb\u6570\u3002\u5b83\u63a7\u5236\u4e86\u6210\u672c\u7684z-score\u5dee\u5f02\u8f6c\u5316\u4e3a\u76ee\u6807\u88d5\u5ea6\u548c\u7f6e\u4fe1\u5ea6\u6743\u91cd\u7684\u654f\u611f\u5ea6\u3002\u8f83\u5927\u7684beta\u503c\u610f\u5473\u7740\u5bf9\u6210\u672c\u5206\u5e03\u4e2d\u5206\u79bb\u5ea6\u9ad8\u7684\u6837\u672c\u5bf9\u65bd\u52a0\u66f4\u5f3a\u7684\u5b66\u4e60\u538b\u529b\uff0c\u8981\u6c42\u6a21\u578b\u4ea7\u751f\u66f4\u5927\u7684\u7f6e\u4fe1\u5ea6\u5dee\u5f02\u3002"}}, "operators_used": ["zscore", "softplus"]}}}
